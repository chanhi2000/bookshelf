<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다","image":["https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png"],"datePublished":"2024-04-02T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/meetup.nhncloud.com/379.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다"><meta property="og:description" content="Article(s) > Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다"><meta property="og:type" content="article"><meta property="og:image" content="https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png"><meta property="og:locale" content="ko-KR"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png"><meta name="twitter:image:alt" content="Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다"><meta property="article:tag" content="redis"><meta property="article:tag" content="spring-boot"><meta property="article:tag" content="spring"><meta property="article:tag" content="jdk"><meta property="article:tag" content="java"><meta property="article:tag" content="meetup.nhncloud.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2024-04-02T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다 | 📚Bookshelf</title><meta name="description" content="Article(s) > Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://meetup.nhncloud.com/resources/img/favicon.ico" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">meetup.nhncloud.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/38.html" aria-label="em1, p2p1 같은 이더넷 이름을 변경하기"><!--[--><i class="vp-icon fa-brands fa-ubuntu" sizing="both"></i><!--]-->em1, p2p1 같은 이더넷 이름을 변경하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/39.html" aria-label="git squash - 여러개의 커밋로그를 하나로 묶기"><!--[--><i class="vp-icon iconfont icon-git" sizing="both"></i><!--]-->git squash - 여러개의 커밋로그를 하나로 묶기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/43.html" aria-label="Objective-C Generics"><!--[--><i class="vp-icon iconfont icon-objective-c" sizing="both"></i><!--]-->Objective-C Generics<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/44.html" aria-label="Spring Interceptor(혹은 Servlet Filter)에서 POST 방식으로 전달된 JSON 데이터 처리하기"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->Spring Interceptor(혹은 Servlet Filter)에서 POST 방식으로 전달된 JSON 데이터 처리하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/45.html" aria-label="git cherry-pick: 다른 브랜치의 일부 커밋만 반영하고 싶을 때"><!--[--><i class="vp-icon iconfont icon-git" sizing="both"></i><!--]-->git cherry-pick: 다른 브랜치의 일부 커밋만 반영하고 싶을 때<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/46.html" aria-label="Spring 3.2.3에서 3.2.14로 업그레이드 정리(스프링 XML 입력에 의한 서비스 거부 취약점 대응)"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->Spring 3.2.3에서 3.2.14로 업그레이드 정리(스프링 XML 입력에 의한 서비스 거부 취약점 대응)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/47.html" aria-label="Java Exception 생성 비용은 비싸다."><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->Java Exception 생성 비용은 비싸다.<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/53.html" aria-label="리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 1편"><!--[--><i class="vp-icon iconfont icon-shell" sizing="both"></i><!--]-->리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 1편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/54.html" aria-label="리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 2편"><!--[--><i class="vp-icon iconfont icon-shell" sizing="both"></i><!--]-->리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 2편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/55.html" aria-label="리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 3편"><!--[--><i class="vp-icon iconfont icon-shell" sizing="both"></i><!--]-->리눅스 서버의 TCP 네트워크 성능을 결정짓는 커널 파라미터 이야기 - 3편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/58.html" aria-label="Apache Cassandra 톺아보기 - 1편"><!--[--><i class="vp-icon iconfont icon-apachecassandra" sizing="both"></i><!--]-->Apache Cassandra 톺아보기 - 1편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/60.html" aria-label="Apache Cassandra 톺아보기 - 2편"><!--[--><i class="vp-icon iconfont icon-apachecassandra" sizing="both"></i><!--]-->Apache Cassandra 톺아보기 - 2편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/65.html" aria-label="Apache Cassandra 톺아보기 - 3편"><!--[--><i class="vp-icon iconfont icon-apachecassandra" sizing="both"></i><!--]-->Apache Cassandra 톺아보기 - 3편<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/73.html" aria-label="ES6의 제너레이터를 사용한 비동기 프로그래밍"><!--[--><i class="vp-icon fa-brands fa-node" sizing="both"></i><!--]-->ES6의 제너레이터를 사용한 비동기 프로그래밍<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/80.html" aria-label="CodeSnippet과 함께하는 JavaScript 프로그래밍"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->CodeSnippet과 함께하는 JavaScript 프로그래밍<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/85.html" aria-label="지금 바로 시작하는 ES6"><!--[--><i class="vp-icon fa-brands fa-node" sizing="both"></i><!--]-->지금 바로 시작하는 ES6<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/251.html" aria-label="캐시 성능 향상기 (Improving Cache Speed at Scale)"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->캐시 성능 향상기 (Improving Cache Speed at Scale)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/283.html" aria-label="VSCode의 Jupyter Extension을 사용하여 간단하게 Python으로 데이터 시각화하기"><!--[--><i class="vp-icon iconfont icon-vscode" sizing="both"></i><!--]-->VSCode의 Jupyter Extension을 사용하여 간단하게 Python으로 데이터 시각화하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/293.html" aria-label="Chromium이 발표한 RenderingNG가 무엇인가?"><!--[--><i class="vp-icon fa-brands fa-chrome" sizing="both"></i><!--]-->Chromium이 발표한 RenderingNG가 무엇인가?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/311.html" aria-label="가볍게 살펴보는 새로운 한/글 파일 포맷 HWPX"><!--[--><i class="vp-icon fa-brands fa-html5" sizing="both"></i><!--]-->가볍게 살펴보는 새로운 한/글 파일 포맷 HWPX<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/371.html" aria-label="PLT Hook 체크를 위한 Android so 파일 파싱"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->PLT Hook 체크를 위한 Android so 파일 파싱<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/374.html" aria-label="Java Reactor onErrorContinue 이모저모"><!--[--><i class="vp-icon iconfont icon-springboot" sizing="both"></i><!--]-->Java Reactor onErrorContinue 이모저모<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/375.html" aria-label="이상 탐지 4부-딥 러닝으로 이상 탐지하기"><!--[--><i class="vp-icon fas fa-brain" sizing="both"></i><!--]-->이상 탐지 4부-딥 러닝으로 이상 탐지하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/376.html" aria-label="Firmware Command Injection을 알아보자!"><!--[--><i class="vp-icon iconfont icon-c" sizing="both"></i><!--]-->Firmware Command Injection을 알아보자!<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/377.html" aria-label="메시징플랫폼개발팀의 브랜칭 전략은? Release Flow!"><!--[--><i class="vp-icon iconfont icon-git" sizing="both"></i><!--]-->메시징플랫폼개발팀의 브랜칭 전략은? Release Flow!<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/378.html" aria-label="디스어셈블 프레임워크 Capstone-engine 활용하기"><!--[--><i class="vp-icon fa-brands fa-python" sizing="both"></i><!--]-->디스어셈블 프레임워크 Capstone-engine 활용하기<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/meetup.nhncloud.com/379.html" aria-label="Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다"><!--[--><i class="vp-icon iconfont icon-springboot" sizing="both"></i><!--]-->Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/meetup.nhncloud.com/381.html" aria-label="보이스피싱 애플리케이션 분석 1부"><!--[--><i class="vp-icon fas fa-shield-halved" sizing="both"></i><!--]-->보이스피싱 애플리케이션 분석 1부<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-springboot" sizing="height"></i>Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">24. 4. 2.</span><meta property="datePublished" content="2024-04-02T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 3 min</span><meta property="timeRequired" content="PT3M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8" role>Java</span><span class="page-category-item color1" role>Spring</span><span class="page-category-item color2" role>Spring Boot</span><span class="page-category-item color3" role>Redis</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Java,Spring,Spring Boot,Redis,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color5" role>meetup.nhncloud.com</span><span class="page-tag-item color8" role>java</span><span class="page-tag-item color2" role>jdk</span><span class="page-tag-item color8" role>spring</span><span class="page-tag-item color6" role>spring-boot</span><span class="page-tag-item color8" role>redis</span><!--]--><meta property="keywords" content="blog,meetup.nhncloud.com,java,jdk,spring,spring-boot,redis"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/java-spring/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Spring > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#개요" class="router-link-active router-link-exact-active">개요</a></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#redisconnectionfactory-설정-lettuceconnectionfactory" class="router-link-active router-link-exact-active">RedisConnectionFactory 설정 - LettuceConnectionFactory</a><ul><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#소켓-옵션-socketoptions-java" class="router-link-active router-link-exact-active">소켓 옵션(<i class="vp-icon fa-brands fa-java" sizing="height"></i>SocketOptions.java)</a></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#클러스터-토폴로지-갱신-옵션-clustertopologyrefreshoptions" class="router-link-active router-link-exact-active">클러스터 토폴로지 갱신 옵션(ClusterTopologyRefreshOptions)</a></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#클러스터-클라이언트-옵션-clusterclientoptions" class="router-link-active router-link-exact-active">클러스터 클라이언트 옵션(ClusterClientOptions)</a></li></ul></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#lettuceclientconfiguration" class="router-link-active router-link-exact-active">LettuceClientConfiguration</a><ul><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#dynamictimeout" class="router-link-active router-link-exact-active">DynamicTimeout</a></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#dynamicconnection" class="router-link-active router-link-exact-active">DynamicConnection</a></li></ul></li><li><a aria-current="page" href="/bookshelf/meetup.nhncloud.com/379.html#참고-문헌" class="router-link-active router-link-exact-active">참고 문헌</a></li></ul></nav><hr><div class="vp-site-info" data-name="Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다 | NHN Cloud Meetup"><a class="vp-site-info-navigator no-external-link-icon" title="Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다 | NHN Cloud Meetup" href="https://meetup.nhncloud.com/posts/379" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://meetup.nhncloud.com/resources/img/favicon.ico" alt loading="lazy" no-view><div class="vp-site-info-name">Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다 | NHN Cloud Meetup</div><div class="vp-site-info-desc">Redis Cluster를 사용할 때 Spring Boot와 Lettuce client를 설정해 드립니다</div></div><!----></div><figure><img src="https://image.toast.com/aaaadh/real/2024/techblog/redislettuce.png" alt="Redis Lettuce" tabindex="0" loading="lazy"><figcaption>Redis Lettuce</figcaption></figure><h2 id="개요" tabindex="-1"><a class="header-anchor" href="#개요"><span>개요</span></a></h2><p>Spring Boot에서 Redis에 명령어를 실행하기 위하여 Lettuce 라이브러리를 기본으로 사용하고 있습니다. 이때 자동 설정(Auto Configuration)을 사용하기보다 몇 가지 설정 값을 튜닝해서 사용한다면 보다 안정적으로 여러분들의 서비스를 운영할 수 있습니다.</p><p>Spring Boot 애플리케이션에서 Redis를 사용하기 위하여 일반적으로는 Spring-Boot-Starter-Data-Redis 의존성을 추가해서 사용합니다.</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis에 명령어를 실행하려면 자동 설정된 RedisTemplate 스프링 빈을 주입하여 제공하는 메서드를 실행합니다. 그리고 Spring Boot에서 제공하는 <code>RedisAutoConfiguration</code>이 자동 설정을 담당합니다. 다음 <code>RedisAutoConfiguration</code>의 코드와 자동 설정이 동작하는 조건을 살펴보겠습니다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@AutoConfiguration</span></span>
<span class="line"><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">RedisOperations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                <span class="token comment">// ---------- (1)</span></span>
<span class="line"><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedisProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">LettuceConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JedisConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span>            <span class="token comment">// ---------- (2)</span></span>
<span class="line">    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">// ---------- (3)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 생략</span></span>
<span class="line">        <span class="token keyword">return</span> template<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>                                    <span class="token comment">// ---------- (4)</span></span>
<span class="line">    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">// ---------- (5)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.<i class="vp-icon fa-brands fa-java" sizing="height"></i><code>RedisAutoConfiguration.java</code>의 주석을 살펴봅시다.</p><ol><li>Spring-Data-Redis의 RedisOperation 클래스가 클래스패스에 있는 조건이면 <code>RedisAutoConfiguration</code>이 동작한다.</li><li>스프링 애플리케이션에 RedisTemplate redisTemplate 스프링 빈이 없는 경우</li><li>스프링 애플리케이션에 <code>RedisConnectionFactory</code> 스프링 빈이 하나만 존재하는 경우 (2)번 항목과 함께 만족하면 <code>RedisTemplate</code> 스프링 빈을 생성한다.</li><li>스프링 애플리케이션에 StringRedisTemplate stringRedisTemplate 스프링 빈이 없는 경우</li><li>스프링 애플리케이션에 <code>RedisConnectionFactory</code> 스프링 빈이 하나만 존재하는 경우 (4)번 항목과 함께 만족하면 <code>StringRedisTemplate</code> 스프링 빈을 생성한다.</li></ol><p>그러므로 개발자는 스프링 애플리케이션에 <code>RedisConnectionFactory</code> 스프링 빈을 하나만 설정하면 됩니다. 자동 설정에 의해서 RedisTemplate redisTemplate, RedisTemplate stringRedisTemplate 스프링 빈이 자동 생성됩니다. <code>RedisConnectionFactory</code>는 Redis와 애플리케이션 사이에 Connection 객체를 생성하는 기능을 제공합니다. <code>LettuceConnectionFactory</code>는 <code>RedisConnectionFactory</code>의 구현 클래스들 중 하나이며, <code>LettuceConnection</code> 객체를 생성하는 팩토리 클래스입니다.</p><hr><h2 id="redisconnectionfactory-설정-lettuceconnectionfactory" tabindex="-1"><a class="header-anchor" href="#redisconnectionfactory-설정-lettuceconnectionfactory"><span><code>RedisConnectionFactory</code> 설정 - <code>LettuceConnectionFactory</code></span></a></h2><p>Redis 클러스터에 연결하기 위한 위한 <code>RedisConnectionFactory</code> 스프링 빈 생성 코드를 확인해 봅시다. 전체 코드는 다음과 같으며 각 설정의 상세 설명은 뒤에서 다시 설명합니다. <code>RedisConnectionFactory</code> 객체를 개발자가 설정할 수 있는 부분은 크게 4부분으로 나눌 수 있습니다.</p><ul><li><code>SocketOptions</code>: 소켓 설정</li><li><code>ClusterTopologyRefreshOptions</code>: Redis 클러스터 토폴로지 정보를 클라이언트에 동기화하는 설정</li><li><code>ClusterClientOptions</code>: SocketOptions + ClusterTopologyRefreshOptions를 사용하여 클라이언트를 설정</li><li><code>LettuceClientConfiguration</code>: ClusterClientOptions를 사용하여 Lettuce 클라이언트를 설정</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line">    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;redisConnectionFactory&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisConnectionFactory</span> <span class="token function">redisConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//----------------- (1) Socket Option</span></span>
<span class="line">        <span class="token class-name">SocketOptions</span> socketOptions <span class="token operator">=</span> <span class="token class-name">SocketOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                                                   <span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                                                   <span class="token punctuation">.</span><span class="token function">keepAlive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                                                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//----------------- (2) Cluster topology refresh 옵션</span></span>
<span class="line">        <span class="token class-name">ClusterTopologyRefreshOptions</span> clusterTopologyRefreshOptions <span class="token operator">=</span> <span class="token class-name">ClusterTopologyRefreshOptions</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">dynamicRefreshSources</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">enableAllAdaptiveRefreshTriggers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">enablePeriodicRefresh</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//----------------- (3) Cluster client 옵션</span></span>
<span class="line">        <span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> <span class="token class-name">ClusterClientOptions</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">pingBeforeActivateConnection</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">autoReconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">socketOptions</span><span class="token punctuation">(</span>socketOptions<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">topologyRefreshOptions</span><span class="token punctuation">(</span>clusterTopologyRefreshOptions<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">maxRedirects</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//----------------- (4) Lettuce Client 옵션</span></span>
<span class="line">        <span class="token keyword">final</span> <span class="token class-name">LettuceClientConfiguration</span> clientConfig <span class="token operator">=</span> <span class="token class-name">LettuceClientConfiguration</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">150L</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">clientOptions</span><span class="token punctuation">(</span>clusterClientOptions<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">RedisClusterConfiguration</span> clusterConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisClusterConfiguration</span><span class="token punctuation">(</span>redisClusterProperties<span class="token punctuation">.</span><span class="token function">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        clusterConfig<span class="token punctuation">.</span><span class="token function">setMaxRedirects</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        clusterConfig<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">LettuceConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>clusterConfig<span class="token punctuation">,</span> clientConfig<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//----------------- (5) LettuceConnectionFactory 옵션</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setValidateConnection</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> factory<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="소켓-옵션-socketoptions-java" tabindex="-1"><a class="header-anchor" href="#소켓-옵션-socketoptions-java"><span>소켓 옵션(<i class="vp-icon fa-brands fa-java" sizing="height"></i><code>SocketOptions.java</code>)</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">SocketOptions</span> socketOptions <span class="token operator">=</span> <span class="token class-name">SocketOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">keepAlive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lettuce 라이브러리를 사용한다면 Keep Alive 기능을 활성화하고 Connection timeout을 설정하는 것을 추천합니다.</p><p><code>keepAlive</code> 옵션을 활성화(<code>keepAlive(true)</code>)하면, 애플리케이션 런타임 중에 실패한 연결을 처리해야 할 상황이 줄어듭니다. 이 속성은 TCP Keep Alive 기능을 설정합니다. TCP Keep Alive는 다음과 같은 특성을 가집니다.</p><ul><li>TCP Keep Alive를 켜면 오랫동안 데이터를 전송하지 않아도, TCP Connection이 활성된 상태로 유지됩니다.</li><li>TCP Keep Alive는 주기적으로 프로브(Probe)나 메시지를 전송하고 Acknowledgment를 수신합니다.</li><li>만약 Acknowledgment가 주어진 시간에 오지 않는다면, TCP Connection은 끊어진 걸로 간주되어 종료됩니다.</li></ul><p>Java 애플리케이션에서 TCP Keep Alive를 활성화하기 위해서는 몇 가지 조건이 필요합니다. 다음을 참고하시길 바랍니다.</p><ul><li>Java 11 또는 그 이상의 epoll을 사용하는 NIO Socket을 사용하는 경우 가능</li><li>Java 10이나 이전 버전의 epoll을 사용하는 NIO Socket을 사용하는 경우 불가능</li><li>kqueue는 불가능</li><li>참고 : <a href="https://lettuce.io/core/release/api/io/lettuce/core/SocketOptions.KeepAliveOptions.html" target="_blank" rel="noopener noreferrer">https://lettuce.io/core/release/api/io/lettuce/core/SocketOptions.KeepAliveOptions.html</a></li></ul><p><code>ConnectionTimeout</code>에 설정된 시간 값(<code>connectTimeout(Duration.ofMillis(100L))</code>)은 애플리케이션과 Redis 사이에 <code>LettuceConnection</code>을 생성하는 시간 초과 값입니다. 일반적으로 Redis와 애플리케이션은 내부 네트워크를 사용하고 있으므로 커넥션을 생성하는 시간을 짧게 두어도 무방합니다. 예제에서는 100ms로 설정했습니다. <code>connectionTimeout</code>은 뒤에서 설명할 command timeout과 같이 반드시 설정해야 하는 값입니다.</p><p>네트워크 또는 Redis에 문제가 발생하여 Redis 명령어를 빠르게 실행할 수 없다면 애플리케이션 처리량까지 느려질 수 있습니다. 두 설정 값을 너무 크게 잡지 않는다면(예: 1초 이상) Redis나 네트워크에 문제가 발생했을 때 빠르게 예외(Exception)를 발생시킬 수 있습니다. 그래서 애플리케이션이 연쇄적인 장애에 빠지지 않게, 시스템을 격리/보호하는 전략도 고려해 볼 수 있습니다. 비즈니스 로직에 따라서 빠른 실패가 시스템 전체를 보호할 수 있습니다.</p><h3 id="클러스터-토폴로지-갱신-옵션-clustertopologyrefreshoptions" tabindex="-1"><a class="header-anchor" href="#클러스터-토폴로지-갱신-옵션-clustertopologyrefreshoptions"><span>클러스터 토폴로지 갱신 옵션(<code>ClusterTopologyRefreshOptions</code>)</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">ClusterTopologyRefreshOptions</span> clusterTopologyRefreshOptions <span class="token operator">=</span> <span class="token class-name">ClusterTopologyRefreshOptions</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">dynamicRefreshSources</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>                    <span class="token comment">// 모든 Redis 노드로부터 topology 정보 획득. default = true</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">enableAllAdaptiveRefreshTriggers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment">// Redis 클러스터에서 발생하는 모든 이벤트(MOVE, ACK)등에 대해서 topology 갱신</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">enablePeriodicRefresh</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 주기적으로 토폴로지를 갱신하는 시간 </span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis 클러스터는 3개 이상의 Redis 노드들로 구성되어 있습니다. Redis 클러스터에 노드를 추가/삭제 또는 Master 승격 같은 이벤트가 발생하면 토폴로지가 변경됩니다. Redis 클러스터를 연결된 클라이언트 애플리케이션은 최신의 Redis 클러스터 정보를 동기화합니다. 그래서 클라이언트 애플리케이션이 어떤 노드에 데이터를 조회/생성/삭제할지 미리 알고 있습니다. ClusterTopologyRefreshOptions는 Redis 클러스터 토폴로지에 변경이 발생했을 때 클라이언트 애플리케이션이 가진 토폴로지 갱신과 관련된 설정 기능을 제공합니다.</p><p><code>enablePeriodicRefresh()</code>의 시간 인자는 클라이언트 애플리케이션이 Redis 토폴로지를 갱신하는 주기를 설정합니다. 하지만 <code>dynamicRefreshSources()</code>, <code>enableAllAdaptiveRefreshTriggers()</code>는 Redis 클러스터에서 발생하는 이벤트를 클라이언트 애플리케이션이 수신하여 토폴로지를 갱신하는 차이가 있습니다.</p><p>만약 클라이언트 애플리케이션의 토폴로지 정보가 업데이트되지 않아 잘못된 노드에 명령어를 실행해도 문제없습니다. Redis 노드들 또한 토폴로지 정보를 업데이트하고 있으며, <code>MOVED</code> 응답으로 해당 데이터가 저장된 정확한 노드를 응답합니다.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">127.0.0.1:7100&gt; get session:12351712:member:123123123</span>
<span class="line">(error) MOVED 7879 127.0.0.1:7200</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>enablePeriodicRefresh()</code>의 기본값은 60초입니다. 이 옵션이 비활성화되면 클라이언트 애플리케이션은 클러스터에 명령을 실행하고 오류가 발생할 때만 클러스터 토폴로지를 업데이트합니다. 대규모의 Redis 클러스터를 사용하고 있다면 리프레시 주기를 길게 가져가는 것이 좋습니다. 갱신 시간 값이 짧고 Redis 클러스터의 노드 수가 많은 클라이언트 애플리케이션이 자주 토폴로지를 갱신한다면, Redis 클러스터 전체에 부하가 될 수 있습니다.</p><p><code>enableAllAdaptiveRefreshTriggers()</code>는 Redis 클러스터에서 발행하는 모든 트리거에 대해서 토폴로지를 갱신합니다. 트리거는 <code>MOVED_REDIRECT</code>, <code>ASK_REDIRECT</code>, <code>PERSISTENT_RECONNECTS</code>, <code>UNCOVERED_SLOT</code>, <code>UNKNOWN_NODE</code> 등이 될 수 있습니다.</p><p><code>dynamicRefreshSources()</code>의 기본 값은 true입니다. 소규모 클러스터에는 <code>DynamicRefreshResources</code>를 활성화하고 대규모 클러스터에는 비활성화하는 것이 좋습니다. 이 설정이 false이면 Redis 클라이언트는 seed 노드에만 질의하여 새로운 노드를 찾는 데 사용합니다. 이 경우 문제가 있는 노드가 클라이언트 애플리케이션의 토폴로지 정보에서 제외되는 데 시간이 소요됩니다. 이 설정이 true이면 Redis 클라이언트는 모든 Redis 클러스터 노드에게 질의하여 결과를 비교합니다. 그래서 새로운 정보로 토폴로지를 업데이트합니다. 그러므로 대규모 Redis 클러스터에는 <code>DynamicRefreshResources</code> 기능을 끄는 것을 추천합니다.</p><h3 id="클러스터-클라이언트-옵션-clusterclientoptions" tabindex="-1"><a class="header-anchor" href="#클러스터-클라이언트-옵션-clusterclientoptions"><span>클러스터 클라이언트 옵션(<code>ClusterClientOptions</code>)</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> <span class="token class-name">ClusterClientOptions</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">pingBeforeActivateConnection</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>                        <span class="token comment">// 커넥션을 사용하기 위하여 PING 명령어를 사용하여 검증합니다.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">autoReconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>                                       <span class="token comment">// 자동 재접속 옵션을 사용합니다.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">socketOptions</span><span class="token punctuation">(</span>socketOptions<span class="token punctuation">)</span>                              <span class="token comment">// 앞서 생성한 socketOptions 객체를 세팅합니다.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">topologyRefreshOptions</span><span class="token punctuation">(</span>clusterTopologyRefreshOptions<span class="token punctuation">)</span>     <span class="token comment">// 앞서 생성한 clusterTopologyRefreshOptions 객체를 생성합니다.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">maxRedirects</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>maxRedirects()</code> 옵션은 Redis 클러스터가 <code>MOVED_REDIRECT</code>를 응답할 때 클라이언트 애플리케이션에서 Redirect하는 최대 횟수를 설정합니다.</p><p>Redis 클라이언트는 Redis 토폴로지 정보를 동기화하고 있습니다. 각 Redis 노드의 마스터/슬레이브 정보와 IP, 그리고 데이터를 분배하는 정보인 슬롯 범위를 동기화합니다. 만약 Redis 클라이언트가 토폴로지 업데이트에 실패하거나 동기화하지 못한 경우, 잘못된 노드에 Redis 명령을 실행할 수 있습니다. 이 경우 Redis는 실패(<code>MOVED_REDIRECT</code>)를 응답하고 클라이언트는 적절한 노드로 리다이렉션할 수 있습니다. 만약 Redis 클러스터가 3대의 노드로 구성되어 있다면 <code>maxRedirects</code> 값을 3으로 설정했다고 생각해 봅시다. 이 경우 클라이언트 애플리케이션이 실행한 명령어가 실패할 확률은 매우 줄어듭니다.</p><hr><h2 id="lettuceclientconfiguration" tabindex="-1"><a class="header-anchor" href="#lettuceclientconfiguration"><span><code>LettuceClientConfiguration</code></span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">final</span> <span class="token class-name">LettuceClientConfiguration</span> clientConfig <span class="token operator">=</span> <span class="token class-name">LettuceClientConfiguration</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">150L</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ----------- 명령어 타임아웃 설정.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">clientOptions</span><span class="token punctuation">(</span>clusterClientOptions<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lettuce 라이브러리는 지연 연결을 사용하고 있으므로, Command Timeout 값이 Connection Timeout 값보다 커야 합니다. 예제에서는 Command Timeout을 150ms로 설정했으며, 앞서 설정한 <code>SocketOptions</code>의 Connection Timeout 값을 100ms로 설정했습니다.</p><h3 id="dynamictimeout" tabindex="-1"><a class="header-anchor" href="#dynamictimeout"><span><code>DynamicTimeout</code></span></a></h3><p>Lettuce에서는 Redis 명령어마다 별도의 Timeout을 설정할 수 있습니다. FLUSHDB, FLUSHALL, KEYS, SMEMBERS 또는 Lua 스크립트와 같이 여러 키를 반복하는 명령어에는 더 긴 command timeout을 설정할 수 있습니다. 반대로 <code>SET</code>, <code>GET</code>, <code>HSET</code> 등 단일 키 명령어에 대해서는 상대적으로 짧은 command timeout을 설정할 수 있습니다. Lettuce 라이브러리에서는 <code>io.lettuce.core.TimeoutOptions.TimeoutSource</code> 추상 클래스를 제공하고 있으며, 다음과 같이 커스텀 클래스를 작성할 수 있습니다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicCommandTimeout</span> <span class="token keyword">extends</span> <span class="token class-name">TimeoutOptions<span class="token punctuation">.</span>TimeoutSource</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProtocolKeyword</span><span class="token punctuation">&gt;</span></span> <span class="token constant">META_COMMAND_TYPES</span> <span class="token operator">=</span></span>
<span class="line">            <span class="token class-name">ImmutableSet</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProtocolKeyword</span><span class="token punctuation">&gt;</span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommandType</span><span class="token punctuation">.</span><span class="token constant">FLUSHDB</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommandType</span><span class="token punctuation">.</span><span class="token constant">FLUSHALL</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommandType</span><span class="token punctuation">.</span><span class="token constant">CLUSTER</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommandType</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommandType</span><span class="token punctuation">.</span><span class="token constant">KEYS</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Duration</span> defaultCommandTimeout<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Duration</span> metaCommandTimeout<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// META_COMMAND_TYPES에 정의된 명령어는 metaTimeout을 설정하고</span></span>
<span class="line">    <span class="token comment">// 나머지 명령어는 defaultTimeout을 설정합니다.</span></span>
<span class="line">    <span class="token class-name">DynamicCommandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> defaultTimeout<span class="token punctuation">,</span> <span class="token class-name">Duration</span> metaTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        defaultCommandTimeout <span class="token operator">=</span> defaultTimeout<span class="token punctuation">;</span></span>
<span class="line">        metaCommandTimeout <span class="token operator">=</span> metaTimeout<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token class-name">RedisCommand</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">META_COMMAND_TYPES</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> metaCommandTimeout<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> defaultCommandTimeout<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>예제의 <code>DynamicCommandTimeout</code> 클래스는 <code>FLUSHDB</code>, <code>FLUSHALL</code>, <code>CLUSTER</code>, <code>INFO</code>, <code>KEYS</code> 명령어에 대해서 Duration metaTimeout 값을 설정하는 구조입니다. 다음은 <code>DynamicCommandTimeout</code> 객체를 만들어서 설정하는 방법을 설명합니다.</p><ul><li>먼저 <code>TimeoutOptions.Builder</code> 객체를 생성하고 <code>timeoutSource()</code> 메서드를 사용하여 <code>DynamicCommandTimeout</code> 객체를 주입합니다.</li><li><code>DynamicCommandTimeout</code> 객체는 기본 timeout 값으로 100ms를 설정하고, <code>META_COMMAND_TYPES</code>에 정의된 명령어에 대해서는 300ms로 설정한 예제입니다.</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 앞서 생성한 클래스를 DynamicCommandTimeout 객체</span></span>
<span class="line"><span class="token class-name">TimeoutOptions</span> timeoutOptions <span class="token operator">=</span> <span class="token class-name">TimeoutOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">timeoutSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DynamicCommandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">300L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> <span class="token class-name">ClusterClientOptions</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment">//... 생략</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">timeoutOptions</span><span class="token punctuation">(</span>timeoutOptions<span class="token punctuation">)</span>        <span class="token comment">// 생성한 timeoutOptions는 다음과 같이 설정합니다.</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dynamicconnection" tabindex="-1"><a class="header-anchor" href="#dynamicconnection"><span>DynamicConnection</span></a></h3><p><code>ClusterClientOptions.Builder</code> 클래스의 <code>nodeFilter()</code> 메서드는 문제가 발생한 노드를 Redis 토폴로지에서 제외하는 기능을 제공합니다. <code>nodeFilter()</code> 메서드는 <code>Predicate</code>를 인자로 받으므로 다음 예제에서는 람다식으로 간단히 표현되어 있습니다.</p><p><code>RedisClusterNode.NodeFlag</code> 열거형의 자세한 내용은 <a href="https://lettuce.io/core/release/api/io/lettuce/core/cluster/models/partitions/RedisClusterNode.NodeFlag.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>여기</a>에서 확인하길 바랍니다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> </span>
<span class="line">    <span class="token class-name">ClusterClientOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// other options</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">nodeFilter</span><span class="token punctuation">(</span>it <span class="token operator">-&gt;</span> </span>
<span class="line">        <span class="token operator">!</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token class-name">RedisClusterNode<span class="token punctuation">.</span>NodeFlag</span><span class="token punctuation">.</span><span class="token constant">FAIL</span><span class="token punctuation">)</span> </span>
<span class="line">        <span class="token operator">||</span> it<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token class-name">RedisClusterNode<span class="token punctuation">.</span>NodeFlag</span><span class="token punctuation">.</span><span class="token constant">EVENTUAL_FAIL</span><span class="token punctuation">)</span> </span>
<span class="line">        <span class="token operator">||</span> it<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token class-name">RedisClusterNode<span class="token punctuation">.</span>NodeFlag</span><span class="token punctuation">.</span><span class="token constant">HANDSHAKE</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">||</span> it<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token class-name">RedisClusterNode<span class="token punctuation">.</span>NodeFlag</span><span class="token punctuation">.</span><span class="token constant">NOADDR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">validateClusterNodeMembership</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">redisClusterClient<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>clusterClientOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis가 장애 상태에서 복구되면 Redis 클러스터는 복구 프로세스를 시작합니다. 이때 Redis 클러스터는 토폴로지를 새로 갱신하며, 작동 안 되는 노드(down node)들은 토폴로지에서 제거될 때 까지는 실패(FAIL) 상태로 표시됩니다. 이 기간동안 Redis 클라이언트는 이를 정상 노드(healthy node)로 판단하며 계속해서 연결하려고 합니다.<br>validateClusterNodeMembership은 클러스터 노드에 연결 전 유효한 노드인지 확인하는 옵션이므로 정상 노드로 착각하여 검증하지 않도록 false로 설정합니다.</p><hr><h2 id="참고-문헌" tabindex="-1"><a class="header-anchor" href="#참고-문헌"><span>참고 문헌</span></a></h2><a class="vp-card" href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/BestPractices.Clients-lettuce.html" target="_blank" style="background:rgba(247,155,38,0.2);"><img class="vp-card-logo" src="https://docs.aws.amazon.com/assets/images/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Lettuce client configuration - Amazon ElastiCache for Redis</div><hr><div class="vp-card-desc">This section describes the recommended Java and Lettuce configuration options, and how they apply to ElastiCache clusters.</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/meetup.nhncloud.com/379.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/java-spring/articles/" aria-label="/programming/java-spring/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/java-spring/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/meetup.nhncloud.com/381.html" aria-label="보이스피싱 애플리케이션 분석 1부"><div class="hint">Next<span class="arrow end"></span></div><div class="link">보이스피싱 애플리케이션 분석 1부<i class="vp-icon fas fa-shield-halved" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
