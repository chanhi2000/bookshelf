<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Augmented Reality in Android with Google’s Face API","image":["https://koenig-media.raywenderlich.com/uploads/2017/04/sad-cat.jpg","https://koenig-media.raywenderlich.com/uploads/2017/05/camera-permission-request.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-01-1.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/04/build.gradle-app-in-project-pane.jpg","https://koenig-media.raywenderlich.com/uploads/2017/04/androidmanifest.xml-in-project-pane.jpg","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-02-1.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-03.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/04/landmarks.png","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-02-1.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-05.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-06.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-07.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-08.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-09.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/04/x-y-and-z-axes-for-euler-angles-1.jpg","https://koenig-media.raywenderlich.com/uploads/2017/05/eulerYRotation.gif =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/eulerZRotation.gif =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-10.jpg =240x","https://koenig-media.raywenderlich.com/uploads/2017/05/googly.gif =240x","https://koenig-media.raywenderlich.com/uploads/2017/04/facespotter-object-diagram-650x418.png"],"datePublished":"2017-07-12T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Augmented Reality in Android with Google’s Face API"><meta property="og:description" content="Article(s) > Augmented Reality in Android with Google’s Face API"><meta property="og:type" content="article"><meta property="og:image" content="https://koenig-media.raywenderlich.com/uploads/2017/05/MobileVision-twitter.png"><meta property="og:locale" content="ko-KR"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://koenig-media.raywenderlich.com/uploads/2017/05/MobileVision-twitter.png"><meta name="twitter:image:alt" content="Augmented Reality in Android with Google’s Face API"><meta property="article:tag" content="gradle"><meta property="article:tag" content="android"><meta property="article:tag" content="java"><meta property="article:tag" content="kodeco.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2017-07-12T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Augmented Reality in Android with Google’s Face API | 📚Bookshelf</title><meta name="description" content="Article(s) > Augmented Reality in Android with Google’s Face API">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">kodeco.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/" aria-label="Kodeco (kodeco.com)"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->Kodeco (kodeco.com)<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html" aria-label="Augmented Reality in Android with Google’s Face API"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Augmented Reality in Android with Google’s Face API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/324-viewpager-tutorial-getting-started-in-kotlin.html" aria-label="ViewPager Tutorial - Getting Started in Kotlin"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->ViewPager Tutorial - Getting Started in Kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/853-couchbase-tutorial-for-android-getting-started.html" aria-label="Couchbase Tutorial for Android - Getting Started"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Couchbase Tutorial for Android - Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/272-intermediate-recyclerview-tutorial-with-kotlin.html" aria-label="Intermediate RecyclerView Tutorial with Kotlin"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Intermediate RecyclerView Tutorial with Kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/262-dependency-injection-in-android-with-dagger-2-and-kotlin.html" aria-label="Dependency Injection in Android with Dagger 2 and Kotlin"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Dependency Injection in Android with Dagger 2 and Kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/254-getting-started-with-android-wear-with-kotlin.html" aria-label="Getting Started with Android Wear with Kotlin"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Getting Started with Android Wear with Kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/249-gradle-tutorial-for-android-getting-started.html" aria-label="Gradle Tutorial for Android - Getting Started"><!--[--><i class="vp-icon iconfont icon-gradle" sizing="both"></i><!--]-->Gradle Tutorial for Android - Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/247-react-native-tutorial-building-android-apps-with-javascript.html" aria-label="React Native Tutorial - Building Android Apps with JavaScript"><!--[--><i class="vp-icon fa-brands fa-react" sizing="both"></i><!--]-->React Native Tutorial - Building Android Apps with JavaScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/240-android-accessibility-tutorial-getting-started.html" aria-label="Android Accessibility Tutorial: Getting Started"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Android Accessibility Tutorial: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/230-introduction-to-google-maps-api-for-android-with-kotlin.html" aria-label="Introduction to Google Maps API for Android with Kotlin"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Introduction to Google Maps API for Android with Kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/1144981-kotlin-for-android-an-introduction.html" aria-label="Kotlin For Android: An Introduction"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Kotlin For Android: An Introduction<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6398124-swiftui-tutorial-for-ios-creating-charts.html" aria-label="SwiftUI Tutorial for iOS - Creating Charts"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->SwiftUI Tutorial for iOS - Creating Charts<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6334294-my-app-crashed-now-what.html" aria-label="My App Crashed, Now What?"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->My App Crashed, Now What?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started.html" aria-label="SQLite With Swift Tutorial: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->SQLite With Swift Tutorial: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6747815-uigesturerecognizer-tutorial-getting-started.html" aria-label="UIGestureRecognizer Tutorial: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->UIGestureRecognizer Tutorial: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6742901-protocol-oriented-programming-tutorial-in-swift-5-1-getting-started.html" aria-label="Protocol-Oriented Programming Tutorial in Swift 5.1: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Protocol-Oriented Programming Tutorial in Swift 5.1: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/7076593-cocoapods-tutorial-for-swift-getting-started.html" aria-label="CocoaPods Tutorial for Swift: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->CocoaPods Tutorial for Swift: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/7181017-unsafe-swift-using-pointers-and-interacting-with-c.html" aria-label="Unsafe Swift: Using Pointers and Interacting With C"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Unsafe Swift: Using Pointers and Interacting With C<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6827616-ios-accessibility-getting-started.html" aria-label="iOS Accessibility: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->iOS Accessibility: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/6587213-alamofire-5-tutorial-for-ios-getting-started.html" aria-label="Alamofire 5 Tutorial for iOS: Getting Started"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Alamofire 5 Tutorial for iOS: Getting Started<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/30067669-documenting-kotlin-code-for-android-using-kdoc-and-dokka.html" aria-label="Documenting Kotlin Code for Android Using KDoc and Dokka"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Documenting Kotlin Code for Android Using KDoc and Dokka<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/kodeco.com/31290959-kotlin-sequences-getting-started.html" aria-label="Kotlin Sequences - Getting Started"><!--[--><i class="vp-icon iconfont icon-kotlin" sizing="both"></i><!--]-->Kotlin Sequences - Getting Started<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://koenig-media.raywenderlich.com/uploads/2017/05/MobileVision-twitter.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-android" sizing="height"></i>Augmented Reality in Android with Google’s Face API</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">17. 7. 12.</span><meta property="datePublished" content="2017-07-12T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 17 min</span><meta property="timeRequired" content="PT17M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8" role>Java</span><span class="page-category-item color0" role>Android</span><span class="page-category-item color2" role>Gradle</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Java,Android,Gradle,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color1" role>kodeco.com</span><span class="page-tag-item color8" role>java</span><span class="page-tag-item color3" role>android</span><span class="page-tag-item color4" role>gradle</span><!--]--><meta property="keywords" content="blog,kodeco.com,java,android,gradle"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Augmented Reality in Android with Google’s Face API 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/java-android/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Android > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#what-can-google-s-face-api-do" class="router-link-active router-link-exact-active">What can Google’s Face API do?</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#getting-started" class="router-link-active router-link-exact-active">Getting Started</a><ul><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#project-dependencies" class="router-link-active router-link-exact-active">Project Dependencies</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#using-the-cameras" class="router-link-active router-link-exact-active">Using the Cameras</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#pre-defined-classes" class="router-link-active router-link-exact-active">Pre-defined Classes</a></li></ul></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#finding-faces" class="router-link-active router-link-exact-active">Finding Faces</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#landmarks-ahoy" class="router-link-active router-link-exact-active">Landmarks Ahoy!</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#classifications" class="router-link-active router-link-exact-active">Classifications</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#giving-faces-the-cartoon-treatment" class="router-link-active router-link-exact-active">Giving Faces the Cartoon Treatment</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#what-s-your-angle" class="router-link-active router-link-exact-active">What’s Your Angle?</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#bouncing-irises" class="router-link-active router-link-exact-active">Bouncing Irises</a></li><li><a aria-current="page" href="/bookshelf/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.html#where-to-go-from-here" class="router-link-active router-link-exact-active">Where to Go From Here?</a></li></ul></nav><hr><div class="vp-site-info" data-name="Augmented Reality in Android with Google’s Face API"><a class="vp-site-info-navigator no-external-link-icon" title="Augmented Reality in Android with Google’s Face API" href="https://kodeco.com/523-augmented-reality-in-android-with-google-s-face-api" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://koenig-media.raywenderlich.com/uploads/2017/05/MobileVision-twitter.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://assets.carolus.kodeco.com/assets/murakami/category-icons/category-ar-vr-android-847ca6fdd6f2a12866d7e3b66eb5ecf5420ad5695418a64c57f800b1ad89a4d3.svg" alt loading="lazy" no-view><div class="vp-site-info-name">Augmented Reality in Android with Google’s Face API</div><div class="vp-site-info-desc">You’ll build a Snapchat Lens-like app called FaceSpotter which draws cartoony features over faces in a camera feed using augmented reality.</div></div><!----></div><p>If you’ve ever used <a href="https://support.snapchat.com/en-US/a/lenses1" target="_blank" rel="noopener noreferrer">Snapchat’s “Lenses” feature</a>, you’ve used a combination of <strong>augmented reality</strong> and <strong>face detection</strong>.</p><p>Augmented reality — <em>AR</em> for short — is technical and an impressive-sounding term that simply describes real-world images overlaid with computer-generated ones. As for face detection, it’s nothing new for humans, but finding faces in images is still a new trick for computers, especially <em>handheld</em> ones.</p><p>Writing apps that feature AR and face detection used to require serious programming chops, but with Google’s <a href="https://developers.google.com/vision" target="_blank" rel="noopener noreferrer">Mobile Vision</a> suite of libraries and its <a href="https://developers.google.com/vision/face-detection-concepts" target="_blank" rel="noopener noreferrer">Face API</a>, it’s much easier.</p><p>In this augmented reality tutorial, you’ll build a Snapchat Lens-like app called <strong>FaceSpotter</strong>. FaceSpotter draws cartoony features over faces in a camera feed.</p><p>In this tutorial, you’ll learn how to:</p><ul><li>Incorporate Google’s Face API into your own apps</li><li>Programmatically identify and track human faces from a camera feed</li><li>Identify points of interest on faces, such as eyes, ears, nose, and mouth</li><li>Draw text and graphics over images from a camera feed</li></ul><div class="hint-container tip"><p class="hint-container-title">Note</p><p>This tutorial assumes you’re experienced in Android development with Java. If you’re new to the Android world or are not familiar with Android Studio, please have a look at our <a href="https://www.raywenderlich.com/android-tutorials" target="_blank" rel="noopener noreferrer">Android tutorials</a>.</p></div><hr><h2 id="what-can-google-s-face-api-do" tabindex="-1"><a class="header-anchor" href="#what-can-google-s-face-api-do"><span>What can Google’s Face API do?</span></a></h2><p>Google’s Face API performs <em>face detection</em>, which locates faces in pictures, along with their <strong>position</strong> (where they are in the picture) and orientation (which way they’re facing, relative to the camera). It can detect <a href="https://developers.google.com/vision/face-detection-concepts#landmarks" target="_blank" rel="noopener noreferrer">landmarks</a> (points of interest on a face) and perform <a href="https://developers.google.com/vision/face-detection-concepts#classification" target="_blank" rel="noopener noreferrer">classifications</a> to determine whether the eyes are open or closed, and whether or not a face is smiling. The Face API also detects and follows faces in moving images, which is known as <em>face tracking</em>.</p><p>Note that the Face API is limited to detecting human faces in pictures. Sorry, cat bloggers…</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/sad-cat.jpg" alt="sad cat" tabindex="0" loading="lazy"><figcaption>sad cat</figcaption></figure><p>The Face API <em>doesn’t</em> perform face recognition, which connects a given face to an identity. It can’t perform that Facebook trick of detecting a face in an image and then identifying that person.</p><p>Once you’re able to detect a face, its position and its landmarks in an image, you can use that data to augment the image with your own reality! Apps like Pokemon GO, or Snapchat make use of augmented reality to give users a fun way to use their cameras, and so can you!</p><hr><h2 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started"><span>Getting Started</span></a></h2><p>Download the <strong>FaceSpotter</strong> starter project <a href="https://koenig-media.raywenderlich.com/uploads/2017/05/FaceSpotter-starter-5.zip" target="_blank" rel="noopener noreferrer">here</a> and open it in Android Studio. Build and run the app, and it will ask for permission to use the camera.</p><p>![Augmented Reality -Screenshot of FaceSpotter, showing a dialog asking &#39;Allow FaceSpotter to take pictures and record video?&#39; with two buttons labeled &#39;DENY&#39; and &#39;ALLOW&#39;.](https://koenig-media.raywenderlich.com/uploads/2017/05/camera-permission-request.jpg =240x)</p><p>Click <strong>ALLOW</strong>, then point the camera at someone’s face.</p><p>![Augmented Reality -FaceSpotter Starter](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-01-1.jpg =240x)</p><p>The button in the app’s lower left-hand corner toggles between front and back camera.</p><p>This project was made so that you can start using face detection and tracking quickly. Let’s review what’s included.</p><h3 id="project-dependencies" tabindex="-1"><a class="header-anchor" href="#project-dependencies"><span>Project Dependencies</span></a></h3><p>Open the project’s <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>app</code>/<i class="vp-icon iconfont icon-engine" sizing="height"></i><code>build.gradle</code>:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/build.gradle-app-in-project-pane.jpg" alt="Screenshot of the Project pane in Android studio, showing &#39;build.gradle (Module:app)&#39; highlighted." tabindex="0" loading="lazy"><figcaption>Screenshot of the Project pane in Android studio, showing &#39;build.gradle (Module:app)&#39; highlighted.</figcaption></figure><p>At the end of the <code>dependencies</code> section, you’ll see the following:</p><div class="language-groovy line-numbers-mode" data-highlighter="prismjs" data-ext="groovy"><pre><code class="language-groovy"><span class="line">implementaion <span class="token string">&#39;com.google.android.gms:play-services-vision:10.2.0&#39;</span></span>
<span class="line">implementaion <span class="token string">&#39;com.android.support:design:25.2.0&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The first of these lines imports the <a href="https://developers.google.com/android/reference/com/google/android/gms/vision/package-summary" target="_blank" rel="noopener noreferrer">Android Vision API</a>, which supports not just face detection, but barcode detection and text recognition as well.</p><p>The second brings in the <a href="https://developer.android.com/training/material/design-library.html" target="_blank" rel="noopener noreferrer">Android Design Support Library</a>, which provides the <a href="https://developer.android.com/reference/android/support/design/widget/Snackbar.html" target="_blank" rel="noopener noreferrer">Snackbar</a> widget that informs the user that the app needs access to the cameras.</p><h3 id="using-the-cameras" tabindex="-1"><a class="header-anchor" href="#using-the-cameras"><span>Using the Cameras</span></a></h3><p>FaceSpotter specifies that it uses the camera and requests the user’s permission to do so with these lines in <i class="vp-icon fa-brands fa-android" sizing="height"></i> <code>AndroidManifest.xml</code>:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/androidmanifest.xml-in-project-pane.jpg" alt="Screenshot of the Project pane in Android studio, showing &#39;AndroidManifest.xml&#39; highlighted." tabindex="0" loading="lazy"><figcaption>Screenshot of the Project pane in Android studio, showing &#39;AndroidManifest.xml&#39; highlighted.</figcaption></figure><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-feature</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.hardware.camera<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.CAMERA<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pre-defined-classes" tabindex="-1"><a class="header-anchor" href="#pre-defined-classes"><span>Pre-defined Classes</span></a></h3><p>The starter project comes with a few pre-defined classes:</p><ul><li><strong>FaceActivity</strong>: The main activity of the app which shows the camera preview.</li><li><strong>FaceTracker</strong>: Follows faces that are detected in images from the camera, and gathers their positions and landmarks.</li><li><strong>FaceGraphic</strong>: Draws the computer-generated images over faces in the camera images.</li><li><strong>FaceData</strong>: A data class for passing <code>FaceTracker</code> data to <code>FaceGraphic</code>.</li><li><strong>EyePhysics</strong>: Provided by Google in their <a href="https://github.com/googlesamples/android-vision" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-github" sizing="height"></i> Mobile Vision sample apps on GitHub</a>, it’s a simple physics engine that will animate the AR irises as the faces they’re on move.</li><li><strong>CameraSourcePreview</strong>: Another class from Google. It displays the live image data from the camera in a view.</li><li><strong>GraphicOverlay</strong>: One more Google class; FaceGraphic subclasses it.</li></ul><p>Let’s take a moment to get familiar with how they work.</p><p><code>FaceActivity</code> defines the app’s only activity, and along with handling touch events, also requests for permission to access the device’s camera at runtime (applies to Android 6.0 and above). FaceActivity also creates two objects which FaceSpotter depends on, namely <strong>CameraSource</strong> and <strong>FaceDetector</strong>.</p><p>Open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceActivity.java</code> and look for the <code>createCameraSource</code> method:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createCameraSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token class-name">FaceDetector</span> detector <span class="token operator">=</span> <span class="token function">createFaceDetector</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  <span class="token keyword">int</span> facing <span class="token operator">=</span> <span class="token class-name">CameraSource</span><span class="token punctuation">.</span><span class="token constant">CAMERA_FACING_FRONT</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mIsFrontFacing<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    facing <span class="token operator">=</span> <span class="token class-name">CameraSource</span><span class="token punctuation">.</span><span class="token constant">CAMERA_FACING_BACK</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 3</span></span>
<span class="line">  mCameraSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CameraSource<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> detector<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setFacing</span><span class="token punctuation">(</span>facing<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setRequestedPreviewSize</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setRequestedFps</span><span class="token punctuation">(</span><span class="token number">60.0f</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setAutoFocusEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what the above code does:</p><ul><li><code>setFacing</code>: Specifies which camera to use.</li><li><code>setRequestedPreviewSize</code>: Sets the resolution of the preview image from the camera. Lower resolutions (like the 320×240 resolution specified) work better with budget devices and provide faster face detection. Higher resolutions (640×480 and higher) are for higher-end devices and offer better detection of small faces and facial features. Try out different settings.</li><li><code>setRequestedFps</code>: Sets the camera frame rate. Higher rates mean better face tracking, but use more processor power. Experiment with different frame rates.</li><li><code>setAutoFocusEnabled</code>: Turns autofocus off or on. Keep this set to true for better face detection and user experience. This has no effect if the device doesn’t have autofocus.</li></ul><ol><li>Creates a <code>FaceDetector</code> object, which detects faces in images from the camera’s data stream.</li><li>Determines which camera is currently the active one.</li><li>Uses the results of steps 1 and 2 and the <a href="http://www.javaworld.com/article/2074938/core-java/too-many-parameters-in-java-methods-part-3-builder-pattern.html" target="_blank" rel="noopener noreferrer"><em>Builder pattern</em></a> to create the camera source. The builder methods are:</li></ol><p>Now let’s check out the <code>createFaceDetector</code> method:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@NonNull</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">FaceDetector</span> <span class="token function">createFaceDetector</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token class-name">FaceDetector</span> detector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FaceDetector<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setLandmarkType</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector</span><span class="token punctuation">.</span><span class="token constant">ALL_LANDMARKS</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setClassificationType</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector</span><span class="token punctuation">.</span><span class="token constant">ALL_CLASSIFICATIONS</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setTrackingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector</span><span class="token punctuation">.</span><span class="token constant">FAST_MODE</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setProminentFaceOnly</span><span class="token punctuation">(</span>mIsFrontFacing<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">setMinFaceSize</span><span class="token punctuation">(</span>mIsFrontFacing <span class="token operator">?</span> <span class="token number">0.35f</span> <span class="token operator">:</span> <span class="token number">0.15f</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 2 </span></span>
<span class="line">  <span class="token class-name">MultiProcessor<span class="token punctuation">.</span>Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiProcessor<span class="token punctuation">.</span>Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Tracker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FaceTracker</span><span class="token punctuation">(</span>mGraphicOverlay<span class="token punctuation">,</span> context<span class="token punctuation">,</span> mIsFrontFacing<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 3</span></span>
<span class="line">  <span class="token class-name">Detector<span class="token punctuation">.</span>Processor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> processor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiProcessor<span class="token punctuation">.</span>Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  detector<span class="token punctuation">.</span><span class="token function">setProcessor</span><span class="token punctuation">(</span>processor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 4</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>detector<span class="token punctuation">.</span><span class="token function">isOperational</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Face detector dependencies are not yet available.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Check the device&#39;s storage.  If there&#39;s little available storage, the native</span></span>
<span class="line">    <span class="token comment">// face detection library will not be downloaded, and the app won&#39;t work,</span></span>
<span class="line">    <span class="token comment">// so notify the user.</span></span>
<span class="line">    <span class="token class-name">IntentFilter</span> lowStorageFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DEVICE_STORAGE_LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">boolean</span> hasLowStorage <span class="token operator">=</span> <span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> lowStorageFilter<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasLowStorage<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>low_storage_error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      builder<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>low_storage_error<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>disappointed_ok<span class="token punctuation">,</span> listener<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> detector<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Taking the above comment-by-comment:</p><ul><li><code>setLandmarkType</code>: Set to <code>NO_LANDMARKS</code> if it should not detect facial landmarks (this makes face detection faster) or <code>ALL_LANDMARKS</code> if landmarks should be detected.</li><li><code>setClassificationType</code>: Set to <code>NO_CLASSIFICATIONS</code> if it should not detect whether subjects’ eyes are open or closed or if they’re smiling (which speeds up face detection) or <code>ALL_CLASSIFICATIONS</code> if it should detect them.</li><li><code>setTrackingEnabled</code>: Enables/disables face tracking, which maintains a consistent ID for each face from frame to frame. Since you need face tracking to process live video and multiple faces, set this to true.</li><li><code>setMode</code>: Set to <code>FAST_MODE</code> to detect fewer faces (but more quickly), or <code>ACCURATE_MODE</code> to detect more faces (but more slowly) and to detect the Euler Y angles of faces (we’ll cover this topic later).</li><li><code>setProminentFaceOnly</code>: Set to <code>true</code> to detect only the most prominent face in the frame.</li><li><code>setMinFaceSize</code>: Specifies the smallest face size that will be detected, expressed as a proportion of the width of the face relative to the width of the image.</li></ul><ol><li>Creates a <code>FaceDetector</code> object using the Builder pattern, and sets the following properties:</li><li>Creates a <a href="https://en.wikipedia.org/wiki/Factory_method_pattern" target="_blank" rel="noopener noreferrer">factory</a> class that creates new <code>FaceTracker</code> instances.</li><li>When a face detector detects a face, it passes the result to a <strong>processor</strong>, which determines what actions should be taken. If you wanted to deal with only one face at a time, you’d use an instance of <a href="https://developers.google.com/android/reference/com/google/android/gms/vision/Detector.Processor" target="_blank" rel="noopener noreferrer"><code>Processor</code></a>. In this app, you’ll handle <em>multiple</em> faces, so you’ll create a <a href="https://developers.google.com/android/reference/com/google/android/gms/vision/MultiProcessor" target="_blank" rel="noopener noreferrer"><code>MultiProcessor</code></a> instance, which creates a new <code>FaceTracker</code> instance for each detected face. Once created, we connect the processor to the detector.</li><li>The face detection library downloads as the app is installed. It’s large enough that there’s a chance that it may not be downloaded when the user runs the app for the first time. This code handles that case, as well as the when the device doesn’t have enough storage for the library.</li></ol><p>With the intro taken care of, it’s time to detect some faces!</p><hr><h2 id="finding-faces" tabindex="-1"><a class="header-anchor" href="#finding-faces"><span>Finding Faces</span></a></h2><p>First you add a view into the overlay to draw detected face data.</p><p>Open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceGraphic.java</code>. You may have noticed the declaration for the instance variable <code>mFace</code> is marked with the keyword <code>volatile</code>. <code>mFace</code> stores face data sent from <code>FaceTracker</code>, and may be written to by many threads. Marking it as <code>volatile</code> guarantees that you always get the result of the latest “write” any time you read its value. This is important since face data will change very quickly.</p><p>Delete the existing <code>draw()</code> and add the following to <code>FaceGraphic</code>:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 1</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mFace <span class="token operator">=</span> face<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">postInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Trigger a redraw of the graphic (i.e. cause draw() to be called).</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  <span class="token comment">// Confirm that the face and its features are still visible</span></span>
<span class="line">  <span class="token comment">// before drawing any graphics over it.</span></span>
<span class="line">  <span class="token class-name">Face</span> face <span class="token operator">=</span> mFace<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>face <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 3</span></span>
<span class="line">  <span class="token keyword">float</span> centerX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">+</span> face<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> centerY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">+</span> face<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> offsetX <span class="token operator">=</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> offsetY <span class="token operator">=</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 4</span></span>
<span class="line">  <span class="token comment">// Draw a box around the face.</span></span>
<span class="line">  <span class="token keyword">float</span> left <span class="token operator">=</span> centerX <span class="token operator">-</span> offsetX<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> right <span class="token operator">=</span> centerX <span class="token operator">+</span> offsetX<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> top <span class="token operator">=</span> centerY <span class="token operator">-</span> offsetY<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> bottom <span class="token operator">=</span> centerY <span class="token operator">+</span> offsetY<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 5</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 6</span></span>
<span class="line">  <span class="token comment">// Draw the face&#39;s id.</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;id: %d&quot;</span><span class="token punctuation">,</span> face<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what that code does:</p><ol><li>When a <code>FaceTracker</code> instance gets an update on a tracked face, it calls its corresponding <code>FaceGraphic</code> instance’s <code>update</code> method and passes it information about that face. The method saves that information in <code>mFace</code> and then calls <code>FaceGraphic</code>’s parent class’ <code>postInvalidate</code> method, which forces the graphic to redraw.</li><li>Before attempting to draw a box around the face, the <code>draw</code> method checks to see if the face is still being tracked. If it is, <code>mFace</code> will be non-<code>null</code>.</li><li>The x- and y-coordinates of the center of the face are calculated. <code>FaceTracker</code> provides camera coordinates, but you’re drawing to <code>FaceGraphic</code>’s view coordinates, so you use <code>GraphicOverlay</code>’s <code>translateX</code> and <code>translateY</code> methods to convert <code>mFace</code>’s camera coordinates to the view coordinates of the canvas.</li><li>Calculate the x-offsets for the left and right sides of the box and the y-offsets for the top and bottom. The difference between the camera’s and the view’s coordinate systems require you convert the face’s width and height using <code>GraphicOverlay</code>’s <code>scaleX</code> and <code>scaleY</code> methods.</li><li>Draw the box around the face using the calculated center coordinates and offsets.</li><li>Draw the face’s <code>id</code> using the face’s center point as the starting coordinates.</li></ol><p>The face detector in <code>FaceActivity</code> sends information about faces it detects in the camera’s data stream to its assigned multiprocessor. For each detected face, the multiprocessor spawns a new <code>FaceTracker</code> instance.</p><p>Add the following methods to <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceTracker.java</code> after the constructor:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 1</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNewItem</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mFaceGraphic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FaceGraphic</span><span class="token punctuation">(</span>mOverlay<span class="token punctuation">,</span> mContext<span class="token punctuation">,</span> mIsFrontFacing<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector<span class="token punctuation">.</span>Detections</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> detectionResults<span class="token punctuation">,</span> <span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mOverlay<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mFaceGraphic<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceGraphic<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMissing</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector<span class="token punctuation">.</span>Detections</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> detectionResults<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mOverlay<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>mFaceGraphic<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mOverlay<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>mFaceGraphic<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what each method does:</p><ol><li><strong>onNewItem</strong>: Called when a new <code>Face</code> is detected and its tracking begins. You’re using it to create a new instance of <code>FaceGraphic</code>, which makes sense: when a new face is detected, you want to create new AR images to draw over it.</li><li><strong>onUpdate</strong>: Called when some property (position, angle, or state) of a tracked face changes. You’re using it to add the <code>FaceGraphic</code> instance to the <code>GraphicOverlay</code> and then call <code>FaceGraphic</code>’s <code>update</code> method, which passes along the tracked face’s data.</li><li><strong>onMissing</strong> and <strong>onDone</strong>: Called when a tracked face is assumed to be temporarily and permanently gone, respectively. Both remove the <code>FaceGraphic</code> instance from the overlay.</li></ol><p>Run the app. It will draw a box around each face it detects, along with the corresponding ID number:</p><p>![Augmented Reality - Face with ID](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-02-1.jpg =240x)</p><p>![Augmented Reality - Multiple faces with ID](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-03.jpg =240x)</p><hr><h2 id="landmarks-ahoy" tabindex="-1"><a class="header-anchor" href="#landmarks-ahoy"><span>Landmarks Ahoy!</span></a></h2><p>The Face API can identify the facial landmarks shown below.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/landmarks.png" alt="Augmented Reality - Face API landmarks overview" tabindex="0" loading="lazy"><figcaption>Augmented Reality - Face API landmarks overview</figcaption></figure><p>You’ll modify the app so that it identifies the following for any tracked face:</p><ul><li>left eye</li><li>right eye</li><li>nose base</li><li>mouth left</li><li>mouth bottom</li><li>mouth right</li></ul><p>This information will be saved in a <code>FaceData</code> object, instead of the provided <code>Face</code> object.</p><p>For facial landmarks, “left” and “right” refer to the subject’s left and right. Viewed through the front camera, the subject’s right eye will be closer to the right side of the screen, but through the rear camera, it’ll be closer to the left.</p><p>Open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceTracker.java</code> and modify <code>onUpdate()</code> as shown below. The call to <code>update()</code> will momentarily cause a build error while you are in the process of modifying the app to use the <code>FaceData</code> model and you will fix it soon.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector<span class="token punctuation">.</span>Detections</span> detectionResults<span class="token punctuation">,</span> <span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mOverlay<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mFaceGraphic<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Get face dimensions.</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Get the positions of facial landmarks.</span></span>
<span class="line">  <span class="token function">updatePreviousLandmarkPositions</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setLeftEyePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EYE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setRightEyePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EYE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_CHEEK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_CHEEK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setNoseBasePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">NOSE_BASE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EAR_TIP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EAR_TIP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthLeftPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">BOTTOM_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthRightPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  mFaceGraphic<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>mFaceData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that you’re now passing a <code>FaceData</code> instance to <code>FaceGraphic</code>’s <code>update</code> method instead of the <code>Face</code> instance that the <code>onUpdate</code> method receives.</p><p>This allows you to specify the face information passed to <code>FaceTracker</code>, which in turn lets you use some math trickery based on the last known locations of facial landmarks when the faces are moving too quickly to approximate their current locations. You use <code>mPreviousLandmarkPositions</code> and the <code>getLandmarkPosition</code> and <code>updatePreviousLandmarkPositions</code> methods for this purpose.</p><p>Now open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceGraphic.java</code>.</p><p>First, since it’s now receiving a <code>FaceData</code> value instead of a <code>Face</code> value from <code>FaceTracker</code>, you need to change a key instance variable declaration from:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Face</span> mFace<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>to:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">FaceData</span> mFaceData<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Modify <code>update()</code> to account for this change:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">FaceData</span> faceData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mFaceData <span class="token operator">=</span> faceData<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">postInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Trigger a redraw of the graphic (i.e. cause draw() to be called).</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And finally, you need to update <code>draw()</code> to draw dots over the landmarks of any tracked face, and identifying text over those dots:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DOT_RADIUS</span> <span class="token operator">=</span> <span class="token number">3.0f</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">TEXT_OFFSET_Y</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">30.0f</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Confirm that the face and its features are still visible before drawing any graphics over it.</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>mFaceData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectLeftEyePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getLeftEyePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectRightEyePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getRightEyePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectNoseBasePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getNoseBasePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthLeftPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthLeftPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthBottomPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthBottomPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthRightPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthRightPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>detectPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectLeftEyePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectRightEyePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectNoseBasePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthLeftPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthBottomPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthRightPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  <span class="token keyword">float</span> leftEyeX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectLeftEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> leftEyeY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectLeftEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>leftEyeX<span class="token punctuation">,</span> leftEyeY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;left eye&quot;</span><span class="token punctuation">,</span> leftEyeX<span class="token punctuation">,</span> leftEyeY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> rightEyeX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectRightEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> rightEyeY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectRightEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>rightEyeX<span class="token punctuation">,</span> rightEyeY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;right eye&quot;</span><span class="token punctuation">,</span> rightEyeX<span class="token punctuation">,</span> rightEyeY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> noseBaseX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectNoseBasePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> noseBaseY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectNoseBasePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>noseBaseX<span class="token punctuation">,</span> noseBaseY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;nose base&quot;</span><span class="token punctuation">,</span> noseBaseX<span class="token punctuation">,</span> noseBaseY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> mouthLeftX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthLeftPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> mouthLeftY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthLeftPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>mouthLeftX<span class="token punctuation">,</span> mouthLeftY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;mouth left&quot;</span><span class="token punctuation">,</span> mouthLeftX<span class="token punctuation">,</span> mouthLeftY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> mouthRightX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthRightPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> mouthRightY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthRightPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>mouthRightX<span class="token punctuation">,</span> mouthRightY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;mouth right&quot;</span><span class="token punctuation">,</span> mouthRightX<span class="token punctuation">,</span> mouthRightY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> mouthBottomX <span class="token operator">=</span> <span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthBottomPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> mouthBottomY <span class="token operator">=</span> <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthBottomPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>mouthBottomX<span class="token punctuation">,</span> mouthBottomY<span class="token punctuation">,</span> <span class="token constant">DOT_RADIUS</span><span class="token punctuation">,</span> mHintOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token string">&quot;mouth bottom&quot;</span><span class="token punctuation">,</span> mouthBottomX<span class="token punctuation">,</span> mouthBottomY <span class="token operator">+</span> <span class="token constant">TEXT_OFFSET_Y</span><span class="token punctuation">,</span> mHintTextPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what you should note about this revised method:</p><ol><li>Because face data will change very quickly, these checks are necessary to confirm that any objects that you extract from <code>mFaceData</code> are not <code>null</code> before using their data. Without these checks, the app will crash.</li><li>This part, which verbose, is fairly straightforward: it extracts the coordinates for each landmark and uses them to draw dots and identify text over the appropriate locations on the tracked face.</li></ol><p>Run the app. You should get results similar to this…</p><p>![Landmarks detected with the Face API](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-02-1.jpg =240x)</p><p>…or with multiple faces, results like this:</p><p>![Landmarks with multiple faces](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-05.jpg =240x)</p><p>Now that you can identify landmarks on faces, you can start drawing cartoon features over them! But first, let’s talk about facial classifications.</p><hr><h2 id="classifications" tabindex="-1"><a class="header-anchor" href="#classifications"><span>Classifications</span></a></h2><p>The <code>Face</code> class provides classifications through these methods:</p><ol><li><code>getIsLeftEyeOpenProbability</code> and <code>getIsRightEyeOpenProbability</code>: The probability that the specified eye is open or closed, and</li><li><code>getIsSmilingProbability</code>: The probability that the face is smiling.</li></ol><p>Both return <code>floats</code> with a range of 0.0 (highly unlikely) to 1.0 (bet everything on it). You’ll use the results from these methods to determine whether an eye is open and whether a face is smiling and pass that information along to <code>FaceGraphic</code>.</p><p>Modify <code>FaceTracker</code> to make use of classifications. First, add two new instance variables to the <code>FaceTracker</code> class to keep track of the previous eye states. As with landmarks, when subjects move around quickly, the detector may fail to determine eye states, and that’s when having the previous state comes in handy:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">boolean</span> mPreviousIsLeftEyeOpen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">boolean</span> mPreviousIsRightEyeOpen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>onUpdate</code> also needs to be updated as follows:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token class-name">FaceDetector<span class="token punctuation">.</span>Detections</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Face</span><span class="token punctuation">&gt;</span></span> detectionResults<span class="token punctuation">,</span> <span class="token class-name">Face</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mOverlay<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mFaceGraphic<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">updatePreviousLandmarkPositions</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Get face dimensions.</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Get the positions of facial landmarks.</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setLeftEyePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EYE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setRightEyePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EYE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_CHEEK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_CHEEK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setNoseBasePosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">NOSE_BASE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_EAR_TIP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_EAR_TIP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthLeftPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">LEFT_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthBottomPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">BOTTOM_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setMouthRightPosition</span><span class="token punctuation">(</span><span class="token function">getLandmarkPosition</span><span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token class-name">Landmark</span><span class="token punctuation">.</span><span class="token constant">RIGHT_MOUTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">EYE_CLOSED_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">0.4f</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> leftOpenScore <span class="token operator">=</span> face<span class="token punctuation">.</span><span class="token function">getIsLeftEyeOpenProbability</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>leftOpenScore <span class="token operator">==</span> <span class="token class-name">Face</span><span class="token punctuation">.</span><span class="token constant">UNCOMPUTED_PROBABILITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    mFaceData<span class="token punctuation">.</span><span class="token function">setLeftEyeOpen</span><span class="token punctuation">(</span>mPreviousIsLeftEyeOpen<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    mFaceData<span class="token punctuation">.</span><span class="token function">setLeftEyeOpen</span><span class="token punctuation">(</span>leftOpenScore <span class="token operator">&gt;</span> <span class="token constant">EYE_CLOSED_THRESHOLD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    mPreviousIsLeftEyeOpen <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">isLeftEyeOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">float</span> rightOpenScore <span class="token operator">=</span> face<span class="token punctuation">.</span><span class="token function">getIsRightEyeOpenProbability</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>rightOpenScore <span class="token operator">==</span> <span class="token class-name">Face</span><span class="token punctuation">.</span><span class="token constant">UNCOMPUTED_PROBABILITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    mFaceData<span class="token punctuation">.</span><span class="token function">setRightEyeOpen</span><span class="token punctuation">(</span>mPreviousIsRightEyeOpen<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    mFaceData<span class="token punctuation">.</span><span class="token function">setRightEyeOpen</span><span class="token punctuation">(</span>rightOpenScore <span class="token operator">&gt;</span> <span class="token constant">EYE_CLOSED_THRESHOLD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    mPreviousIsRightEyeOpen <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">isRightEyeOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  <span class="token comment">// See if there&#39;s a smile!</span></span>
<span class="line">  <span class="token comment">// Determine if person is smiling.</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">SMILING_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">0.8f</span><span class="token punctuation">;</span></span>
<span class="line">  mFaceData<span class="token punctuation">.</span><span class="token function">setSmiling</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getIsSmilingProbability</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token constant">SMILING_THRESHOLD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  mFaceGraphic<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>mFaceData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here are the changes:</p><ol><li><code>FaceGraphic</code> should be responsible simply for drawing graphics over faces, not determining whether an eye is open or closed based on the face detector’s probability assessments. This means that <code>FaceTracker</code> should do those calculations and provide <code>FaceGraphic</code> with ready-to-eat data in the form of a <code>FaceData</code> instance. These calculations take the results from <code>getIsLeftEyeOpenProbability</code> and <code>getIsRightEyeOpenProbability</code> and turn them into a simple <code>true</code>/<code>false</code> value. If the detector thinks that there’s a greater than 40% chance that an eye is open, it’s considered open.</li><li>You’ll do the same for smiling with <code>getIsSmilingProbability</code>, but more strictly. If the detector thinks that there’s a greater than 80% chance that the face is smiling, it’s considered to be smiling.</li></ol><hr><h2 id="giving-faces-the-cartoon-treatment" tabindex="-1"><a class="header-anchor" href="#giving-faces-the-cartoon-treatment"><span>Giving Faces the Cartoon Treatment</span></a></h2><p>Now that you’re collecting landmarks and classifications, you can now overlay any tracked face with these cartoon features:</p><ul><li>Cartoon eyes over the real eyes, with each cartoon eye reflecting the real eye’s open/closed state</li><li>A pig nose over the real nose</li><li>A mustache</li><li>If the tracked face is smiling, the cartoon irises in its cartoon eyes are rendered as smiling stars.</li></ul><p>This requires the following changes to <code>FaceGraphic</code>’s <code>draw</code> method:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DOT_RADIUS</span> <span class="token operator">=</span> <span class="token number">3.0f</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">TEXT_OFFSET_Y</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">30.0f</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Confirm that the face and its features are still visible</span></span>
<span class="line">  <span class="token comment">// before drawing any graphics over it.</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>mFaceData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token class-name">PointF</span> detectPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectLeftEyePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getLeftEyePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectRightEyePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getRightEyePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectNoseBasePosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getNoseBasePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthLeftPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthLeftPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthBottomPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthBottomPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> detectMouthRightPosition <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getMouthRightPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>detectPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectLeftEyePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectRightEyePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectNoseBasePosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthLeftPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthBottomPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">      <span class="token punctuation">(</span>detectMouthRightPosition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Face position and dimensions</span></span>
<span class="line">  <span class="token class-name">PointF</span> position <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                               <span class="token function">translateY</span><span class="token punctuation">(</span>detectPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> width <span class="token operator">=</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>mFaceData<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> height <span class="token operator">=</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>mFaceData<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Eye coordinates</span></span>
<span class="line">  <span class="token class-name">PointF</span> leftEyePosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectLeftEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectLeftEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> rightEyePosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectRightEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectRightEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Eye state</span></span>
<span class="line">  <span class="token keyword">boolean</span> leftEyeOpen <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">isLeftEyeOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">boolean</span> rightEyeOpen <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">isRightEyeOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Nose coordinates</span></span>
<span class="line">  <span class="token class-name">PointF</span> noseBasePosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectNoseBasePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectNoseBasePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Mouth coordinates</span></span>
<span class="line">  <span class="token class-name">PointF</span> mouthLeftPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthLeftPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthLeftPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> mouthRightPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthRightPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthRightPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">PointF</span> mouthBottomPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token function">translateX</span><span class="token punctuation">(</span>detectMouthBottomPosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">translateY</span><span class="token punctuation">(</span>detectMouthBottomPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Smile state</span></span>
<span class="line">  <span class="token keyword">boolean</span> smiling <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">isSmiling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Calculate the distance between the eyes using Pythagoras&#39; formula,</span></span>
<span class="line">  <span class="token comment">// and we&#39;ll use that distance to set the size of the eyes and irises.</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">EYE_RADIUS_PROPORTION</span> <span class="token operator">=</span> <span class="token number">0.45f</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">IRIS_RADIUS_PROPORTION</span> <span class="token operator">=</span> <span class="token constant">EYE_RADIUS_PROPORTION</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> distance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span>rightEyePosition<span class="token punctuation">.</span>x <span class="token operator">-</span> leftEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>rightEyePosition<span class="token punctuation">.</span>x <span class="token operator">-</span> leftEyePosition<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span></span>
<span class="line">      <span class="token punctuation">(</span>rightEyePosition<span class="token punctuation">.</span>y <span class="token operator">-</span> leftEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>rightEyePosition<span class="token punctuation">.</span>y <span class="token operator">-</span> leftEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> eyeRadius <span class="token operator">=</span> <span class="token constant">EYE_RADIUS_PROPORTION</span> <span class="token operator">*</span> distance<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> irisRadius <span class="token operator">=</span> <span class="token constant">IRIS_RADIUS_PROPORTION</span> <span class="token operator">*</span> distance<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Draw the eyes.</span></span>
<span class="line">  <span class="token function">drawEye</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> leftEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> leftEyePosition<span class="token punctuation">,</span> irisRadius<span class="token punctuation">,</span> leftEyeOpen<span class="token punctuation">,</span> smiling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">drawEye</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> rightEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> rightEyePosition<span class="token punctuation">,</span> irisRadius<span class="token punctuation">,</span> rightEyeOpen<span class="token punctuation">,</span> smiling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Draw the nose.</span></span>
<span class="line">  <span class="token function">drawNose</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> noseBasePosition<span class="token punctuation">,</span> leftEyePosition<span class="token punctuation">,</span> rightEyePosition<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Draw the mustache.</span></span>
<span class="line">  <span class="token function">drawMustache</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> noseBasePosition<span class="token punctuation">,</span> mouthLeftPosition<span class="token punctuation">,</span> mouthRightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>…and add the following methods to draw the eyes, nose, and mustache:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawEye</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span></span>
<span class="line">                     <span class="token class-name">PointF</span> eyePosition<span class="token punctuation">,</span> <span class="token keyword">float</span> eyeRadius<span class="token punctuation">,</span></span>
<span class="line">                     <span class="token class-name">PointF</span> irisPosition<span class="token punctuation">,</span> <span class="token keyword">float</span> irisRadius<span class="token punctuation">,</span></span>
<span class="line">                     <span class="token keyword">boolean</span> eyeOpen<span class="token punctuation">,</span> <span class="token keyword">boolean</span> smiling<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>eyeOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>eyePosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> eyePosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> mEyeWhitePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>smiling<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      mHappyStarGraphic<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>irisPosition<span class="token punctuation">.</span>x <span class="token operator">-</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>irisPosition<span class="token punctuation">.</span>y <span class="token operator">-</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>irisPosition<span class="token punctuation">.</span>x <span class="token operator">+</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>irisPosition<span class="token punctuation">.</span>y <span class="token operator">+</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      mHappyStarGraphic<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>irisPosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> irisPosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> irisRadius<span class="token punctuation">,</span> mIrisPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>eyePosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> eyePosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> mEyelidPaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> y <span class="token operator">=</span> eyePosition<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> start <span class="token operator">=</span> eyePosition<span class="token punctuation">.</span>x <span class="token operator">-</span> eyeRadius<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> end <span class="token operator">=</span> eyePosition<span class="token punctuation">.</span>x <span class="token operator">+</span> eyeRadius<span class="token punctuation">;</span></span>
<span class="line">    canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> y<span class="token punctuation">,</span> end<span class="token punctuation">,</span> y<span class="token punctuation">,</span> mEyeOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>eyePosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> eyePosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> mEyeOutlinePaint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawNose</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span></span>
<span class="line">                      <span class="token class-name">PointF</span> noseBasePosition<span class="token punctuation">,</span></span>
<span class="line">                      <span class="token class-name">PointF</span> leftEyePosition<span class="token punctuation">,</span> <span class="token class-name">PointF</span> rightEyePosition<span class="token punctuation">,</span></span>
<span class="line">                      <span class="token keyword">float</span> faceWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">NOSE_FACE_WIDTH_RATIO</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> noseWidth <span class="token operator">=</span> faceWidth <span class="token operator">*</span> <span class="token constant">NOSE_FACE_WIDTH_RATIO</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>noseBasePosition<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>noseWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>noseBasePosition<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>noseWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>leftEyePosition<span class="token punctuation">.</span>y <span class="token operator">+</span> rightEyePosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> bottom <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>noseBasePosition<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  mPigNoseGraphic<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mPigNoseGraphic<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawMustache</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span></span>
<span class="line">                          <span class="token class-name">PointF</span> noseBasePosition<span class="token punctuation">,</span></span>
<span class="line">                          <span class="token class-name">PointF</span> mouthLeftPosition<span class="token punctuation">,</span> <span class="token class-name">PointF</span> mouthRightPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>mouthLeftPosition<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>noseBasePosition<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>mouthRightPosition<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> bottom <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>mouthLeftPosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mouthRightPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>mIsFrontFacing<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    mMustacheGraphic<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    mMustacheGraphic<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  mMustacheGraphic<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Run the app and start pointing the camera at faces. For non-smiling faces with both eyes open, you should see something like this:</p><p>![Augmented reality at work - cartoon faced baby](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-06.jpg =240x)</p><p>This one’s of me winking with my right eye (hence it’s closed) and smiling (which is why my iris is a smiling star):</p><p>![Augmented Reality-Me smiling as a cartoon with winking eyes](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-07.jpg =240x)</p><p>The app will draw cartoon features over a small number of faces simultaneously…</p><p>![Augmented Reality-Multiple faces with cartoon overlay](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-08.jpg =240x)</p><p>…and even over faces in illustrations if they’re realistic enough:</p><p>![Augmented Reality-Sketch that looks like a face recognized by the Face API](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-09.jpg =240x)</p><p>It’s a lot more like Snapchat now!</p><hr><h2 id="what-s-your-angle" tabindex="-1"><a class="header-anchor" href="#what-s-your-angle"><span>What’s Your Angle?</span></a></h2><p>The Face API provides another measurement: <strong>Euler angles</strong>.</p><p>Pronounced “Oiler” and named after mathematician <a href="https://en.wikipedia.org/wiki/Leonhard_Euler" target="_blank" rel="noopener noreferrer">Leonhard Euler</a>, these describe the orientation of detected faces. The API uses the x-, y-, and z- coordinate system below.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/x-y-and-z-axes-for-euler-angles-1.jpg" alt="Augmented Reality-euler angles" tabindex="0" loading="lazy"><figcaption>Augmented Reality-euler angles</figcaption></figure><p>…and reports the following Euler angles for each detected face.</p><p>![Euler Y rotation](https://koenig-media.raywenderlich.com/uploads/2017/05/eulerYRotation.gif =240x)</p><p>![Euler Z rotation](https://koenig-media.raywenderlich.com/uploads/2017/05/eulerZRotation.gif =240x)</p><ol><li>The <strong>Euler y angle</strong>, which is its angle rotation around the y-axis. When you shake your head to say “no” as shown below, you’re rotating your head back and forth around the y-axis. This angle is detected only if the detector is set to <code>ACCURATE_MODE</code>.</li><li>The <strong>Euler z angle</strong>, which measures its rotation around the z-axis. When you bobble your head from side to side as illustrated below, you’re rotating your head back and forth around the z-axis.</li></ol><p>Open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceTracker.java</code> and add support for Euler angles by adding these lines to its <code>onUpdate()</code> method, after the call to <code>updatePreviousLandmarkPositions</code>:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// Get head angles.</span></span>
<span class="line">mFaceData<span class="token punctuation">.</span><span class="token function">setEulerY</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getEulerY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mFaceData<span class="token punctuation">.</span><span class="token function">setEulerZ</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span><span class="token function">getEulerZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You’ll make use of the Euler z angle to modify <code>FaceGraphic</code> so that it draws a hat on any face whose Euler z angle is greater than 20 degrees to one side.</p><p>Open <i class="vp-icon fa-brands fa-java" sizing="height"></i><code>FaceGraphic.java</code> and add the following to the end of draw:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// Head tilt</span></span>
<span class="line"><span class="token keyword">float</span> eulerY <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getEulerY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">float</span> eulerZ <span class="token operator">=</span> mFaceData<span class="token punctuation">.</span><span class="token function">getEulerZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Draw the hat only if the subject&#39;s head is titled at a sufficiently jaunty angle.</span></span>
<span class="line"><span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">HEAD_TILT_HAT_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">20.0f</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>eulerZ<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token constant">HEAD_TILT_HAT_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">drawHat</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> position<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> noseBasePosition<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>…and add the following <code>drawHat</code> method to the end of the class:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawHat</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">,</span> <span class="token class-name">PointF</span> facePosition<span class="token punctuation">,</span> <span class="token keyword">float</span> faceWidth<span class="token punctuation">,</span> <span class="token keyword">float</span> faceHeight<span class="token punctuation">,</span> <span class="token class-name">PointF</span> noseBasePosition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">HAT_FACE_WIDTH_RATIO</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">HAT_FACE_HEIGHT_RATIO</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">6.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">HAT_CENTER_Y_OFFSET_FACTOR</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">float</span> hatCenterY <span class="token operator">=</span> facePosition<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>faceHeight <span class="token operator">*</span> <span class="token constant">HAT_CENTER_Y_OFFSET_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> hatWidth <span class="token operator">=</span> faceWidth <span class="token operator">*</span> <span class="token constant">HAT_FACE_WIDTH_RATIO</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">float</span> hatHeight <span class="token operator">=</span> faceHeight <span class="token operator">*</span> <span class="token constant">HAT_FACE_HEIGHT_RATIO</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>noseBasePosition<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>hatWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>noseBasePosition<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>hatWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>hatCenterY <span class="token operator">-</span> <span class="token punctuation">(</span>hatHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> bottom <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>hatCenterY <span class="token operator">+</span> <span class="token punctuation">(</span>hatHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mHatGraphic<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mHatGraphic<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Run the app. Now a cute little hat will appear near the top of any head titled at a jaunty angle:</p><p>![augmented reality - baby with a hat, googly eyes and a moustache](https://koenig-media.raywenderlich.com/uploads/2017/05/facespotter-screenshot-10.jpg =240x)</p><hr><h2 id="bouncing-irises" tabindex="-1"><a class="header-anchor" href="#bouncing-irises"><span>Bouncing Irises</span></a></h2><p>Finally, you’ll use a simple physics engine to make the irises bounce around. This requires two simple changes to <code>FaceGraphic</code>. First, you need to declare two new instance variables, which provide a physics engine for each eye. Put these just below the declaration for the <code>Drawable</code> instance variables:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// We want each iris to move independently, so each one gets its own physics engine.</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">EyePhysics</span> mLeftPhysics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EyePhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">EyePhysics</span> mRightPhysics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EyePhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The second change goes in the call to <code>FaceGraphic</code>’s <code>draw</code> method. Until now, you’ve set the iris positions to the same coordinates as the eye positions.</p><p>Now, modify the code in <code>draw</code>’s “draw the eyes” section to use the physics engines to determine each iris’ position:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// Draw the eyes.</span></span>
<span class="line"><span class="token class-name">PointF</span> leftIrisPosition <span class="token operator">=</span> mLeftPhysics<span class="token punctuation">.</span><span class="token function">nextIrisPosition</span><span class="token punctuation">(</span>leftEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">drawEye</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> leftEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> leftIrisPosition<span class="token punctuation">,</span> irisRadius<span class="token punctuation">,</span> leftEyeOpen<span class="token punctuation">,</span> smiling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">PointF</span> rightIrisPosition <span class="token operator">=</span> mRightPhysics<span class="token punctuation">.</span><span class="token function">nextIrisPosition</span><span class="token punctuation">(</span>rightEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> irisRadius<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">drawEye</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> rightEyePosition<span class="token punctuation">,</span> eyeRadius<span class="token punctuation">,</span> rightIrisPosition<span class="token punctuation">,</span> irisRadius<span class="token punctuation">,</span> rightEyeOpen<span class="token punctuation">,</span> smiling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Run the app. Now everyone has googly (pun somewhat intended) eyes!</p><p>![Augmented Reality-googly eyes](https://koenig-media.raywenderlich.com/uploads/2017/05/googly.gif =240x)</p><hr><h2 id="where-to-go-from-here" tabindex="-1"><a class="header-anchor" href="#where-to-go-from-here"><span>Where to Go From Here?</span></a></h2><p>You can download the final project <a href="https://koenig-media.raywenderlich.com/uploads/2017/05/FaceSpotter-final.zip" target="_blank" rel="noopener noreferrer">here</a>.</p><p>You’ve made the journey from augmented reality and face detection newbie to…well, maybe not grizzled veteran, but someone who now knows how to make use of both in Android apps.</p><p>Now that you’ve gone through a few iterations of the app, from starter version to finished version, you should have no trouble understanding this diagram showing how FaceSpotter’s objects are related:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/04/facespotter-object-diagram-650x418.png" alt="augmented reality" tabindex="0" loading="lazy"><figcaption>augmented reality</figcaption></figure><p>A good next step would be to take a closer look at Google’s Mobile Vision site, and particularly the section on the Face API.</p><p>Reading other people’s code is a great way to learn things, and Google’s android-vision GitHub repository is a treasure trove of ideas and code.</p><p>If you have any questions or comments, please join the discussion below!</p><p>[download-material]</p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/kodeco.com/523-augmented-reality-in-android-with-google-s-face-api.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/java-android/articles/" aria-label="/programming/java-android/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/java-android/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/kodeco.com/324-viewpager-tutorial-getting-started-in-kotlin.html" aria-label="ViewPager Tutorial - Getting Started in Kotlin"><div class="hint">Next<span class="arrow end"></span></div><div class="link">ViewPager Tutorial - Getting Started in Kotlin<i class="vp-icon fa-brands fa-android" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
