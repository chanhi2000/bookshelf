<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑","image":["https://chanhi2000.github.io/bookshelf/assets/image/d2.naver.com/2690202/1.png"],"datePublished":"2024-03-29T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/d2.naver.com/2690202.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑"><meta property="og:description" content="Article(s) > Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑"><meta property="og:type" content="article"><meta property="og:image" content="https://chanhi2000.github.io/bookshelf/assets/image/d2.naver.com/2690202/banner.png"><meta property="og:locale" content="ko-KR"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://chanhi2000.github.io/bookshelf/assets/image/d2.naver.com/2690202/banner.png"><meta name="twitter:image:alt" content="Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑"><meta property="article:tag" content="golang"><meta property="article:tag" content="go"><meta property="article:tag" content="d2.naver.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2024-03-29T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑 | 📚Bookshelf</title><meta name="description" content="Article(s) > Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">d2.naver.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/6532276.html" aria-label="User-Agent Client Hints의 도입, UA 프리징을 대비하라"><!--[--><i class="vp-icon fa-brands fa-node" sizing="both"></i><!--]-->User-Agent Client Hints의 도입, UA 프리징을 대비하라<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1329.html" aria-label="Java Garbage Collection"><!--[--><i class="vp-icon fa-brands fa-java" sizing="both"></i><!--]-->Java Garbage Collection<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1336.html" aria-label="WebSocket과 Socket.io"><!--[--><i class="vp-icon fa-brands fa-java" sizing="both"></i><!--]-->WebSocket과 Socket.io<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1341.html" aria-label="Spring-Test-MVC 프로젝트 소개"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->Spring-Test-MVC 프로젝트 소개<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/994.html" aria-label="AMIGO - 행위 기반 악성코드 탐지"><!--[--><i class="vp-icon fas fa-shield-halved" sizing="both"></i><!--]-->AMIGO - 행위 기반 악성코드 탐지<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1011.html" aria-label="Git vs. Mercurial"><!--[--><i class="vp-icon iconfont icon-git" sizing="both"></i><!--]-->Git vs. Mercurial<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1016.html" aria-label="Hadoop과 MongoDB를 이용한 로그분석시스템"><!--[--><i class="vp-icon iconfont icon-hadoop" sizing="both"></i><!--]-->Hadoop과 MongoDB를 이용한 로그분석시스템<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1039.html" aria-label="NoSQL 가용성과 운영 안정성"><!--[--><i class="vp-icon iconfont icon-apachecassandra" sizing="both"></i><!--]-->NoSQL 가용성과 운영 안정성<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1042.html" aria-label="분산 고속 저장소 nStore"><!--[--><i class="vp-icon fas fa-database" sizing="both"></i><!--]-->분산 고속 저장소 nStore<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1052.html" aria-label="RTCS 실시간 웹 서비스를 위한 도전"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->RTCS 실시간 웹 서비스를 위한 도전<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1062.html" aria-label="uMon의 이해"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->uMon의 이해<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8842776.html" aria-label="HTTPS 전환 후 서버 메모리는 안녕한가요?"><!--[--><i class="vp-icon iconfont icon-shell" sizing="both"></i><!--]-->HTTPS 전환 후 서버 메모리는 안녕한가요?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/0590136.html" aria-label="사용자의 액션에 반응하는 UI 라이브러리, eg.Axes"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->사용자의 액션에 반응하는 UI 라이브러리, eg.Axes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/0853669.html" aria-label="Kafka NetworkClient Internals"><!--[--><i class="vp-icon iconfont icon-apachekafka" sizing="both"></i><!--]-->Kafka NetworkClient Internals<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/6445508.html" aria-label="HDFS 쓰기 파이프라인을 활용한 HBase의 WAL 쓰기 최적화"><!--[--><i class="vp-icon fa-brands fa-java" sizing="both"></i><!--]-->HDFS 쓰기 파이프라인을 활용한 HBase의 WAL 쓰기 최적화<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8404108.html" aria-label="프로파일링 적용기 - 당신의 Go 애플리케이션은 좀 더 나아질 수 있다"><!--[--><i class="vp-icon fa-brands fa-golang" sizing="both"></i><!--]-->프로파일링 적용기 - 당신의 Go 애플리케이션은 좀 더 나아질 수 있다<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1203723.html" aria-label="Virtual Thread의 기본 개념 이해하기"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->Virtual Thread의 기본 개념 이해하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/9581727.html" aria-label="일 3,000만 건의 네이버페이 주문 메시지를 처리하는 Kafka 시스템의 무중단 전환 사례"><!--[--><i class="vp-icon iconfont icon-apachekafka" sizing="both"></i><!--]-->일 3,000만 건의 네이버페이 주문 메시지를 처리하는 Kafka 시스템의 무중단 전환 사례<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8588537.html" aria-label="Golang, 그대들은 어떻게 할 것인가 - 1. 들어가며"><!--[--><i class="vp-icon fa-brands fa-golang" sizing="both"></i><!--]-->Golang, 그대들은 어떻게 할 것인가 - 1. 들어가며<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/6178029.html" aria-label="Golang, 그대들은 어떻게 할 것인가 - 2. MongoDB Go Driver 추상화"><!--[--><i class="vp-icon fa-brands fa-golang" sizing="both"></i><!--]-->Golang, 그대들은 어떻게 할 것인가 - 2. MongoDB Go Driver 추상화<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/d2.naver.com/2690202.html" aria-label="Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑"><!--[--><i class="vp-icon fa-brands fa-golang" sizing="both"></i><!--]-->Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/6507662.html" aria-label="Golang, 그대들은 어떻게 할 것인가 - 4. error 핸들링"><!--[--><i class="vp-icon fa-brands fa-golang" sizing="both"></i><!--]-->Golang, 그대들은 어떻게 할 것인가 - 4. error 핸들링<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8113611.html" aria-label="네이버 통합 검색의 웹 성능 - 모니터링과 성능 개선"><!--[--><i class="vp-icon fas fa-gauge" sizing="both"></i><!--]-->네이버 통합 검색의 웹 성능 - 모니터링과 성능 개선<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/2461452.html" aria-label="UX 원칙에 따른 NELO 4.0 개발기"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->UX 원칙에 따른 NELO 4.0 개발기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/5564264.html" aria-label="쿠버네티스 네이티브 사이드카 컨테이너 (Sidecar Containers)"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->쿠버네티스 네이티브 사이드카 컨테이너 (Sidecar Containers)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/7472830.html" aria-label="infer, never만 보면 두려워지는 당신을 위한 고급 TypeScript"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->infer, never만 보면 두려워지는 당신을 위한 고급 TypeScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/0680815.html" aria-label="실시간 광고 사용자 ID 매핑"><!--[--><i class="vp-icon iconfont icon-apachespark" sizing="both"></i><!--]-->실시간 광고 사용자 ID 매핑<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/0623656.html" aria-label="DESIGN SYSTEM FOR Android: From Figma to Jetpack Compose"><!--[--><i class="vp-icon fa-brands fa-figma" sizing="both"></i><!--]-->DESIGN SYSTEM FOR Android: From Figma to Jetpack Compose<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/7030870.html" aria-label="디자인시스템을 개발에서 적용 하는법"><!--[--><i class="vp-icon fa-brands fa-figma" sizing="both"></i><!--]-->디자인시스템을 개발에서 적용 하는법<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8011540.html" aria-label="Writing Path: MBTI J처럼 체계적으로 글쓰는 AI"><!--[--><i class="vp-icon fas fa-language" sizing="both"></i><!--]-->Writing Path: MBTI J처럼 체계적으로 글쓰는 AI<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/2905424.html" aria-label="Kubernetes에서 DNS 다루는 방법 - 도메인을 찾아서"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Kubernetes에서 DNS 다루는 방법 - 도메인을 찾아서<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/7282210.html" aria-label="보낼 로그가 1000개가 되는동안 겪었던 고민들"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->보낼 로그가 1000개가 되는동안 겪었던 고민들<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/7321313.html" aria-label="시간은 금이다: LLM을 이용한 AI 코드 리뷰 도입기"><!--[--><i class="vp-icon fas fa-language" sizing="both"></i><!--]-->시간은 금이다: LLM을 이용한 AI 코드 리뷰 도입기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/9283310.html" aria-label="infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 기초 타입 이론"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 기초 타입 이론<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/3713986.html" aria-label="infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 고급 타입 추론"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 고급 타입 추론<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/5088940.html" aria-label="infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 응용 문제"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->infer, never만 보면 두려워지는 당신을 위한 타입 추론 - 응용 문제<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/0281668.html" aria-label="네이버 검색 SRE - 상위 레벨 모니터링 시스템"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->네이버 검색 SRE - 상위 레벨 모니터링 시스템<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/1623894.html" aria-label="네이버 검색 SRE - 지진과 비상 대응 시스템"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->네이버 검색 SRE - 지진과 비상 대응 시스템<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/7989422.html" aria-label="실시간 광고 사용자 ID 매핑"><!--[--><i class="vp-icon fa-brands fa-python" sizing="both"></i><!--]-->실시간 광고 사용자 ID 매핑<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/d2.naver.com/8149881.html" aria-label="GitHub Actions를 이용한 코드 리뷰 문화 개선기"><!--[--><i class="vp-icon iconfont icon-github" sizing="both"></i><!--]-->GitHub Actions를 이용한 코드 리뷰 문화 개선기<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="/bookshelf/assets/image/d2.naver.com/2690202/banner.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-golang" sizing="height"></i>Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">24. 3. 29.</span><meta property="datePublished" content="2024-03-29T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 3 min</span><meta property="timeRequired" content="PT3M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2" role>Go</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Go,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color8" role>d2.naver.com</span><span class="page-tag-item color5" role>go</span><span class="page-tag-item color5" role>golang</span><!--]--><meta property="keywords" content="blog,d2.naver.com,go,golang"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/go/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Go > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#기존-문제점" class="router-link-active router-link-exact-active">기존 문제점</a></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#사전-조사" class="router-link-active router-link-exact-active">사전 조사</a><ul><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#_1-pkg-errors-wrap" class="router-link-active router-link-exact-active">1. <i class="vp-icon iconfont icon-github" sizing="height"></i>pkg/errors Wrap()</a></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#_2-fmt-errorf-w-err" class="router-link-active router-link-exact-active">2. fmt.Errorf(”%w”, err)</a></li></ul></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#고민" class="router-link-active router-link-exact-active">고민</a></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#개발-과정" class="router-link-active router-link-exact-active">개발 과정</a><ul><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#위치-및-이름" class="router-link-active router-link-exact-active">위치 및 이름</a></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#추가-message-및-이전-error-내용" class="router-link-active router-link-exact-active">추가 message 및 이전 error 내용</a></li></ul></li><li><a aria-current="page" href="/bookshelf/d2.naver.com/2690202.html#마치며" class="router-link-active router-link-exact-active">마치며</a></li></ul></nav><hr><div class="vp-site-info" data-name="Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑 | NAVER D2"><a class="vp-site-info-navigator no-external-link-icon" title="Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑 | NAVER D2" href="https://d2.naver.com/helloworld/2690202" target="_blank"></a><div class="vp-site-info-preview" style="background:url(/bookshelf/assets/image/d2.naver.com/2690202/banner.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="/assets/image/d2.naver.com/favicon.ico" alt loading="lazy" no-view><div class="vp-site-info-name">Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑 | NAVER D2</div><div class="vp-site-info-desc">Golang, 그대들은 어떻게 할 것인가 - 3. error 래핑</div></div><!----></div><div></div> <p><a class="route-link" href="/bookshelf/d2.naver.com/6178029.html">앞 글</a>에서는 각 서버에 산재해 있던 MongoDB 관련 코드를 공통화 및 추상화하고, DB error 정보를 담을 수 있는 구조를 만들었습니다. 이번에는 이러한 error를 어떻게 상위 함수에 반환했는지에 대해 이야기해보려 합니다.</p><hr><h2 id="기존-문제점" tabindex="-1"><a class="header-anchor" href="#기존-문제점"><span>기존 문제점</span></a></h2><p>Golang에서 error는 caller가 처리하는 것을 권장하고 있습니다.</p><blockquote><p>Avoid duplication. If you return an error, it&#39;s usually better not to log it yourself but rather let the caller handle it. The caller can choose to log the error, or perhaps rate-limit logging using rate.</p><p>출처: <a href="https://google.github.io/styleguide/go/best-practices#logging-errors" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-google" sizing="height"></i>Logging errors</a></p></blockquote><p>error를 상위 함수로 올리면, 상위 함수에서 해당 error에 대해 로그를 남기거나 다른 처리를 하도록 하는 것입니다.</p><p>하지만 다음과 같이 error를 단순히 올리기만 한다면 디버깅할 때 정보가 많이 부족합니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">checkName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">  newError <span class="token operator">:=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid Name&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">&quot;valid name&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> newError</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">  name <span class="token operator">:=</span> <span class="token string">&quot;Hello&quot;</span></span>
<span class="line">  err <span class="token operator">:=</span> <span class="token function">checkName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Invalid Name  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>error message만 보일 뿐, 어느 함수에서 발생했는지 알기 어렵습니다. 특히, 재사용이 많은 함수에서 error가 발생하면 해당 error가 어떤 호출 스택으로 불려 발생했는지 찾기 힘들 것입니다.</p><p>그래서 기존 V1 코드에서는 error가 발생한 지점을 포함하여, 상위 함수로 올리면서 모두 로그를 남겨서 호출 스택을 찾을 수 있게 했었습니다. 하지만 이러한 방식은 <code>함수 이름</code> 정도만이 추가적인 정보일 뿐, 나머지는 모두 중복이었습니다. 또한, 매번 로그를 남겨야하는 불편함도 컸습니다.</p><hr><h2 id="사전-조사" tabindex="-1"><a class="header-anchor" href="#사전-조사"><span>사전 조사</span></a></h2><p>위와 같은 비효율을 없애면서 편하게 호출 스택을 남기는 방법을 고민했고, 두 가지 방법을 찾았습니다.</p><h3 id="_1-pkg-errors-wrap" tabindex="-1"><a class="header-anchor" href="#_1-pkg-errors-wrap"><span>1. <a href="http://github.com/pkg/errors" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-github" sizing="height"></i><code>pkg/errors</code></a> <code>Wrap()</code></span></a></h3><p>Go 1.13 미만 버전에서는 표준 라이브러리에서 error 래핑 및 스택 기능을 제공하지 않아, 이를 제공하는 <a href="http://github.com/pkg/errors" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-github" sizing="height"></i><code>pkg/errors</code></a>라는 서드파티 라이브러리를 많이 사용했습니다. 현재는 추가 개발 없이 유지하는 중입니다(이 라이브러리에서 제공하는 기능이 Go 2에 포함될 예정).</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">   <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>sql<span class="token punctuation">.</span>ErrNoRows<span class="token punctuation">,</span> <span class="token string">&quot;foo failed&quot;</span><span class="token punctuation">)</span> <span class="token comment">// attach the call stack</span></span>
<span class="line">   <span class="token comment">// return errors.WithStack(sql.ErrNoRows) // attach the call stack without message</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">   <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">WithMessage</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;bar failed&quot;</span><span class="token punctuation">)</span> <span class="token comment">// without attaching call stack</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">   err <span class="token operator">:=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">   <span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Cause</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">==</span> sql<span class="token punctuation">.</span>ErrNoRows <span class="token punctuation">{</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;data not found, %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*</span>
<span class="line">Output:</span>
<span class="line">data not found, bar failed: foo failed: sql: no rows in result set</span>
<span class="line"></span>
<span class="line">sql: no rows in result set  </span>
<span class="line">foo failed  </span>
<span class="line">main.foo  </span>
<span class="line">    /usr/three/main.go:11</span>
<span class="line">main.bar  </span>
<span class="line">    /usr/three/main.go:15</span>
<span class="line">main.main  </span>
<span class="line">    /usr/three/main.go:19</span>
<span class="line">runtime.main  </span>
<span class="line">    ...</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>간단히 보면 다음과 같습니다.</p><ul><li><code>errors.Wrap(err, message)</code>: 호출 스택 추가</li><li><code>errors.WithMessage(err, message)</code>: 호출 스택은 추가하지 않고 message만 추가</li></ul><p>이렇게 래핑된 err는 상위 함수에서 다음과 같은 형식으로 로그를 출력할 수 있습니다.</p><ul><li><code>%v</code>: 호출 스택의 순서대로 모든 context 텍스트를 포함하는 한 줄 문자열</li><li><code>%+v</code>: 전체 호출 스택</li></ul><h3 id="_2-fmt-errorf-w-err" tabindex="-1"><a class="header-anchor" href="#_2-fmt-errorf-w-err"><span>2. <code>fmt.Errorf(”%w”, err)</code></span></a></h3><p>Go 1.13 이상 버전에서는 표준 라이브러리에 error 래핑 기능이 추가되어, 호출 스택이 필요 없는 경우에는 다음과 같이 간편하게 사용할 수 있습니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;foo error!!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, %w&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    err <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, %w&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;main!!&quot;</span><span class="token punctuation">,</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>string formatting 방식과 비슷하며, <code>%w</code>를 사용하여 message가 아니라 error를 직접 래핑할 수 있습니다.</p><p>그리고 마지막에 <code>%+v</code>로 err를 출력하면, 래핑된 error들이 출력됩니다.</p><div class="language-erlang line-numbers-mode" data-highlighter="prismjs" data-ext="erlang"><pre><code class="language-erlang"><span class="line"><span class="token atom">main</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token atom">bar</span><span class="token punctuation">,</span> <span class="token atom">foo</span> <span class="token atom">error</span><span class="token operator">!</span><span class="token operator">!</span>  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="고민" tabindex="-1"><a class="header-anchor" href="#고민"><span>고민</span></a></h2><p>Golang은 Java나 Python처럼 많은 사람들이 사용하는 언어가 아니어서, 저를 비롯하여 저희 팀에 합류하신 분들 중에서도 Golang을 처음 접하는 경우가 많았습니다. 처음 접하고 개발하다 보면 error 처리에서 어려움을 많이 겪습니다. 그래서 저는 error를 <strong>직관적</strong>이고 <strong>편하게</strong> 처리하는 방법을 만들고 싶었습니다.</p><p>1번 방식의 <code>errors.Wrap()</code>은 분명히 편했습니다. 그러나 무작정 <code>Wrap()</code>을 실행하다 보면 <strong>호출 스택이 재귀적으로 쌓이는 문제</strong>가 있었습니다.</p><details class="hint-container details"><summary>문제 코드 예</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;foo Error!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;bar message&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    err <span class="token operator">:=</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">/*</span>
<span class="line">foo Error!  </span>
<span class="line">main.foo  </span>
<span class="line">    main.go:15</span>
<span class="line">main.bar  </span>
<span class="line">    main.go:18</span>
<span class="line">main.main  </span>
<span class="line">    main.go:22</span>
<span class="line">runtime.main  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/proc.go:250</span>
<span class="line">runtime.goexit  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/asm_amd64.s:1594</span>
<span class="line">bar message  </span>
<span class="line">main.bar  </span>
<span class="line">    main.go:18</span>
<span class="line"></span>
<span class="line">main.main  </span>
<span class="line">    main.go:22</span>
<span class="line">runtime.main  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/proc.go:250</span>
<span class="line">runtime.goexit  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/asm_amd64.s:1594</span>
<span class="line">main.main  </span>
<span class="line">    main.go:22</span>
<span class="line">runtime.main  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/proc.go:250</span>
<span class="line">runtime.goexit  </span>
<span class="line">    /usr/local/go-faketime/src/runtime/asm_amd64.s:1594</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>이 문제를 해결하기 위해 <code>Wrap()</code>을 최하위 함수에서 1번만 사용하고 나머지에서는 <code>WithMessage()</code>를 사용하도록 규칙을 정하면 어떨지 생각해보았습니다.</p><p>여러 명이 개발하고 새로운 사람이 보더라도 <strong>직관적으로 이해할 수 있을지</strong> 고민해보았을 때, 그에 대한 대답은 &#39;<strong>아닐 것 같다</strong>&#39;였습니다. 매번 Wrap이 되었는지 하위 함수로 내려가 확인하는 데 시간이 소모되고, 추가 message를 적고 싶지 않더라도 중복 스택을 쌓지 않기 위해 <code>WithMessage()</code>에 빈 문자열(<code>&quot;&quot;</code>)이라도 넣어야 하는 불편함이 있었습니다. 결국 사용하는 사람이 라이브러리에 대한 이해가 선행되어야 했고, 이는 편하게 사용할 수 있는 방향이 아니라고 생각했습니다.</p><p>반면 2번의 방식은 <strong>호출 스택이 없다는 단점</strong>이 있었습니다. 그러나 formatting 방식으로 error가 래핑되고, message도 쉽게 추가할 수 있었고, 호출 스택을 직접 넣어볼 수도 있겠다는 생각이 들었습니다. 이렇게 개발만 된다면 1번과 같이 라이브러리에 대한 이해가 없더라도 쉽게 이해할 수 있도록 만들 수 있을 것 같았습니다.</p><p>그래서 저는 <strong>2번의 방식을 택하고, 직접 스택 트레이스를 개발</strong>해보기로 했습니다.(직접 만들어 쓰는 게 Golang이죠!)</p><hr><h2 id="개발-과정" tabindex="-1"><a class="header-anchor" href="#개발-과정"><span>개발 과정</span></a></h2><p>우선 스택 트레이스에 어떤 내용이 필요할지 생각해보았습니다.</p><ul><li>함수의 위치 및 이름</li><li>추가 message 및 이전 error 내용</li></ul><p>위 2가지가 필요하다고 판단했고 이를 직접 하나씩 구현해 나갔습니다.</p><h3 id="위치-및-이름" tabindex="-1"><a class="header-anchor" href="#위치-및-이름"><span>위치 및 이름</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// {filename:line} [func name]</span></span>
<span class="line"><span class="token keyword">var</span> funcInfoFormat <span class="token operator">=</span> <span class="token string">&quot;{%s:%d} [%s]&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">getFuncInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>  </span>
<span class="line">    pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    f <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">FuncForPC</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> f <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>funcInfoFormat<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> <span class="token string">&quot;unknwon&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>funcInfoFormat<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>runtime.Caller(skip int)</code> 함수를 통하여, 현재 호출되는 곳에서 <code>skip</code>만큼 상위 호출 스택의 정보를 가져올 수 있습니다. 제공하는 값은 <code>pc</code>(프로그램 카운터), <code>file</code>(함수가 위치한 파일 이름), <code>line</code>(파일 안의 함수 위치)입니다.</p><p><code>runtime.FuncForPC(pc int)</code> 함수로, 앞에서 얻은 상위 함수의 <code>pc</code> 정보를 넘겨, 해당 함수의 정보를 획득할 수 있습니다.</p><p>그리고 마지막으로 <code>f.Name()</code> 메서드로 <code>패키지이름.함수이름</code> 형식의 정보를 가져올 수 있습니다.</p><details class="hint-container details"><summary>사용 예</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">getFuncInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*</span>
<span class="line">{main.go:28} [main.hi]</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="추가-message-및-이전-error-내용" tabindex="-1"><a class="header-anchor" href="#추가-message-및-이전-error-내용"><span>추가 message 및 이전 error 내용</span></a></h3><p>error가 발생하면 어떤 처리가 필요할지 생각해보았습니다.</p><ul><li>단순히 error를 상위로 올린다.</li><li>기존 error에 추가 message를 담아서 상위로 올린다.</li></ul><p>위 2가지 경우가 있었고, 이에 따라 단순히 <strong>이전 error를 래핑</strong>하는 함수와 <strong>추가 message를 함께 래핑</strong>하는 함수, 두 개의 함수를 만들었습니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> wrapFormat <span class="token operator">=</span> <span class="token string">&quot;%s\n%w&quot;</span>  <span class="token comment">// &quot;{file:line} [func name] msg \n error&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Wrap</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ok <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// {file:line} [funcName] msg</span></span>
<span class="line">    stack <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s&quot;</span><span class="token punctuation">,</span> <span class="token function">getFuncInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> stack<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WrapWithMessage</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ok <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    stack <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s&quot;</span><span class="token punctuation">,</span> <span class="token function">getFuncInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> stack<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>runtime.Caller</code>의 skip 조정이 중요하기에 <code>getFuncInfo()</code>는 파라미터로 받도록 조정했고, <code>message \n error</code>의 형식으로 래핑하여 로깅 시 스택의 상단에서부터 error를 출력하도록 했습니다.</p><p>작업을 마친 후 코드를 다시 확인해보니 중복되는 부분이 상당히 많았습니다. 중복 코드를 함수로 추출하고 <code>skip</code>을 한 번 더 조정하여 공통화했습니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">wrap</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ok <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// {file:line} [funcName] msg</span></span>
<span class="line">    stack <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s&quot;</span><span class="token punctuation">,</span> <span class="token function">getFuncInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">,</span> file<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>wrapFormat<span class="token punctuation">,</span> stack<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>위와 같이 skip을 조정하고 공통화할 수 있는 영역을 추출하고, 추가 message가 있는 함수와 없는 함수를 만들었습니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">WrapWithMessage</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> msg<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Wrap</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>이렇게 만든 함수는 다음과 같이 사용할 수 있습니다.</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        err <span class="token operator">=</span> <span class="token function">Wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// 추가 message가 필요 없을 때</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// 하위 함수에서 error 발생</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">WrapWithMessage</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;foo message&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 추가 message가 필요할 때</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;bar Error!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{main.go:24} [main.main]</span>
<span class="line">{main.go:17} [main.foo] foo message</span>
<span class="line">bar Error!  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="마치며" tabindex="-1"><a class="header-anchor" href="#마치며"><span>마치며</span></a></h2><p>여기까지 DB 레이어 공통화 및 error 분류, error 래핑까지 완료했습니다.</p><figure><img src="/bookshelf/assets/image/d2.naver.com/2690202/1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>기존 V1 코드에서 error를 상위로 보낼 때마다 매번 로깅을 하던 불편함을 없애고, 단순히 <code>Wrap(err)</code>만으로 호출 스택을 추가하여 보낼 수 있게 되었습니다.</p><p>다음으로는 이렇게 쌓아올린 error를 상위에서 어떻게 처리했는지에 대해 이야기해보려 합니다.</p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/d2.naver.com/2690202.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/go/articles/" aria-label="/programming/go/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/go/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/d2.naver.com/6507662.html" aria-label="Golang, 그대들은 어떻게 할 것인가 - 4. error 핸들링"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Golang, 그대들은 어떻게 할 것인가 - 4. error 핸들링<i class="vp-icon fa-brands fa-golang" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
