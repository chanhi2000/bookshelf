import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as e,b as l,t as m,n as v,g,w as t,e as a,r as i,o as b}from"./app-BVguHYKu.js";const w={},y={id:"frontmatter-title-관련",tabindex:"-1"},f={class:"header-anchor",href:"#frontmatter-title-관련"},U={class:"table-of-contents"},L={href:"https://bitly.com/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://tinyurl.com/app",target:"_blank",rel:"noopener noreferrer"},S={href:"https://postgresql.org/",target:"_blank",rel:"noopener noreferrer"},x={href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"},q={href:"https://datatracker.ietf.org/doc/html/rfc7231#section-6.4.3",target:"_blank",rel:"noopener noreferrer"},T={href:"https://youtu.be/2UoA_PoEvuA",target:"_blank",rel:"noopener noreferrer"};function C(c,n){const r=i("VPCard"),o=i("router-link"),u=i("SiteInfo"),p=i("VPIcon"),d=i("RouteLink");return b(),h("div",null,[s("h1",y,[s("a",f,[s("span",null,m(c.$frontmatter.title)+" 관련",1)])]),e(r,v(g({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",U,[s("ul",null,[s("li",null,[e(o,{to:"#url-shortener-system-design"},{default:t(()=>n[0]||(n[0]=[a("URL Shortener System Design")])),_:1,__:[0]})]),s("li",null,[e(o,{to:"#the-data-model"},{default:t(()=>n[1]||(n[1]=[a("The Data Model")])),_:1,__:[1]})]),s("li",null,[e(o,{to:"#unique-code-generation"},{default:t(()=>n[2]||(n[2]=[a("Unique Code Generation")])),_:1,__:[2]}),s("ul",null,[s("li",null,[e(o,{to:"#downsides-and-improvement-points"},{default:t(()=>n[3]||(n[3]=[a("Downsides and Improvement Points")])),_:1,__:[3]})])])]),s("li",null,[e(o,{to:"#url-shortening"},{default:t(()=>n[4]||(n[4]=[a("URL Shortening")])),_:1,__:[4]})]),s("li",null,[e(o,{to:"#url-redirection"},{default:t(()=>n[5]||(n[5]=[a("URL Redirection")])),_:1,__:[5]})]),s("li",null,[e(o,{to:"#url-shortener-improvement-points"},{default:t(()=>n[6]||(n[6]=[a("URL Shortener Improvement Points")])),_:1,__:[6]})])])]),n[28]||(n[28]=s("hr",null,null,-1)),e(u,{name:"How to Build a URL Shortener With .NET",desc:"A URL shortener is a simple yet powerful tool that converts long URLs into more manageable, shorter versions. Today, I'll guide you through the design, implementation, and considerations for creating your URL shortener in .NET",url:"https://milanjovanovic.tech/blog/how-to-build-a-url-shortener-with-dotnet/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_074.png"}),s("p",null,[n[9]||(n[9]=a("A ")),n[10]||(n[10]=s("strong",null,"URL shortener",-1)),n[11]||(n[11]=a(" is a simple yet powerful tool that converts long URLs into more manageable, shorter versions. This is particularly useful for sharing links on platforms with character limits or improving user experience by reducing clutter. Two popular URL shorteners are ")),s("a",L,[e(p,{icon:"fas fa-globe"}),n[7]||(n[7]=a("Bitly"))]),n[12]||(n[12]=a(" and ")),s("a",R,[e(p,{icon:"fas fa-globe"}),n[8]||(n[8]=a("TinyURL"))]),n[13]||(n[13]=a(". Designing a URL shortener is an interesting challenge with fun problems to solve."))]),n[29]||(n[29]=s("p",null,"But how would you build a URL shortener in .NET?",-1)),n[30]||(n[30]=s("p",null,"URL shorteners have two core functionalities:",-1)),n[31]||(n[31]=s("ul",null,[s("li",null,"Generating a unique code for a given URL"),s("li",null,"Redirecting users who access the short link to the original URL")],-1)),n[32]||(n[32]=s("p",null,"Today, I'll guide you through the design, implementation, and considerations for creating your URL shortener.",-1)),n[33]||(n[33]=s("hr",null,null,-1)),n[34]||(n[34]=s("h2",{id:"url-shortener-system-design",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#url-shortener-system-design"},[s("span",null,"URL Shortener System Design")])],-1)),s("p",null,[n[16]||(n[16]=a("Here's the high-level system design for our URL shortener. We want to expose two endpoints. One to shorten a long URL and the other to redirect users based on a shortened URL. The shortened URLs are stored in a ")),s("a",S,[e(p,{icon:"iconfont icon-postgresql"}),n[14]||(n[14]=a("PostgreSQL"))]),n[17]||(n[17]=a(" database in this example. We can introduce a distributed cache like ")),s("a",x,[e(p,{icon:"iconfont icon-redis"}),n[15]||(n[15]=a("Redis"))]),n[18]||(n[18]=a(" to the system to improve read performance."))]),n[35]||(n[35]=l(`<figure><img src="https://milanjovanovic.tech/blogs/mnw_074/url_shortener.png?imwidth=3840" alt="URL shortener system design. It contains two API endpoints, a PostgreSQL database, and a Redis cache." tabindex="0" loading="lazy"><figcaption>URL shortener system design. It contains two API endpoints, a PostgreSQL database, and a Redis cache.</figcaption></figure><p>We first need to ensure a large number of short URLs. We&#39;re going to assign a unique code to each long URL, and use it to generate the shortened URL. The unique code length and set of characters determine how many short URLs the system can generate. We will discuss this in more detail when we implement unique code generation.</p><p>We&#39;re going to use the random code generation strategy. It&#39;s straightforward to implement and has an acceptably low rate of collisions. The trade-off we&#39;re making is increased latency, but we will also explore other options.</p><hr><h2 id="the-data-model" tabindex="-1"><a class="header-anchor" href="#the-data-model"><span>The Data Model</span></a></h2><p>Let&#39;s start by figuring out what we will store in the database. Our data model is straightforward. We have a <code>ShortenedUrl</code> class representing the URLs stored in our system:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShortenedUrl</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LongUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ShortUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Code <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedOnUtc <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This class includes properties for the original URL (<code>LongUrl</code>), the shortened URL (<code>ShortUrl</code>), and a unique code (<code>Code</code>) that represents the shortened URL. The <code>Id</code> and <code>CreatedOnUtc</code> fields are used for database and tracking purposes. The users will send the unique <code>Code</code> to our system, which will try to find a matching <code>LongUrl</code> and redirect them.</p><p>In addition, we will also define an EF <code>ApplicationDbContext</code> class, which is responsible for configuring our entity and setting up our database context. I&#39;m doing two things here to improve performance:</p><ul><li>Configuring the <code>Code</code> maximum length with <code>HasMaxLength</code></li><li>Defining a unique index on the <code>Code</code> column</li></ul><p>A unique index shields us from concurrency conflicts, so we will never have duplicate <code>Code</code> values persisted in the database. Setting the maximum length for this column saves storage space, and it&#39;s a requirement for indexing string columns in some databases.</p><p>Note that some databases treat strings in a case-insensitive way. This severely reduces the number of available short URLs. You want to configure the database to treat the unique code in a case-sensitive way.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">ApplicationDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions</span> options<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>ShortenedUrl<span class="token punctuation">&gt;</span></span> ShortenedUrls <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ShortenedUrl<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>builder <span class="token operator">=&gt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            builder</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">Property</span><span class="token punctuation">(</span>shortenedUrl <span class="token operator">=&gt;</span> shortenedUrl<span class="token punctuation">.</span>Code<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">HasMaxLength</span><span class="token punctuation">(</span>ShortLinkSettings<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            builder</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">HasIndex</span><span class="token punctuation">(</span>shortenedUrl <span class="token operator">=&gt;</span> shortenedUrl<span class="token punctuation">.</span>Code<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">IsUnique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="unique-code-generation" tabindex="-1"><a class="header-anchor" href="#unique-code-generation"><span>Unique Code Generation</span></a></h2><p>The most crucial part of our URL shortener is generating a unique code for each URL. There are a few different algorithms you can choose to implement this. We want an even distribution of unique codes across all possible values. This helps to reduce potential collisions.</p><p>I will implement a random, unique code generator with a predefined alphabet. It&#39;s simple to implement, and the chance of collision is relatively low. Still, there are more performant solutions than this, but more on this later.</p><p>Let&#39;s define a <code>ShortLinkSettings</code> class that contains two constants. One is for defining the length of the unqualified code we will generate. The other constant is the alphabet we will use to generate the random code.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ShortLinkSettings</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Length <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> Alphabet <span class="token operator">=</span></span>
<span class="line">        <span class="token string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The alphabet has <code>62</code> characters, which gives us <code>62^7</code> possible unique code combinations.</p><p>If you&#39;re wondering, this is <code>3,521,614,606,208</code> combinations.</p><p>Spelled out: three trillion, five hundred twenty-one billion, six hundred fourteen million, six hundred six thousand, two hundred eight.</p><p>Those are quite a few unique codes, which will be enough for our URL shortener.</p><p>Now, let&#39;s implement our <code>UrlShorteningService</code>, which handles generating unique codes. This service generates a random string of the specified length using our predefined alphabet. It checks against the database to ensure uniqueness.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UrlShorteningService</span><span class="token punctuation">(</span><span class="token class-name">ApplicationDbContext</span> dbContext<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Random</span> _random <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GenerateUniqueCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> codeChars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">char</span></span><span class="token punctuation">[</span>ShortLinkSettings<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> maxValue <span class="token operator">=</span> ShortLinkSettings<span class="token punctuation">.</span>Alphabet<span class="token punctuation">.</span>Length<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShortLinkSettings<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name"><span class="token keyword">var</span></span> randomIndex <span class="token operator">=</span> _random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>maxValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                codeChars<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ShortLinkSettings<span class="token punctuation">.</span>Alphabet<span class="token punctuation">[</span>randomIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> code <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">(</span>codeChars<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">await</span> dbContext<span class="token punctuation">.</span>ShortenedUrls<span class="token punctuation">.</span><span class="token function">AnyAsync</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Code <span class="token operator">==</span> code<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> code<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="downsides-and-improvement-points" tabindex="-1"><a class="header-anchor" href="#downsides-and-improvement-points"><span>Downsides and Improvement Points</span></a></h3><p>The downside of this implementation is increased latency because we&#39;re checking each code we generate against the database. An improvement point could be generating the unique codes in the database ahead of time.</p><p>Another improvement point could be using a fixed number of iterations instead of an infinite loop. In case of multiple collisions in a row, the current implementation would continue until a unique value is found. Consider throwing an exception instead after a few collisions in a row.</p><hr><h2 id="url-shortening" tabindex="-1"><a class="header-anchor" href="#url-shortening"><span>URL Shortening</span></a></h2><p>Now that our core business logic is ready, we can expose an endpoint to shorten URLs. We can use a simple Minimal API endpoint.</p><p>This endpoint accepts a URL, validates it, and then uses the <code>UrlShorteningService</code> to create a shortened URL, which is then saved to the database. We return the full shortened URL to the client.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">ShortenUrlRequest</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> Url<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">MapPost</span><span class="token punctuation">(</span><span class="token string">&quot;shorten&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">ShortenUrlRequest</span> request<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">UrlShorteningService</span> urlShorteningService<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">ApplicationDbContext</span> dbContext<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">HttpContext</span> httpContext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Uri<span class="token punctuation">.</span><span class="token function">TryCreate</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Url<span class="token punctuation">,</span> UriKind<span class="token punctuation">.</span>Absolute<span class="token punctuation">,</span> <span class="token keyword">out</span> _<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string">&quot;The specified URL is invalid.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> code <span class="token operator">=</span> <span class="token keyword">await</span> urlShorteningService<span class="token punctuation">.</span><span class="token function">GenerateUniqueCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> httpContext<span class="token punctuation">.</span>Request<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> shortenedUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ShortenedUrl</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        LongUrl <span class="token operator">=</span> request<span class="token punctuation">.</span>Url<span class="token punctuation">,</span></span>
<span class="line">        Code <span class="token operator">=</span> code<span class="token punctuation">,</span></span>
<span class="line">        ShortUrl <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Scheme</span><span class="token punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Host</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">code</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span></span>
<span class="line">        CreatedOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    dbContext<span class="token punctuation">.</span>ShortenedUrls<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>shortenedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">await</span> dbContext<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Ok</span><span class="token punctuation">(</span>shortenedUrl<span class="token punctuation">.</span>ShortUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,33)),s("p",null,[n[20]||(n[20]=a("There is a minor ")),e(d,{to:"/milanjovanovic.tech/solving-race-conditions-with-ef-core-optimistic-locking.html"},{default:t(()=>n[19]||(n[19]=[a("race condition")])),_:1,__:[19]}),n[21]||(n[21]=a(" here, as we generate a unique code first and then insert it into the database. A concurrent request could generate the same unique code and insert it into the database before we complete our transaction. However, the chances of this happening are low, so I decided not to handle that case."))]),n[36]||(n[36]=l(`<p>Remember that the unique index in the database is still guarding us against duplicate values.</p><hr><h2 id="url-redirection" tabindex="-1"><a class="header-anchor" href="#url-redirection"><span>URL Redirection</span></a></h2><p>The second use case for a URL shortener is redirection when accessing a shortened URL.</p><p>We will expose another Minimal API endpoint for this feature. The endpoint will accept a unique code, find the respective shortened URL, and redirect the user to the original long URL. You can implement additional validation for the specified code before checking if there&#39;s a shortened URL in the database.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">&quot;{code}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> code<span class="token punctuation">,</span> <span class="token class-name">ApplicationDbContext</span> dbContext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> shortenedUrl <span class="token operator">=</span> <span class="token keyword">await</span> dbContext</span>
<span class="line">        <span class="token punctuation">.</span>ShortenedUrls</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">SingleOrDefaultAsync</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Code <span class="token operator">==</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>shortenedUrl <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>shortenedUrl<span class="token punctuation">.</span>LongUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6)),s("p",null,[n[23]||(n[23]=a("This endpoint looks up the code in the database and, if found, redirects the user to the original long URL. The response will have a ")),s("a",q,[e(p,{icon:"fas fa-globe"}),n[22]||(n[22]=a("302 (Found) status code"))]),n[24]||(n[24]=a(" per the HTTP standards."))]),n[37]||(n[37]=l('<hr><h2 id="url-shortener-improvement-points" tabindex="-1"><a class="header-anchor" href="#url-shortener-improvement-points"><span>URL Shortener Improvement Points</span></a></h2><p>While our basic URL shortener is functional, there are several areas we can improve:</p><ul><li><strong>Caching</strong>: Implement caching to reduce database load for frequently accessed URLs.</li><li><strong>Horizontal Scaling</strong>: Design the system to scale horizontally to handle increased load.</li><li><strong>Data Sharding</strong>: Implement data sharding to distribute data across multiple databases.</li><li><strong>Analytics</strong>: Introduce analytics to track URL usage and expose reports to users.</li><li><strong>User Accounts</strong>: Allow users to create accounts to manage their URLs.</li></ul><p>We&#39;ve covered the key components of building a URL shortener using .NET. You can take this further and implement the improvements points for a more robust solution.</p>',5)),s("p",null,[n[26]||(n[26]=a("If you want to see me build this from scratch, here's a ")),s("a",T,[e(p,{icon:"fa-brands fa-youtube"}),n[25]||(n[25]=a("video tutorial on YouTube"))]),n[27]||(n[27]=a("."))]),n[38]||(n[38]=s("p",null,"That's all for today.",-1)),n[39]||(n[39]=s("p",null,"See you next week.",-1))])}const D=k(w,[["render",C]]),N=JSON.parse('{"path":"/milanjovanovic.tech/how-to-build-a-url-shortener-with-dotnet.html","title":"How to Build a URL Shortener With .NET","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"How to Build a URL Shortener With .NET","description":"Article(s) > How to Build a URL Shortener With .NET","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to Build a URL Shortener With .NET\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_074/url_shortener.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-02-03T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanović\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-to-build-a-url-shortener-with-dotnet.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"How to Build a URL Shortener With .NET"}],["meta",{"property":"og:description","content":"Article(s) > How to Build a URL Shortener With .NET"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_074.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_074.png"}],["meta",{"name":"twitter:image:alt","content":"How to Build a URL Shortener With .NET"}],["meta",{"property":"article:author","content":"Milan Jovanović"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-02-03T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > How to Build a URL Shortener With .NET"},{"property":"og:description","content":"How to Build a URL Shortener With .NET"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-to-build-a-url-shortener-with-dotnet.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-02-03T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanović","cover":"https://milanjovanovic.tech/blog-covers/mnw_074.png"},"git":{},"readingTime":{"minutes":5.48,"words":1643},"filePathRelative":"milanjovanovic.tech/how-to-build-a-url-shortener-with-dotnet.md","copyright":{"author":"Milan Jovanović"}}');export{D as comp,N as data};
