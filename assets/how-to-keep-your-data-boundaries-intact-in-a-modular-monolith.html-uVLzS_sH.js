import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,d as s,f as e,b as d,a as g,t as b,n as l,g as p,w as t,e as a,r as c,o as v}from"./app-BItykJLQ.js";const y={},w={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},f={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},E={class:"table-of-contents"};function T(u,n){const i=c("VPCard"),o=c("router-link"),m=c("SiteInfo"),r=c("RouteLink");return v(),k("div",null,[s("h1",w,[s("a",f,[s("span",null,b(u.$frontmatter.title)+" ê´€ë ¨",1)])]),e(i,l(p({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e(i,l(p({title:"PostgreSQL > Article(s)",desc:"Article(s)",link:"/data-science/postgres/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e(i,l(p({title:"System Desgin > Article(s)",desc:"Article(s)",link:"/academics/system-design/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",E,[s("ul",null,[s("li",null,[e(o,{to:"#why-enforce-database-boundaries"},{default:t(()=>[...n[0]||(n[0]=[a("Why enforce database boundaries?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#schemas-roles-and-search-paths"},{default:t(()=>[...n[1]||(n[1]=[a("Schemas, roles and search paths",-1)])]),_:1})]),s("li",null,[e(o,{to:"#configuring-ef-schemas-and-multiple-dbcontexts"},{default:t(()=>[...n[2]||(n[2]=[a("Configuring EF schemas and multiple DbContexts",-1)])]),_:1})]),s("li",null,[e(o,{to:"#step-by-step-enforcing-module-boundaries"},{default:t(()=>[...n[3]||(n[3]=[a("Step-by-step: Enforcing module boundaries",-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#_1-create-schemas-and-roles"},{default:t(()=>[...n[4]||(n[4]=[a("1. Create schemas and roles",-1)])]),_:1})]),s("li",null,[e(o,{to:"#_2-add-connection-strings"},{default:t(()=>[...n[5]||(n[5]=[a("2. Add connection strings",-1)])]),_:1})]),s("li",null,[e(o,{to:"#_3-define-dbcontexts"},{default:t(()=>[...n[6]||(n[6]=[a("3. Define DbContexts",-1)])]),_:1})]),s("li",null,[e(o,{to:"#_4-maintain-migrations-separately"},{default:t(()=>[...n[7]||(n[7]=[a("4. Maintain migrations separately",-1)])]),_:1})])])]),s("li",null,[e(o,{to:"#cross-cutting-queries"},{default:t(()=>[...n[8]||(n[8]=[a("Cross-cutting queries",-1)])]),_:1})]),s("li",null,[e(o,{to:"#conclusion"},{default:t(()=>[...n[9]||(n[9]=[a("Conclusion",-1)])]),_:1})])])]),n[29]||(n[29]=s("hr",null,null,-1)),e(m,{name:"How to Keep Your Data Boundaries Intact in a Modular Monolith",desc:"Want real boundaries in your modular monolith? This article shows how to enforce them at the database level using Postgres schemas, roles, and EF Core â€” so your modules can't step on each other's data, even by accident.",url:"https://milanjovanovic.tech/blog/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_153.png"}),s("p",null,[e(r,{to:"/milanjovanovic.tech/what-is-a-modular-monolith.html"},{default:t(()=>[...n[10]||(n[10]=[s("strong",null,"Modular monoliths",-1)])]),_:1}),n[11]||(n[11]=a(" promise the productivity of a monolith and the clear boundaries of microservices. They work because each module is self-contained: its domain model, behavior and data live behind a boundary. But one of the hardest places to maintain those boundaries is in the database.",-1))]),n[30]||(n[30]=s("p",null,[a("Nothing stops a developer from running a rogue "),s("code",null,"JOIN"),a(" across tables or bypassing a public API.")],-1)),s("p",null,[n[14]||(n[14]=a("In previous articles, I described ",-1)),e(r,{to:"/milanjovanovic.tech/modular-monolith-data-isolation.html"},{default:t(()=>[...n[12]||(n[12]=[s("strong",null,"four levels of data isolation",-1)])]),_:1}),n[15]||(n[15]=a(" (table, schema, database and alternative persistence) and argued that ",-1)),e(r,{to:"/milanjovanovic.tech/internal-vs-public-apis-in-modular-monoliths.html"},{default:t(()=>[...n[13]||(n[13]=[s("strong",null,"modules should expose explicit APIs",-1)])]),_:1}),n[16]||(n[16]=a(" to access their data.",-1))]),n[31]||(n[31]=d(`<p>This article goes deeper on the database side. You&#39;ll learn how to carve out logical and physical boundaries using PostgreSQL schemas and roles and EF Core, why those choices matter, and how to handle cross-cutting queries without breaking encapsulation.</p><hr><h2 id="why-enforce-database-boundaries" tabindex="-1"><a class="header-anchor" href="#why-enforce-database-boundaries"><span>Why enforce database boundaries?</span></a></h2><p>In a modular monolith each module <strong>owns its data</strong>. If Module A reaches into Module B&#39;s tables, you lose this constraint and your modules become tightly coupled. Instead, B exposes a public API and hides its persistence logic from consumers.</p><p>Beyond clean code, enforcing boundaries at the database level protects you against mistakes and makes it easier to extract a module into its own service later.</p><p>Database schemas act like folders: they let you organise objects and share a database among many users, but a user can access any schema only if they have privileges. This means we can deliberately lock each module to its own schema.</p><div class="hint-container info"><p class="hint-container-title">The strategy</p><ul><li>Create a schema per module and a dedicated database role.</li><li>Grant that role privileges only on its schema and set its default search path.</li><li>Use EF with one <code>DbContext</code> per module, setting a default schema and connection string per module.</li><li>For cross-cutting queries, publish a read-only database view that acts like a public API.</li><li><em>Optional</em>: Use row-level security policies to restrict access within a table.</li></ul></div><p>These practices give us <strong>enforceable boundaries</strong> while keeping the <strong>operational overhead low</strong>.</p><hr><h2 id="schemas-roles-and-search-paths" tabindex="-1"><a class="header-anchor" href="#schemas-roles-and-search-paths"><span>Schemas, roles and search paths</span></a></h2><p>PostgreSQL lets you create multiple schemas within a single database. A module can define its own schema and a role that owns it. The role only has usage and table-level privileges on that schema. For example, for an orders module:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- create a user for the module and its schema</span></span>
<span class="line"><span class="token keyword">CREATE</span> ROLE orders_role LOGIN PASSWORD <span class="token string">&#39;orders_secret&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">AUTHORIZATION</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">TO</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">TO</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">ALTER</span> ROLE orders_role <span class="token keyword">SET</span> search_path <span class="token operator">=</span> orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>ALTER ROLE</code> command sets the role&#39;s default search path so unqualified names resolve to the module&#39;s schema. If you don&#39;t want to rely on the search path, always qualify table names (<code>orders.table_name</code>).</p><p>Row-level security (RLS) allows you to filter rows based on a policy expression. You enable RLS on a table and define a policy referencing <code>current_user</code> or columns:</p><p>RLS is powerful for multi-tenant scenarios or sensitive data, but it adds complexity. Start with schemas and roles and add RLS only when necessary.</p><hr><h2 id="configuring-ef-schemas-and-multiple-dbcontexts" tabindex="-1"><a class="header-anchor" href="#configuring-ef-schemas-and-multiple-dbcontexts"><span>Configuring EF schemas and multiple DbContexts</span></a></h2><p>I assume readers are comfortable with EF Core, so we&#39;ll skip the basics and focus on what matters for modular monoliths:</p>`,18)),s("ul",null,[s("li",null,[n[18]||(n[18]=a("Use ",-1)),e(r,{to:"/milanjovanovic.tech/using-multiple-ef-core-dbcontext-in-single-application.html"},{default:t(()=>[...n[17]||(n[17]=[s("strong",null,"one DbContext per module",-1)])]),_:1}),n[19]||(n[19]=a(". Each context contains only the entities of its module, and you call ",-1)),n[20]||(n[20]=s("code",null,'modelBuilder.HasDefaultSchema("orders")',-1)),n[21]||(n[21]=a(" in ",-1)),n[22]||(n[22]=s("code",null,"OnModelCreating",-1)),n[23]||(n[23]=a(" to map entities to the correct schema. Setting a default schema also affects sequences and migrations.",-1))]),n[24]||(n[24]=s("li",null,"Provide a connection string per module using the module's role. Even if modules share the same database, separate credentials ensure that a misconfigured context cannot access another schema.",-1)),n[25]||(n[25]=s("li",null,[a("Configure the migrations history table in each context using "),s("code",null,'MigrationsHistoryTable("__EFMigrationsHistory", "orders")'),a(" so that EF's migration metadata stays within the module's schema.")],-1))]),n[32]||(n[32]=d(`<p>These settings ensure EF Core queries and migrations respect the boundaries established by the database.</p><hr><h2 id="step-by-step-enforcing-module-boundaries" tabindex="-1"><a class="header-anchor" href="#step-by-step-enforcing-module-boundaries"><span>Step-by-step: Enforcing module boundaries</span></a></h2><p>Suppose we have two modules (<strong>Orders</strong> and <strong>Shipping</strong>) and we want to enforce boundaries between them. Here&#39;s what we need to do:</p><h3 id="_1-create-schemas-and-roles" tabindex="-1"><a class="header-anchor" href="#_1-create-schemas-and-roles"><span>1. Create schemas and roles</span></a></h3><p>Use SQL to create orders and shipping schemas and their corresponding roles (<code>orders_role</code>, <code>shipping_role</code>). Grant each role privileges only on its schema.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- Orders schema and role</span></span>
<span class="line"><span class="token keyword">CREATE</span> ROLE orders_role LOGIN PASSWORD <span class="token string">&#39;orders_secret&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">AUTHORIZATION</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">TO</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> orders <span class="token keyword">TO</span> orders_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">ALTER</span> ROLE orders_role <span class="token keyword">SET</span> search_path <span class="token operator">=</span> orders<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line"><span class="token comment">-- Shipping schema and role</span></span>
<span class="line"><span class="token keyword">CREATE</span> ROLE shipping_role LOGIN PASSWORD <span class="token string">&#39;shipping_secret&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> shipping <span class="token keyword">AUTHORIZATION</span> shipping_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> shipping <span class="token keyword">TO</span> shipping_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> <span class="token keyword">TABLES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> shipping <span class="token keyword">TO</span> shipping_role<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">ALTER</span> ROLE shipping_role <span class="token keyword">SET</span> search_path <span class="token operator">=</span> shipping<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-add-connection-strings" tabindex="-1"><a class="header-anchor" href="#_2-add-connection-strings"><span>2. Add connection strings</span></a></h3><p>In configuration, define separate connection strings per module:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ConnectionStrings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Orders&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Host=localhost;Database=appdb;Username=orders_role;Password=orders_secret&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Shipping&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Host=localhost;Database=appdb;Username=shipping_role;Password=shipping_secret&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-define-dbcontexts" tabindex="-1"><a class="header-anchor" href="#_3-define-dbcontexts"><span>3. Define <code>DbContexts</code></span></a></h3><p>Each module defines its own context and sets the default schema. For the Orders module:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrdersDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span> Orders <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token operator">!</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>OrderLine<span class="token punctuation">&gt;</span></span> OrderLines <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token operator">!</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">OrdersDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>OrdersDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// set default schema for all entities in this context</span></span>
<span class="line">        modelBuilder<span class="token punctuation">.</span><span class="token function">HasDefaultSchema</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// optional: configure tables explicitly</span></span>
<span class="line">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToTable</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderLine<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToTable</span><span class="token punctuation">(</span><span class="token string">&quot;order_lines&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnModelCreating</span><span class="token punctuation">(</span>modelBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Register each context with its connection string and specify the migrations history table:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrdersDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line">    options<span class="token punctuation">.</span><span class="token function">UseNpgsql</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        o <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span><span class="token function">MigrationsHistoryTable</span><span class="token punctuation">(</span><span class="token string">&quot;__EFMigrationsHistory&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ShippingDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line">    options<span class="token punctuation">.</span><span class="token function">UseNpgsql</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;Shipping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        o <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span><span class="token function">MigrationsHistoryTable</span><span class="token punctuation">(</span><span class="token string">&quot;__EFMigrationsHistory&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shipping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-maintain-migrations-separately" tabindex="-1"><a class="header-anchor" href="#_4-maintain-migrations-separately"><span>4. Maintain migrations separately</span></a></h3><p>Because each module has its own context and schema, you maintain migrations separately. When generating a migration, specify the context:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">dotnet ef migrations <span class="token function">add</span> InitialOrders <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">--context</span> OrdersDbContext <span class="token punctuation">\\</span></span>
<span class="line">--output-dir Data/Migrations/Orders</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Repeat this for the Shipping context. EF Core will generate migration classes that create tables within the specified schema (because of <code>HasDefaultSchema</code>). Remember to apply the migrations in the correct order when deploying. You can automate this by having a migration runner iterate through the contexts.</p><p>With schemas, roles and multiple contexts in place, the data boundary becomes enforceable at the database level:</p><ul><li>The <strong>Orders</strong> module&#39;s <code>DbContext</code> knows only about the orders schema and uses credentials that have no privileges on the <strong>Shipping</strong> schema.</li><li>The <strong>Shipping</strong> module cannot query <code>orders.orders</code> directly because its role lacks the necessary privileges.</li><li>Cross-module communication must go through the module&#39;s public API (or an asynchronous event). This explicit coupling makes dependencies obvious and maintainable.</li></ul><hr><h2 id="cross-cutting-queries" tabindex="-1"><a class="header-anchor" href="#cross-cutting-queries"><span>Cross-cutting queries</span></a></h2><p>Even in a modular system you occasionally need a screen that spans multiple modules, such as an <strong>Order History</strong> page that shows order and shipping data. Resist the temptation to <code>JOIN</code> across schemas. Two approaches can help:</p><ul><li><strong>Dedicated read model</strong>. One module owns a view model and subscribes to events from others. This pattern works well when modules might be extracted later.</li><li><strong>Database views with privileges</strong>. Since our modules share a database, we can create a read-only view in the public schema that joins the relevant tables. We grant <code>SELECT</code> on the view to a special role or module. This view acts like a controlled public API. Consumers query the view but cannot access the underlying tables directly. The trade-off is similar to calling a synchronous API: if you later split the database, the view will have to be replaced with a service call.</li></ul><p>For example:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> <span class="token keyword">public</span><span class="token punctuation">.</span>order_summary <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> o<span class="token punctuation">.</span>id<span class="token punctuation">,</span> o<span class="token punctuation">.</span>total<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword">status</span></span>
<span class="line"><span class="token keyword">FROM</span> orders<span class="token punctuation">.</span>orders o</span>
<span class="line"><span class="token keyword">JOIN</span> shipping<span class="token punctuation">.</span>shipments s <span class="token keyword">ON</span> s<span class="token punctuation">.</span>order_id <span class="token operator">=</span> o<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- grant read access to a reporting role</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token keyword">public</span><span class="token punctuation">.</span>order_summary <span class="token keyword">TO</span> reporting_role<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach lets you build dashboards or admin screens without breaking boundaries.</p><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>By giving each module its own schema, role and DbContext, and by controlling cross-module access via views or APIs, you <strong>ensure that boundaries in your modular monolith are enforceable</strong> rather than aspirational. This discipline makes it easier to evolve your system and paves the way for a future microservice extraction.</p><p>If you found this article valuable, check out my previous posts on modular monoliths:</p>`,32)),e(i,l(p({title:"What Is a Modular Monolith?",desc:"Modular monoliths blend the simplicity and robustness of traditional monolithic applications with the flexibility and scalability of microservices. Today, I'll introduce you to the modular monolith architecture and why you should know about it.",link:"/milanjovanovic.tech/what-is-a-modular-monolith.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16),e(i,l(p({title:"Modular Monolith Data Isolation",desc:"Modular monoliths are an architectural approach that's becoming very popular. They combine the benefits of modularity and monolithic design. Data isolation ensures that modules are independent and loosely coupled. Today, I will show you four data isolation approaches for modular monoliths",link:"/milanjovanovic.tech/modular-monolith-data-isolation.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16),e(i,l(p({title:"Internal vs. Public APIs in Modular Monoliths",desc:"Every article about modular monoliths tells you to use public APIs between modules, but they rarely explain why these APIs exist or how to design them properly. After building several large-scale modular monoliths, I've learned that public APIs are not just about clean code - they're about controlling chaos.",link:"/milanjovanovic.tech/internal-vs-public-apis-in-modular-monoliths.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16),s("p",null,[n[27]||(n[27]=a("If you want a structured, hands-on approach to building modular systems, from defining boundaries to extracting services, check out my ",-1)),e(r,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:t(()=>[...n[26]||(n[26]=[s("strong",null,"Modular Monolith Architecture",-1)])]),_:1}),n[28]||(n[28]=a(" course. Join more than 2,100+ students who have mastered modular monoliths with it. The course walks through these patterns in depth and shows how to apply them in a real codebase.",-1))]),n[33]||(n[33]=s("hr",null,null,-1)),g(" TODO: add ARTICLE CARD "),e(i,l(p({title:"How to Keep Your Data Boundaries Intact in a Modular Monolith",desc:"Want real boundaries in your modular monolith? This article shows how to enforce them at the database level using Postgres schemas, roles, and EF Core â€” so your modules can't step on each other's data, even by accident.",link:"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith.html",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16)])}const x=h(y,[["render",T]]),C=JSON.parse('{"path":"/milanjovanovic.tech/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith.html","title":"How to Keep Your Data Boundaries Intact in a Modular Monolith","lang":"en-US","frontmatter":{"lang":"en-US","title":"How to Keep Your Data Boundaries Intact in a Modular Monolith","description":"Article(s) > How to Keep Your Data Boundaries Intact in a Modular Monolith","icon":"iconfont icon-csharp","category":["C#","DotNet","Data Science","PostgreSQL","Design","System","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet","data-science","sql","postgres","posgtresql","design","system"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to Keep Your Data Boundaries Intact in a Modular Monolith\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_153.png\\"],\\"datePublished\\":\\"2025-08-02T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"How to Keep Your Data Boundaries Intact in a Modular Monolith"}],["meta",{"property":"og:description","content":"Article(s) > How to Keep Your Data Boundaries Intact in a Modular Monolith"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_153.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_153.png"}],["meta",{"name":"twitter:image:alt","content":"How to Keep Your Data Boundaries Intact in a Modular Monolith"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"system"}],["meta",{"property":"article:tag","content":"design"}],["meta",{"property":"article:tag","content":"posgtresql"}],["meta",{"property":"article:tag","content":"postgres"}],["meta",{"property":"article:tag","content":"sql"}],["meta",{"property":"article:tag","content":"data-science"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-08-02T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > How to Keep Your Data Boundaries Intact in a Modular Monolith"},{"property":"og:description","content":"How to Keep Your Data Boundaries Intact in a Modular Monolith"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith.html"}]],"prev":"/programming/cs/articles/README.md","date":"2025-08-02T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_153.png"},"git":{},"readingTime":{"minutes":6.59,"words":1976},"filePathRelative":"milanjovanovic.tech/how-to-keep-your-data-boundaries-intact-in-a-modular-monolith.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{x as comp,C as data};
