import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as s,f as t,b as p,a as v,t as b,n as c,g as r,w as i,e as a,r as u,o as f}from"./app-BItykJLQ.js";const h={},y={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},x={class:"table-of-contents"},q={href:"https://github.com/testcontainers/testcontainers-java",target:"_blank",rel:"noopener noreferrer"},T={href:"https://testcontainers.org/quickstart/junit_4_quickstart/",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/testcontainers/moby-ryuk",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/apache/incubator-zipkin/blob/b8646142fa15c8c5f47ff2a2a48dc663c7bb65b3/zipkin-storage/elasticsearch/src/test/java/zipkin2/elasticsearch/integration/ElasticsearchStorageRule.java#L30",target:"_blank",rel:"noopener noreferrer"},C={href:"https://github.com/testcontainers/testcontainers-go",target:"_blank",rel:"noopener noreferrer"},j={href:"https://testcontainers.org/modules/databases/",target:"_blank",rel:"noopener noreferrer"},E={href:"https://github.com/testcontainers/testcontainers-go/pull/59",target:"_blank",rel:"noopener noreferrer"},G={href:"https://testcontainers.org/features/creating_images/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://github.com/kubernetes-sigs/kind",target:"_blank",rel:"noopener noreferrer"},A={href:"https://github.com/testcontainers/testcontainers-go/pull/67",target:"_blank",rel:"noopener noreferrer"},D={href:"https://github.com/genuinetools/img",target:"_blank",rel:"noopener noreferrer"},M={href:"https://testcontainers.slack.com",target:"_blank",rel:"noopener noreferrer"},P={href:"https://github.com/testcontainers",target:"_blank",rel:"noopener noreferrer"},B={href:"https://twitter.com/gianarb",target:"_blank",rel:"noopener noreferrer"};function O(k,n){const l=u("VPCard"),o=u("router-link"),d=u("SiteInfo"),e=u("VPIcon");return f(),g("div",null,[s("h1",y,[s("a",w,[s("span",null,b(k.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),t(l,c(r({title:"Docker > Article(s)",desc:"Article(s)",link:"/devops/docker/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),t(l,c(r({title:"Testcontainer > Article(s)",desc:"Article(s)",link:"/devops/testcontainer/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),t(l,c(r({title:"Java > Article(s)",desc:"Article(s)",link:"/programming/java/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",x,[s("ul",null,[s("li",null,[t(o,{to:"#getting-started-testcontainers-java"},{default:i(()=>[...n[0]||(n[0]=[a("Getting Started: testcontainers-java",-1)])]),_:1})]),s("li",null,[t(o,{to:"#creating-the-test"},{default:i(()=>[...n[1]||(n[1]=[a("Creating the Test",-1)])]),_:1})]),s("li",null,[t(o,{to:"#modules"},{default:i(()=>[...n[2]||(n[2]=[a("Modules",-1)])]),_:1})]),s("li",null,[t(o,{to:"#what-i-m-working-on-now"},{default:i(()=>[...n[3]||(n[3]=[a("What I‚Äôm working on now",-1)])]),_:1})]),s("li",null,[t(o,{to:"#calling-all-coders"},{default:i(()=>[...n[4]||(n[4]=[a("Calling All Coders",-1)])]),_:1})]),s("li",null,[t(o,{to:"#try-it-out"},{default:i(()=>[...n[5]||(n[5]=[a("Try It Out",-1)])]),_:1})])])]),n[52]||(n[52]=s("hr",null,null,-1)),t(d,{name:"Write Maintainable Integration Tests with Docker",desc:"The popularity of microservices and the use of third-party services for non-business critical features has drastically increased the number of integrations that make up the modern application. All of these integration points require different layers of testing.",url:"https://docker.com/blog/maintainable-integration-tests-with-docker",logo:"https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png",preview:"https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg"}),n[53]||(n[53]=p('<div class="hint-container info"><p class="hint-container-title">Info</p><p>Testcontainer is an open source community focused on making integration tests easier across many languages. Gianluca Arbezzano is a Docker Captain, SRE at Influx Data and the maintainer of the Golang implementation of Testcontainer that uses the Docker API to expose a test-friendly library that you can use in your test cases.</p><figure><img src="https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg" alt="Photo by Markus Spiske on Unsplash." tabindex="0" loading="lazy"><figcaption>Photo by Markus Spiske on Unsplash.</figcaption></figure></div><p>The popularity of microservices and the use of third-party services for non-business critical features has drastically increased the number of integrations that make up the modern application. These days, it is commonplace to use MySQL, Redis as a key value store, MongoDB, Postgress, and InfluxDB ‚Äì and that is all just for the database ‚Äì let alone the multiple services that make up other parts of the application.</p><p>All of these integration points require different layers of testing. Unit tests increase how fast you write code because you can mock all of your dependencies, set the expectation for your function and iterate until you get the desired transformation. But, we need more. We need to make sure that the integration with Redis, MongoDB or a microservice works as expected, not just that the mock works as we wrote it. Both are important but the difference is huge.</p><p>In this article, I will show you how to use testcontainer to write integration tests in Go with very low overhead. So, I am not telling you to stop writing unit tests, just to be clear!</p><p>Back in the day, when I was interested in becoming a Java developer, I tried to write an integration between Zipkin, a popular open source tracer, and InfluxDB. I ultimately failed because I am not a Java developer, but I did understand how they wrote integration tests, and I became fascinated.</p><hr><h2 id="getting-started-testcontainers-java" tabindex="-1"><a class="header-anchor" href="#getting-started-testcontainers-java"><span>Getting Started: <code>testcontainers-java</code></span></a></h2>',7)),s("p",null,[n[8]||(n[8]=a("Zipkin provides a UI and an API to store and manipulate traces, it supports Cassandra, in-memory, ElasticSearch, MySQL and many more platforms as storage. In order to validate that all the storage systems work, they use a library called ",-1)),s("a",q,[t(e,{icon:"iconfont icon-github"}),n[6]||(n[6]=s("code",null,"testcontainers/testcontainers-java",-1))]),n[9]||(n[9]=a(" that is a wrapper around the docker-api designed to be ‚Äútest-friendly.‚ÄùHere is the ",-1)),s("a",T,[t(e,{icon:"iconfont icon-testcontainers"}),n[7]||(n[7]=a("Quick Start",-1))]),n[10]||(n[10]=a(" example:",-1))]),n[54]||(n[54]=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisBackedCacheIntTestStep0</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RedisBackedCache</span> underTest<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Before</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Assume that we have Redis running locally?</span></span>
<span class="line">        underTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisBackedCache</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimplePutAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        underTest<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">String</span> retrieved <span class="token operator">=</span> underTest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span> retrieved<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the <code>setUp</code> you can create a container (redis in this case) and expose a port. From here, you can interact with a live redis instance.</p>`,2)),s("p",null,[n[13]||(n[13]=a("Everytime you start a new container, there is a ‚Äúsidecar‚Äù called ",-1)),s("a",I,[t(e,{icon:"iconfont icon-github"}),n[11]||(n[11]=s("code",null,"testcontainers/moby-ryuk",-1))]),n[14]||(n[14]=a(" that keeps your Docker environment clean by removing containers, volumes and networks after a certain amount of time. You can also remove them from inside the test.The below example comes from ",-1)),s("a",S,[t(e,{icon:"iconfont icon-github"}),n[12]||(n[12]=s("code",null,"apache/incubator-zipkin",-1))]),n[15]||(n[15]=a(". They are testing the ElasticSearch integration and as the example shows, you can programmatically configure your dependencies from inside the test case.",-1))]),n[55]||(n[55]=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ElasticsearchStorageRule</span> <span class="token keyword">extends</span> <span class="token class-name">ExternalResource</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ElasticsearchStorageRule</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">ELASTICSEARCH_PORT</span> <span class="token operator">=</span> <span class="token number">9200</span><span class="token punctuation">;</span> <span class="token keyword">final</span> <span class="token class-name">String</span> image<span class="token punctuation">;</span> <span class="token keyword">final</span> <span class="token class-name">String</span> index<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">GenericContainer</span> container<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Closer</span> closer <span class="token operator">=</span> <span class="token class-name">Closer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ElasticsearchStorageRule</span><span class="token punctuation">(</span><span class="token class-name">String</span> image<span class="token punctuation">,</span> <span class="token class-name">String</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>image <span class="token operator">=</span> image<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Starting docker image &quot;</span> <span class="token operator">+</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container <span class="token operator">=</span></span>
<span class="line">                 <span class="token keyword">new</span> <span class="token class-name">GenericContainer</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line">                     <span class="token punctuation">.</span><span class="token function">withExposedPorts</span><span class="token punctuation">(</span><span class="token constant">ELASTICSEARCH_PORT</span><span class="token punctuation">)</span></span>
<span class="line">                     <span class="token punctuation">.</span><span class="token function">waitingFor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpWaitStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;ES_DEBUG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">               container<span class="token punctuation">.</span><span class="token function">followOutput</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Slf4jLogConsumer</span><span class="token punctuation">(</span><span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Starting docker image &quot;</span> <span class="token operator">+</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">           <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Couldn&#39;t start docker image &quot;</span> <span class="token operator">+</span> image <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That this happens programmatically is key because you do not need to rely on something external such as <code>docker-compose</code> to spin up your integration tests environment. By spinning it up from inside the test itself, you have a lot more control over the orchestration and provisioning, and the test is more stable. You can even check when a container is ready before you start a test.</p>`,2)),s("p",null,[n[17]||(n[17]=a("Since I am not a Java developer, I ported the library (we are still working on all the features) in Golang and now it‚Äôs in the main ",-1)),s("a",C,[t(e,{icon:"iconfont icon-github"}),n[16]||(n[16]=s("code",null,"testcontainers/testcontainers-go",-1))]),n[18]||(n[18]=a(" organization.",-1))]),n[56]||(n[56]=p(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">TestNginxLatestReturn</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    req <span class="token operator">:=</span> testcontainers<span class="token punctuation">.</span>ContainerRequest<span class="token punctuation">{</span></span>
<span class="line">        Image<span class="token punctuation">:</span>        <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        ExposedPorts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;80/tcp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    nginxC<span class="token punctuation">,</span> err <span class="token operator">:=</span> testcontainers<span class="token punctuation">.</span><span class="token function">GenericContainer</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> testcontainers<span class="token punctuation">.</span>GenericContainerRequest<span class="token punctuation">{</span></span>
<span class="line">        ContainerRequest<span class="token punctuation">:</span> req<span class="token punctuation">,</span></span>
<span class="line">        Started<span class="token punctuation">:</span>          <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">defer</span> nginxC<span class="token punctuation">.</span><span class="token function">Terminate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line">    ip<span class="token punctuation">,</span> err <span class="token operator">:=</span> nginxC<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    port<span class="token punctuation">,</span> err <span class="token operator">:=</span> nginxC<span class="token punctuation">.</span><span class="token function">MappedPort</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;80&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;http://%s:%s&quot;</span><span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">.</span><span class="token function">Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> resp<span class="token punctuation">.</span>StatusCode <span class="token operator">!=</span> http<span class="token punctuation">.</span>StatusOK <span class="token punctuation">{</span></span>
<span class="line">        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Expected status code %d. Got %d.&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="creating-the-test" tabindex="-1"><a class="header-anchor" href="#creating-the-test"><span>Creating the Test</span></a></h2><p>This is what it looks like:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">req <span class="token operator">:=</span> testcontainers<span class="token punctuation">.</span>ContainerRequest<span class="token punctuation">{</span></span>
<span class="line">    Image<span class="token punctuation">:</span>        <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    ExposedPorts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;80/tcp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">nginxC<span class="token punctuation">,</span> err <span class="token operator">:=</span> testcontainers<span class="token punctuation">.</span><span class="token function">GenericContainer</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> testcontainers<span class="token punctuation">.</span>GenericContainerRequest<span class="token punctuation">{</span></span>
<span class="line">    ContainerRequest<span class="token punctuation">:</span> req<span class="token punctuation">,</span></span>
<span class="line">    Started<span class="token punctuation">:</span>          <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">defer</span> nginxC<span class="token punctuation">.</span><span class="token function">Terminate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You create the nginx container and with the <code>defer nginxC.Terminate(ctx)</code> command, you are cleaning up the container when the test is over. Remember ryuk? it is not a mandatory command, but testcontainers-go uses it to remove the containers at some point.</p><hr><h2 id="modules" tabindex="-1"><a class="header-anchor" href="#modules"><span>Modules</span></a></h2>`,8)),s("p",null,[n[23]||(n[23]=a("The Java library has a feature called ",-1)),s("a",j,[t(e,{icon:"iconfont icon-testcontainer"}),n[19]||(n[19]=a("modules",-1))]),n[24]||(n[24]=a(" where you get pre-canned containers such as databases (mysql, postgress, cassandra, etc.) or applications like nginx.The go version is working on something similar but it is still an ",-1)),s("a",E,[n[20]||(n[20]=a("open pr (",-1)),t(e,{icon:"iconfont icon-github"}),n[21]||(n[21]=s("code",null,"testcontainers/testcontainers-go",-1)),n[22]||(n[22]=a(")",-1))]),n[25]||(n[25]=a(".",-1))]),s("p",null,[n[27]||(n[27]=a("If you‚Äôd like to build a microservice your application relies on from the upstream video, this is a great feature. Or if you would like to test how your application behaves from inside a container (probably more similar to where it will run in prod). This is ",-1)),s("a",G,[t(e,{icon:"iconfont icon-testcontainer"}),n[26]||(n[26]=a("how it works",-1))]),n[28]||(n[28]=a(" in Java:",-1))]),n[57]||(n[57]=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token annotation punctuation">@Rule</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">GenericContainer</span> dslContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericContainer</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">ImageFromDockerfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withFileFromString</span><span class="token punctuation">(</span><span class="token string">&quot;folder/someFile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withFileFromClasspath</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mappable-resource/test-resource.txt&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">withFileFromClasspath</span><span class="token punctuation">(</span><span class="token string">&quot;Dockerfile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mappable-dockerfile/Dockerfile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="what-i-m-working-on-now" tabindex="-1"><a class="header-anchor" href="#what-i-m-working-on-now"><span>What I‚Äôm working on now</span></a></h2>`,3)),s("p",null,[n[30]||(n[30]=a("Something that I am currently working on is a new ",-1)),n[31]||(n[31]=s("code",null,"canned",-1)),n[32]||(n[32]=a(" container that uses ",-1)),s("a",R,[t(e,{icon:"iconfont icon-github"}),n[29]||(n[29]=s("code",null,"kubernetes-sigs/kind",-1))]),n[33]||(n[33]=a(" to spin up Kubernetes clusters inside a container. If your applications use the Kubernetes API, you can test it in integration:",-1))]),n[58]||(n[58]=p(`<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">k <span class="token operator">:=</span> <span class="token operator">&amp;</span>KubeKindContainer<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">err <span class="token operator">:=</span> k<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">  t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">defer</span> k<span class="token punctuation">.</span><span class="token function">Terminate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span>
<span class="line">clientset<span class="token punctuation">,</span> err <span class="token operator">:=</span> k<span class="token punctuation">.</span><span class="token function">GetClientset</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">  t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">ns<span class="token punctuation">,</span> err <span class="token operator">:=</span> clientset<span class="token punctuation">.</span><span class="token function">CoreV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Namespaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>GetOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">  t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">if</span> ns<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;default&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Expected default namespace got %s&quot;</span><span class="token punctuation">,</span> ns<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),s("p",null,[n[37]||(n[37]=a("This feature is still a work in progress as you can see from ",-1)),s("a",A,[n[34]||(n[34]=a("PR67 (",-1)),t(e,{icon:"iconfont icon-github"}),n[35]||(n[35]=s("code",null,"testcontainers/testcontainers-go",-1)),n[36]||(n[36]=a(")",-1))]),n[38]||(n[38]=a(".",-1))]),n[59]||(n[59]=s("hr",null,null,-1)),n[60]||(n[60]=s("h2",{id:"calling-all-coders",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#calling-all-coders"},[s("span",null,"Calling All Coders")])],-1)),n[61]||(n[61]=s("p",null,"The Java version for testcontainers is the first one developed, it has a lot of features not ported to the Go version or to other libraries as well such as JavaScript, Rust, .Net.",-1)),n[62]||(n[62]=s("p",null,"My suggestion is to try the one written in your language and to contribute to it.",-1)),s("p",null,[n[40]||(n[40]=a("In Go we don‚Äôt have a way to programmatically build images. I am thinking to embed ",-1)),n[41]||(n[41]=s("code",null,"buildkit",-1)),n[42]||(n[42]=a(" or ",-1)),s("a",D,[t(e,{icon:"iconfont icon-github"}),n[39]||(n[39]=s("code",null,"genuinetools/img",-1))]),n[43]||(n[43]=a(" in order to get a damonless builder that doesn‚Äôt depend on Docker. The great part about working with the Go version is that all the container related libraries are already in Go, so you can do a very good work of integration with them.",-1))]),s("p",null,[n[45]||(n[45]=a("This is a great chance to become part of this community! If you are passionate about testing framework join us and send your pull requests, or come to hang out on ",-1)),s("a",M,[t(e,{icon:"fa-brands fa-slack"}),n[44]||(n[44]=a("Slack",-1))]),n[46]||(n[46]=a(".",-1))]),n[63]||(n[63]=s("hr",null,null,-1)),n[64]||(n[64]=s("h2",{id:"try-it-out",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#try-it-out"},[s("span",null,"Try It Out")])],-1)),s("p",null,[n[49]||(n[49]=a("I hope you are as excited as me about the flavour and the power this library provides. Take a look at the ",-1)),s("a",P,[t(e,{icon:"iconfont icon-github"}),n[47]||(n[47]=s("code",null,"testcontainers",-1))]),n[50]||(n[50]=a(" organization on GitHub to see if your language is covered and try it out! And, if your language is not covered, let‚Äôs write it! If you are a Go developer and you‚Äôd like to contribute, feel free to reach out to me ",-1)),s("a",B,[t(e,{icon:"fa-brands fa-x-twitter"}),n[48]||(n[48]=s("code",null,"@gianarb",-1))]),n[51]||(n[51]=a(", or go check it out and open an issue or pull request!",-1))]),v(" TODO: add ARTICLE CARD "),t(l,c(r({title:"Write Maintainable Integration Tests with Docker",desc:"The popularity of microservices and the use of third-party services for non-business critical features has drastically increased the number of integrations that make up the modern application. All of these integration points require different layers of testing.",link:"https://chanhi2000.github.io/bookshelf/docker.com/maintainable-integration-tests-with-docker.html",logo:"https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png",background:"rgba(29,99,237,0.2)"})),null,16)])}const L=m(h,[["render",O]]),W=JSON.parse('{"path":"/docker.com/maintainable-integration-tests-with-docker.html","title":"Write Maintainable Integration Tests with Docker","lang":"en-US","frontmatter":{"lang":"en-US","title":"Write Maintainable Integration Tests with Docker","description":"Article(s) > Write Maintainable Integration Tests with Docker","icon":"fa-brands fa-docker","category":["DevOps","Docker","Testcontainer","Java","Go","Article(s)"],"tag":["blog","docker.com","devops","docker","testcontainer","java","jdk","jdk11","go","golang"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Write Maintainable Integration Tests with Docker\\",\\"image\\":[\\"https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg\\"],\\"datePublished\\":\\"2019-08-01T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Gianluca Arbezzano\\",\\"url\\":\\"https://docker.com/author/gianluca/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/docker.com/maintainable-integration-tests-with-docker.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Write Maintainable Integration Tests with Docker"}],["meta",{"property":"og:description","content":"Article(s) > Write Maintainable Integration Tests with Docker"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg"}],["meta",{"name":"twitter:image:alt","content":"Write Maintainable Integration Tests with Docker"}],["meta",{"property":"article:author","content":"Gianluca Arbezzano"}],["meta",{"property":"article:tag","content":"golang"}],["meta",{"property":"article:tag","content":"go"}],["meta",{"property":"article:tag","content":"jdk11"}],["meta",{"property":"article:tag","content":"jdk"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"testcontainer"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"devops"}],["meta",{"property":"article:tag","content":"docker.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2019-08-01T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Write Maintainable Integration Tests with Docker"},{"property":"og:description","content":"Write Maintainable Integration Tests with Docker"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/docker.com/maintainable-integration-tests-with-docker.html"}]],"prev":"/devops/docker/articles/README.md","date":"2019-08-01T00:00:00.000Z","isOriginal":false,"author":[{"name":"Gianluca Arbezzano","url":"https://docker.com/author/gianluca/"}],"cover":"https://docker.com/app/uploads/2019/07/markus-spiske-code-unsplash-1110x740.jpg"},"git":{},"readingTime":{"minutes":5.73,"words":1718},"filePathRelative":"docker.com/maintainable-integration-tests-with-docker.md","copyright":{"author":"Gianluca Arbezzano"}}');export{L as comp,W as data};
