import{_ as f}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as v,d as s,f as e,b as p,a as u,t as w,n as d,g as m,w as t,e as a,r as l,o as y}from"./app-BItykJLQ.js";const b={},P={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},A={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},H={class:"table-of-contents"},D={href:"https://fandf.co/4aVMokD",target:"_blank",rel:"noopener noreferrer"},S={href:"https://fandf.co/4aVMokD",target:"_blank",rel:"noopener noreferrer"},x={href:"https://fandf.co/49GvtA9",target:"_blank",rel:"noopener noreferrer"},M={href:"https://fandf.co/49GvtA9",target:"_blank",rel:"noopener noreferrer"},T={href:"https://en.wikipedia.org/wiki/Argon2",target:"_blank",rel:"noopener noreferrer"},I={href:"https://en.wikipedia.org/wiki/Bcrypt",target:"_blank",rel:"noopener noreferrer"},R={href:"https://en.wikipedia.org/wiki/PBKDF2",target:"_blank",rel:"noopener noreferrer"},j={class:"hint-container info"},F={href:"https://youtu.be/7YUV4O9eMjQ",target:"_blank",rel:"noopener noreferrer"};function q(g,n){const r=l("VPCard"),o=l("router-link"),h=l("SiteInfo"),i=l("VPIcon"),c=l("RouteLink"),k=l("VidStack");return y(),v("div",null,[s("h1",P,[s("a",A,[s("span",null,w(g.$frontmatter.title)+" ê´€ë ¨",1)])]),e(r,d(m({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",H,[s("ul",null,[s("li",null,[e(o,{to:"#the-naive-approach-and-why-it-fails"},{default:t(()=>[...n[0]||(n[0]=[a("The Naive Approach and Why It Fails",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-solution-migration-on-login"},{default:t(()=>[...n[1]||(n[1]=[a("The Solution: Migration on Login",-1)])]),_:1})]),s("li",null,[e(o,{to:"#implementation-with-net-keyed-services"},{default:t(()=>[...n[2]||(n[2]=[a("Implementation with .NET Keyed Services",-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#_1-registering-the-services"},{default:t(()=>[...n[3]||(n[3]=[a("1. Registering the Services",-1)])]),_:1})]),s("li",null,[e(o,{to:"#_2-the-login-command-handler"},{default:t(()=>[...n[4]||(n[4]=[a("2. The Login Command Handler",-1)])]),_:1})])])]),s("li",null,[e(o,{to:"#real-world-improvements"},{default:t(()=>[...n[5]||(n[5]=[a("Real-World Improvements",-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#_1-algorithm-prefixes"},{default:t(()=>[...n[6]||(n[6]=[a("1. Algorithm Prefixes",-1)])]),_:1})]),s("li",null,[e(o,{to:"#_2-feature-flags"},{default:t(()=>[...n[7]||(n[7]=[a("2. Feature Flags",-1)])]),_:1})])])]),s("li",null,[e(o,{to:"#finishing-the-migration"},{default:t(()=>[...n[8]||(n[8]=[a("Finishing the Migration",-1)])]),_:1})]),s("li",null,[e(o,{to:"#summary"},{default:t(()=>[...n[9]||(n[9]=[a("Summary",-1)])]),_:1})])])]),n[46]||(n[46]=s("hr",null,null,-1)),e(h,{name:"A Practical Demo of Zero-Downtime Migrations Using Password Hashing",desc:"A practical demo of the zero-downtime migration pattern: run old + new password hash formats side-by-side, migrate users on login, and remove legacy safely.",url:"https://milanjovanovic.tech/blog/a-practical-demo-of-zero-downtime-migrations-using-password-hashing",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_178.png"}),s("p",null,[s("a",D,[e(i,{icon:"fas fa-globe"}),n[10]||(n[10]=a("Push updates live faster with RunPod",-1))]),n[12]||(n[12]=s("br",null,null,-1)),n[13]||(n[13]=a(" Spin up compute and storage in seconds with RunPod. Deploy serverless inference that scales automatically, with no manual tuning or capacity planning. Push updates live, iterate fast, and monitor everything in one place with logs, and metrics built in. RunPod is infrastructure for AI startups and technical teams who want to stay in flow, move fast, and spend less time on cloud plumbing and more time shipping real products. ",-1)),s("a",S,[e(i,{icon:"fas fa-globe"}),n[11]||(n[11]=a("Explore Runpod",-1))])]),s("p",null,[s("a",x,[e(i,{icon:"fas fa-globe"}),n[14]||(n[14]=a("Data Engineering Design Patterns - Book Giveaway from Buf",-1))]),n[16]||(n[16]=s("br",null,null,-1)),n[17]||(n[17]=a(" Buf Schema Registry brings type safety to data pipelines with Protobuf. Manage schemas centrally, validate changes, and generate Python code automatically. Plus: Buf is giving away an O'Reilly Media book, Data Engineering Design Patterns with proven solutions to idempotency, error handling, observability challenges and more. ",-1)),s("a",M,[e(i,{icon:"fas fa-globe"}),n[15]||(n[15]=a("Get your copy now",-1))]),n[18]||(n[18]=a(".",-1))]),n[47]||(n[47]=s("p",null,'Security requirements evolve. What was considered "secure enough" five years ago might not pass a security audit today.',-1)),s("p",null,[n[21]||(n[21]=a("You need to upgrade to a modern algorithm like ",-1)),s("a",T,[e(i,{icon:"fa-brands fa-wikipedia-w"}),n[19]||(n[19]=a("Argon2",-1))]),n[22]||(n[22]=a(" or ",-1)),s("a",I,[e(i,{icon:"fa-brands fa-wikipedia-w"}),n[20]||(n[20]=a("Bcrypt",-1))]),n[23]||(n[23]=a(". But here is the problem: hashing is a ",-1)),n[24]||(n[24]=s("strong",null,"one-way operation",-1)),n[25]||(n[25]=a('. You cannot reverse-engineer the existing hashes to "upgrade" them.',-1))]),n[48]||(n[48]=s("p",null,[a("If you simply swap your "),s("code",null,"IPasswordHasher"),a(" implementation, you break the application. Every single existing user who tries to log in will fail authentication because your new hasher doesn't understand the old format.")],-1)),n[49]||(n[49]=s("p",null,[a("In this article, I want to demo a "),s("strong",null,"zero-downtime migration"),a(" concept in practice.")],-1)),s("p",null,[n[27]||(n[27]=a("Real systems have more constraints (and you should not build auth from scratch). But this is a clean example of a ",-1)),n[28]||(n[28]=s("strong",null,"pattern",-1)),n[29]||(n[29]=a(" you can reuse for ",-1)),e(c,{to:"/milanjovanovic.tech/efcore-migrations-a-detailed-guide.html"},{default:t(()=>[...n[26]||(n[26]=[s("strong",null,"database migrations",-1)])]),_:1}),n[30]||(n[30]=a(":",-1))]),n[50]||(n[50]=p(`<ul><li>Move from old format to new format</li><li>Keep existing behavior working</li><li>Gradually migrate data</li><li>Delete legacy only when you are done</li></ul><p>Let&#39;s dive in.</p><hr><h2 id="the-naive-approach-and-why-it-fails" tabindex="-1"><a class="header-anchor" href="#the-naive-approach-and-why-it-fails"><span>The Naive Approach and Why It Fails</span></a></h2><p>Let&#39;s imagine you have a simple authentication system. You want to replace your legacy <code>PBKDF2</code> hasher with a standard <code>Argon2</code> implementation.</p><p>You might think, &quot;I&#39;ll just register the new implementation in the dependency injection container.&quot;</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// Switching from LegacyHasher to ModernHasher</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPasswordHasher<span class="token punctuation">,</span> ModernHasher<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Here is the failure scenario:</p>`,8)),s("ol",null,[n[37]||(n[37]=s("li",null,[s("strong",null,"New Users:"),a(" They register and log in perfectly. Their passwords are hashed with Argon2 from day one.")],-1)),s("li",null,[n[32]||(n[32]=s("strong",null,"Existing Users:",-1)),n[33]||(n[33]=a(" A user enters their correct password. The system fetches the ",-1)),n[34]||(n[34]=s("em",null,"old",-1)),n[35]||(n[35]=a()),s("a",R,[e(i,{icon:"fa-brands fa-wikipedia-w"}),n[31]||(n[31]=a("PBKDF2",-1))]),n[36]||(n[36]=a(" hash from the database.",-1))]),n[38]||(n[38]=s("li",null,[s("strong",null,"The Crash:"),a(" The "),s("code",null,"ModernHasher"),a(" tries to verify the PBKDF2 hash. It fails immediately, returning "),s("code",null,"401 Unauthorized"),a(".")],-1))]),n[51]||(n[51]=p('<p>You have inadvertently locked out your entire user base. We need a way to support <em>both</em> algorithms simultaneously without making the login code a mess.</p><hr><h2 id="the-solution-migration-on-login" tabindex="-1"><a class="header-anchor" href="#the-solution-migration-on-login"><span>The Solution: Migration on Login</span></a></h2><p>The strategy is simple: we don&#39;t migrate the database in a batch job. We migrate users lazily when they prove their identity.</p><p>The flow looks like this:</p><ol><li><strong>Attempt 1:</strong> Try to verify the password using the <strong>New</strong> algorithm.</li><li><strong>Attempt 2 (Fallback):</strong> If that fails, check if the <strong>Legacy</strong> algorithm can verify it.</li><li><strong>The Migration:</strong> If the <em>Legacy</em> verification succeeds: <ul><li>Log the user in (Success).</li><li><strong>Immediately re-hash</strong> their password using the <strong>New</strong> algorithm.</li><li>Update the database record.</li></ul></li></ol><p>Future logins for this user will now succeed via the standard flow.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_178/migration_on_login_flow.png?imwidth=1920" alt="A sequence diagram showing the migration on login flow, with attempts to verify using new and legacy hashers." tabindex="0" loading="lazy"><figcaption>A sequence diagram showing the migration on login flow, with attempts to verify using new and legacy hashers.</figcaption></figure>',8)),u(" TODO: mermaidí™”"),n[52]||(n[52]=p(`<hr><h2 id="implementation-with-net-keyed-services" tabindex="-1"><a class="header-anchor" href="#implementation-with-net-keyed-services"><span>Implementation with .NET Keyed Services</span></a></h2><p>In .NET 8, Microsoft introduced <strong>Keyed Services</strong>, which are perfect for this scenario. They allow us to register multiple implementations of the same interface and retrieve them by name.</p><h3 id="_1-registering-the-services" tabindex="-1"><a class="header-anchor" href="#_1-registering-the-services"><span>1. Registering the Services</span></a></h3><p>We register both hashers in our <code>Program.cs</code>, assigning them unique keys:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// Register the implementations with specific keys</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddKeyedSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPasswordHasher<span class="token punctuation">,</span> Pbdkf2PasswordHasher<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;legacy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddKeyedSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPasswordHasher<span class="token punctuation">,</span> Argon2PasswordHasher<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;modern&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// (Optional) Register the modern one as the default for other services</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPasswordHasher<span class="token punctuation">,</span> Argon2PasswordHasher<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-the-login-command-handler" tabindex="-1"><a class="header-anchor" href="#_2-the-login-command-handler"><span>2. The Login Command Handler</span></a></h3><p>Now we implement the migration logic. We inject both hashers using the <code>[FromKeyedServices]</code> attribute.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginCommandHandler</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">IUserRepository</span> userRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromKeyedServices</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;modern&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">IPasswordHasher</span> newHasher<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromKeyedServices</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;legacy&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">IPasswordHasher</span> legacyHasher<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>AuthenticationResult<span class="token punctuation">&gt;</span></span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">LoginCommand</span> command<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">await</span> userRepository<span class="token punctuation">.</span><span class="token function">GetByEmailAsync</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> AuthenticationResult<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 1. Try the new algorithm first (Happy Path)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>newHasher<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>PasswordHash<span class="token punctuation">,</span> command<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> AuthenticationResult<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. Fallback: Check if it&#39;s a legacy hash</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>legacyHasher<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>PasswordHash<span class="token punctuation">,</span> command<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 3. MIGRATION STEP: Re-hash and save</span></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> newHash <span class="token operator">=</span> newHasher<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            user<span class="token punctuation">.</span><span class="token function">UpdatePasswordHash</span><span class="token punctuation">(</span>newHash<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">await</span> userRepository<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> AuthenticationResult<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> AuthenticationResult<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code ensures that active users are automatically upgraded. After a few months, the vast majority of your user base will be on the new algorithm.</p><hr><h2 id="real-world-improvements" tabindex="-1"><a class="header-anchor" href="#real-world-improvements"><span>Real-World Improvements</span></a></h2><p>While the implementation above works, here are two improvements to make it production-ready.</p><h3 id="_1-algorithm-prefixes" tabindex="-1"><a class="header-anchor" href="#_1-algorithm-prefixes"><span>1. Algorithm Prefixes</span></a></h3><p>Relying on &quot;trial and error&quot; verification works, but it&#39;s cleaner to know exactly which algorithm was used to create a hash.</p><p>Standard algorithms often include a prefix (e.g., Bcrypt starts with <code>$2a$</code> or <code>$2b$</code>). You can use this to route the request efficiently:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsLegacyHash</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> hash<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// This assumes we&#39;re storing a prefix for PBKDF2 hashes. Something to consider.</span></span>
<span class="line">    <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;pbkdf2$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Another benefit this unlocks is being able to query the database for users still on the legacy format.</p><h3 id="_2-feature-flags" tabindex="-1"><a class="header-anchor" href="#_2-feature-flags"><span>2. Feature Flags</span></a></h3><p>Performing a database write during a login request adds latency. If you have high traffic, you might want to control this roll-out.</p>`,20)),s("p",null,[n[40]||(n[40]=a("By wrapping the migration logic behind a ",-1)),e(c,{to:"/milanjovanovic.tech/feature-flags-in-dotnet-and-how-i-use-them-for-ab-testing.html"},{default:t(()=>[...n[39]||(n[39]=[s("strong",null,"Feature Flag",-1)])]),_:1}),n[41]||(n[41]=a(', you can disable the "write" step if your database comes under load, while still allowing users to log in via the read-only fallback.',-1))]),n[53]||(n[53]=p(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> featureManager<span class="token punctuation">.</span><span class="token function">IsEnabledAsync</span><span class="token punctuation">(</span>FeatureFlags<span class="token punctuation">.</span>MigratePasswords<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">    legacyHasher<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>PasswordHash<span class="token punctuation">,</span> command<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Perform migration...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="finishing-the-migration" tabindex="-1"><a class="header-anchor" href="#finishing-the-migration"><span>Finishing the Migration</span></a></h2><p>After you run this for a while (usually a few months), most active accounts will be upgraded. You can then run a cleanup script to identify any remaining legacy hashes and force those users to reset their passwords on the next login attempt.</p><p>At that point, you can remove:</p><ul><li>The legacy hasher registration</li><li>The legacy verification code path</li><li>The feature flag</li></ul><p>And the migration is complete.</p><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>A &quot;simple&quot; hashing upgrade is really a <strong>data migration</strong>. This article is about the migration pattern. Not about reinventing auth.</p><p>The <strong>zero-downtime pattern</strong> looks like this:</p><ol><li>New format for new writes</li><li>Support both formats for reads</li><li>Migrate old data gradually (migrate-on-login is a great trick)</li><li>Put it behind a feature flag</li><li>Delete legacy when you are done</li></ol><p>By allowing the old and new formats to coexist for a period of time, you achieve a seamless transition. Once your monitoring shows that 99% of active users have migrated, you can identify the users on the legacy format and force a password reset on their next attempt.</p>`,13)),s("div",j,[n[45]||(n[45]=s("p",{class:"hint-container-title"},"Info",-1)),s("p",null,[n[43]||(n[43]=a("If you want to see a practical demo of this, ",-1)),s("a",F,[e(i,{icon:"fa-brands fa-youtube"}),n[42]||(n[42]=a("check out this video I made",-1))]),n[44]||(n[44]=a(".",-1))]),e(k,{src:"youtube/7YUV4O9eMjQ"})]),n[54]||(n[54]=s("hr",null,null,-1)),u(" TODO: add ARTICLE CARD "),e(r,d(m({title:"A Practical Demo of Zero-Downtime Migrations Using Password Hashing",desc:"A practical demo of the zero-downtime migration pattern: run old + new password hash formats side-by-side, migrate users on login, and remove legacy safely.",link:"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/a-practical-demo-of-zero-downtime-migrations-using-password-hashing.html",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16)])}const N=f(b,[["render",q]]),E=JSON.parse('{"path":"/milanjovanovic.tech/a-practical-demo-of-zero-downtime-migrations-using-password-hashing.html","title":"A Practical Demo of Zero-Downtime Migrations Using Password Hashing","lang":"en-US","frontmatter":{"lang":"en-US","title":"A Practical Demo of Zero-Downtime Migrations Using Password Hashing","description":"Article(s) > A Practical Demo of Zero-Downtime Migrations Using Password Hashing","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"A Practical Demo of Zero-Downtime Migrations Using Password Hashing\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_178/migration_on_login_flow.png?imwidth=1920\\"],\\"datePublished\\":\\"2026-01-24T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/a-practical-demo-of-zero-downtime-migrations-using-password-hashing.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"A Practical Demo of Zero-Downtime Migrations Using Password Hashing"}],["meta",{"property":"og:description","content":"Article(s) > A Practical Demo of Zero-Downtime Migrations Using Password Hashing"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_178.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_178.png"}],["meta",{"name":"twitter:image:alt","content":"A Practical Demo of Zero-Downtime Migrations Using Password Hashing"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2026-01-24T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > A Practical Demo of Zero-Downtime Migrations Using Password Hashing"},{"property":"og:description","content":"A Practical Demo of Zero-Downtime Migrations Using Password Hashing"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/a-practical-demo-of-zero-downtime-migrations-using-password-hashing.html"}]],"prev":"/programming/cs/articles/README.md","date":"2026-01-24T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_178.png"},"git":{},"readingTime":{"minutes":4.94,"words":1481},"filePathRelative":"milanjovanovic.tech/a-practical-demo-of-zero-downtime-migrations-using-password-hashing.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{N as comp,E as data};
