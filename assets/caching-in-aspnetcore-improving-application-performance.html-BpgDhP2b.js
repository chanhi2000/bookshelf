import{_ as b}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as f,d as s,f as e,b as c,t as y,n as d,g as m,w as t,e as a,r as p,o as w}from"./app-BItykJLQ.js";const C={},S={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},A={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},x={class:"table-of-contents"},P={href:"https://learn.microsoft.com/en-us/aspnet/core/performance/caching/memory",target:"_blank",rel:"noopener noreferrer"},T={href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"},E={href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"},I={href:"https://en.wikipedia.org/wiki/Cache_stampede",target:"_blank",rel:"noopener noreferrer"},D={href:"https://learn.microsoft.com/en-us/aspnet/core/performance/caching/hybrid",target:"_blank",rel:"noopener noreferrer"};function M(k,n){const u=p("VPCard"),i=p("router-link"),h=p("SiteInfo"),o=p("VPIcon"),v=p("Tabs"),g=p("RouteLink");return w(),f("div",null,[s("h1",S,[s("a",A,[s("span",null,y(k.$frontmatter.title)+" ê´€ë ¨",1)])]),e(u,d(m({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e(u,d(m({title:"Redis > Article(s)",desc:"Article(s)",link:"/data-science/redis/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",x,[s("ul",null,[s("li",null,[e(i,{to:"#how-caching-improves-application-performance"},{default:t(()=>[...n[0]||(n[0]=[a("How Caching Improves Application Performance",-1)])]),_:1})]),s("li",null,[e(i,{to:"#caching-abstractions-in-asp-net-core"},{default:t(()=>[...n[1]||(n[1]=[a("Caching Abstractions in ASP.NET Core",-1)])]),_:1})]),s("li",null,[e(i,{to:"#cache-aside-pattern"},{default:t(()=>[...n[2]||(n[2]=[a("Cache-Aside Pattern",-1)])]),_:1})]),s("li",null,[e(i,{to:"#pros-and-cons-of-in-memory-caching"},{default:t(()=>[...n[3]||(n[3]=[a("Pros and Cons of In-Memory Caching",-1)])]),_:1})]),s("li",null,[e(i,{to:"#distributed-caching-with-redis"},{default:t(()=>[...n[4]||(n[4]=[a("Distributed Caching With Redis",-1)])]),_:1})]),s("li",null,[e(i,{to:"#cache-stampede-and-hybridcache"},{default:t(()=>[...n[5]||(n[5]=[a("Cache Stampede and HybridCache",-1)])]),_:1})]),s("li",null,[e(i,{to:"#summary"},{default:t(()=>[...n[6]||(n[6]=[a("Summary",-1)])]),_:1})])])]),n[45]||(n[45]=s("hr",null,null,-1)),e(h,{name:"Caching in ASP.NET Core: Improving Application Performance",desc:"Caching is one of the simplest techniques to significantly improve your application's performance. In this newsletter, we will explore how to implement caching in ASP.NET Core applications.",url:"https://milanjovanovic.tech/blog/caching-in-aspnetcore-improving-application-performance/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_093.png"}),n[46]||(n[46]=s("p",null,"Caching is one of the simplest techniques to significantly improve your application's performance. It's the process of temporarily storing data in a faster access location. You will typically cache the results of expensive operations or frequently accessed data.",-1)),n[47]||(n[47]=s("p",null,"Caching allows subsequent requests for the same data to be served from the cache instead of fetching the data from its source.",-1)),n[48]||(n[48]=s("p",null,[a("ASP.NET Core offers several types of caches, such as "),s("code",null,"IMemoryCache"),a(", "),s("code",null,"IDistributedCache"),a(", and the upcoming "),s("code",null,"HybridCache"),a(" (.NET 9).")],-1)),s("p",null,[n[8]||(n[8]=a("In this newsletter, we will explore how to implement ",-1)),s("a",P,[e(o,{icon:"fa-brands fa-microsoft"}),n[7]||(n[7]=a("caching in ASP.NET Core",-1))]),n[9]||(n[9]=a(" applications.",-1))]),n[49]||(n[49]=s("hr",null,null,-1)),n[50]||(n[50]=s("h2",{id:"how-caching-improves-application-performance",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#how-caching-improves-application-performance"},[s("span",null,"How Caching Improves Application Performance")])],-1)),n[51]||(n[51]=s("p",null,"Caching improves your application's performance by reducing latency and server load while enhancing scalability and user experience.",-1)),s("ul",null,[n[14]||(n[14]=s("li",null,[s("strong",null,"Faster data retrieval"),a(": Cached data can be accessed much faster than retrieving it from the source (like a database or an API). Caches are typically stored in memory (RAM).")],-1)),n[15]||(n[15]=s("li",null,[s("strong",null,"Fewer database queries"),a(": Caching frequently accessed data reduces the number of database queries. This reduces the load on the database server.")],-1)),n[16]||(n[16]=s("li",null,[s("strong",null,"Lower CPU usage"),a(": Rendering web pages or processing API responses can consume significant CPU resources. Caching the results reduces the need for repetitive CPU-intensive tasks.")],-1)),n[17]||(n[17]=s("li",null,[s("strong",null,"Handling increased traffic"),a(": By reducing the load on backend systems, caching allows your application to handle more concurrent users and requests.")],-1)),s("li",null,[n[11]||(n[11]=s("strong",null,"Distributed caching",-1)),n[12]||(n[12]=a(": Distributed cache solutions like ",-1)),s("a",T,[e(o,{icon:"iconfont icon-redis"}),n[10]||(n[10]=a("Redis",-1))]),n[13]||(n[13]=a(" enable scaling the cache across multiple servers, further improving performance and resilience.",-1))])]),n[52]||(n[52]=c(`<p>In a recent project I worked on, we used Redis to scale to more than 1,000,000 users. We only had one SQL Server instance with a read-replica for reporting. The power of caching, eh?</p><hr><h2 id="caching-abstractions-in-asp-net-core" tabindex="-1"><a class="header-anchor" href="#caching-abstractions-in-asp-net-core"><span>Caching Abstractions in ASP.NET Core</span></a></h2><p>ASP.NET Core provides two primary abstractions for working with caches:</p><ul><li><code>IMemoryCache</code>: Stores data in the memory of the web server. Simple to use but not suitable for distributed scenarios.</li><li><code>IDistributedCache</code>: Offers a more robust solution for distributed applications. It allows you to store cached data in a distributed cache like Redis.</li></ul><p>We have to register these services with DI to use them. <code>AddDistributedMemoryCache</code> will configure the in-memory implementation of <code>IDistributedCache</code>, which isn&#39;t distributed.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddDistributedMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how you can use the <code>IMemoryCache</code>. We will first check if the cached value is present and return it directly if it&#39;s there. Otherwise, we must fetch the value from the database and cache it for subsequent requests.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;products/{id}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token class-name">IMemoryCache</span> cache<span class="token punctuation">,</span> <span class="token class-name">AppDbContext</span> context<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">Product</span> product<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            product <span class="token operator">=</span> context<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> cacheEntryOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryCacheEntryOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">SetAbsoluteExpiration</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">SetSlidingExpiration</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            cache<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> product<span class="token punctuation">,</span> cacheEntryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Ok</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cache expiration is another important topic to discuss. We want to remove cache entries that aren&#39;t used and become stale. You can pass in the <code>MemoryCacheEntryOptions</code>, allowing you to configure cache expiration. For example, we can set the <code>AbsoluteExpiration</code> and <code>SlidingExpiration</code> values to control when the cache entry will expire.</p><hr><h2 id="cache-aside-pattern" tabindex="-1"><a class="header-anchor" href="#cache-aside-pattern"><span>Cache-Aside Pattern</span></a></h2><p>The cache-aside pattern is the most common caching strategy. Here&#39;s how it works:</p><ol><li><strong>Check the cache</strong>: Look for the requested data in the cache.</li><li><strong>Fetch from source (if cache miss)</strong>: If the data isn&#39;t in the cache, fetch it from the source.</li><li><strong>Update the cache</strong>: Store the fetched data in the cache for subsequent requests.</li></ol><figure><img src="https://milanjoavnovic.tech/blogs/mnw_093/cache_aside.png?imwidth=3840" alt="Cache-aside pattern." tabindex="0" loading="lazy"><figcaption>Cache-aside pattern.</figcaption></figure><p>Here&#39;s how you can implement the cache-aside pattern as an extension method for <code>IDistributedCache</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DistributedCacheExtensions</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DistributedCacheEntryOptions</span> DefaultExpiration <span class="token operator">=&gt;</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        AbsoluteExpirationRelativeToNow <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">GetOrCreateAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token keyword">this</span> <span class="token class-name">IDistributedCache</span> cache<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">Func<span class="token punctuation">&lt;</span>Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> factory<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">DistributedCacheEntryOptions<span class="token punctuation">?</span></span> cacheOptions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> cachedData <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedData <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>cachedData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">SetStringAsync</span><span class="token punctuation">(</span></span>
<span class="line">            key<span class="token punctuation">,</span></span>
<span class="line">            JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            cacheOptions <span class="token operator">??</span> DefaultExpiration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We&#39;re using <code>JsonSerializer</code> to manage serialization to and from a JSON string. The <code>SetStringAsync</code> method also accepts a <code>DistributedCacheEntryOptions</code> argument to control cache expiration.</p><p>Here&#39;s how we would use this extension method:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;products/{id}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token class-name">IDistributedCache</span> cache<span class="token punctuation">,</span> <span class="token class-name">AppDbContext</span> context<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetOrCreateAsync</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;products-</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> productFromDb <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> productFromDb<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Ok</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="pros-and-cons-of-in-memory-caching" tabindex="-1"><a class="header-anchor" href="#pros-and-cons-of-in-memory-caching"><span>Pros and Cons of In-Memory Caching</span></a></h2>`,22)),e(v,{data:[{id:"Pros:"},{id:"Cons:"}],active:0},{title0:t(({value:l,isActive:r})=>[...n[18]||(n[18]=[a("Pros:",-1)])]),title1:t(({value:l,isActive:r})=>[...n[19]||(n[19]=[a("Cons:",-1)])]),tab0:t(({value:l,isActive:r})=>[...n[20]||(n[20]=[s("ul",null,[s("li",null,"Extremely fast"),s("li",null,"Simple to implement"),s("li",null,"No external dependencies")],-1)])]),tab1:t(({value:l,isActive:r})=>[...n[21]||(n[21]=[s("ul",null,[s("li",null,"Cache data is lost if the server restarts"),s("li",null,"Limited to the memory (RAM) of a single server"),s("li",null,"Cache data is not shared across multiple instances of your application")],-1)])]),_:1}),n[53]||(n[53]=s("hr",null,null,-1)),n[54]||(n[54]=s("h2",{id:"distributed-caching-with-redis",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#distributed-caching-with-redis"},[s("span",null,"Distributed Caching With Redis")])],-1)),s("p",null,[s("a",E,[e(o,{icon:"iconfont icon-redis"}),n[22]||(n[22]=a("Redis",-1))]),n[23]||(n[23]=a(" is a popular in-memory data store often used as a high-performance distributed cache. To use Redis in your ASP.NET Core application, you can use the ",-1)),n[24]||(n[24]=s("code",null,"StackExchange.Redis",-1)),n[25]||(n[25]=a(" library.",-1))]),n[55]||(n[55]=c(`<p>However, there&#39;s also the <code>Microsoft.Extensions.Caching.StackExchangeRedis</code> library, allowing you to integrate Redis with <code>IDistributedCache</code>.</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>StackExchangeRedis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Here&#39;s how you can configure it with DI by providing a connection string to Redis:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;Redis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddStackExchangeRedisCache</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    options<span class="token punctuation">.</span>Configuration <span class="token operator">=</span> connectionString<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>An alternative approach is to register an <code>IConnectionMultiplexer</code> as a service. Then, we will use it to provide a function for the <code>ConnectionMultiplexerFactory</code>.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;Redis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">IConnectionMultiplexer</span> connectionMultiplexer <span class="token operator">=</span></span>
<span class="line">    ConnectionMultiplexer<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddSingleton</span><span class="token punctuation">(</span>connectionMultiplexer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddStackExchangeRedisCache</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    options<span class="token punctuation">.</span>ConnectionMultiplexerFactory <span class="token operator">=</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>connectionMultiplexer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, when you inject <code>IDistributedCache</code>, it will use Redis under the hood.</p><hr><h2 id="cache-stampede-and-hybridcache" tabindex="-1"><a class="header-anchor" href="#cache-stampede-and-hybridcache"><span>Cache Stampede and HybridCache</span></a></h2>`,9)),s("p",null,[n[27]||(n[27]=a("The in-memory cache implementations in ASP.NET Core are susceptible to race conditions, which can cause a cache stampede. A ",-1)),s("a",I,[e(o,{icon:"fa-brands fa-wikipedia-w"}),n[26]||(n[26]=a("cache stampede",-1))]),n[28]||(n[28]=a(" happens when concurrent requests encounter a cache miss and try to fetch the data from the source. This can overload your application and negate the benefits of caching.",-1))]),s("p",null,[n[30]||(n[30]=a("Locking is one solution for the cache stampede problem. .NET offers many options for ",-1)),e(g,{to:"/milanjovanovic.tech/introduction-to-locking-and-concurrency-control-in-dotnet-6.html"},{default:t(()=>[...n[29]||(n[29]=[a("locking and concurrency control",-1)])]),_:1}),n[31]||(n[31]=a(". The most commonly used locking primitives are the ",-1)),n[32]||(n[32]=s("code",null,"lock",-1)),n[33]||(n[33]=a(" statement and the ",-1)),n[34]||(n[34]=s("code",null,"Semaphore",-1)),n[35]||(n[35]=a(" (or ",-1)),n[36]||(n[36]=s("code",null,"SemaphoreSlim",-1)),n[37]||(n[37]=a(") class.",-1))]),n[56]||(n[56]=c(`<p>Here&#39;s how we could use <code>SemaphoreSlim</code> to introduce locking before fetching data:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DistributedCacheExtensions</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">SemaphoreSlim</span> Semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SemaphoreSlim</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Arguments omitted for brevity</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">GetOrCreateAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Fetch data from cache, and return if present</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Cache miss</span></span>
<span class="line">        <span class="token keyword">try</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">await</span> Semaphore<span class="token punctuation">.</span><span class="token function">WaitAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// Check if the data was added to the cache by another request</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// If not, proceed to fetch data and cache it</span></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">SetStringAsync</span><span class="token punctuation">(</span></span>
<span class="line">                key<span class="token punctuation">,</span></span>
<span class="line">                JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                cacheOptions <span class="token operator">??</span> DefaultExpiration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">finally</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Semaphore<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The previous implementation has a lock contention issue since all requests have to wait for the semaphore. A much better solution would be locking based on the <code>key</code> value.</p>`,3)),s("p",null,[n[39]||(n[39]=a(".NET 9 introduces a new caching abstraction called ",-1)),n[40]||(n[40]=s("code",null,"HybridCache",-1)),n[41]||(n[41]=a(", which aims to solve the shortcomings of ",-1)),n[42]||(n[42]=s("code",null,"IDistributedCache",-1)),n[43]||(n[43]=a(". Learn more about this in the ",-1)),s("a",D,[e(o,{icon:"fa-brands fa-microsoft"}),n[38]||(n[38]=a("Hybrid cache documentation",-1))]),n[44]||(n[44]=a(".",-1))]),n[57]||(n[57]=c('<hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Caching is a powerful technique for improving web application performance. ASP.NET Core&#39;s caching abstractions make it easy to implement various caching strategies.</p><p>We can choose from <code>IMemoryCache</code> for in-memory cache and <code>IDistributedCache</code> for distributed caching.</p><p>Here are a few guidelines to wrap up this week&#39;s issue:</p><ul><li>Use <code>IMemoryCache</code> for simple, in-memory caching</li><li>Implement the cache aside pattern to minimize database hits</li><li>Consider Redis as a high-performance distributed cache implementation</li><li>Use <code>IDistributedCache</code> for sharing cached data across multiple applications</li></ul><p>That&#39;s all for today.</p><p>See you next week.</p>',8))])}const q=b(C,[["render",M]]),j=JSON.parse('{"path":"/milanjovanovic.tech/caching-in-aspnetcore-improving-application-performance.html","title":"Caching in ASP.NET Core: Improving Application Performance","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Caching in ASP.NET Core: Improving Application Performance","description":"Article(s) > Caching in ASP.NET Core: Improving Application Performance","icon":"iconfont icon-csharp","category":["C#","DotNet","Redis","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet","redis"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Caching in ASP.NET Core: Improving Application Performance\\",\\"image\\":[\\"https://milanjoavnovic.tech/blogs/mnw_093/cache_aside.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-06-08T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/caching-in-aspnetcore-improving-application-performance.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Caching in ASP.NET Core: Improving Application Performance"}],["meta",{"property":"og:description","content":"Article(s) > Caching in ASP.NET Core: Improving Application Performance"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_093.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_093.png"}],["meta",{"name":"twitter:image:alt","content":"Caching in ASP.NET Core: Improving Application Performance"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-06-08T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Caching in ASP.NET Core: Improving Application Performance"},{"property":"og:description","content":"Caching in ASP.NET Core: Improving Application Performance"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/caching-in-aspnetcore-improving-application-performance.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-06-08T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_093.png"},"git":{},"readingTime":{"minutes":4.83,"words":1449},"filePathRelative":"milanjovanovic.tech/caching-in-aspnetcore-improving-application-performance.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{q as comp,j as data};
