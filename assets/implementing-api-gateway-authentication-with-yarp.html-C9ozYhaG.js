import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as t,f as s,b as u,t as g,n as v,g as y,w as e,e as a,r as l,o as f}from"./app-BItykJLQ.js";const k={},b={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},A={class:"table-of-contents"},P={href:"https://microsoft.github.io/reverse-proxy/index.html",target:"_blank",rel:"noopener noreferrer"},q={href:"https://docs.microsoft.com/aspnet/core/security/authentication/",target:"_blank",rel:"noopener noreferrer"},I={href:"https://learn.microsoft.com/en-us/aspnet/core/security/authorization/introduction",target:"_blank",rel:"noopener noreferrer"},R={href:"https://learn.microsoft.com/en-us/aspnet/core/security/authorization/policies",target:"_blank",rel:"noopener noreferrer"},j={class:"hint-container note"},x={href:"https://github.com/m-jovanovic/yarp-authentication",target:"_blank",rel:"noopener noreferrer"};function z(c,n){const d=l("VPCard"),p=l("router-link"),r=l("SiteInfo"),i=l("VPIcon"),o=l("RouteLink");return f(),h("div",null,[t("h1",b,[t("a",w,[t("span",null,g(c.$frontmatter.title)+" ê´€ë ¨",1)])]),s(d,v(y({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),t("nav",A,[t("ul",null,[t("li",null,[s(p,{to:"#the-role-of-api-gateways"},{default:e(()=>[...n[0]||(n[0]=[a("The Role of API Gateways",-1)])]),_:1})]),t("li",null,[s(p,{to:"#configuring-authentication-with-yarp"},{default:e(()=>[...n[1]||(n[1]=[a("Configuring Authentication With YARP",-1)])]),_:1})]),t("li",null,[s(p,{to:"#creating-custom-authentication-policies"},{default:e(()=>[...n[2]||(n[2]=[a("Creating Custom Authentication Policies",-1)])]),_:1})]),t("li",null,[s(p,{to:"#summary"},{default:e(()=>[...n[3]||(n[3]=[a("Summary",-1)])]),_:1})])])]),n[42]||(n[42]=t("hr",null,null,-1)),s(r,{name:"Implementing API Gateway Authentication With YARP",desc:"In this newsletter, we'll explore how you can implement API gateway authentication using YARP (Yet Another Reverse Proxy), a powerful and flexible reverse proxy library for .NET applications.",url:"https://milanjovanovic.tech/blog/implementing-api-gateway-authentication-with-yarp/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_087.png"}),n[43]||(n[43]=t("p",null,"API gateways provide clients with a single point of entry. This streamlines their interactions with your system and ensures the security of your microservices or distributed system.",-1)),n[44]||(n[44]=t("p",null,"One critical aspect of API gateways is authentication - ensuring only authorized users and applications can access your valuable data and resources.",-1)),t("p",null,[n[5]||(n[5]=a("In this newsletter, we'll explore how you can implement API gateway authentication using ",-1)),t("a",P,[s(i,{icon:"fa-brands fa-microsoft"}),n[4]||(n[4]=a("YARP",-1))]),n[6]||(n[6]=a(" (Yet Another Reverse Proxy), a powerful and flexible reverse proxy library for .NET applications.",-1))]),n[45]||(n[45]=t("p",null,"Here's what we will cover:",-1)),n[46]||(n[46]=t("ul",null,[t("li",null,"The role of API gateways"),t("li",null,"Configuring authentication with YARP"),t("li",null,"Creating custom authorization policies")],-1)),n[47]||(n[47]=t("p",null,"Let's dive in.",-1)),n[48]||(n[48]=t("hr",null,null,-1)),n[49]||(n[49]=t("h2",{id:"the-role-of-api-gateways",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#the-role-of-api-gateways"},[t("span",null,"The Role of API Gateways")])],-1)),t("p",null,[n[8]||(n[8]=a("An ",-1)),s(o,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:e(()=>[...n[7]||(n[7]=[t("strong",null,"API gateway",-1)])]),_:1}),n[9]||(n[9]=a(' is the "front door" to your backend services and APIs. It acts as an intermediary layer, handling client requests and routing them to the appropriate destinations.',-1))]),n[50]||(n[50]=t("p",null,"The key benefits of API gateways are:",-1)),t("ul",null,[n[14]||(n[14]=t("li",null,[t("strong",null,"Centralized access"),a(": All incoming requests must first pass through the gateway. This simplifies management and monitoring.")],-1)),n[15]||(n[15]=t("li",null,[t("strong",null,"Service abstraction"),a(": Clients interact only with the gateway. We can hide the complexity of the backend architecture from clients.")],-1)),t("li",null,[n[11]||(n[11]=t("strong",null,"Performance enhancement",-1)),n[12]||(n[12]=a(": Implement techniques like caching and ",-1)),s(o,{to:"/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html"},{default:e(()=>[...n[10]||(n[10]=[t("strong",null,"load balancing",-1)])]),_:1}),n[13]||(n[13]=a(" to optimize API performance.",-1))]),n[16]||(n[16]=t("li",null,[t("strong",null,"Authentication and Authorization"),a(": API gateways verify user and application identities, enforcing whether a request is allowed or not.")],-1))]),t("figure",null,[n[21]||(n[21]=t("img",{src:"https://milanjovanovic.tech/blogs/mnw_088/api_gateway.png?imwidth=3840",alt:"API Gateway diagram.<br/>Source: Modular Monolith Architecture",tabindex:"0",loading:"lazy"},null,-1)),t("figcaption",null,[n[18]||(n[18]=a("API Gateway diagram.",-1)),n[19]||(n[19]=t("br",null,null,-1)),n[20]||(n[20]=a("Source: ",-1)),s(o,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:e(()=>[...n[17]||(n[17]=[a("Modular Monolith Architecture",-1)])]),_:1})])]),n[51]||(n[51]=t("hr",null,null,-1)),n[52]||(n[52]=t("h2",{id:"configuring-authentication-with-yarp",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#configuring-authentication-with-yarp"},[t("span",null,"Configuring Authentication With YARP")])],-1)),n[53]||(n[53]=t("p",null,"We can use the API gateway to authenticate and authorize requests before they are proxied to the destination servers. This can reduce the load on the destination servers, and introduce a layer of security. Implementing authentication on the API gateway ensures consistent policies are implemented across your applications.",-1)),t("p",null,[n[23]||(n[23]=a("If you're new to YARP, I recommend first reading about ",-1)),s(o,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:e(()=>[...n[22]||(n[22]=[t("strong",null,"how to implement an API gateway with YARP",-1)])]),_:1}),n[24]||(n[24]=a(".",-1))]),n[54]||(n[54]=t("p",null,"By default, YARP won't authenticate or authorize requests unless enabled in the route or application configuration.",-1)),t("p",null,[n[27]||(n[27]=a("We can start by introducing ",-1)),t("a",q,[s(i,{icon:"fa-brands fa-microsoft"}),n[25]||(n[25]=a("authentication",-1))]),n[28]||(n[28]=a(" and ",-1)),t("a",I,[s(i,{icon:"fa-brands fa-microsoft"}),n[26]||(n[26]=a("authorization",-1))]),n[29]||(n[29]=a(" middleware:",-1))]),n[55]||(n[55]=u(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">MapReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This allows us to configure the authorization policy by providing the <code>AuthorizationPolicy</code> value in the route configuration.</p><p>There are two special values we can specify in a route&#39;s authorization parameter:</p><ul><li><code>default</code> - The route will require an authenticated user.</li><li><code>anonymous</code> - The route will not require authorization regardless of any other configuration.</li></ul><p>Here&#39;s how we can enforce that all incoming requests must be authenticated:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// This is how we define reverse proxy routes.</span></span>
<span class="line">  <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;api-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/{**catch-all}&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We want to authorize any incoming request as soon as it hits the API gateway. However, the destination server may still need to know who the user is (authentication) and what they can do (authorization).</p><p>YARP will pass any credentials to the proxied request. By default, cookies, bearer tokens, and API keys will flow to the destination server.</p><hr><h2 id="creating-custom-authentication-policies" tabindex="-1"><a class="header-anchor" href="#creating-custom-authentication-policies"><span>Creating Custom Authentication Policies</span></a></h2>`,10)),t("p",null,[n[31]||(n[31]=a("YARP can utilize the powerful ",-1)),t("a",R,[s(i,{icon:"fa-brands fa-microsoft"}),n[30]||(n[30]=a("authorization policies",-1))]),n[32]||(n[32]=a(" feature in ASP.NET Core. We can specify a policy per route in the proxy configuration, and the rest is handled by existing ASP.NET Core authentication and authorization components.",-1))]),n[56]||(n[56]=u(`<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// This is how we define auth policies for reverse proxy routes.</span></span>
<span class="line">  <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;api-route1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;is-vip&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/hello-vip&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;api-route2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/{**catch-all}&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how we can create a custom <code>is-vip</code> policy with two components. It requires an authenticated user and <code>vip</code> claim with one of the defined allowed values to be present . To use this policy, we can just specify it as the value for the <code>AuthorizationPolicy</code> in the route configuration.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">services<span class="token punctuation">.</span><span class="token function">AddAuthorization</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    options<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">&quot;is-vip&quot;</span><span class="token punctuation">,</span> policy <span class="token operator">=&gt;</span></span>
<span class="line">        policy</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">RequireAuthenticatedUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">RequireClaim</span><span class="token punctuation">(</span><span class="token string">&quot;vip&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">allowedValues</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>API gateways provide a unified access point, streamlining client interactions and securing your backend services. Authentication is an essential element of API gateway security, controlling who can access your resources.</p><p>YARP offers a versatile solution for building .NET API gateways. By integrating with ASP.NET Core&#39;s authentication and authorization frameworks, YARP enables robust security mechanisms.</p>`,7)),t("p",null,[n[34]||(n[34]=a("This flexibility really shines with support for custom authorization policies. This allows you to define ",-1)),s(o,{to:"/milanjovanovic.tech/master-claims-transformation-for-flexible-aspnetcore-authorization.html"},{default:e(()=>[...n[33]||(n[33]=[t("strong",null,"granular access control",-1)])]),_:1}),n[35]||(n[35]=a(" based on user roles, claims, or other attributes.",-1))]),n[57]||(n[57]=t("p",null,"Thanks for reading, and I'll see you next week.",-1)),t("div",j,[n[41]||(n[41]=t("p",{class:"hint-container-title"},"P.S.",-1)),t("p",null,[n[39]||(n[39]=a("Here's the complete ",-1)),t("a",x,[n[36]||(n[36]=a("source code (",-1)),s(i,{icon:"iconfont icon-github"}),n[37]||(n[37]=t("code",null,"m-jovanovic/yarp-authentication",-1)),n[38]||(n[38]=a(")",-1))]),n[40]||(n[40]=a(" for this article if you want to try it out.",-1))]),s(r,{name:"m-jovanovic/yarp-authentication",desc:"An example project demonstrating how to implement an API Gateway with authentication using YARP.",url:"https://github.com/m-jovanovic/yarp-authentication",logo:"https://avatars.githubusercontent.com/u/34191235?s=96&v=4",preview:"https://opengraph.githubassets.com/8f88b7fbb4e56e9a3c4b643b30cb9332e0589f668c40767bf9f5be9c4c3eec70/m-jovanovic/yarp-authentication"})])])}const C=m(k,[["render",z]]),W=JSON.parse('{"path":"/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html","title":"Implementing API Gateway Authentication With YARP","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Implementing API Gateway Authentication With YARP","description":"Article(s) > Implementing API Gateway Authentication With YARP","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Implementing API Gateway Authentication With YARP\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/modular-monolith-architecture/README.md\\"],\\"datePublished\\":\\"2024-05-04T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Implementing API Gateway Authentication With YARP"}],["meta",{"property":"og:description","content":"Article(s) > Implementing API Gateway Authentication With YARP"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"name":"twitter:image:alt","content":"Implementing API Gateway Authentication With YARP"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-05-04T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Implementing API Gateway Authentication With YARP"},{"property":"og:description","content":"Implementing API Gateway Authentication With YARP"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-05-04T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_087.png"},"git":{},"readingTime":{"minutes":3.37,"words":1010},"filePathRelative":"milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{C as comp,W as data};
