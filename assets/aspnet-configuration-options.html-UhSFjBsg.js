import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as e,b as d,t as b,n as f,g as y,w as t,e as a,r as p,o as w}from"./app-BItykJLQ.js";const C="/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/Home-Page-ProjectConfigurationDemo.png",q="/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/Home-Page-blue.png",T={},P={id:"frontmatter-title-관련",tabindex:"-1"},I={class:"header-anchor",href:"#frontmatter-title-관련"},S={class:"table-of-contents"},O={class:"hint-container info"},j={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration",target:"_blank",rel:"noopener noreferrer"},M={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration/tree/basic-concepts",target:"_blank",rel:"noopener noreferrer"},x={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration/tree/options-pattern",target:"_blank",rel:"noopener noreferrer"};function H(k,n){const g=p("VPCard"),o=p("router-link"),u=p("SiteInfo"),r=p("RouteLink"),i=p("VPIcon"),m=p("Tabs");return w(),h("div",null,[s("h1",P,[s("a",I,[s("span",null,b(k.$frontmatter.title)+" 관련",1)])]),e(g,f(y({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",S,[s("ul",null,[s("li",null,[e(o,{to:"#why-the-options-pattern"},{default:t(()=>[...n[0]||(n[0]=[a("Why the Options Pattern?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#how-to-use-the-options-pattern-to-read-configuration-with-ioptions-interface"},{default:t(()=>[...n[1]||(n[1]=[a("How to Use the Options Pattern to Read Configuration with IOptions Interface",-1)])]),_:1})]),s("li",null,[e(o,{to:"#using-ioptionssnapshot-to-read-the-updated-configuration"},{default:t(()=>[...n[2]||(n[2]=[a("Using IOptionsSnapshot to Read the Updated Configuration",-1)])]),_:1})]),s("li",null,[e(o,{to:"#using-ioptionsmonitor-for-singleton-services"},{default:t(()=>[...n[3]||(n[3]=[a("Using IOptionsMonitor for Singleton Services",-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#ioptionsmonitor-t-purpose"},{default:t(()=>[...n[4]||(n[4]=[a("IOptionsMonitor<T> Purpose",-1)])]),_:1})])])]),s("li",null,[e(o,{to:"#named-options"},{default:t(()=>[...n[5]||(n[5]=[a("Named Options",-1)])]),_:1})]),s("li",null,[e(o,{to:"#choosing-between-ioptions-ioptionssnapshot-and-ioptionsmonitor"},{default:t(()=>[...n[6]||(n[6]=[a("Choosing Between IOptions, IOptionsSnapshot, and IOptionsMonitor",-1)])]),_:1})]),s("li",null,[e(o,{to:"#conclusion"},{default:t(()=>[...n[7]||(n[7]=[a("Conclusion",-1)])]),_:1})])])]),n[38]||(n[38]=s("hr",null,null,-1)),e(u,{name:"ASP.NET Core Configuration - Options Pattern",desc:"In this article, we're going to cover another, better way of reading configuration data in .NET Core - the options pattern.",url:"https://code-maze.com/aspnet-configuration-options/",logo:"/assets/image/code-maze.com/favicon.png",preview:"/assets/image/code-maze.com/aspnet-configuration-options/banner.png"}),n[39]||(n[39]=s("p",null,"In this article, we’re going to cover another way of reading configuration data in .NET Core - the options pattern. The options pattern helps us group related configuration settings, and it provides strongly typed access to them. We are going to learn how the options pattern works and how we can improve our existing configuration access or even reload the configuration in real-time.",-1)),s("p",null,[n[9]||(n[9]=a("If you’ve missed some of the basic configuration stuff, check out the ",-1)),e(r,{to:"/code-maze.com/aspnet-configuration-basic-concepts.html"},{default:t(()=>[...n[8]||(n[8]=[a("ASP.NET Core Configuration Basics",-1)])]),_:1}),n[10]||(n[10]=a(".",-1))]),s("div",O,[n[26]||(n[26]=s("p",{class:"hint-container-title"},"Info",-1)),s("p",null,[n[22]||(n[22]=a("The source code for this article can be found on the ",-1)),s("a",j,[n[11]||(n[11]=a("ASP.NET Core Configuration repo on GitHub (",-1)),e(i,{icon:"iconfont icon-github"}),n[12]||(n[12]=s("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[13]||(n[13]=a(")",-1))]),n[23]||(n[23]=a(". If you wish to follow along, use the ",-1)),s("a",M,[e(i,{icon:"fas fa-code-branch"}),n[14]||(n[14]=s("code",null,"basic-concepts",-1)),n[15]||(n[15]=a(" (",-1)),e(i,{icon:"iconfont icon-github"}),n[16]||(n[16]=s("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[17]||(n[17]=a(")",-1))]),n[24]||(n[24]=a(" branch. To check out the finished source code, check out the ",-1)),s("a",x,[e(i,{icon:"fas fa-code-branch"}),n[18]||(n[18]=s("code",null,"options-pattern",-1)),n[19]||(n[19]=a(" (",-1)),e(i,{icon:"iconfont icon-github"}),n[20]||(n[20]=s("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[21]||(n[21]=a(")",-1))]),n[25]||(n[25]=a(" branch.",-1))]),e(u,{name:"CodeMazeBlog/aspnet-core-configuration",desc:"This repo contains the source code for the ASP.NET Core Configuration Series of articles.",url:"https://github.com/CodeMazeBlog/aspnet-core-configuration",logo:"https://avatars.githubusercontent.com/u/29179238?v=4",preview:"https://opengraph.githubassets.com/e80292ed715f08922effe73e0902ccf220294b7d0a8e5c5759c861254e9e4e0f/CodeMazeBlog/aspnet-core-configuration"})]),n[40]||(n[40]=d(`<p>Let’s dive in.</p><hr><h2 id="why-the-options-pattern" tabindex="-1"><a class="header-anchor" href="#why-the-options-pattern"><span>Why the Options Pattern?</span></a></h2><p>In the previous article, we’ve seen how we can <strong>bind configuration data to strongly typed objects</strong>. The options pattern gives us similar possibilities, but it offers a more structured approach and more features like validation, live reloading, and easier testing.</p><p>Once we configure the class containing our configuration we can inject it <strong>via dependency injection</strong> with <code>IOptions&lt;T&gt;</code> and thus injecting only part of our configuration or rather <strong>only the part that we need</strong>.</p><p>If we need to <strong>reload the configuration without stopping the application</strong>, we can use the <code>IOptionsSnapshot&lt;T&gt;</code> interface or the <code>IOptionsMonitor&lt;T&gt;</code> interface depending on the situation. We’ll see when these interfaces should be used and why.</p><p>The options pattern also provides a good <strong>validation mechanism</strong> that uses the widely used DataAnotations attributes to check if the configuration abides by the logical rules of our application.</p><p>The <strong>testing</strong> of options is also easy because of the helper methods and easy to mock options classes.</p><p>So, in short, the options pattern helps us to:</p><ul><li>bind the configuration data to strongly typed objects</li><li>group the configuration data in logical sections</li><li>reload the configuration while the application is running</li><li>validate the configuration</li><li>inject only the needed parts of the configuration into different parts of the application</li><li>test the configuration easier</li></ul><p>Let’s see some real examples of the options pattern usage.</p><hr><h2 id="how-to-use-the-options-pattern-to-read-configuration-with-ioptions-interface" tabindex="-1"><a class="header-anchor" href="#how-to-use-the-options-pattern-to-read-configuration-with-ioptions-interface"><span>How to Use the Options Pattern to Read Configuration with IOptions Interface</span></a></h2><p>Okay, let’s start by looking at the Index method of the home controller without any options pattern implemented:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> logLevelConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LoggingLevelConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    _configuration<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token string">&quot;Logging:LogLevel&quot;</span><span class="token punctuation">,</span> logLevelConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> homeModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HomeModel</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        DefaultLogLevel <span class="token operator">=</span> logLevelConfiguration<span class="token punctuation">.</span>Default</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>homeModel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this case, the configuration is injected through the IConfiguration interface in the HomeController constructor, so we’re actually able to access the whole configuration whether we need it or not.</p><p>After that, we’re binding the <code>LogLevel</code> subsection of the configuration to the <code>LoggingLevelConfiguration</code> class, in order to send it to the <code>Index</code> view.</p><p>Okay, now let’s see how that works with <code>IOptions&lt;T&gt;</code> interface.</p><p>Let’s add a few values to our appsettings.json file first:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;LogLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;Microsoft&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;Microsoft.Hosting.Lifetime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ConnectionStrings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;sqlConnection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;server=.; database=CodeMazeCommerce; Integrated Security=true&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;HomePage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;WelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Welcome to the ProjectConfigurationDemo Home Page&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;ShowWelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;Color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;AllowedHosts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We’ll be using the <code>HomePage</code> subsection to configure our <code>Index</code> view of the <code>HomeController</code>.</p><p>Next, we need a class that will contain these properties, so let’s create it in the Models folder of the project:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TitleConfiguration</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> WelcomeMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> ShowWelcomeMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Color <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We need to make sure these property names match those of the appsettings.json file section.</p><p>Now we can modify the <code>HomeController</code> to support the options pattern. First, let’s inject <code>IOptions&lt;HomePageController&gt;</code> instead of <code>IConfiguration</code> as we did before:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">TitleConfiguration</span> _homePageTitleConfiguration<span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line"><span class="token keyword">public</span> <span class="token function">HomeController</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>HomeController<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IOptions<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see we’re accessing the configuration data via the <code>Value</code> property of the <code>IOptions</code> interface.</p><p>We are going to change the HomeModel class to reflect these changes too:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeModel</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">TitleConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We need to change the Index method too:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> homeModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HomeModel</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Configuration <span class="token operator">=</span> _homePageTitleConfiguration</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>homeModel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And we should add some logic to the view so we can use these properties we’ve defined:</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line">@{</span>
<span class="line">    ViewData[&quot;Title&quot;] = &quot;Home Page&quot;;</span>
<span class="line">}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    @{</span>
<span class="line">        if (Model.Configuration.ShowWelcomeMessage)</span>
<span class="line">        {</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>display-4<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>@Model.Configuration.Color</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>@Model.Configuration.WelcomeMessage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This should give us a big red title right in the middle of our Home Page.</p><p>Now, the only thing left to do is to actually register and configure the <code>TitleConfiguration</code> in our <code>Startup</code> class:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;Pages:HomePage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This should register our HomePage configuration</p><p>Now if we run our application the result is pretty clear:</p><figure><img src="`+C+`" alt="Home Page - ProjectConfigurationDemo" tabindex="0" loading="lazy"><figcaption>Home Page - ProjectConfigurationDemo</figcaption></figure><p>Great! We’re getting the right properties to the view.</p><p>But if we want to change the title to the color green for example, we need to <strong>restart the application</strong> to do it.</p><p>But there’s a better way to do it! And it’s called <code>IOptionsSnapshot</code>.</p><hr><h2 id="using-ioptionssnapshot-to-read-the-updated-configuration" tabindex="-1"><a class="header-anchor" href="#using-ioptionssnapshot-to-read-the-updated-configuration"><span>Using IOptionsSnapshot to Read the Updated Configuration</span></a></h2><p>IOptionsSnapshot contains the values just for the lifetime of a request. So that means it’s registered as a scoped service in our application and we can use it only with scoped and transient dependencies. We cannot inject it into singleton services!</p><p>If we need to change the configuration without restarting the application, we need to implement <code>IOptionsSnapshot&lt;T&gt;</code> because <code>IOptions&lt;T&gt;</code> doesn’t support it.</p><p>Let’s modify our code to use <code>IOptionsSnapshot&lt;T&gt;</code> instead of <code>IOptions&lt;T&gt;</code>.</p><p>Changing our code, in this case, is easy, we just need to change the constructor of the <code>HomeController</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token function">HomeController</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>HomeController<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IOptionsSnapshot<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If we run the application, we’ll get the same home page as we did before, big red title.</p><p>But to test <code>IOptionsSnapshot</code>, let’s go to our appsettings.json file and change the color of the text to “blue”:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token property">&quot;Pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;HomePage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;WelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Welcome to the ProjectConfigurationDemo Home Page&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ShowWelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, we just need to refresh the HomePage and our title will be blue if we did everything correctly:</p><figure><img src="`+q+`" alt="Home Page blue" tabindex="0" loading="lazy"><figcaption>Home Page blue</figcaption></figure><p>Great, we’ve successfully modified our application to reload the configuration data dynamically.</p><hr><h2 id="using-ioptionsmonitor-for-singleton-services" tabindex="-1"><a class="header-anchor" href="#using-ioptionsmonitor-for-singleton-services"><span>Using IOptionsMonitor for Singleton Services</span></a></h2><p>There is one problem with our current solution, and we’ve already mentioned it. <code>IOptionsSnapshot</code> <strong>is not suitable to be injected into services registered as a singleton</strong> in our application.</p><p>To demonstrate this, let’s create a simple service and try to inject <code>IOptionsSnapshot</code> into it.</p><p>First, let’s extend our Home Page title configuration a bit. We’ll add a new configuration property <code>UseRandomTitleColor</code> to our <code>TitleConfiguration</code> class:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TitleConfiguration</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> WelcomeMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> ShowWelcomeMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Color <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> UseRandomTitleColor <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And we’ll change <code>appsettings.json</code> to reflect it:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token property">&quot;Pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;HomePage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;WelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Welcome to the ProjectConfigurationDemo Home Page&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ShowWelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;UseRandomTitleColor&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After that, we’ll need a service we can register as a singleton, so let’s create a new one. We’ll call it <code>ITitleColorService</code> and we’ll create it in a separate folder called <code>Services</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITitleColorService</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ITitleColorService</code> declares just one method and that’s <code>GetTitleColor</code>, which should return a random color from the list of defined colors. So let’s create <code>TitleColorService</code> in the same folder and implement this interface:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TitleColorService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITitleColorService</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _colors <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;brown&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pink&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">TitleConfiguration</span> _homePageTitleConfiguration<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">TitleColorService</span><span class="token punctuation">(</span><span class="token class-name">IOptionsSnapshot<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> colorIndex <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> _homePageTitleConfiguration<span class="token punctuation">.</span>UseRandomTitleColor <span class="token punctuation">?</span></span>
<span class="line">            _colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token punctuation">:</span></span>
<span class="line">            _homePageTitleConfiguration<span class="token punctuation">.</span>Color<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It’s a simple implementation, that returns one of the colors from the array of colors if <code>UseRandomTitleColor</code> is set to true, and the value of the <code>Color</code> property if it’s set to false. Take note that we’re using <code>IOptionsSnapshot</code> to inject our configuration.</p><p>Now we need to register our service with our application, and we do that in Startup class, in the <code>ConfigureServices</code> method:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;Pages:HomePage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryAddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ITitleColorService<span class="token punctuation">,</span> TitleColorService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    services<span class="token punctuation">.</span><span class="token function">AddControllersWithViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And finally, let’s change <code>HomeController</code> to override the title color:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>HomeController<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">TitleConfiguration</span> _homePageTitleConfiguration<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ITitleColorService</span> _titleColorService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token function">HomeController</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>HomeController<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IOptionsSnapshot<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">ITitleColorService</span> titleColorService<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line">    _titleColorService <span class="token operator">=</span> titleColorService<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> homeModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HomeModel</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Configuration <span class="token operator">=</span> _homePageTitleConfiguration</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    homeModel<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Color <span class="token operator">=</span> _titleColorService<span class="token punctuation">.</span><span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>homeModel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That’s about it. Or is it?</p><h3 id="ioptionsmonitor-t-purpose" tabindex="-1"><a class="header-anchor" href="#ioptionsmonitor-t-purpose"><span><code>IOptionsMonitor&lt;T&gt;</code> Purpose</span></a></h3><p>Now if we run the application, it crashes and we get the following exception message:</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>Some services are not able to be constructed (Error while validating the service descriptor ‘ServiceType: ProjectConfigurationDemo.Services.ITitleColorService Lifetime: Singleton ImplementationType: ProjectConfigurationDemo.Services.TitleColorService’: Cannot consume scoped service ‘Microsoft.Extensions.Options.IOptionsSnapshot\`1[ProjectConfigurationDemo.Models.TitleConfiguration]’ from singleton ‘ProjectConfigurationDemo.Services.ITitleColorService’.)</p></div><p>This happens because ASP.NET Core is trying to prevent us from making a mistake of referencing a scoped service from a singleton. It’s a classic mistake and it could result in unexpected behavior otherwise. To put it in simple terms if the parent is a singleton, we can’t create a child service per page loaded. Child service has to be singleton or transient instead.</p><p>And that’s exactly where <code>IOptionsMonitor</code> comes in.</p><p>Let’s go back to our service and replace <code>IOptionsSnapshot</code> with <code>IOptionsMonitor</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token function">TitleColorService</span><span class="token punctuation">(</span><span class="token class-name">IOptionsMonitor<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span>CurrentValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The only thing we need to modify is the constructor. <code>IOptionsMonitor</code> uses the <code>CurrentValue</code> instead of <code>Value</code> retrieving the configuration values.</p><p>Now if we run the application again we’re not getting the exception we did before. If we refresh the page, our title screen shows up in different colors we’ve defined previously.</p><p>Great!</p><p>There is one more concept we need to cover.</p><hr><h2 id="named-options" tabindex="-1"><a class="header-anchor" href="#named-options"><span>Named Options</span></a></h2><p>Named options are not the feature we need to use very often, but there is a specific case where it can come in handy.</p><p>Let’s imagine we have a configuration like this one:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token property">&quot;Pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;HomePage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;WelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Welcome to the ProjectConfigurationDemo Home Page&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ShowWelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;UseRandomTitleColor&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ProductPage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;WelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Welcome to the ProjectConfigurationDemo Product Page&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ShowWelcomeMessage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;UseRandomTitleColor&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We have the same configuration structure for the different configuration subsections of the section “Pages”. Both the “HomePage” and the “ProductPage” have the exact same configuration properties.</p><p>Instead of adding another configuration class that’s exactly the same as our <code>TitleConfiguration</code> we’ve already implemented, we can use that class to map different subsections of the Pages section and just name them differently to be able to differentiate between each other.</p><p>This might be a bit confusing so let’s implement it. In our <code>Startup</code> class we should configure:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;HomePage&quot;</span><span class="token punctuation">,</span> Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;Pages:HomePage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;ProductPage&quot;</span><span class="token punctuation">,</span> Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;Pages:ProductPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Now both subsections are mapped to the same configuration class, which makes sense. We don’t want to create multiple classes with the same properties and just name them differently. This is a much better way of doing it.</p><p>Calling the specific option is now done using the <code>Get()</code> method, so we need to refactor our <code>TitleColorService</code> class a bit:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TitleColorService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITitleColorService</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _colors <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;brown&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pink&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IOptionsMonitor<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> _titleConfiguration<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">TitleColorService</span><span class="token punctuation">(</span><span class="token class-name">IOptionsMonitor<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> titleConfiguration<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _titleConfiguration <span class="token operator">=</span> titleConfiguration<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> pageTitleConfiguration<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> colorIndex <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> titleConfiguration <span class="token operator">=</span> _titleConfiguration<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>pageTitleConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> titleConfiguration<span class="token punctuation">.</span>UseRandomTitleColor <span class="token punctuation">?</span></span>
<span class="line">            _colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token punctuation">:</span></span>
<span class="line">            titleConfiguration<span class="token punctuation">.</span>Color<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We need to change the <code>ITitleColorService</code> interface as well:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITitleColorService</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> pageTitleConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And change the <code>HomeController</code> accordingly:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token function">HomeController</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>HomeController<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IOptionsSnapshot<span class="token punctuation">&lt;</span>TitleConfiguration<span class="token punctuation">&gt;</span></span> homePageTitleConfiguration<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">ITitleColorService</span> titleColorService<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    _homePageTitleConfiguration <span class="token operator">=</span> homePageTitleConfiguration<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;HomePage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _titleColorService <span class="token operator">=</span> titleColorService<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> homeModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HomeModel</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Configuration <span class="token operator">=</span> _homePageTitleConfiguration</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    homeModel<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Color <span class="token operator">=</span> _titleColorService<span class="token punctuation">.</span><span class="token function">GetTitleColor</span><span class="token punctuation">(</span><span class="token string">&quot;HomePage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>homeModel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That’s it, now if we run the application, we’ll see exactly the same result as before. The only thing here we want to change is to use string constants rather than string literals to get the subsections, as to avoid runtime errors. But you can play around a bit and try it out.</p><p>Let’s summarize.</p><hr><h2 id="choosing-between-ioptions-ioptionssnapshot-and-ioptionsmonitor" tabindex="-1"><a class="header-anchor" href="#choosing-between-ioptions-ioptionssnapshot-and-ioptionsmonitor"><span>Choosing Between IOptions, IOptionsSnapshot, and IOptionsMonitor</span></a></h2><p>So in short</p>`,105)),e(m,{data:[{id:"<code>IOptions<T></code>"},{id:"<code>IOptionsSnapshot<T></code>"},{id:"<code>IOptionsMonitor<T></code>"}],active:0},{title0:t(({value:l,isActive:c})=>[...n[27]||(n[27]=[s("code",null,"IOptions<T>",-1)])]),title1:t(({value:l,isActive:c})=>[...n[28]||(n[28]=[s("code",null,"IOptionsSnapshot<T>",-1)])]),title2:t(({value:l,isActive:c})=>[...n[29]||(n[29]=[s("code",null,"IOptionsMonitor<T>",-1)])]),tab0:t(({value:l,isActive:c})=>[...n[30]||(n[30]=[s("ul",null,[s("li",null,"Is the original Options interface and it’s better than binding whole Configuration"),s("li",null,"Does not support configuration reloading"),s("li",null,"Is registered as a singleton service and can be injected anywhere"),s("li",null,"Binds the configuration values only once at the registration, and returns the same values every time"),s("li",null,"Does not support named options")],-1)])]),tab1:t(({value:l,isActive:c})=>[...n[31]||(n[31]=[s("ul",null,[s("li",null,"Registered as a scoped service"),s("li",null,"Supports configuration reloading"),s("li",null,"Cannot be injected into singleton services"),s("li",null,"Values reload per request"),s("li",null,"Supports named options")],-1)])]),tab2:t(({value:l,isActive:c})=>[...n[32]||(n[32]=[s("ul",null,[s("li",null,"Registered as a singleton service"),s("li",null,"Supports configuration reloading"),s("li",null,"Can be injected into any service lifetime"),s("li",null,"Values are cached and reloaded immediately"),s("li",null,"Supports named options")],-1)])]),_:1}),n[41]||(n[41]=d('<p>Having said that, we can see that if we don’t want to enable live reloading or we don’t need named options, we can simply use <code>IOptions&lt;T&gt;</code>. If we do, we can use either <code>IOptionsSnapshot&lt;T&gt;</code> or <code>IOptionsMonitor&lt;T&gt;</code>, but <code>IOptionsMonitor&lt;T&gt;</code> can be injected into other singleton services while <code>IOptionsSnapshot&lt;T&gt;</code> cannot.</p><p>Sometimes the nature of the project dictates that we shouldn’t change our configuration “on the fly”. Sometimes it’s needed. Be careful when choosing the “right option”, no pun intended 😉</p><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>In this article, we’ve learned what options are and why they’re good for us. We’ve also covered different ways to implement options, as well as the pros and cons of each one. As we’ve mentioned, this is a powerful mechanism and you need to decide carefully which one is the best for your concrete project.</p>',5)),s("p",null,[n[35]||(n[35]=a("In the next article, we’ll cover ",-1)),e(r,{to:"/code-maze.com/aspnet-configuration-options-validation.html"},{default:t(()=>[...n[33]||(n[33]=[a("options validation",-1)])]),_:1}),n[36]||(n[36]=a(", and you can find other parts of this series on the ",-1)),e(r,{to:"/code-maze.com/net-core-series.html#configuration"},{default:t(()=>[...n[34]||(n[34]=[a("ASP.NET Core Web API page",-1)])]),_:1}),n[37]||(n[37]=a(".",-1))])])}const N=v(T,[["render",H]]),z=JSON.parse('{"path":"/code-maze.com/aspnet-configuration-options.html","title":"ASP.NET Core Configuration - Options Pattern","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"ASP.NET Core Configuration - Options Pattern","description":"Article(s) > ASP.NET Core Configuration - Options Pattern","icon":"iconfont icon-csharp","category":["C#","Article(s)"],"tag":["blog","code-maze.com","cs","c#","csharp"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ASP.NET Core Configuration - Options Pattern\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/Home-Page-ProjectConfigurationDemo.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/Home-Page-blue.png\\"],\\"datePublished\\":\\"2021-12-27T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/aspnet-configuration-options.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"ASP.NET Core Configuration - Options Pattern"}],["meta",{"property":"og:description","content":"Article(s) > ASP.NET Core Configuration - Options Pattern"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/banner.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-options/banner.png"}],["meta",{"name":"twitter:image:alt","content":"ASP.NET Core Configuration - Options Pattern"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"code-maze.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2021-12-27T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > ASP.NET Core Configuration - Options Pattern"},{"property":"og:description","content":"ASP.NET Core Configuration - Options Pattern"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/aspnet-configuration-options.html"}]],"prev":"/programming/cs/articles/README.md","date":"2021-12-27T00:00:00.000Z","isOriginal":false,"cover":"/assets/image/code-maze.com/aspnet-configuration-options/banner.png"},"git":{},"readingTime":{"minutes":8.72,"words":2617},"filePathRelative":"code-maze.com/aspnet-configuration-options.md"}');export{N as comp,z as data};
