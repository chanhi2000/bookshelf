import{_ as g}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as y,d as s,f as e,b as i,a as b,t as v,n as d,g as h,w as t,e as a,r as c,o as w}from"./app-BItykJLQ.js";const S={},C={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},x={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},T={class:"table-of-contents"},D={class:"hint-container note"},A={href:"https://scroll-driven-animations.style/",target:"_blank",rel:"noopener noreferrer"},q={class:"hint-container info"},I={href:"https://scroll-driven-animations.style/",target:"_blank",rel:"noopener noreferrer"},P={href:"https://drafts.css-houdini.org/css-properties-values-api/#at-property-rule",target:"_blank",rel:"noopener noreferrer"},j={href:"https://drafts.css-houdini.org/css-properties-values-api/#animation-behavior-of-custom-properties",target:"_blank",rel:"noopener noreferrer"},E={href:"https://w3.org/TR/web-animations/#discrete",target:"_blank",rel:"noopener noreferrer"},B={href:"https://drafts.csswg.org/css-transitions/#transition-delay-property",target:"_blank",rel:"noopener noreferrer"},R={class:"hint-container note"},W={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´-1",tabindex:"-1"},z={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´-1"},L={class:"table-of-contents"};function M(l,n){const u=c("VPCard"),o=c("router-link"),k=c("SiteInfo"),f=c("VidStack"),r=c("VPIcon"),p=c("CodePen"),m=c("RouteLink");return w(),y("div",null,[s("h1",C,[s("a",x,[s("span",null,v(l.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(u,d(h({title:"CSS > Article(s)",desc:"Article(s)",link:"/programming/css/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",T,[s("ul",null,[s("li",null,[e(o,{to:"#table-of-contents"},{default:t(()=>[...n[0]||(n[0]=[a("Table of Contents",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-code"},{default:t(()=>[...n[1]||(n[1]=[a("The Code",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-concept"},{default:t(()=>[...n[2]||(n[2]=[a("The Concept",-1)])]),_:1})]),s("li",null,[e(o,{to:"#basic-demos"},{default:t(()=>[...n[3]||(n[3]=[a("# Basic demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#intermezzo-what-about-style-queries"},{default:t(()=>[...n[4]||(n[4]=[a("# Intermezzo: what about Style Queries?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#combine-multiple-scroll-states-thanks-to-more-maths"},{default:t(()=>[...n[5]||(n[5]=[a("# Combine multiple scroll states, thanks to more Maths",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lerp-effects"},{default:t(()=>[...n[6]||(n[6]=[a("# LERP-effects",-1)])]),_:1})]),s("li",null,[e(o,{to:"#more-demos"},{default:t(()=>[...n[7]||(n[7]=[a("# More Demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#a-note-on-performance"},{default:t(()=>[...n[8]||(n[8]=[a("# A note on performance",-1)])]),_:1})]),s("li",null,[e(o,{to:"#closing-thoughts"},{default:t(()=>[...n[9]||(n[9]=[a("# Closing Thoughts",-1)])]),_:1})]),s("li",null,[e(o,{to:"#spread-the-word-name-spread-the-word"},{default:t(()=>[...n[10]||(n[10]=[a("[#](#spread-the-word name=) Spread the word",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lang-en-ustitle-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-description-article-s-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-icon-category"},{default:t(()=>[...n[11]||(n[11]=[a('lang: en-UStitle: "Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"description: "Article(s) > Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"icon:category:',-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#table-of-contents-1"},{default:t(()=>[...n[12]||(n[12]=[a("Table of Contents",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-code-1"},{default:t(()=>[...n[13]||(n[13]=[a("# The Code",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-concept-1"},{default:t(()=>[...n[14]||(n[14]=[a("# The Concept",-1)])]),_:1})]),s("li",null,[e(o,{to:"#basic-demos-1"},{default:t(()=>[...n[15]||(n[15]=[a("# Basic demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#intermezzo-what-about-style-queries-1"},{default:t(()=>[...n[16]||(n[16]=[a("# Intermezzo: what about Style Queries?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#combine-multiple-scroll-states-thanks-to-more-maths-1"},{default:t(()=>[...n[17]||(n[17]=[a("# Combine multiple scroll states, thanks to more Maths",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lerp-effects-1"},{default:t(()=>[...n[18]||(n[18]=[a("# LERP-effects",-1)])]),_:1})]),s("li",null,[e(o,{to:"#more-demos-1"},{default:t(()=>[...n[19]||(n[19]=[a("# More Demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#a-note-on-performance-1"},{default:t(()=>[...n[20]||(n[20]=[a("# A note on performance",-1)])]),_:1})]),s("li",null,[e(o,{to:"#closing-thoughts-1"},{default:t(()=>[...n[21]||(n[21]=[a("# Closing Thoughts",-1)])]),_:1})])])])])]),n[94]||(n[94]=s("hr",null,null,-1)),e(k,{name:"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed",desc:"Combine Scroll-Driven Animations with @‚Äãproperty, transition-delay, calc(), sign() and abs() ‚Ä¶ and you can do Scroll Detection using only CSS!",url:"https://bram.us/2023/10/23/css-scroll-detection/",logo:"https://bramu.us/favicon.ico",preview:"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif"}),e(f,{src:"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4"}),s("div",D,[n[24]||(n[24]=s("p",{class:"hint-container-title"},"Note",-1)),s("p",null,[s("a",A,[e(r,{icon:"fas fa-globe"}),n[22]||(n[22]=a("Scroll-Driven Animations",-1))]),n[23]||(n[23]=a(" can be used for more than driving an animation by scroll. In this post, I share how you can use Scroll-Driven Animations to detect the Scroll Velocity a user is actively scrolling in.",-1))]),n[25]||(n[25]=s("p",null,[a("That means that "),s("strong",null,[a("using only CSS you can style an element based on whether the user is scrolling "),s("em",null,"(or not scrolling)"),a(", the direction they are scrolling in, and the speed they are scrolling with")]),a(".")],-1))]),n[95]||(n[95]=i('<h3 id="table-of-contents" tabindex="-1"><a class="header-anchor" href="#table-of-contents"><span>Table of Contents</span></a></h3><ul><li><a href="#the-code">The Code</a></li><li><a href="#the-concept">The Concept</a></li><li><a href="#basic-demos">Basic Demos</a></li><li><a href="#style-queries">Intermezzo: what about Style Queries?</a></li><li><a href="#more-scroll-states">Combine multiple scroll states, thanks to more Maths</a></li><li><a href="#lerp-effects">LERP Effects</a></li><li><a href="#more-demos">More Demos</a></li><li><a href="#performance">A note on performance</a></li><li><a href="#closing-thoughts">Closing Thoughts</a></li><li><a href="#spread-the-word">Spread the word</a></li></ul>',2)),s("div",q,[n[29]||(n[29]=s("p",{class:"hint-container-title"},"üíÅ‚Äç‚ôÇÔ∏è",-1)),s("p",null,[n[27]||(n[27]=a("This article assumes you know the basics of Scroll-Driven Animations. If you don‚Äôt, then get yourself acquainted with it over at ",-1)),s("a",I,[e(r,{icon:"fas fa-globe"}),n[26]||(n[26]=a("scroll-driven-animations.style",-1))]),n[28]||(n[28]=a(", which includes links to relevant articles and videos.",-1))])]),n[96]||(n[96]=i(`<div class="hint-container warning"><p class="hint-container-title">‚ö†Ô∏è Motion Warning</p><p>This article is all about animations so things will move around, often quite abruptly. When implementing these effects in your own projects, take <code>prefers-reduced-motion</code> into account.</p></div><div class="hint-container warning"><p class="hint-container-title">üë®‚Äçüî¨ Browser Compat Warning</p><p>The demos in this post rely on Scroll-Driven Animations and <code>@property</code> being available. In practice, this means you need a Chromium-based browser, version 115 or newer.</p></div><h3 id="the-code" tabindex="-1"><a class="header-anchor" href="#the-code"><span>The Code</span></a></h3><p>If you‚Äôre here for just the code, here it is:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position-delayed</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> adjust-pos</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">to</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">--scroll-position</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token property">--scroll-position-delayed</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">:root</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">,</span> -1 * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* abs(var(--scroll-velocity)); */</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> / <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* sign(var(--scroll-velocity)); */</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-up</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-down</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-down-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-up-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you want to know how to use it and why this works, keep on reading üòâ</p><h3 id="the-concept" tabindex="-1"><a class="header-anchor" href="#the-concept"><span>The Concept</span></a></h3><p>When combining a few CSS things together, you often end up with a novel way to achieving something. A while ago, I figured out that you can detect the scroll speed and scroll direction using only CSS when combining the following:</p><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;"></th></tr></thead><tbody><tr><td style="text-align:left;"><code>@property</code></td><td style="text-align:left;">To register two custom properties of the type <code>&lt;number&gt;</code> so that they can be animated.</td></tr><tr><td style="text-align:left;">Scroll-Driven Animations</td><td style="text-align:left;">To animate those custom properties from <code>0</code> to <code>1</code> on scroll.</td></tr><tr><td style="text-align:left;"><code>transition-delay</code></td><td style="text-align:left;">To delay the computation of the 2nd custom property on a child element of the scroller.</td></tr><tr><td style="text-align:left;"><code>calc()</code></td><td style="text-align:left;">To compute the difference between both numbers, giving you the scroll velocity (= speed + direction).</td></tr><tr><td style="text-align:left;"><code>sign()</code></td><td style="text-align:left;">To extract the scroll direction from the velocity, leaving you with a value of <code>1</code>, <code>0</code>, or <code>-1</code>.</td></tr><tr><td style="text-align:left;"><code>abs()</code></td><td style="text-align:left;">To extract the scroll speed from the velocity.</td></tr></tbody></table><p>If that‚Äôs all gibberish to you don‚Äôt worry, as I‚Äôll explain it all in the next few sections.</p><h4 id="animating-two-custom-properties-on-scroll" tabindex="-1"><a class="header-anchor" href="#animating-two-custom-properties-on-scroll"><span>Animating two Custom Properties on scroll</span></a></h4><p>Let‚Äôs start off at the start, by animating two custom properties on scroll. This is done using a Scroll Timeline which is attached to the root scroller.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position-delayed</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> adjust-pos</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">to</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">--scroll-position</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token property">--scroll-position-delayed</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">:root</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13)),s("p",null,[n[33]||(n[33]=a("Both of these values will animate from ",-1)),n[34]||(n[34]=s("code",null,"0",-1)),n[35]||(n[35]=a(" to ",-1)),n[36]||(n[36]=s("code",null,"1",-1)),n[37]||(n[37]=a(" as you scroll the document from top to bottom. Because they are registered through ",-1)),s("a",P,[e(r,{icon:"fas fa-globe"}),n[30]||(n[30]=s("code",null,"@property",-1))]),n[38]||(n[38]=a(", ",-1)),s("a",j,[e(r,{icon:"fas fa-globe"}),n[31]||(n[31]=a("they will interpolate nicely",-1))]),n[39]||(n[39]=a(" instead of ",-1)),s("a",E,[e(r,{icon:"iconfont icon-w3c"}),n[32]||(n[32]=a("animating discretely",-1))]),n[40]||(n[40]=a(".",-1))]),n[97]||(n[97]=s("blockquote",null,[s("p",null,"When referenced by animations and transitions, custom property values interpolate by computed value, in accordance with the type that they parsed as.")],-1)),e(p,{user:"bramus","slug-hash":"LYMoMEz",title:"Detecting Scroll Directionality with Scroll-Driven Animations (DEBUG, v0)\\","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[98]||(n[98]=s("h4",{id:"delaying-one-of-the-custom-properties",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#delaying-one-of-the-custom-properties"},[s("span",null,"Delaying one of the Custom Properties")])],-1)),s("p",null,[n[42]||(n[42]=a("Animating two different properties in exactly the same way seems a bit stupid, but that‚Äôs where the rest of the trick comes into play. By delaying the ",-1)),n[43]||(n[43]=s("code",null,"--scroll-position-delayed",-1)),n[44]||(n[44]=a(" property ‚Äì using ",-1)),s("a",B,[e(r,{icon:"fas fa-globe"}),n[41]||(n[41]=s("code",null,"transition-delay",-1))]),n[45]||(n[45]=a(" ‚Äì ",-1)),n[46]||(n[46]=s("strong",null,"on a child of the scroller",-1)),n[47]||(n[47]=a(", you can have it lag on the parent.",-1))]),n[99]||(n[99]=i(`<div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It is very important to note that I‚Äôm delaying the <code>--scroll-position-delayed</code> on the <code>body</code> element, which is a child of <code>html</code>. By doing so, I am not lagging <code>--scroll-position-delayed</code> on <code>--scroll-position</code> but, instead, I am lagging the <code>--scroll-position-delayed</code> value of the <code>body</code> element on the <code>--scroll-position-delayed</code> value of the <code>html</code> element.</p>`,2)),s("div",R,[n[55]||(n[55]=s("p",{class:"hint-container-title"},"‚òùÔ∏è",-1)),s("p",null,[n[49]||(n[49]=a("This parent-child relationship is a requirement for this trick to work ‚Äì it won‚Äôt work if you delay ",-1)),n[50]||(n[50]=s("code",null,"--scroll-position-delayed",-1)),n[51]||(n[51]=a(" on the scroller ‚Äì here ",-1)),n[52]||(n[52]=s("code",null,"html",-1)),n[53]||(n[53]=a(" ‚Äì itself. You can draw a parallel to ",-1)),e(m,{to:"/bram.us/css-container-queries-a-first-look-and-demo.html#container-queries"},{default:t(()=>[...n[48]||(n[48]=[s("strong",null,"Container Queries",-1)])]),_:1}),n[54]||(n[54]=a(" here, which also require a parent-child relationship.",-1))])]),n[100]||(n[100]=s("p",null,[a("The set "),s("code",null,"transition-delay"),a(" controls how much lag there is before "),s("code",null,"--scroll-position-delayed"),a(" on the "),s("code",null,"body"),a(" catches up with the value from the "),s("code",null,"html"),a(" element. Best is to keep the delay pretty low, as the resulting effect could otherwise feel slow to users.")],-1)),e(p,{user:"bramus","slug-hash":"YzdbdyL/52b163fb496bc91464f1a851878b344d",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[101]||(n[101]=i(`<p>Try scrolling up and down in the CodePen embedded above, and notice how <code>--scroll-position-delayed</code> lags on the <code>--scroll-position</code> variable. Repeat your test while scrolling very fast or really slow, and compare the effect of both speeds to each other.</p><p>~</p><h4 id="calculating-the-scroll-velocity" tabindex="-1"><a class="header-anchor" href="#calculating-the-scroll-velocity"><span><a href="#the-concept-3">#</a> Calculating the Scroll Velocity</span></a></h4><p>Because the computed values of the <code>--scroll-position</code> and <code>--scroll-position-delayed</code> properties differ as you scroll, you can use them to calculate the scroll velocity. By taking the difference of both values ‚Äì using a regular <a href="https://drafts.csswg.org/css-values/#funcdef-calc" target="_blank" rel="noopener noreferrer"><code>calc()</code></a> ‚Äì you end up with a number that will be one of these:</p><ul><li>A positive float, ranging from <code>0</code> to <code>1</code>, indicating the user is scrolling down</li><li><code>0</code>, indicating the user is not scrolling</li><li>A negative float, ranging from <code>-1</code> to <code>0</code>, indicating the user is scrolling up</li></ul><p>In CSS, it looks like this:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7)),e(p,{user:"bramus","slug-hash":"VwqOqwQ/d0a922a21fd64f8decc88991c754cc04",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[102]||(n[102]=i(`<p>Try scrolling up and down in the CodePen embedded above, and notice how <code>--scroll-velocity</code> is a float representing the scroll velocity. Repeat your test while scrolling very fast or really slow, and compare the effect of both speeds to each other.</p><p>üïµÔ∏è When looking really close, you might notice that the number is a bit off when quickly changing the direction or when abruptly stopping a scroll: the updated value of <code>--scroll-velocity</code> will not immediately reflect the actual state. This can be tweaked by tightening the <code>transition-delay</code> of the <code>--scroll-position-delayed</code> property, but then you end up with smaller values for <code>--scroll-velocity</code> so you might need a multiplier to counteract that.</p><p>There‚Äôs also a difference in update speed between dragging the scrollbar versus using the touchpad to scroll the scroller. The former updates much, much, faster.</p><p>~</p><h4 id="calculating-the-scroll-direction-and-scroll-speed" tabindex="-1"><a class="header-anchor" href="#calculating-the-scroll-direction-and-scroll-speed"><span><a href="#the-concept-4">#</a> Calculating the Scroll Direction and Scroll Speed</span></a></h4><p>Because Velocity is a measured Speed into a certain Direction <em>(<a href="https://britannica.com/story/whats-the-difference-between-speed-and-velocity" target="_blank" rel="noopener noreferrer">ref</a>)</em>, the Direction and Speed can be extracted from the Velocity.</p><p>The direction of scrolling can be derived from the <code>--scroll-velocity</code> by looking at its sign: If it‚Äôs positive, then the user is scrolling down. If it is negative, the user is scrolling up.</p><p>In CSS, you can use the <a href="https://drafts.csswg.org/css-values/#sign-funcs" target="_blank" rel="noopener noreferrer">the <code>sign()</code> function</a> to extract that info:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The value for <code>--scroll-direction</code> is one of these:</p><ul><li><code>1</code>, indicating the user is scrolling down</li><li><code>0</code>, indicating the user is not scrolling</li><li><code>-1</code>, indicating the user is scrolling up</li></ul><p>This value will come in handy in calculations further down the road.</p><p>Extracting the scroll speed from the velocity is also easy to do, as it‚Äôs a matter of dropping sign from the value. In CSS, this can be done using <a href="https://drafts.csswg.org/css-values/#sign-funcs" target="_blank" rel="noopener noreferrer">the <code>abs()</code> function</a>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Put together, you get this:</p>`,15)),e(p,{user:"bramus","slug-hash":"LYMLoJa/49dd704872be26534482faef58b788fb",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[103]||(n[103]=i(`<p>Try scrolling up and down in the CodePen above, and notice how <code>--scroll-direction</code> is an integer representing the scroll direction, unaffected by the scroll speed.</p><p>üë®‚Äçüî¨ At the time of writing, <code>sign()</code> and <code>abs()</code> are available in Chrome only once you flip on the Experimental Web Platform Features feature flag on through <code>chrome://flags</code>.</p><p>Thankfully, the functionality can be polyfilled using some basic mathematics, as detailed by <a href="https://thebabydino.github.io/" target="_blank" rel="noopener noreferrer">Ana Tudor</a> in <a href="https://css-tricks.com/using-absolute-value-sign-rounding-and-modulo-in-css-today/#aa-sign" target="_blank" rel="noopener noreferrer">this post on CSS-Tricks</a>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">,</span> -1 * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> / <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>~</p><h3 id="basic-demos" tabindex="-1"><a class="header-anchor" href="#basic-demos"><span><a href="#basic-demos">#</a> Basic demos</span></a></h3><p>With these computed custom properties <code>--scroll-velocity</code> and <code>--scroll-direction</code> available it‚Äôs time to get creative ‚Ä¶</p><p>~</p><h4 id="tilted-colored-boxes" tabindex="-1"><a class="header-anchor" href="#tilted-colored-boxes"><span><a href="#demo-tilted-boxes">#</a> Tilted Colored boxes</span></a></h4><p>A first demos are these boxes that get skewed in a certain angle depending on the scroll. The faster you scroll, the more skewed they get, with a maximum of 25 degrees.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * -25deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore the boxes also get the hue of their <code>background-color</code> rotated depending on the scroll direction.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>0deg + <span class="token punctuation">(</span>145deg * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 50% 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> background 0.15s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When idle, the boxes are red. When scrolling down they become green and when scrolling up they are blue. The transition of the background is eased at <code>0.15s</code>.</p>`,14)),e(p,{user:"bramus","slug-hash":"oNJeLWg/cb3542fb8be1f8bb0a33e107229b9027",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[104]||(n[104]=s("p",null,"~",-1)),n[105]||(n[105]=s("h4",{id:"motion-blur-scroll",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#motion-blur-scroll"},[s("span",null,[s("a",{href:"#demo-motion-blur-scroll"},"#"),a(" Motion Blur Scroll")])])],-1)),n[106]||(n[106]=s("p",null,[a("Things also become interesting when using the "),s("code",null,"--scroll-velocity"),a(" and "),s("code",null,"--scroll-speed"),a(" values in a "),s("code",null,"filter"),a(", as that function has many options. With it, you can create a Motion Blur effect, that even desaturates the content as you scroll.")],-1)),e(p,{user:"bramus","slug-hash":"XWoREjv/a0e0aca0d543dc146b90bea779fbd964",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[107]||(n[107]=i(`<p>The blurring and desaturating is handled by the <code>filter</code> property. Some basic translation and <code>opacity</code>-meddling also takes place, to give it a rather cinematic effect. To always have a positive float value for use within all calculations, the code relies on <code>--scroll-speed</code> instead of <code>--scroll-velocity</code> which can become negative.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">main</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">filter</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token function">blur</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>2rem * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">contrast</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>100% - <span class="token punctuation">(</span>500% * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">saturate</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>100% - <span class="token punctuation">(</span>500% * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>1 - <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span> * 4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>-8rem * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore the entire photostrip gets skewed a tiny bit while scrolling, similar to a previous demo.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.photo</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * 3deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The faster your scroll, the harder the effect is.</p><p>~</p><h3 id="intermezzo-what-about-style-queries" tabindex="-1"><a class="header-anchor" href="#intermezzo-what-about-style-queries"><span><a href="#style-queries">#</a> Intermezzo: what about Style Queries?</span></a></h3><p><strong>UPDATE 2023.10.26</strong> After chatting with <a href="https://xanthir.com/contact/" target="_blank" rel="noopener noreferrer">Tab Atkins</a> about this, it became clear that the simplification won‚Äôt happen until the custom property is registered as a <code>&lt;number&gt;</code> ‚Äì something I wasn‚Äôt aware of. This section has been rewritten to incorporate that info.</p><p>Now, you might be wondering if you can use <a href="https://brm.us/style-queries" target="_blank" rel="noopener noreferrer">Style Queries</a> for easier styling when relying on only the scroll direction. It‚Äôs definitely a valid question, as doing the calculations can be hard to get right, with a lot of trial and error.</p><p>After all, it would be so much easier if you could do this, allowing you to put any styles in the container blocks:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Idle */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling down */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> -1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling up */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>According <a href="https://drafts.csswg.org/css-values-4/#calc-computed-value" target="_blank" rel="noopener noreferrer">to the spec</a> any mathematical expression should be simplified:</p><blockquote><p>The computed value of a math function is its calculation tree simplified, using all the information available at computed value time.</p></blockquote><p>So when idling, the computed value of <code>--scroll-direction</code> should become <code>0</code>, right? Unfortunately that doesn‚Äôt seem to be the case: when checking the computed value of <code>--scroll-direction</code> when idle, it computes to <code>sign(calc(0 - 0))</code>, without any simplification applied. Huh?!</p><p>The reason why simplification doesn‚Äôt happen is that the browser doesn‚Äôt know that it can. A custom property can hold any value; It‚Äôs only when it‚Äôs being used as a value ‚Äì via <code>var()</code> ‚Äì that the browser tries to convert the custom property to be of a certain type that fits the property it is used in. If the type conversion doesn‚Äôt work out ‚Äì e.g. when trying to set a color as the value for an <code>animation-duration</code> ‚Äì the declaration will become <a href="https://w3.org/TR/css-variables-1/#invalid-at-computed-value-time" target="_blank" rel="noopener noreferrer">‚ÄúInvalid At Computed Value Time‚Äù</a>.</p><p>~</p><h4 id="property-to-the-rescue" tabindex="-1"><a class="header-anchor" href="#property-to-the-rescue"><span><a href="#cq-at-property">#</a> <code>@property</code> to the rescue!</span></a></h4><p>So, can you force the conversion to happen, in order for the simplification to occur? Why yes you can! By registering <code>--scroll-direction</code> ‚Äì using <code>@property</code> ‚Äì to be a <code>&lt;number&gt;</code>, the browser will try to fit the declared value into that type. At that point the simplification will occur, and <code>sign(calc(0 - 0))</code> can be simplified to <code>0</code></p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-direction</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With this registration, it now becomes possible to use style queries for the styling based on the scroll direction:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Idle */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> crimson<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling down */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> forestgreen<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> -1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling up */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> lightskyblue<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21)),e(p,{user:"bramus","slug-hash":"dyaYoyG",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[108]||(n[108]=s("p",null,"üíÅ‚Äç‚ôÇÔ∏è Compare the non-registered vs registered behavior",-1)),n[109]||(n[109]=s("p",null,[a("Here‚Äôs a small CodePen that tests the simplification/seriallization of "),s("code",null,"calc()"),a(". The value of the "),s("code",null,"--output"),a(" property eventually becomes "),s("code",null,"calc(2 * 0.5)"),a(", because the custom property is not registered to be of a certain type.")],-1)),e(p,{user:"bramus","slug-hash":"RwEqJye/2ebcc612170ef036b46bb2fb6c6cf0c7",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[110]||(n[110]=s("p",null,[a("Now compare this to this adjusted version where the custom property is registered as a "),s("code",null,"<number>"),a(":")],-1)),e(p,{user:"bramus","slug-hash":"WNPvvzm",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[111]||(n[111]=i(`<p>~</p><h3 id="combine-multiple-scroll-states-thanks-to-more-maths" tabindex="-1"><a class="header-anchor" href="#combine-multiple-scroll-states-thanks-to-more-maths"><span><a href="#more-scroll-states">#</a> Combine multiple scroll states, thanks to more Maths</span></a></h3><p>Thanks to some more basic maths, it‚Äôs possible to end up with a value of <code>1</code> in various scroll-cases.</p><p>For example, if you take the absolute value of <code>--scroll-direction</code> ‚Äì which is either <code>-1</code>, <code>0</code>, or <code>1</code> ‚Äì you end up with a value of <code>1</code> only when the user scrolling:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore, if you take that value, subtract <code>1</code> from it, and absolute the result, you end up with a value of <code>1</code> only when the user is not scrolling:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mix and match basic maths, <code>abs</code>, <code>min</code>, <code>max</code>, <code>clamp</code>, and you can end up with a value of <code>1</code> in any of these situations:</p><ul><li>When scrolling up or down</li><li>When not scrolling</li><li>When scrolling up</li><li>When scrolling down</li><li>When scrolling up or idle</li><li>When scrolling down or idle</li></ul><p>In code, it looks like this:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-up</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-down</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-down-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-up-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Look at the examples below for some use-cases. Don‚Äôt forget to <a href="#cq-at-property">register these as a <code>&lt;number&gt;</code> if you want to use these in Style Queries</a>.</p><h4 id="demo-moving-header" tabindex="-1"><a class="header-anchor" href="#demo-moving-header"><span>Demo: Moving Header</span></a></h4>`,13)),s("p",null,[n[57]||(n[57]=a("One example where you can use this is to hide the header and footer bars while the user is scrolling. This is done by translating the bars out the way in that case. For this, the code uses ",-1)),n[58]||(n[58]=s("code",null,"--when-scrolling",-1)),n[59]||(n[59]=a(" ‚Äì which has a value of ",-1)),n[60]||(n[60]=s("code",null,"1",-1)),n[61]||(n[61]=a(" when scrolling and a value of ",-1)),n[62]||(n[62]=s("code",null,"0",-1)),n[63]||(n[63]=a(" when not scrolling ‚Äì as ",-1)),e(m,{to:"/bram.us/conditions-for-css-calculations.html"},{default:t(()=>[...n[56]||(n[56]=[s("strong",null,"the condition for the calculation",-1)])]),_:1}),n[64]||(n[64]=a(".",-1))]),n[112]||(n[112]=i(`<div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--hide-bars</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">header</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> 0 <span class="token function">calc</span><span class="token punctuation">(</span>-90% * <span class="token function">var</span><span class="token punctuation">(</span>--hide-bars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">footer</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> 0 <span class="token function">calc</span><span class="token punctuation">(</span>90% * <span class="token function">var</span><span class="token punctuation">(</span>--hide-bars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The demo below requires Chrome with the Experimental Web Platform Features feature flag enabled.</p>`,2)),e(p,{user:"bramus","slug-hash":"dywzeoN/d4ee4fafdd7287701713d46e741ba94e",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[113]||(n[113]=i(`<p>üí≠ Initially I wanted to hide the header upon scrolling down or remaining idle after having scrolled down, and only show it again once starting to scroll up again. I couldn‚Äôt immediately find a solution here ‚Äì using <code>--when-scrolling-down-or-when-not-scrolling</code> also hides it on initial load, which is not what I want ‚Äì but I‚Äôm sure <a href="https://front-end.social/@johannes" target="_blank" rel="noopener noreferrer">Johannes</a> will be able to tell me how to do it using <a href="https://johannesodland.github.io/state/scroll-snap/scroll-driven-animations/2023/06/18/scroll-persisted-state.html" target="_blank" rel="noopener noreferrer">Scroll-Persisted State</a>.</p><p>It is possible to ‚Äúremember‚Äù the last scrolled direction by using a long <code>transition-delay</code>. See <a href="https://brm.us/hidey-bar" target="_blank" rel="noopener noreferrer">https://brm.us/hidey-bar</a> for details on how to use this.</p><p>~</p><h4 id="demo-directional-chicky-scroll" tabindex="-1"><a class="header-anchor" href="#demo-directional-chicky-scroll"><span><a href="#demo-directional-chicky-scroll">#</a> Demo: Directional Chicky Scroll</span></a></h4><p>When <a href="https://twitter.com/utilitybend" target="_blank" rel="noopener noreferrer">Brecht De Ruyte</a> <a href="https://utilitybend.com/blog/for-the-love-of-scroll-driven-animations-in-css" target="_blank" rel="noopener noreferrer">explored Scroll-Driven Animations back in February</a>, he built a demo where a little chicky walks across the screen as you scroll the page. While building that demo he noted that when scrolling up, the chicky is facing the wrong direction:</p><blockquote><p>The downside is that my animation seems to trigger a bit of moonwalking when scrolling back to top. Let‚Äôs just call it a feature for now, ok? üòâ</p></blockquote><p>With <code>--scroll-direction</code> available it‚Äôs pretty easy to flip the chicky in the other direction by passing that into <code>scaleX()</code>. However, when idling you‚Äôd end up with a <code>scaleX()</code> of <code>0</code> so to counter that I add <code>--when-not-scrolling</code> to the equation. By doing so, the <code>scaleX()</code> will also be <code>1</code> when idle, so the chicky will face forwards in that case.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> moveChicky</span> <span class="token punctuation">{</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>80px<span class="token punctuation">)</span> <span class="token function">scaleX</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">var</span><span class="token punctuation">(</span>--when-not-scrolling<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The demo below requires Chrome with the Experimental Web Platform Features feature flag enabled.</p>`,9)),e(p,{user:"bramus","slug-hash":"LYMjgjB/1e36fc337fc5f703e84397f089fc017c",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[114]||(n[114]=i(`<p>~</p><h3 id="lerp-effects" tabindex="-1"><a class="header-anchor" href="#lerp-effects"><span><a href="#lerp-effects">#</a> LERP-effects</span></a></h3><p>Because there is a delay happening it‚Äôs possible to create typical LERP-effects. Below are a few demos that reproduce that.</p><p>üí° LERP = <a href="https://en.wikipedia.org/wiki/Linear_interpolation" target="_blank" rel="noopener noreferrer"><strong>L</strong>inear int<strong>ERP</strong>olation</a></p><p>~</p><h4 id="demo-lerp-reading-indicator" tabindex="-1"><a class="header-anchor" href="#demo-lerp-reading-indicator"><span><a href="#demo-lerp-reading-indicator">#</a> Demo: LERP Reading Indicator</span></a></h4><p>In this demo, the reading indicator catches up on the actual reading position. The code is easy, as it relies directly on <code>--scroll-position-delayed</code>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">#progress</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)),e(p,{user:"bramus","slug-hash":"VwqJObR/7ef7eaaa78ad1382dbe5c5c4c5066989",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[115]||(n[115]=i(`<p>Compare the behavior of the demo above to <a href="https://scroll-driven-animations.style/demos/progress-bar/css/" target="_blank" rel="noopener noreferrer">this original version</a> whose reading indicator responds directly to the scroll position change.</p><p>~</p><h4 id="demo-lerp-scrolling" tabindex="-1"><a class="header-anchor" href="#demo-lerp-scrolling"><span><a href="#demo-lerp-scrolling">#</a> Demo: LERP Scrolling</span></a></h4><p>Recreating a LERP scrolling effect is a bit more difficult as you don‚Äôt want to recreate an entirely custom scroller from scratch ‚Äì These always end up in the <a href="https://en.wikipedia.org/wiki/Uncanny_valley" target="_blank" rel="noopener noreferrer">uncanny valley</a>. What I‚Äôve done in the demo below is added some fake drag to the scroll by translating the contents in the opposite scrolling direction.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Hook animation onto self */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.25s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * 500vh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Add some drag. Tweak the 500vh value to adjust how much drag */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5)),e(p,{user:"bramus","slug-hash":"GRPvqrN/1c39bc90ac0e08708933eb999c0941a8",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[116]||(n[116]=i('<p>The effect is not entirely perfect though. For example, when hitting the end of the scroller the <code>--scroll-position-delayed</code> is still getting delayed while it should skip forwards in that case.</p><p>~</p><h3 id="more-demos" tabindex="-1"><a class="header-anchor" href="#more-demos"><span><a href="#more-demos">#</a> More Demos</span></a></h3><p>I‚Äôm sure this technique will spark a lot of nice new demos. Here‚Äôs a few more that I‚Äôve built using this technique.</p><p>~</p><h4 id="demo-wormhole" tabindex="-1"><a class="header-anchor" href="#demo-wormhole"><span><a href="#demo-wormhole">#</a> Demo: Wormhole</span></a></h4><p>By nesting a bunch of boxes, you can see how the value of <code>--scroll-position-delayed</code> propagates from box to box. Add some translation + colors, and you get a wormhole effect.</p>',7)),e(p,{user:"bramus","slug-hash":"wvRqVBm/b4a25463d8c5315758802aba3e60b9ab",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[117]||(n[117]=i('<p>The demo also includes the code to respond to a horizontal delayed scroll.</p><p>~</p><h4 id="demo-badass" tabindex="-1"><a class="header-anchor" href="#demo-badass"><span><a href="#demo-badass">#</a> Demo: BADASS</span></a></h4><p>Back in 2017 I saw a nice scroll effect on <a href="https://badassfilms.tv/" target="_blank" rel="noopener noreferrer">the BADASS website</a>. The site is no longer up in that state, but thankfully <a href="https://bram.us/2017/10/15/badass/" target="_blank" rel="noopener noreferrer">my blog entry about it</a> also included a video of the effect, which I‚Äôve also embedded below:</p><figure><img src="https://bram.us/wordpress/wp-content/uploads/2017/10/badass_homepage_shoot_02.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Recording of the original</p><p>As I wrote back then:</p><blockquote><p>The effect is achieved by placing a duplicate (but clipped) list on top of another one, in combination with scroll velocity calculation to define the slant of the list.</p></blockquote><p>Recreating this effect is now perfectly possible with just CSS:</p><ul><li>Move the two lists across the screen as you scroll from top to bottom</li><li>Adjust the <code>clip-path</code> of the hotpink list as you scroll</li><li>Adjust the slant of the outlined list depending on the scroll speed and direction</li></ul><p>The difficult part here wasn‚Äôt to skew the list ‚Äì this was already done in the other demos ‚Äì but to get the <code>clip-path</code> working correctly. You can check the code for my calculations and comments.</p>',11)),e(p,{user:"bramus","slug-hash":"OJrxBaL/3069957ece86b0c8aafb4a249ff9271a",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[118]||(n[118]=i('<p>üé¨ Check a recording of this demo</p><p>Video Player</p><p><a href="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4" target="_blank" rel="noopener noreferrer">https://www.bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4</a></p><p>00:00</p><p>00:00</p><p>00:11</p><p>[Use Up/Down Arrow keys to increase or decrease volume.</p><p>](javascript:void(0)üòâ</p><p>Recording of the demo inspired upon the original animation oon the BADASS website.</p><p>~</p><h3 id="a-note-on-performance" tabindex="-1"><a class="header-anchor" href="#a-note-on-performance"><span><a href="#performance">#</a> A note on performance</span></a></h3><p>When doing a trace via Chrome DevTools you might notice that paint constantly gets triggered as you scroll.</p><figure><a href="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png" target="_blank" rel="noopener noreferrer"><img src="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png" alt="" tabindex="0" loading="lazy"></a><figcaption></figcaption></figure><p>A Performance Trace in Chrome DevTools of the <a href="#demo-lerp-reading-indicator">LERP Reading Indicator Demo</a>, riddled with rendering Tasks</p><p>This is because Chrome ‚Äì and any other browser for that matter ‚Äì animates Custom Properties on the main thread. I have <a href="https://brm.us/animate-custom-properties" target="_blank" rel="noopener noreferrer">written about this problem space before</a>, and hope to see this fixed in the future. Star <a href="https://crbug.com/1411864" target="_blank" rel="noopener noreferrer">Chromium Issue #1411864</a> to stay in the loop.</p><p>~</p><h3 id="closing-thoughts" tabindex="-1"><a class="header-anchor" href="#closing-thoughts"><span><a href="#closing-thoughts">#</a> Closing Thoughts</span></a></h3><p>One of the features authors have asked about at the CSS Working Group is to expose current scrolling direction in CSS <em>(<a href="https://github.com/w3c/csswg-drafts/issues/6400" target="_blank" rel="noopener noreferrer">w3c/csswg-drafts#6400</a>)</em>. Not only does the technique described in this article offer an answer to that problem, it cranks it up a notch by also exposing the scrolling speed. While it‚Äôs not entirely perfect ‚Äì e.g. the scroll velocity can lag a bit on the actual situation ‚Äì it can already get you quite the distance.</p><p>Personally I think it is very exciting to see that Scroll-Driven Animations yet again <em>([<a href="https://kizu.dev/scroll-driven-animations/" target="_blank" rel="noopener noreferrer">1</a>], [<a href="https://johannesodland.github.io/state/scroll-snap/scroll-driven-animations/2023/06/18/scroll-persisted-state.html" target="_blank" rel="noopener noreferrer">2</a>], [<a href="https://kizu.dev/fit-to-width-text/" target="_blank" rel="noopener noreferrer">3</a>]. [<a href="https://bram.us/2023/06/26/faking-a-snapped-selector-with-scroll-driven-animations/" target="_blank" rel="noopener noreferrer">4</a>], [<a href="https://bram.us/2023/09/16/solved-by-css-scroll-driven-animations-detect-if-an-element-can-scroll-or-not/" target="_blank" rel="noopener noreferrer">5</a>], [<a href="https://kizu.dev/scroll-driven-state-transfer/" target="_blank" rel="noopener noreferrer">6</a>])</em> can be used for so much more than simply animating things as you scroll. I‚Äôm very much looking forward to more unconventional uses of this feature, unlocking some age-old requests ‚Ä¶</p><p>~</p><h3 id="spread-the-word-name-spread-the-word" tabindex="-1"><a class="header-anchor" href="#spread-the-word-name-spread-the-word"><span>[#](#spread-the-word name=) Spread the word</span></a></h3><p>To help spread the contents of this post, feel free to retweet the announcements made on social media:</p>',22)),e(p,{user:"front-end.social/@bramus/111286294127147693/embed","slug-hash":"undefined",title:"N/A","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[119]||(n[119]=i('<p>~</p><p><strong>üî• Like what you see? Want to stay in the loop? Here&#39;s how:</strong></p><ul><li><a href="https://bsky.app/profile/bram.us" target="_blank" rel="noopener noreferrer">ü¶ã Follow @bram.us on Bluesky</a></li><li><a href="https://bram.us/feed" target="_blank" rel="noopener noreferrer">üî∏ Follow bram.us using RSS</a></li></ul><p>I can also be found on <a href="https://x.com/bramus" target="_blank" rel="noopener noreferrer">ùïè Twitter</a> and <a href="https://front-end.social/@bramus" target="_blank" rel="noopener noreferrer">üêò Mastodon</a> but only post there sporadically.</p>',4)),b(" TODO: add ARTICLE CARD "),e(u,d(h({title:"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed",desc:"Combine Scroll-Driven Animations with @‚Äãproperty, transition-delay, calc(), sign() and abs() ‚Ä¶ and you can do Scroll Detection using only CSS!",link:"https://chanhi2000.github.io/bookshelf/bram.us/css-scroll-detection.html",logo:"https://bramu.us/favicon.ico",background:"rgba(17,17,17,0.2)"})),null,16),n[120]||(n[120]=i('<hr><h2 id="lang-en-ustitle-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-description-article-s-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-icon-category" tabindex="-1"><a class="header-anchor" href="#lang-en-ustitle-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-description-article-s-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-icon-category"><span>lang: en-US title: &quot;Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed&quot; description: &quot;Article(s) &gt; Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed&quot; icon: category:</span></a></h2><ul><li>Article(s) tag:</li><li>blog</li><li>bram.us</li><li></li></ul><p>head:</p><ul><li><ul><li>meta:</li><li>property: og:title content: &quot;Article(s) &gt; Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed&quot;</li><li>property: og:description content: &quot;Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed&quot;</li><li>property: og:url content: https://chanhi2000.github.io/bookshelf/bram.us/css-scroll-detection.html prev: /articles/README.md date: 2023-10-24 isOriginal: false author:</li></ul></li><li>name: Bramus! url : https://bram.us/author/bramus/ cover: https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif</li></ul><hr>',6)),s("h1",W,[s("a",z,[s("span",null,v(l.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(u,d(h({title:" > Article(s)",desc:"Article(s)",link:"/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",L,[s("ul",null,[s("li",null,[e(o,{to:"#table-of-contents"},{default:t(()=>[...n[65]||(n[65]=[a("Table of Contents",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-code"},{default:t(()=>[...n[66]||(n[66]=[a("The Code",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-concept"},{default:t(()=>[...n[67]||(n[67]=[a("The Concept",-1)])]),_:1})]),s("li",null,[e(o,{to:"#basic-demos"},{default:t(()=>[...n[68]||(n[68]=[a("# Basic demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#intermezzo-what-about-style-queries"},{default:t(()=>[...n[69]||(n[69]=[a("# Intermezzo: what about Style Queries?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#combine-multiple-scroll-states-thanks-to-more-maths"},{default:t(()=>[...n[70]||(n[70]=[a("# Combine multiple scroll states, thanks to more Maths",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lerp-effects"},{default:t(()=>[...n[71]||(n[71]=[a("# LERP-effects",-1)])]),_:1})]),s("li",null,[e(o,{to:"#more-demos"},{default:t(()=>[...n[72]||(n[72]=[a("# More Demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#a-note-on-performance"},{default:t(()=>[...n[73]||(n[73]=[a("# A note on performance",-1)])]),_:1})]),s("li",null,[e(o,{to:"#closing-thoughts"},{default:t(()=>[...n[74]||(n[74]=[a("# Closing Thoughts",-1)])]),_:1})]),s("li",null,[e(o,{to:"#spread-the-word-name-spread-the-word"},{default:t(()=>[...n[75]||(n[75]=[a("[#](#spread-the-word name=) Spread the word",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lang-en-ustitle-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-description-article-s-solved-by-css-scroll-driven-animations-style-an-element-based-on-the-active-scroll-direction-and-scroll-speed-icon-category"},{default:t(()=>[...n[76]||(n[76]=[a('lang: en-UStitle: "Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"description: "Article(s) > Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"icon:category:',-1)])]),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#table-of-contents-1"},{default:t(()=>[...n[77]||(n[77]=[a("Table of Contents",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-code-1"},{default:t(()=>[...n[78]||(n[78]=[a("# The Code",-1)])]),_:1})]),s("li",null,[e(o,{to:"#the-concept-1"},{default:t(()=>[...n[79]||(n[79]=[a("# The Concept",-1)])]),_:1})]),s("li",null,[e(o,{to:"#basic-demos-1"},{default:t(()=>[...n[80]||(n[80]=[a("# Basic demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#intermezzo-what-about-style-queries-1"},{default:t(()=>[...n[81]||(n[81]=[a("# Intermezzo: what about Style Queries?",-1)])]),_:1})]),s("li",null,[e(o,{to:"#combine-multiple-scroll-states-thanks-to-more-maths-1"},{default:t(()=>[...n[82]||(n[82]=[a("# Combine multiple scroll states, thanks to more Maths",-1)])]),_:1})]),s("li",null,[e(o,{to:"#lerp-effects-1"},{default:t(()=>[...n[83]||(n[83]=[a("# LERP-effects",-1)])]),_:1})]),s("li",null,[e(o,{to:"#more-demos-1"},{default:t(()=>[...n[84]||(n[84]=[a("# More Demos",-1)])]),_:1})]),s("li",null,[e(o,{to:"#a-note-on-performance-1"},{default:t(()=>[...n[85]||(n[85]=[a("# A note on performance",-1)])]),_:1})]),s("li",null,[e(o,{to:"#closing-thoughts-1"},{default:t(()=>[...n[86]||(n[86]=[a("# Closing Thoughts",-1)])]),_:1})])])])])]),n[121]||(n[121]=s("hr",null,null,-1)),e(k,{name:"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed",desc:"Combine Scroll-Driven Animations with @‚Äãproperty, transition-delay, calc(), sign() and abs() ‚Ä¶ and you can do Scroll Detection using only CSS!",url:"https://bram.us/2023/10/23/css-scroll-detection/",logo:"https://bramu.us/favicon.ico",preview:"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif"}),n[122]||(n[122]=s("p",{"top:":"","3em;":""},".post-33847 .entry-content article { margin: 0; position: relative; } .post-33847 .entry-content :is(h3,h4) { position: sticky; top: 0em; padding: 0.5em 0; border-bottom: 1px solid #e4e4e4; z-index: 2; background: #fff; /* If only we could stick against another sticky ‚Ä¶ */ white-space: nowrap; overflow-x: auto; max-width: 100%; } .post-33847 .entry-content h4",-1)),n[123]||(n[123]=i(`<p>Video Player</p><p><a href="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4" target="_blank" rel="noopener noreferrer">https://www.bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4</a></p><p>00:02</p><p>00:00</p><p>00:11</p><p>[Use Up/Down Arrow keys to increase or decrease volume.</p><p>](javascript:void(0)üòâ</p><p>Recording of <a href="#demo-badass">the BADASS Demo</a></p><p><a href="https://scroll-driven-animations.style/" target="_blank" rel="noopener noreferrer">Scroll-Driven Animations</a> can be used for more than driving an animation by scroll. In this post, I share how you can use Scroll-Driven Animations to detect the Scroll Velocity a user is actively scrolling in.</p><p>That means that <strong>using only CSS you can style an element based on whether the user is scrolling <em>(or not scrolling)</em>, the direction they are scrolling in, and the speed they are scrolling with</strong>.</p><p>~</p><h3 id="table-of-contents-1" tabindex="-1"><a class="header-anchor" href="#table-of-contents-1"><span>Table of Contents</span></a></h3><ul><li><a href="#the-code">The Code</a></li><li><a href="#the-concept">The Concept</a><ul><li><a href="#the-concept-1">Animating two Custom Properties on scroll</a></li><li><a href="#the-concept-2">Delaying one of the Custom Properties</a></li><li><a href="#the-concept-3">Calculating the Scroll Velocity</a></li><li><a href="#the-concept-4">Calculating the Scroll Direction and Scroll Speed</a></li></ul></li><li><a href="#basic-demos">Basic Demos</a><ul><li><a href="#demo-tilted-boxes">Tilted Colored Boxes</a></li><li><a href="#demo-motion-blur-scroll">Motion Blur Scroll</a> (üî•)</li></ul></li><li><a href="#style-queries">Intermezzo: what about Style Queries?</a><ul><li><a href="#cq-at-property"><code>@property</code> to the rescue!</a></li></ul></li><li><a href="#more-scroll-states">Combine multiple scroll states, thanks to more Maths</a><ul><li><a href="#demo-moving-header">Demo: Moving Header</a></li><li><a href="#demo-directional-chicky-scroll">Demo: Directional Chicky Scroll</a></li></ul></li><li><a href="#lerp-effects">LERP Effects</a><ul><li><a href="#demo-lerp-reading-indicator">Demo: LERP reading indicator</a></li><li><a href="#demo-lerp-scrolling">Demo: LERP scrolling</a></li></ul></li><li><a href="#more-demos">More Demos</a><ul><li><a href="#demo-wormhole">Wormhole</a></li><li><a href="#demo-badass">Badass (üî•)</a></li></ul></li><li><a href="#performance">A note on performance</a></li><li><a href="#closing-thoughts">Closing Thoughts</a></li><li><a href="#spread-the-word">Spread the word</a></li></ul><p>~</p><p>üíÅ‚Äç‚ôÇÔ∏è This article assumes you know the basics of Scroll-Driven Animations. If you don‚Äôt, then get yourself acquainted with it over at <a href="https://scroll-driven-animations.style/" target="_blank" rel="noopener noreferrer">scroll-driven-animations.style</a>, which includes links to relevant articles and videos.</p><p>‚ö†Ô∏è Motion Warning ‚Äì This article is all about animations so things will move around, often quite abruptly. When implementing these effects in your own projects, take <code>prefers-reduced-motion</code> into account.</p><p>üë®‚Äçüî¨ Browser Compat Warning ‚Äì The demos in this post rely on Scroll-Driven Animations and <code>@property</code> being available. In practice, this means you need a Chromium-based browser, version 115 or newer.</p><p>~</p><h3 id="the-code-1" tabindex="-1"><a class="header-anchor" href="#the-code-1"><span><a href="#the-code">#</a> The Code</span></a></h3><p>If you‚Äôre here for just the code, here it is:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position-delayed</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> adjust-pos</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">to</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">--scroll-position</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token property">--scroll-position-delayed</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">:root</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">,</span> -1 * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* abs(var(--scroll-velocity)); */</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> / <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* sign(var(--scroll-velocity)); */</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-up</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-down</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-down-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-up-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you want to know how to use it and why this works, keep on reading üòâ</p><p>~</p><h3 id="the-concept-1" tabindex="-1"><a class="header-anchor" href="#the-concept-1"><span><a href="#the-concept">#</a> The Concept</span></a></h3><p>When combining a few CSS things together, you often end up with a novel way to achieving something. A while ago, I figured out that you can detect the scroll speed and scroll direction using only CSS when combining the following:</p><p><code>@property</code></p><p>To register two custom properties of the type <code>&lt;number&gt;</code> so that they can be animated.</p><p>Scroll-Driven Animations</p><p>To animate those custom properties from <code>0</code> to <code>1</code> on scroll.</p><p><code>transition-delay</code></p><p>To delay the computation of the 2nd custom property on a child element of the scroller.</p><p><code>calc()</code></p><p>To compute the difference between both numbers, giving you the scroll velocity (= speed + direction).</p><p><code>sign()</code></p><p>To extract the scroll direction from the velocity, leaving you with a value of <code>1</code>, <code>0</code>, or <code>-1</code>.</p><p><code>abs()</code></p><p>To extract the scroll speed from the velocity.</p><p>If that‚Äôs all gibberish to you don‚Äôt worry, as I‚Äôll explain it all in the next few sections.</p><p>~</p><h4 id="animating-two-custom-properties-on-scroll-1" tabindex="-1"><a class="header-anchor" href="#animating-two-custom-properties-on-scroll-1"><span><a href="#the-concept-1">#</a> Animating two Custom Properties on scroll</span></a></h4><p>Let‚Äôs start off at the start, by animating two custom properties on scroll. This is done using a Scroll Timeline which is attached to the root scroller.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-position-delayed</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> adjust-pos</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">to</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">--scroll-position</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token property">--scroll-position-delayed</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">:root</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Both of these values will animate from <code>0</code> to <code>1</code> as you scroll the document from top to bottom. Because they are registered through <a href="https://drafts.css-houdini.org/css-properties-values-api/#at-property-rule" target="_blank" rel="noopener noreferrer"><code>@property</code></a>, <a href="https://drafts.css-houdini.org/css-properties-values-api/#animation-behavior-of-custom-properties" target="_blank" rel="noopener noreferrer">they will interpolate nicely</a> instead of <a href="https://w3.org/TR/web-animations/#discrete" target="_blank" rel="noopener noreferrer">animating discretely</a>.</p><blockquote><p>When referenced by animations and transitions, custom property values interpolate by computed value, in accordance with the type that they parsed as.</p></blockquote>`,44)),e(p,{user:"bramus","slug-hash":"LYMoMEz/eb904c5de30a6a7dd7ffcc1f7c5a085a",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[124]||(n[124]=i(`<p>~</p><h4 id="delaying-one-of-the-custom-properties-1" tabindex="-1"><a class="header-anchor" href="#delaying-one-of-the-custom-properties-1"><span><a href="#the-concept-2">#</a> Delaying one of the Custom Properties</span></a></h4><p>Animating two different properties in exactly the same way seems a bit stupid, but that‚Äôs where the rest of the trick comes into play. By delaying the <code>--scroll-position-delayed</code> property ‚Äì using <a href="https://drafts.csswg.org/css-transitions/#transition-delay-property" target="_blank" rel="noopener noreferrer"><code>transition-delay</code></a> ‚Äì <strong>on a child of the scroller</strong>, you can have it lag on the parent.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It is very important to note that I‚Äôm delaying the <code>--scroll-position-delayed</code> on the <code>body</code> element, which is a child of <code>html</code>. By doing so, I am not lagging <code>--scroll-position-delayed</code> on <code>--scroll-position</code> but, instead, I am lagging the <code>--scroll-position-delayed</code> value of the <code>body</code> element on the <code>--scroll-position-delayed</code> value of the <code>html</code> element.</p>`,5)),s("p",null,[n[88]||(n[88]=a("‚òùÔ∏è This parent-child relationship is a requirement for this trick to work ‚Äì it won‚Äôt work if you delay ",-1)),n[89]||(n[89]=s("code",null,"--scroll-position-delayed",-1)),n[90]||(n[90]=a(" on the scroller ‚Äì here ",-1)),n[91]||(n[91]=s("code",null,"html",-1)),n[92]||(n[92]=a(" ‚Äì itself. You can draw a parallel to ",-1)),e(m,{to:"/bram.us/css-container-queries-a-first-look-and-demo.html#container-queries"},{default:t(()=>[...n[87]||(n[87]=[s("strong",null,"Container Queries",-1)])]),_:1}),n[93]||(n[93]=a(" here, which also require a parent-child relationship.",-1))]),n[125]||(n[125]=s("p",null,[a("The set "),s("code",null,"transition-delay"),a(" controls how much lag there is before "),s("code",null,"--scroll-position-delayed"),a(" on the "),s("code",null,"body"),a(" catches up with the value from the "),s("code",null,"html"),a(" element. Best is to keep the delay pretty low, as the resulting effect could otherwise feel slow to users.")],-1)),e(p,{user:"bramus","slug-hash":"YzdbdyL/52b163fb496bc91464f1a851878b344d",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[126]||(n[126]=i(`<p>Try scrolling up and down in the CodePen embedded above, and notice how <code>--scroll-position-delayed</code> lags on the <code>--scroll-position</code> variable. Repeat your test while scrolling very fast or really slow, and compare the effect of both speeds to each other.</p><p>~</p><h4 id="calculating-the-scroll-velocity-1" tabindex="-1"><a class="header-anchor" href="#calculating-the-scroll-velocity-1"><span><a href="#the-concept-3">#</a> Calculating the Scroll Velocity</span></a></h4><p>Because the computed values of the <code>--scroll-position</code> and <code>--scroll-position-delayed</code> properties differ as you scroll, you can use them to calculate the scroll velocity. By taking the difference of both values ‚Äì using a regular <a href="https://drafts.csswg.org/css-values/#funcdef-calc" target="_blank" rel="noopener noreferrer"><code>calc()</code></a> ‚Äì you end up with a number that will be one of these:</p><ul><li>A positive float, ranging from <code>0</code> to <code>1</code>, indicating the user is scrolling down</li><li><code>0</code>, indicating the user is not scrolling</li><li>A negative float, ranging from <code>-1</code> to <code>0</code>, indicating the user is scrolling up</li></ul><p>In CSS, it looks like this:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.15s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7)),e(p,{user:"bramus","slug-hash":"VwqOqwQ/d0a922a21fd64f8decc88991c754cc04",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[127]||(n[127]=i(`<p>Try scrolling up and down in the CodePen embedded above, and notice how <code>--scroll-velocity</code> is a float representing the scroll velocity. Repeat your test while scrolling very fast or really slow, and compare the effect of both speeds to each other.</p><p>üïµÔ∏è When looking really close, you might notice that the number is a bit off when quickly changing the direction or when abruptly stopping a scroll: the updated value of <code>--scroll-velocity</code> will not immediately reflect the actual state. This can be tweaked by tightening the <code>transition-delay</code> of the <code>--scroll-position-delayed</code> property, but then you end up with smaller values for <code>--scroll-velocity</code> so you might need a multiplier to counteract that.</p><p>There‚Äôs also a difference in update speed between dragging the scrollbar versus using the touchpad to scroll the scroller. The former updates much, much, faster.</p><p>~</p><h4 id="calculating-the-scroll-direction-and-scroll-speed-1" tabindex="-1"><a class="header-anchor" href="#calculating-the-scroll-direction-and-scroll-speed-1"><span><a href="#the-concept-4">#</a> Calculating the Scroll Direction and Scroll Speed</span></a></h4><p>Because Velocity is a measured Speed into a certain Direction <em>(<a href="https://britannica.com/story/whats-the-difference-between-speed-and-velocity" target="_blank" rel="noopener noreferrer">ref</a>)</em>, the Direction and Speed can be extracted from the Velocity.</p><p>The direction of scrolling can be derived from the <code>--scroll-velocity</code> by looking at its sign: If it‚Äôs positive, then the user is scrolling down. If it is negative, the user is scrolling up.</p><p>In CSS, you can use the <a href="https://drafts.csswg.org/css-values/#sign-funcs" target="_blank" rel="noopener noreferrer">the <code>sign()</code> function</a> to extract that info:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The value for <code>--scroll-direction</code> is one of these:</p><ul><li><code>1</code>, indicating the user is scrolling down</li><li><code>0</code>, indicating the user is not scrolling</li><li><code>-1</code>, indicating the user is scrolling up</li></ul><p>This value will come in handy in calculations further down the road.</p><p>Extracting the scroll speed from the velocity is also easy to do, as it‚Äôs a matter of dropping sign from the value. In CSS, this can be done using <a href="https://drafts.csswg.org/css-values/#sign-funcs" target="_blank" rel="noopener noreferrer">the <code>abs()</code> function</a>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Put together, you get this:</p>`,15)),e(p,{user:"bramus","slug-hash":"LYMLoJa/49dd704872be26534482faef58b788fb",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[128]||(n[128]=i(`<p>Try scrolling up and down in the CodePen above, and notice how <code>--scroll-direction</code> is an integer representing the scroll direction, unaffected by the scroll speed.</p><p>üë®‚Äçüî¨ At the time of writing, <code>sign()</code> and <code>abs()</code> are available in Chrome only once you flip on the Experimental Web Platform Features feature flag on through <code>chrome://flags</code>.</p><p>Thankfully, the functionality can be polyfilled using some basic mathematics, as detailed by <a href="https://thebabydino.github.io/" target="_blank" rel="noopener noreferrer">Ana Tudor</a> in <a href="https://css-tricks.com/using-absolute-value-sign-rounding-and-modulo-in-css-today/#aa-sign" target="_blank" rel="noopener noreferrer">this post on CSS-Tricks</a>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--scroll-speed</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">,</span> -1 * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-direction</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> / <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>~</p><h3 id="basic-demos-1" tabindex="-1"><a class="header-anchor" href="#basic-demos-1"><span><a href="#basic-demos">#</a> Basic demos</span></a></h3><p>With these computed custom properties <code>--scroll-velocity</code> and <code>--scroll-direction</code> available it‚Äôs time to get creative ‚Ä¶</p><p>~</p><h4 id="tilted-colored-boxes-1" tabindex="-1"><a class="header-anchor" href="#tilted-colored-boxes-1"><span><a href="#demo-tilted-boxes">#</a> Tilted Colored boxes</span></a></h4><p>A first demos are these boxes that get skewed in a certain angle depending on the scroll. The faster you scroll, the more skewed they get, with a maximum of 25 degrees.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * -25deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore the boxes also get the hue of their <code>background-color</code> rotated depending on the scroll direction.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>0deg + <span class="token punctuation">(</span>145deg * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 50% 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> background 0.15s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When idle, the boxes are red. When scrolling down they become green and when scrolling up they are blue. The transition of the background is eased at <code>0.15s</code>.</p>`,14)),e(p,{user:"bramus","slug-hash":"oNJeLWg/cb3542fb8be1f8bb0a33e107229b9027",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[129]||(n[129]=s("p",null,"~",-1)),n[130]||(n[130]=s("h4",{id:"motion-blur-scroll-1",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#motion-blur-scroll-1"},[s("span",null,[s("a",{href:"#demo-motion-blur-scroll"},"#"),a(" Motion Blur Scroll")])])],-1)),n[131]||(n[131]=s("p",null,[a("Things also become interesting when using the "),s("code",null,"--scroll-velocity"),a(" and "),s("code",null,"--scroll-speed"),a(" values in a "),s("code",null,"filter"),a(", as that function has many options. With it, you can create a Motion Blur effect, that even desaturates the content as you scroll.")],-1)),e(p,{user:"bramus","slug-hash":"XWoREjv/a0e0aca0d543dc146b90bea779fbd964",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[132]||(n[132]=i(`<p>The blurring and desaturating is handled by the <code>filter</code> property. Some basic translation and <code>opacity</code>-meddling also takes place, to give it a rather cinematic effect. To always have a positive float value for use within all calculations, the code relies on <code>--scroll-speed</code> instead of <code>--scroll-velocity</code> which can become negative.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">main</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">filter</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token function">blur</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>2rem * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">contrast</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>100% - <span class="token punctuation">(</span>500% * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">saturate</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>100% - <span class="token punctuation">(</span>500% * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>1 - <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-speed<span class="token punctuation">)</span> * 4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>-8rem * <span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span><span class="token punctuation">)</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore the entire photostrip gets skewed a tiny bit while scrolling, similar to a previous demo.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.photo</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * 3deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The faster your scroll, the harder the effect is.</p><p>~</p><h3 id="intermezzo-what-about-style-queries-1" tabindex="-1"><a class="header-anchor" href="#intermezzo-what-about-style-queries-1"><span><a href="#style-queries">#</a> Intermezzo: what about Style Queries?</span></a></h3><p><strong>UPDATE 2023.10.26</strong> After chatting with <a href="https://xanthir.com/contact/" target="_blank" rel="noopener noreferrer">Tab Atkins</a> about this, it became clear that the simplification won‚Äôt happen until the custom property is registered as a <code>&lt;number&gt;</code> ‚Äì something I wasn‚Äôt aware of. This section has been rewritten to incorporate that info.</p><p>Now, you might be wondering if you can use <a href="https://brm.us/style-queries" target="_blank" rel="noopener noreferrer">Style Queries</a> for easier styling when relying on only the scroll direction. It‚Äôs definitely a valid question, as doing the calculations can be hard to get right, with a lot of trial and error.</p><p>After all, it would be so much easier if you could do this, allowing you to put any styles in the container blocks:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Idle */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling down */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> -1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling up */</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>According <a href="https://drafts.csswg.org/css-values-4/#calc-computed-value" target="_blank" rel="noopener noreferrer">to the spec</a> any mathematical expression should be simplified:</p><blockquote><p>The computed value of a math function is its calculation tree simplified, using all the information available at computed value time.</p></blockquote><p>So when idling, the computed value of <code>--scroll-direction</code> should become <code>0</code>, right? Unfortunately that doesn‚Äôt seem to be the case: when checking the computed value of <code>--scroll-direction</code> when idle, it computes to <code>sign(calc(0 - 0))</code>, without any simplification applied. Huh?!</p><p>The reason why simplification doesn‚Äôt happen is that the browser doesn‚Äôt know that it can. A custom property can hold any value; It‚Äôs only when it‚Äôs being used as a value ‚Äì via <code>var()</code> ‚Äì that the browser tries to convert the custom property to be of a certain type that fits the property it is used in. If the type conversion doesn‚Äôt work out ‚Äì e.g. when trying to set a color as the value for an <code>animation-duration</code> ‚Äì the declaration will become <a href="https://w3.org/TR/css-variables-1/#invalid-at-computed-value-time" target="_blank" rel="noopener noreferrer">‚ÄúInvalid At Computed Value Time‚Äù</a>.</p><p>~</p><h4 id="property-to-the-rescue-1" tabindex="-1"><a class="header-anchor" href="#property-to-the-rescue-1"><span><a href="#cq-at-property">#</a> <code>@property</code> to the rescue!</span></a></h4><p>So, can you force the conversion to happen, in order for the simplification to occur? Why yes you can! By registering <code>--scroll-direction</code> ‚Äì using <code>@property</code> ‚Äì to be a <code>&lt;number&gt;</code>, the browser will try to fit the declared value into that type. At that point the simplification will occur, and <code>sign(calc(0 - 0))</code> can be simplified to <code>0</code></p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@property</span> --scroll-direction</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">syntax</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;number&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">inherits</span><span class="token punctuation">:</span> true<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">initial-value</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With this registration, it now becomes possible to use style queries for the styling based on the scroll direction:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Idle */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> crimson<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> 1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling down */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> forestgreen<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token atrule"><span class="token rule">@container</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token property">--scroll-direction</span><span class="token punctuation">:</span> -1<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token comment">/* Scrolling up */</span></span>
<span class="line">  <span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">background</span><span class="token punctuation">:</span> lightskyblue<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21)),e(p,{user:"bramus","slug-hash":"dyaYoyG",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[133]||(n[133]=s("p",null,"üíÅ‚Äç‚ôÇÔ∏è Compare the non-registered vs registered behavior",-1)),n[134]||(n[134]=s("p",null,[a("Here‚Äôs a small CodePen that tests the simplification/seriallization of "),s("code",null,"calc()"),a(". The value of the "),s("code",null,"--output"),a(" property eventually becomes "),s("code",null,"calc(2 * 0.5)"),a(", because the custom property is not registered to be of a certain type.")],-1)),e(p,{user:"bramus","slug-hash":"RwEqJye/2ebcc612170ef036b46bb2fb6c6cf0c7",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[135]||(n[135]=s("p",null,[a("Now compare this to this adjusted version where the custom property is registered as a "),s("code",null,"<number>"),a(":")],-1)),e(p,{user:"bramus","slug-hash":"WNPvvzm",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[136]||(n[136]=i(`<p>~</p><h3 id="combine-multiple-scroll-states-thanks-to-more-maths-1" tabindex="-1"><a class="header-anchor" href="#combine-multiple-scroll-states-thanks-to-more-maths-1"><span><a href="#more-scroll-states">#</a> Combine multiple scroll states, thanks to more Maths</span></a></h3><p>Thanks to some more basic maths, it‚Äôs possible to end up with a value of <code>1</code> in various scroll-cases.</p><p>For example, if you take the absolute value of <code>--scroll-direction</code> ‚Äì which is either <code>-1</code>, <code>0</code>, or <code>1</code> ‚Äì you end up with a value of <code>1</code> only when the user scrolling:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Furthermore, if you take that value, subtract <code>1</code> from it, and absolute the result, you end up with a value of <code>1</code> only when the user is not scrolling:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mix and match basic maths, <code>abs</code>, <code>min</code>, <code>max</code>, <code>clamp</code>, and you can end up with a value of <code>1</code> in any of these situations:</p><ul><li>When scrolling up or down</li><li>When not scrolling</li><li>When scrolling up</li><li>When scrolling down</li><li>When scrolling up or idle</li><li>When scrolling down or idle</li></ul><p>In code, it looks like this:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--when-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-up</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-down</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">--when-scrolling-down-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--when-scrolling-up-or-when-not-scrolling</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> - 1<span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Look at the examples below for some use-cases. Don‚Äôt forget to <a href="#cq-at-property">register these as a <code>&lt;number&gt;</code> if you want to use these in Style Queries</a>.</p><p>~</p><h4 id="demo-moving-header-1" tabindex="-1"><a class="header-anchor" href="#demo-moving-header-1"><span><a href="#demo-moving-header">#</a> Demo: Moving Header</span></a></h4><p>One example where you can use this is to hide the header and footer bars while the user is scrolling. This is done by translating the bars out the way in that case. For this, the code uses <code>--when-scrolling</code> ‚Äì which has a value of <code>1</code> when scrolling and a value of <code>0</code> when not scrolling ‚Äì as <a href="https://bram.us/2017/01/17/conditions-for-css-calculations/" target="_blank" rel="noopener noreferrer">the condition for the calculation</a>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">--hide-bars</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--when-scrolling<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">header</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> 0 <span class="token function">calc</span><span class="token punctuation">(</span>-90% * <span class="token function">var</span><span class="token punctuation">(</span>--hide-bars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">footer</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">translate</span><span class="token punctuation">:</span> 0 <span class="token function">calc</span><span class="token punctuation">(</span>90% * <span class="token function">var</span><span class="token punctuation">(</span>--hide-bars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The demo below requires Chrome with the Experimental Web Platform Features feature flag enabled.</p>`,17)),e(p,{user:"bramus","slug-hash":"dywzeoN/d4ee4fafdd7287701713d46e741ba94e",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[137]||(n[137]=i(`<p>üí≠ Initially I wanted to hide the header upon scrolling down or remaining idle after having scrolled down, and only show it again once starting to scroll up again. I couldn‚Äôt immediately find a solution here ‚Äì using <code>--when-scrolling-down-or-when-not-scrolling</code> also hides it on initial load, which is not what I want ‚Äì but I‚Äôm sure <a href="https://front-end.social/@johannes" target="_blank" rel="noopener noreferrer">Johannes</a> will be able to tell me how to do it using <a href="https://johannesodland.github.io/state/scroll-snap/scroll-driven-animations/2023/06/18/scroll-persisted-state.html" target="_blank" rel="noopener noreferrer">Scroll-Persisted State</a>.</p><p>It is possible to ‚Äúremember‚Äù the last scrolled direction by using a long <code>transition-delay</code>. See <a href="https://brm.us/hidey-bar" target="_blank" rel="noopener noreferrer">https://brm.us/hidey-bar</a> for details on how to use this.</p><p>~</p><h4 id="demo-directional-chicky-scroll-1" tabindex="-1"><a class="header-anchor" href="#demo-directional-chicky-scroll-1"><span><a href="#demo-directional-chicky-scroll">#</a> Demo: Directional Chicky Scroll</span></a></h4><p>When <a href="https://twitter.com/utilitybend" target="_blank" rel="noopener noreferrer">Brecht De Ruyte</a> <a href="https://utilitybend.com/blog/for-the-love-of-scroll-driven-animations-in-css" target="_blank" rel="noopener noreferrer">explored Scroll-Driven Animations back in February</a>, he built a demo where a little chicky walks across the screen as you scroll the page. While building that demo he noted that when scrolling up, the chicky is facing the wrong direction:</p><blockquote><p>The downside is that my animation seems to trigger a bit of moonwalking when scrolling back to top. Let‚Äôs just call it a feature for now, ok? üòâ</p></blockquote><p>With <code>--scroll-direction</code> available it‚Äôs pretty easy to flip the chicky in the other direction by passing that into <code>scaleX()</code>. However, when idling you‚Äôd end up with a <code>scaleX()</code> of <code>0</code> so to counter that I add <code>--when-not-scrolling</code> to the equation. By doing so, the <code>scaleX()</code> will also be <code>1</code> when idle, so the chicky will face forwards in that case.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> moveChicky</span> <span class="token punctuation">{</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>80px<span class="token punctuation">)</span> <span class="token function">scaleX</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-direction<span class="token punctuation">)</span> + <span class="token function">var</span><span class="token punctuation">(</span>--when-not-scrolling<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  ‚Ä¶</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The demo below requires Chrome with the Experimental Web Platform Features feature flag enabled.</p>`,9)),e(p,{user:"bramus","slug-hash":"LYMjgjB/1e36fc337fc5f703e84397f089fc017c",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[138]||(n[138]=i(`<p>~</p><h3 id="lerp-effects-1" tabindex="-1"><a class="header-anchor" href="#lerp-effects-1"><span><a href="#lerp-effects">#</a> LERP-effects</span></a></h3><p>Because there is a delay happening it‚Äôs possible to create typical LERP-effects. Below are a few demos that reproduce that.</p><p>üí° LERP = <a href="https://en.wikipedia.org/wiki/Linear_interpolation" target="_blank" rel="noopener noreferrer"><strong>L</strong>inear int<strong>ERP</strong>olation</a></p><p>~</p><h4 id="demo-lerp-reading-indicator-1" tabindex="-1"><a class="header-anchor" href="#demo-lerp-reading-indicator-1"><span><a href="#demo-lerp-reading-indicator">#</a> Demo: LERP Reading Indicator</span></a></h4><p>In this demo, the reading indicator catches up on the actual reading position. The code is easy, as it relies directly on <code>--scroll-position-delayed</code>.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">#progress</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)),e(p,{user:"bramus","slug-hash":"VwqJObR/7ef7eaaa78ad1382dbe5c5c4c5066989",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[139]||(n[139]=i(`<p>Compare the behavior of the demo above to <a href="https://scroll-driven-animations.style/demos/progress-bar/css/" target="_blank" rel="noopener noreferrer">this original version</a> whose reading indicator responds directly to the scroll position change.</p><p>~</p><h4 id="demo-lerp-scrolling-1" tabindex="-1"><a class="header-anchor" href="#demo-lerp-scrolling-1"><span><a href="#demo-lerp-scrolling">#</a> Demo: LERP Scrolling</span></a></h4><p>Recreating a LERP scrolling effect is a bit more difficult as you don‚Äôt want to recreate an entirely custom scroller from scratch ‚Äì These always end up in the <a href="https://en.wikipedia.org/wiki/Uncanny_valley" target="_blank" rel="noopener noreferrer">uncanny valley</a>. What I‚Äôve done in the demo below is added some fake drag to the scroll by translating the contents in the opposite scrolling direction.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.slider</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> adjust-pos linear both<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation-timeline</span><span class="token punctuation">:</span> <span class="token function">scroll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Hook animation onto self */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">.slider-item</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> --scroll-position-delayed 0.25s linear<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">--scroll-velocity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-position<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--scroll-position-delayed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--scroll-velocity<span class="token punctuation">)</span> * 500vh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Add some drag. Tweak the 500vh value to adjust how much drag */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5)),e(p,{user:"bramus","slug-hash":"GRPvqrN/1c39bc90ac0e08708933eb999c0941a8",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[140]||(n[140]=i('<p>The effect is not entirely perfect though. For example, when hitting the end of the scroller the <code>--scroll-position-delayed</code> is still getting delayed while it should skip forwards in that case.</p><p>~</p><h3 id="more-demos-1" tabindex="-1"><a class="header-anchor" href="#more-demos-1"><span><a href="#more-demos">#</a> More Demos</span></a></h3><p>I‚Äôm sure this technique will spark a lot of nice new demos. Here‚Äôs a few more that I‚Äôve built using this technique.</p><p>~</p><h4 id="demo-wormhole-1" tabindex="-1"><a class="header-anchor" href="#demo-wormhole-1"><span><a href="#demo-wormhole">#</a> Demo: Wormhole</span></a></h4><p>By nesting a bunch of boxes, you can see how the value of <code>--scroll-position-delayed</code> propagates from box to box. Add some translation + colors, and you get a wormhole effect.</p>',7)),e(p,{user:"bramus","slug-hash":"wvRqVBm/b4a25463d8c5315758802aba3e60b9ab",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[141]||(n[141]=i('<p>The demo also includes the code to respond to a horizontal delayed scroll.</p><p>~</p><h4 id="demo-badass-1" tabindex="-1"><a class="header-anchor" href="#demo-badass-1"><span><a href="#demo-badass">#</a> Demo: BADASS</span></a></h4><p>Back in 2017 I saw a nice scroll effect on <a href="https://badassfilms.tv/" target="_blank" rel="noopener noreferrer">the BADASS website</a>. The site is no longer up in that state, but thankfully <a href="https://bram.us/2017/10/15/badass/" target="_blank" rel="noopener noreferrer">my blog entry about it</a> also included a video of the effect, which I‚Äôve also embedded below:</p><figure><img src="https://bram.us/wordpress/wp-content/uploads/2017/10/badass_homepage_shoot_02.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Recording of the original</p><p>As I wrote back then:</p><blockquote><p>The effect is achieved by placing a duplicate (but clipped) list on top of another one, in combination with scroll velocity calculation to define the slant of the list.</p></blockquote><p>Recreating this effect is now perfectly possible with just CSS:</p><ul><li>Move the two lists across the screen as you scroll from top to bottom</li><li>Adjust the <code>clip-path</code> of the hotpink list as you scroll</li><li>Adjust the slant of the outlined list depending on the scroll speed and direction</li></ul><p>The difficult part here wasn‚Äôt to skew the list ‚Äì this was already done in the other demos ‚Äì but to get the <code>clip-path</code> working correctly. You can check the code for my calculations and comments.</p>',11)),e(p,{user:"bramus","slug-hash":"OJrxBaL/3069957ece86b0c8aafb4a249ff9271a",title:"CodePen Embed","default-tab":["css","result"],theme:l.dark},null,8,["theme"]),n[142]||(n[142]=i('<p>üé¨ Check a recording of this demo</p><p>Video Player</p><p><a href="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4" target="_blank" rel="noopener noreferrer">https://www.bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-050p.mp4</a></p><p>00:00</p><p>00:00</p><p>00:11</p><p>[Use Up/Down Arrow keys to increase or decrease volume.</p><p>](javascript:void(0)üòâ</p><p>Recording of the demo inspired upon the original animation oon the BADASS website.</p><p>~</p><h3 id="a-note-on-performance-1" tabindex="-1"><a class="header-anchor" href="#a-note-on-performance-1"><span><a href="#performance">#</a> A note on performance</span></a></h3><p>When doing a trace via Chrome DevTools you might notice that paint constantly gets triggered as you scroll.</p><figure><a href="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png" target="_blank" rel="noopener noreferrer"><img src="https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png" alt="" tabindex="0" loading="lazy"></a><figcaption></figcaption></figure><p>A Performance Trace in Chrome DevTools of the <a href="#demo-lerp-reading-indicator">LERP Reading Indicator Demo</a>, riddled with rendering Tasks</p><p>This is because Chrome ‚Äì and any other browser for that matter ‚Äì animates Custom Properties on the main thread. I have <a href="https://brm.us/animate-custom-properties" target="_blank" rel="noopener noreferrer">written about this problem space before</a>, and hope to see this fixed in the future. Star <a href="https://crbug.com/1411864" target="_blank" rel="noopener noreferrer">Chromium Issue #1411864</a> to stay in the loop.</p><p>~</p><h3 id="closing-thoughts-1" tabindex="-1"><a class="header-anchor" href="#closing-thoughts-1"><span><a href="#closing-thoughts">#</a> Closing Thoughts</span></a></h3><p>One of the features authors have asked about at the CSS Working Group is to expose current scrolling direction in CSS <em>(<a href="https://github.com/w3c/csswg-drafts/issues/6400" target="_blank" rel="noopener noreferrer">w3c/csswg-drafts#6400</a>)</em>. Not only does the technique described in this article offer an answer to that problem, it cranks it up a notch by also exposing the scrolling speed. While it‚Äôs not entirely perfect ‚Äì e.g. the scroll velocity can lag a bit on the actual situation ‚Äì it can already get you quite the distance.</p><p>Personally I think it is very exciting to see that Scroll-Driven Animations yet again <em>([<a href="https://kizu.dev/scroll-driven-animations/" target="_blank" rel="noopener noreferrer">1</a>], [<a href="https://johannesodland.github.io/state/scroll-snap/scroll-driven-animations/2023/06/18/scroll-persisted-state.html" target="_blank" rel="noopener noreferrer">2</a>], [<a href="https://kizu.dev/fit-to-width-text/" target="_blank" rel="noopener noreferrer">3</a>]. [<a href="https://bram.us/2023/06/26/faking-a-snapped-selector-with-scroll-driven-animations/" target="_blank" rel="noopener noreferrer">4</a>], [<a href="https://bram.us/2023/09/16/solved-by-css-scroll-driven-animations-detect-if-an-element-can-scroll-or-not/" target="_blank" rel="noopener noreferrer">5</a>], [<a href="https://kizu.dev/scroll-driven-state-transfer/" target="_blank" rel="noopener noreferrer">6</a>])</em> can be used for so much more than simply animating things as you scroll. I‚Äôm very much looking forward to more unconventional uses of this feature, unlocking some age-old requests ‚Ä¶</p>',19)),b(" TODO: add ARTICLE CARD "),e(u,d(h({title:"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed",desc:"Combine Scroll-Driven Animations with @‚Äãproperty, transition-delay, calc(), sign() and abs() ‚Ä¶ and you can do Scroll Detection using only CSS!",link:"https://chanhi2000.github.io/bookshelf/bram.us/css-scroll-detection.html",logo:"https://bramu.us/favicon.ico",background:"rgba(17,17,17,0.2)"})),null,16)])}const N=g(S,[["render",M]]),U=JSON.parse('{"path":"/bram.us/css-scroll-detection.html","title":"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed","lang":"en-US","frontmatter":{"lang":"en-US","title":"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed","description":"Article(s) > Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed","icon":"fa-brands fa-css3-alt","category":["CSS","Article(s)"],"tag":["blog","bram.us","css"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed\\",\\"image\\":[\\"https://bram.us/wordpress/wp-content/uploads/2017/10/badass_homepage_shoot_02.gif\\",\\"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png\\",\\"https://bram.us/wordpress/wp-content/uploads/2017/10/badass_homepage_shoot_02.gif\\",\\"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-custom-property-main-thread.png\\"],\\"datePublished\\":\\"2023-10-24T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Bramus!\\",\\"url\\":\\"https://bram.us/author/bramus/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/bram.us/css-scroll-detection.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"}],["meta",{"property":"og:description","content":"Article(s) > Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif"}],["meta",{"name":"twitter:image:alt","content":"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"}],["meta",{"property":"article:author","content":"Bramus!"}],["meta",{"property":"article:tag","content":"css"}],["meta",{"property":"article:tag","content":"bram.us"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2023-10-24T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"},{"property":"og:description","content":"Solved by CSS Scroll-Driven Animations: Style an element based on the active Scroll Direction and Scroll Speed"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/bram.us/css-scroll-detection.html"}]],"prev":"/programming/css/articles/README.md","date":"2023-10-24T00:00:00.000Z","isOriginal":false,"author":[{"name":"Bramus!","url":"https://bram.us/author/bramus/"}],"cover":"https://bram.us/wordpress/wp-content/uploads/2023/10/sda-badass-short-020p-10fps.gif"},"git":{},"readingTime":{"minutes":30.81,"words":9242},"filePathRelative":"bram.us/css-scroll-detection.md","copyright":{"author":"Bramus!"}}');export{N as comp,U as data};
