import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as s,f as t,b as o,a as h,t as b,n as u,g as r,w as p,e as a,r as i,o as f}from"./app-BItykJLQ.js";const w={},y={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},q={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},A={class:"table-of-contents"},S={href:"https://developer.chrome.com/blog/view-transitions-case-studies",target:"_blank",rel:"noopener noreferrer"},x={href:"https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/At-rules/@view-transition",target:"_blank",rel:"noopener noreferrer"},T={class:"hint-container note"},L={href:"https://merry-crostata-2cc36b.netlify.app/",target:"_blank",rel:"noopener noreferrer"},C={href:"https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API",target:"_blank",rel:"noopener noreferrer"},j={href:"https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event",target:"_blank",rel:"noopener noreferrer"},I={href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame",target:"_blank",rel:"noopener noreferrer"},M={href:"https://github.com/sunkanmii/view-transition-fallback.git",target:"_blank",rel:"noopener noreferrer"},D={href:"https://rad-malabi-08a79d.netlify.app/",target:"_blank",rel:"noopener noreferrer"},F={href:"https://celadon-kitten-df0ea7.netlify.app/",target:"_blank",rel:"noopener noreferrer"};function O(k,n){const c=i("VPCard"),l=i("router-link"),m=i("SiteInfo"),e=i("VPIcon"),d=i("RouteLink");return f(),g("div",null,[s("h1",y,[s("a",q,[s("span",null,b(k.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),t(c,u(r({title:"CSS > Article(s)",desc:"Article(s)",link:"/programming/css/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),t(c,u(r({title:"JavaScript > Article(s)",desc:"Article(s)",link:"/programming/js/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",A,[s("ul",null,[s("li",null,[t(l,{to:"#using-existing-apis-as-the-fallback"},{default:p(()=>[...n[0]||(n[0]=[a("Using existing APIs as the fallback",-1)])]),_:1}),s("ul",null,[s("li",null,[t(l,{to:"#html"},{default:p(()=>[...n[1]||(n[1]=[a("HTML",-1)])]),_:1})]),s("li",null,[t(l,{to:"#css"},{default:p(()=>[...n[2]||(n[2]=[a("CSS",-1)])]),_:1})]),s("li",null,[t(l,{to:"#javascript"},{default:p(()=>[...n[3]||(n[3]=[a("JavaScript",-1)])]),_:1})])])]),s("li",null,[t(l,{to:"#final-code"},{default:p(()=>[...n[4]||(n[4]=[a("Final code",-1)])]),_:1})])])]),n[51]||(n[51]=s("hr",null,null,-1)),t(m,{name:"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()",desc:"Look, we get it, your boss wants everything to work the same in every browser. We're all about progressive enhancement here but we know a lot of organisations don‚Äôt like working like that, so Sunkanmi is here to help you navigate implementing view transitions with that in mind.",url:"https://piccalil.li/blog/a-view-transitions-fallback-domcontentloaded-requestanimationframe",logo:"https://piccalil.li/favicons/favicon.ico",preview:"https://piccalil.b-cdn.net/api/og-image?slug=a-view-transitions-fallback-domcontentloaded-requestanimationframe/"}),s("p",null,[n[7]||(n[7]=a("View transitions came out in ",-1)),s("a",S,[t(e,{icon:"fa-brands fa-chrome"}),n[5]||(n[5]=a("2023, with Chrome announcing support for it in CSS",-1))]),n[8]||(n[8]=a(". In the past, it was difficult to implement this strategy (and it still can be). Thankfully, view transitions can be performed with a couple of instructions in CSS. ",-1)),t(d,{to:"/piccalil.li/start-implementing-view-transitions-on-your-websites-today.html"},{default:p(()=>[...n[6]||(n[6]=[s("strong",null,"Cyd wrote a great beginner‚Äôs guide",-1)])]),_:1}),n[9]||(n[9]=a(" to get you up to speed so I recommend you read that first if this is your first rodeo with view transitions.",-1))]),n[52]||(n[52]=o(`<p>https://iframe.mediadelivery.net/embed/468647/53975853-6013-4cdf-8694-b8aa50e8f3e2?autoplay=true&amp;loop=true&amp;muted=false&amp;preload=true&amp;responsive=true</p><p>The video above shows the smooth transition between home, about, and services. How am I doing this? I‚Äôm using the <code>@view-transition</code> at-rule, the <code>view-transition-name</code> property along with <code>::view-transition-old()</code> and <code>::view-transition-new()</code> pseudo-elements on each of the pages, making sure it transitions between page to page, but it‚Äôs best I show you the code:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token atrule"><span class="token rule">@view-transition</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">navigation</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">nav a.active</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">background</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">color</span><span class="token punctuation">:</span> #f5576c<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">view-transition-name</span><span class="token punctuation">:</span> active-link<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">h1</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">font-size</span><span class="token punctuation">:</span> 3.5rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">view-transition-name</span><span class="token punctuation">:</span> page-title<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">::view-transition-old(page-title),</span>
<span class="line">::view-transition-new(page-title)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation-duration</span><span class="token punctuation">:</span> 0.8s<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">::view-transition-old(active-link)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> 0.6s ease-out both fade-out<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">::view-transition-new(active-link)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> 0.6s ease-out both fade-in<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> fade-out</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">to</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> fade-in</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token selector">from</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),s("p",null,[n[12]||(n[12]=a("Notice how we used the ",-1)),s("a",x,[t(e,{icon:"fa-brands fa-firefox"}),n[10]||(n[10]=s("code",null,"@view-transition",-1)),n[11]||(n[11]=a(" at-rule",-1))]),n[13]||(n[13]=o("? This allows cross-page navigation from all pages, including <em>Home</em>, <em>About</em>, <em>Services</em> and <em>Contact</em>. The elements we wanted to apply our transitions to were on the anchor element <code>a</code> <em>only</em> when it‚Äôs active and the <code>h1</code> element. We gave both of them a view transition name using <code>view-transition-name</code> property, and these names were then used in the <code>::view-transition-old()</code> and <code>::view-transition-new()</code> properties with an animation for them both.",21))]),n[53]||(n[53]=s("p",null,[a("In fact, the only difference between the two animations we used for when they transition between pages is just the milliseconds with "),s("code",null,"active-link"),a(" being 600ms for the anchor elements and "),s("code",null,"page-title"),a(" being for just 800 milliseconds.")],-1)),s("div",T,[n[17]||(n[17]=s("p",{class:"hint-container-title"},"Check it out",-1)),s("p",null,[n[15]||(n[15]=a("You can see the demo in your browser ",-1)),s("a",L,[t(e,{icon:"fas fa-globe"}),n[14]||(n[14]=a("here",-1))]),n[16]||(n[16]=a(".",-1))]),t(c,u(r({title:"Home - View Transitions with Fallback",desc:"",link:"https://merry-crostata-2cc36b.netlify.app",logo:"https://merry-crostata-2cc36b.netlify.app/favicon.ico",background:"rgba(244,245,255,0.2)"})),null,16)]),s("p",null,[n[19]||(n[19]=a("Pretty simple, right? That‚Äôs right. It‚Äôs that easy to set up view transitions on your web pages with the ",-1)),s("a",C,[t(e,{icon:"fa-brands fa-firefox"}),n[18]||(n[18]=a("View Transition API",-1))]),n[20]||(n[20]=a(".",-1))]),n[54]||(n[54]=s("p",null,[a("Now, what if you want to implement fallbacks for older browsers and browsers that don‚Äôt support the View Transitions API? Well, that‚Äôs where this article comes in. In this article, we will implement a simple view transition fallback using the "),s("code",null,"DOMContentLoaded"),a(" + "),s("code",null,"requestAnimationFrame()")],-1)),n[55]||(n[55]=s("hr",null,null,-1)),n[56]||(n[56]=s("h2",{id:"using-existing-apis-as-the-fallback",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#using-existing-apis-as-the-fallback"},[s("span",null,"Using existing APIs as the fallback")])],-1)),s("p",null,[n[23]||(n[23]=a("There is one method I discovered during my research that you can use as a fallback for the View Transitions API, and this is the ",-1)),s("a",j,[t(e,{icon:"fa-brands fa-firefox"}),n[21]||(n[21]=s("code",null,"DOMContentLoaded",-1))]),n[24]||(n[24]=a(" + ",-1)),s("a",I,[t(e,{icon:"fa-brands fa-firefox"}),n[22]||(n[22]=s("code",null,"requestAnimationFrame",-1))]),n[25]||(n[25]=a(" .",-1))]),n[57]||(n[57]=o(`<p>This particular event fires a specific function once the HTML content and deferred scripts, such as <code>&lt;script defer src=&quot;&quot; ../&gt;</code> or <code>&lt;script type=&quot;module&quot;/&gt;</code> have been parsed. Using this method allows us to control what happens when our HTML content is parsed and loaded, but the goal here is to transition from one page, right?</p><p>That‚Äôs where the <code>requestAnimationFrame()</code> comes in. The <code>requestAnimationFrame()</code> function instructs the browser that you wish to perform an animation, and in our case, the animation starts once our HTML content has been loaded using <code>DOMContentLoad</code> on the <code>document</code> object.</p><p>We‚Äôre going to be focusing on a simple demo to illustrate this, or this article would be exceedingly long. A challenge from me to you is to see if you can expand your learning into something higher fidelity like the original demo.</p><p>Let me show you the code:</p><h3 id="html" tabindex="-1"><a class="header-anchor" href="#html"><span>HTML</span></a></h3><div class="code-block-with-title"><div class="code-block-title-bar" data-title="index.html"><span>index.html</span></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My demo site<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Try navigating to About. This uses a pure JS/CSS fallback transition.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mainCard<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Welcome to the index page.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>about.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Go to About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>`,6)),s("p",null,[n[26]||(n[26]=a("In our ",-1)),t(e,{icon:"fa-brands fa-html5"}),n[27]||(n[27]=s("code",null,"index.html",-1)),n[28]||(n[28]=a(" page, our HTML is pretty simple and I‚Äôll start with the important stuff.",-1))]),n[58]||(n[58]=o("<p>First, we create a <code>&lt;h1&gt;</code> in the <code>&lt;header&gt;</code> tag with a short paragraph (<code>&lt;p&gt;</code>). This is important because in this demo, we‚Äôre going to transition to-and-fro, from one page to another, and the <code>&lt;h1&gt;</code> would have a little animation, so we‚Äôre going to give the <code>&lt;header&gt;</code> and <code>&lt;h1&gt;</code> tags a <code>.reveal</code> class. We‚Äôre also going to give use the <code>.reveal</code> class on the <code>&lt;main&gt;</code> tag as well. The reason for this is that these are the targeted elements for page transitions.</p>",1)),s("p",null,[n[29]||(n[29]=a("Inside our ",-1)),n[30]||(n[30]=s("code",null,"<main>",-1)),n[31]||(n[31]=a(", we have a welcome text and links to the ",-1)),t(e,{icon:"fa-brands fa-html5"}),n[32]||(n[32]=s("code",null,"about.html",-1)),n[33]||(n[33]=a(" page. This is important because, where do we want to route to if not? ü§∑üèæ‚Äç‚ôÇÔ∏è",-1))]),s("p",null,[n[34]||(n[34]=a("For our ",-1)),t(e,{icon:"fa-brands fa-html5"}),n[35]||(n[35]=s("code",null,"about.html",-1)),n[36]||(n[36]=a(" page, we have something quite similar.",-1))]),n[59]||(n[59]=o(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="about.html"><span>about.html</span></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>‚óÄ Back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>About this demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This page demonstrates the lightweight fallback animation system without pagereveal or the View Transitions API.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The <code>.reveal</code> class is applied to both the anchor tag (<code>&lt;a&gt;</code>) and the section tag (<code>&lt;section&gt;</code>). We have a little <code>&lt;h2&gt;</code> and <code>&lt;p&gt;</code> tag there too, but let‚Äôs just acknowledge those and move on for now..</p><p>Let‚Äôs head to the CSS section, where it‚Äôs the most fun (bias alert).</p><h3 id="css" tabindex="-1"><a class="header-anchor" href="#css"><span>CSS</span></a></h3><p>One thing I love about CSS is its ever-evolving nature; however, CSS evolving at a good and steady pace can make it hard for major and old browsers to catch up to its speed. That‚Äôs why we have our transitions here to ‚Äî in essence ‚Äî <em>replace</em> our view transitions, <em>just in case</em> the browser doesn‚Äôt support them. I‚Äôm pasting the whole CSS section because, well, it ain‚Äôt much at all.</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token comment">/* Leave this commented for now */</span></span>
<span class="line"><span class="token comment">/* @view-transition {</span>
<span class="line">  navigation: auto;</span>
<span class="line">} */</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">font-family</span><span class="token punctuation">:</span> system-ui<span class="token punctuation">,</span> Arial<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">padding</span><span class="token punctuation">:</span> 3rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* links */</span></span>
<span class="line"><span class="token selector">a</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">margin</span><span class="token punctuation">:</span> .5rem 0<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* card + header styling */</span></span>
<span class="line"><span class="token selector">header</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .45s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">.card</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">padding</span><span class="token punctuation">:</span> 1.2rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 4px 12px <span class="token function">rgba</span><span class="token punctuation">(</span>0 0 0 / 0.06<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">background</span><span class="token punctuation">:</span> #fffff<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Incoming animation  */</span></span>
<span class="line"><span class="token selector">.reveal</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>12px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">.reveal.visible</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Outgoing animation */</span></span>
<span class="line"><span class="token selector">html.leaving .reveal</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-12px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>What‚Äôs important is actually these specific lines of code:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token comment">/* Leave this for now */</span></span>
<span class="line"><span class="token comment">/* @view-transition {</span>
<span class="line">  navigation: auto;</span>
<span class="line">} */</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Incoming animation  */</span></span>
<span class="line"><span class="token selector">.reveal</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>12px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">.reveal.visible</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Outgoing animation */</span></span>
<span class="line"><span class="token selector">html.leaving .reveal</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-12px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I commented out the lines for our <code>@view-transition</code> block because I don‚Äôt want it to work right now. Let‚Äôs focus on the fallback first.</p>`,9)),s("p",null,[n[38]||(n[38]=a("Before that, what happens when JS fails, though? That‚Äôs where ",-1)),t(d,{to:"/piccalil.li/its-about-time-i-tried-to-explain-what-progressive-enhancement-actually-is.html"},{default:p(()=>[...n[37]||(n[37]=[s("strong",null,"progressive enhancement",-1)])]),_:1}),n[39]||(n[39]=a(" comes in, and it‚Äôs a technique we can use to ensure works for everyone by adding a class that nullifies every animation, delivering a more standard page transition (instant), just in case JS fails.",-1))]),n[60]||(n[60]=o(`<p>Add a <code>.default</code> CSS class just above the <code>.reveal</code> class that nullifies the animation and just keeps everything static:</p><div class="language-css line-numbers-mode" data-highlighter="prismjs" data-ext="css"><pre><code class="language-css"><span class="line"><span class="token selector">.default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Incoming animation  */</span></span>
<span class="line"><span class="token selector">.reveal</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>12px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">transition</span><span class="token punctuation">:</span> all .8s ease<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And make sure to add the <code>.default</code> CSS class to all your HTML elements that have <code>.reveal</code> right before <code>.reveal</code> :</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="index.html"><span>index.html</span></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>‚óÄ Back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> // HIGHTLIGHT 5</span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> // HIGHLIGHT 5</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>About this demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This page demonstrates the lightweight fallback animation system without pagereveal or the View Transitions API.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="code-block-with-title"><div class="code-block-title-bar" data-title="about.html"><span>about.html</span></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default reveal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reveal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My demo site<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Try navigating to About. This uses a pure JS/CSS fallback transition.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default card reveal<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mainCard<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Welcome to the index page.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>about.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Go to About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Now, back to our fallback. Notice how the <code>.reveal</code> class has an opacity value of <code>0</code> , translates 12 pixels on the Y-axis, and has a transition on it? Well, that‚Äôs because we want the initial state to be just that. Then, we apply the <code>.visible</code> class to have an <code>opacity</code> of <code>1</code> and it translates back to 0 pixels on the Y-axis.</p><p>That way, when the element reveal class is applied at load time, it animates to-and-fro from 12 pixels on the Y-axis of the screen to 0. Lastly, we have the <code>.leaving</code> class on the <code>html</code> root element when the <code>.reveal</code> class is toggled on the element to set the <code>opacity</code> back to <code>0</code> and have the whole HTML children translate -12 pixels on the Y-axis when it‚Äôs leaving. If not, it would look like this:</p><p>Stale at a point, right? Particularly when loading the next page. That‚Äôs what we‚Äôre trying to avoid. The animation should flow smoothly and not like we forced animations to the page. Now, the icing on our CSS cake is our JavaScript, which handles the hard logic to make this all work; in fact, it‚Äôs why we‚Äôre here in the first place.</p><h3 id="javascript" tabindex="-1"><a class="header-anchor" href="#javascript"><span>JavaScript</span></a></h3><p>The JavaScript is pretty straightforward:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">const</span> allAnchors <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  allAnchors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">anchor</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    anchor<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">      <span class="token comment">// stop default link behavior</span></span>
<span class="line">      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// let animation begin, then navigate</span></span>
<span class="line">      document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;leaving&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> anchor<span class="token punctuation">.</span>href<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// incoming animation (DOMContentLoaded + rAF)</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> els <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.reveal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      els<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;visible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> reveal<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, let‚Äôs break down this super-simple method using <code>DOMContentLoaded</code> &amp; <code>requestAnimationFrame</code> . We first remove the <code>.default</code> class once JS loads because we don‚Äôt need that anymore and listen for a <code>click</code> event on all the anchor tags (<code>&lt;a&gt;</code>) using the <code>addEventListener()</code> function, get the anchor element using <code>anchor</code> variable and prevent its default behaviour using the <code>preventDefault()</code> function.</p><p>This is where it gets interesting.</p><p>You know how we need the page to have an exit animation? Well, that‚Äôs where the next line of code comes in:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;leaving&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This line of code adds the <code>leaving</code> class to the <code>html</code> element when it is leaving for another page, which gives off the illusion of a transition, then we only tell the window where the link is going after 250 milliseconds. The reason for this delay is that we want the exit animation to play out fully before the next page loads. In fact, without this, the document would not load.</p><p>This isn‚Äôt a perfect solution, <em>to be honest</em>, but it‚Äôs worth having in case your browser doesn‚Äôt support view transitions, so users who lack it would have a little experience of what and how it would be like.</p><p>Here‚Äôs where it all comes full circle:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">reveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> els <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.reveal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    els<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;visible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> reveal<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You know how we mentioned the <code>DOMContentLoaded</code> at the start? Yeah, this is where the main magic happens. We call <code>requestAnimationFrame</code> for each element that has the <code>.reveal</code> class, wrapping it into a function called <code>reveal()</code> . This function would then be used when the document loads and <code>DOMContentLoaded</code> fires this function for us just one time. And that‚Äôs the basic gist of it.</p><p>Here‚Äôs the final result!</p><hr><h2 id="final-code" tabindex="-1"><a class="header-anchor" href="#final-code"><span>Final code</span></a></h2><p>Remember how we commented out <code>@view-transition</code> at the start? Well, you can uncomment it out and paste this code above the query selector for the anchor element to ensure the View Transition API detection is live. If it‚Äôs present, we remove the <code>.reveal</code> class and go with view transition, if not, it defaults to the <code>DOMContentLoaded</code> + <code>requestAnimationFrame()</code> solution:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>startViewTransition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ViewTransition supported ‚Äî skipping JS fallback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.reveal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;reveal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> allAnchors <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is what it would look like in Chrome that supports View Transitions:</p>`,26)),s("p",null,[n[45]||(n[45]=a("To get the full code, visit ",-1)),s("a",M,[n[40]||(n[40]=a("this Github repo (",-1)),t(e,{icon:"iconfont icon-github"}),n[41]||(n[41]=s("code",null,"sunkanmii/view-transition-fallback.git",-1)),n[42]||(n[42]=a(")",-1))]),n[46]||(n[46]=a(". Here‚Äôs a ",-1)),s("a",D,[t(e,{icon:"fas fa-globe"}),n[43]||(n[43]=a("Netlify demo link to the with @view-transition and fallback",-1))]),n[47]||(n[47]=a(" and here‚Äôs a ",-1)),s("a",F,[t(e,{icon:"fas fa-globe"}),n[44]||(n[44]=a("demo link to the project",-1))]),n[48]||(n[48]=a(" with just the fallback. Although this method works super well, ",-1)),n[49]||(n[49]=s("strong",null,"always consider and fight for progressive enhancement first",-1)),n[50]||(n[50]=a(".",-1))]),n[61]||(n[61]=s("p",null,[a("Support for view transitions is improving "),s("em",null,"fast"),a(" too. This approach is handy, however, if your boss/client is demanding that everything behaves the same in every browser ‚Äî which I know is very common ‚Äî even "),s("em",null,"now,"),a(" leaning into progressive enhancement as a policy will always put you on a stronger footing for the long term.")],-1)),n[62]||(n[62]=s("hr",null,null,-1)),h(" TODO: add ARTICLE CARD "),t(c,u(r({title:"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()",desc:"Look, we get it, your boss wants everything to work the same in every browser. We're all about progressive enhancement here but we know a lot of organisations don‚Äôt like working like that, so Sunkanmi is here to help you navigate implementing view transitions with that in mind.",link:"https://chanhi2000.github.io/bookshelf/piccalil.li/a-view-transitions-fallback-domcontentloaded-requestanimationframe.html",logo:"https://piccalil.li/favicons/favicon.ico",background:"rgba(253,208,0,0.2)"})),null,16)])}const H=v(w,[["render",O]]),W=JSON.parse('{"path":"/piccalil.li/a-view-transitions-fallback-domcontentloaded-requestanimationframe.html","title":"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()","lang":"en-US","frontmatter":{"lang":"en-US","title":"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()","description":"Article(s) > A view transitions fallback: DOMContentLoaded + requestAnimationFrame()","icon":"fa-brands fa-css3-alt","category":["CSS","JavaScript","Article(s)"],"tag":["blog","piccalil.li","css","js","javascript"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()\\",\\"image\\":[\\"https://piccalil.b-cdn.net/api/og-image?slug=a-view-transitions-fallback-domcontentloaded-requestanimationframe/\\"],\\"datePublished\\":\\"2025-12-05T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Sunkanmi Fafowora\\",\\"url\\":\\"https://piccalil.li/author/sunkanmi-fafowora\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/piccalil.li/a-view-transitions-fallback-domcontentloaded-requestanimationframe.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()"}],["meta",{"property":"og:description","content":"Article(s) > A view transitions fallback: DOMContentLoaded + requestAnimationFrame()"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://piccalil.b-cdn.net/api/og-image?slug=a-view-transitions-fallback-domcontentloaded-requestanimationframe/"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://piccalil.b-cdn.net/api/og-image?slug=a-view-transitions-fallback-domcontentloaded-requestanimationframe/"}],["meta",{"name":"twitter:image:alt","content":"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()"}],["meta",{"property":"article:author","content":"Sunkanmi Fafowora"}],["meta",{"property":"article:tag","content":"javascript"}],["meta",{"property":"article:tag","content":"js"}],["meta",{"property":"article:tag","content":"css"}],["meta",{"property":"article:tag","content":"piccalil.li"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-12-05T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > A view transitions fallback: DOMContentLoaded + requestAnimationFrame()"},{"property":"og:description","content":"A view transitions fallback: DOMContentLoaded + requestAnimationFrame()"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/piccalil.li/a-view-transitions-fallback-domcontentloaded-requestanimationframe.html"}]],"prev":"/programming/css/articles/README.md","date":"2025-12-05T00:00:00.000Z","isOriginal":false,"author":[{"name":"Sunkanmi Fafowora","url":"https://piccalil.li/author/sunkanmi-fafowora"}],"cover":"https://piccalil.b-cdn.net/api/og-image?slug=a-view-transitions-fallback-domcontentloaded-requestanimationframe/"},"git":{},"readingTime":{"minutes":8.71,"words":2614},"filePathRelative":"piccalil.li/a-view-transitions-fallback-domcontentloaded-requestanimationframe.md","copyright":{"author":"Sunkanmi Fafowora"}}');export{H as comp,W as data};
