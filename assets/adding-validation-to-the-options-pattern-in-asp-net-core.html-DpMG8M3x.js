import{_ as g}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as t,b as l,t as m,n as v,g as k,w as i,e as a,r as p,o as b}from"./app-BVguHYKu.js";const y={},f={id:"frontmatter-title-관련",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-관련"},T={class:"table-of-contents"},S={href:"https://youtu.be/wxYt0motww0",target:"_blank",rel:"noopener noreferrer"},A={href:"https://youtu.be/wxYt0motww0",target:"_blank",rel:"noopener noreferrer"},I={href:"https://youtu.be/qRruEdjNVNE",target:"_blank",rel:"noopener noreferrer"};function O(r,n){const u=p("VPCard"),e=p("router-link"),d=p("SiteInfo"),o=p("VPIcon"),c=p("VidStack");return b(),h("div",null,[s("h1",f,[s("a",w,[s("span",null,m(r.$frontmatter.title)+" 관련",1)])]),t(u,v(k({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",T,[s("ul",null,[s("li",null,[t(e,{to:"#strongly-typed-configuration"},{default:i(()=>n[0]||(n[0]=[a("Strongly Typed Configuration")])),_:1,__:[0]})]),s("li",null,[t(e,{to:"#what-could-go-wrong"},{default:i(()=>n[1]||(n[1]=[a("What Could Go Wrong?")])),_:1,__:[1]})]),s("li",null,[t(e,{to:"#validation-for-the-options-pattern"},{default:i(()=>n[2]||(n[2]=[a("Validation For The Options Pattern")])),_:1,__:[2]})]),s("li",null,[t(e,{to:"#running-validation-at-application-start"},{default:i(()=>n[3]||(n[3]=[a("Running Validation At Application Start")])),_:1,__:[3]})]),s("li",null,[t(e,{to:"#closing-thoughts"},{default:i(()=>n[4]||(n[4]=[a("Closing Thoughts")])),_:1,__:[4]})])])]),n[28]||(n[28]=s("hr",null,null,-1)),t(d,{name:"Adding Validation To The Options Pattern In ASP.NET Core",desc:"In this week's newsletter I will show you how to easily add validation the strongly-typed configuration objects injected with IOptions. The Options pattern allows us to use classes to provide strongly-typed configuration values in our application at runtime. But you have no guarantee that the configuration values injected with IOptions will be correctly read from the application settings. Let's see how we can introduce validation for our IOptions and make sure the application settings are correct.",url:"https://milanjovanovic.tech/blog/adding-validation-to-the-options-pattern-in-asp-net-core/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_019.png"}),n[29]||(n[29]=l(`<p>In this week&#39;s newsletter I will show you how to easily add <strong>validation</strong> to the strongly typed configuration objects injected with <code>IOptions</code>.</p><p>The <strong>Options pattern</strong> allows us to use classes to provide strongly typed configuration values in our application at runtime.</p><p>But you have no guarantee that the configuration values injected with <code>IOptions</code> will be correctly read from the application settings.</p><p>Let&#39;s see how we can introduce validation for <code>IOptions</code>, and make sure the application settings are correct.</p><hr><h2 id="strongly-typed-configuration" tabindex="-1"><a class="header-anchor" href="#strongly-typed-configuration"><span>Strongly Typed Configuration</span></a></h2><p>I first want to define a simple class that will represent our strongly typed configuration. Let&#39;s say we want to integrate with the <strong>GitHub API</strong>, so we create a <code>GitHubSettings</code> class to hold our configuration:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GitHubSettings</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> AccessToken <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> RepositoryName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)),s("p",null,[n[5]||(n[5]=a("Inside of our ")),t(o,{icon:"iconfont icon-json"}),n[6]||(n[6]=s("code",null,"appsettings.json",-1)),n[7]||(n[7]=a(" file we need to create a section to hold our configuration values:"))]),n[30]||(n[30]=l(`<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token property">&quot;GitHubSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;AccessToken&quot;</span><span class="token operator">:</span> <span class="token string">&quot;access-token-value&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;RepositoryName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;youtube-projects&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And with this in place, we can configure our <code>GitHubSettings</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GitHubSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">    builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;GitHubSettings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, our <code>GitHubSettings</code> is properly configured and we can inject it with <code>IOptions&lt;GitHubSettings&gt;</code>.</p><hr><h2 id="what-could-go-wrong" tabindex="-1"><a class="header-anchor" href="#what-could-go-wrong"><span>What Could Go Wrong?</span></a></h2><p>If we leave the implementation like this, we&#39;re moving the responsibility for providing the correct configuration values to the developer. I&#39;m not saying we are the problem, but I&#39;ve forgotten to add application settings a few times. I&#39;m sure this happened to you also.</p><p>Here are just a few things that can go wrong:</p>`,8)),s("ul",null,[n[10]||(n[10]=s("li",null,[a("Passing an incorrect section name to "),s("code",null,"IConfiguration.GetSection")],-1)),s("li",null,[n[8]||(n[8]=a("Forgetting to add the settings values in ")),t(o,{icon:"iconfont icon-json"}),n[9]||(n[9]=s("code",null,"appsettings.json",-1))]),n[11]||(n[11]=s("li",null,"Typo in a property name in the class or in the configuration",-1)),n[12]||(n[12]=s("li",null,"Unbindale properties without a setter",-1)),n[13]||(n[13]=s("li",null,"Data type mismatch resulting in incompatible values",-1))]),n[31]||(n[31]=l(`<p>Depending on which one of these mistakes is made, the application will behave differently at runtime.</p><p>The best case scenario is that the incorrect application settings cause a runtime exception, and you realize you have a problem and fix it.</p><p>The worst case scenario, and this happens more often than you may think, is that the application silently fails. The application settings aren&#39;t correctly set on the value provided by <code>IOptions</code>, but you don&#39;t get a runtime exception. The problem may go undetected for some time.</p><p>How do we solve this?</p><hr><h2 id="validation-for-the-options-pattern" tabindex="-1"><a class="header-anchor" href="#validation-for-the-options-pattern"><span>Validation For The Options Pattern</span></a></h2><p>There is a simple way to introduce <strong>validation</strong> to the settings class using <strong>data annotations</strong>. We just add the validation attributes that we need to the properties of the settings class.</p><p>For example, we can add the <code>Required</code> attribute to the <code>GitHubSettings</code> properties:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GitHubSettings</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> AccessToken <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> RepositoryName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We have to slightly change how we configure the <code>GitHubSettings</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services</span>
<span class="line">    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOptions</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GitHubSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">BindConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;GitHubSettings&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ValidateDataAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A few things to note here:</p><ul><li><code>AddOptions</code> - returns an <code>OptionsBuilder&lt;TOptions&gt;</code> that binds to the <code>GitHubSettings</code> class</li><li><code>BindConfiguration</code> - binds the values from the configuration section</li><li><code>ValidateDataAnnotations</code> - enables <strong>validation</strong> using <strong>data annotations</strong></li></ul><p>With this in place, if we try to inject <code>GitHubSettings</code> with any of the properties missing a value, we will get a runtime exception.</p><p>You can also define a <strong>custom delegate</strong> for the <strong>validation</strong> logic, instead of using data annotations:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services</span>
<span class="line">    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOptions</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GitHubSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">BindConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;GitHubSettings&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>gitHubSettings <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>gitHubSettings<span class="token punctuation">.</span>AccessToken<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="running-validation-at-application-start" tabindex="-1"><a class="header-anchor" href="#running-validation-at-application-start"><span>Running Validation At Application Start</span></a></h2><p>It would be great if we could run <strong>validation</strong> on the configuration values when our application is starting, instead of at runtime.</p><p>We can do that by calling <code>ValidateOnStart</code> method when configuring our settings class:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services</span>
<span class="line">    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOptions</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GitHubSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">BindConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;GitHubSettings&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ValidateDataAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ValidateOnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 👈 the magic happens here</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When we start the application, the validation will run on <code>GitHubSettings</code> and an exception is thrown if validation fails. The validation exception will look something like this:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Unhandled exception. Microsoft.Extensions.Options.OptionsValidationException</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">DataAnnotation validation failed for &#39;GitHubSettings&#39; members</span><span class="token punctuation">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>This shortens the feedback loop, and you will know right away that you have a problem. This is much better than finding out that you have a problem at runtime, like in the previous examples.</p><hr><h2 id="closing-thoughts" tabindex="-1"><a class="header-anchor" href="#closing-thoughts"><span>Closing Thoughts</span></a></h2><p>The <strong>Options pattern</strong> is very flexible and allows us to use strongly typed settings in ASP.NET Core.</p>`,27)),s("p",null,[n[16]||(n[16]=a("If you want to see how to implement the ")),s("a",S,[t(o,{icon:"fa-brands fa-youtube"}),n[14]||(n[14]=s("strong",null,"Options pattern",-1))]),n[17]||(n[17]=a(", I made a ")),s("a",A,[t(o,{icon:"fa-brands fa-youtube"}),n[15]||(n[15]=s("strong",null,"video about it where I go into the details.",-1))]),n[18]||(n[18]=a(" I covered the differences between ")),n[19]||(n[19]=s("code",null,"IOptions",-1)),n[20]||(n[20]=a(", ")),n[21]||(n[21]=s("code",null,"IOptionsSnapshot",-1)),n[22]||(n[22]=a(" and ")),n[23]||(n[23]=s("code",null,"IOptionsMonitor",-1)),n[24]||(n[24]=a("."))]),t(c,{src:"youtube/wxYt0motww0"}),n[32]||(n[32]=s("p",null,[a("And now you know how to use the "),s("code",null,"ValidateOnStart"),a(" method, which was introduced in "),s("strong",null,".NET 6"),a(", to validate your application settings on app start up. This allows you to learn about configuration issues as soon as possible, instead of at runtime.")],-1)),s("p",null,[n[26]||(n[26]=a("I also made a video showing how to add ")),s("a",I,[t(o,{icon:"fa-brands fa-youtube"}),n[25]||(n[25]=a("validation to the Option pattern"))]),n[27]||(n[27]=a("."))]),t(c,{src:"youtube/qRruEdjNVNE"})])}const V=g(y,[["render",O]]),x=JSON.parse('{"path":"/milanjovanovic.tech/adding-validation-to-the-options-pattern-in-asp-net-core.html","title":"Adding Validation To The Options Pattern In ASP.NET Core","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Adding Validation To The Options Pattern In ASP.NET Core","description":"Article(s) > Adding Validation To The Options Pattern In ASP.NET Core","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Adding Validation To The Options Pattern In ASP.NET Core\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_019.png\\"],\\"datePublished\\":\\"2023-01-07T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanović\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/adding-validation-to-the-options-pattern-in-asp-net-core.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Adding Validation To The Options Pattern In ASP.NET Core"}],["meta",{"property":"og:description","content":"Article(s) > Adding Validation To The Options Pattern In ASP.NET Core"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_019.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_019.png"}],["meta",{"name":"twitter:image:alt","content":"Adding Validation To The Options Pattern In ASP.NET Core"}],["meta",{"property":"article:author","content":"Milan Jovanović"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2023-01-07T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Adding Validation To The Options Pattern In ASP.NET Core"},{"property":"og:description","content":"Adding Validation To The Options Pattern In ASP.NET Core"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/adding-validation-to-the-options-pattern-in-asp-net-core.html"}]],"prev":"/programming/cs/articles/README.md","date":"2023-01-07T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanović","cover":"https://milanjovanovic.tech/blog-covers/mnw_019.png"},"git":{},"readingTime":{"minutes":3.56,"words":1067},"filePathRelative":"milanjovanovic.tech/adding-validation-to-the-options-pattern-in-asp-net-core.md","copyright":{"author":"Milan Jovanović"}}');export{V as comp,x as data};
