import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as s,f as t,b as i,a as f,t as v,n as d,g as k,w as e,e as a,r,o as w}from"./app-BVguHYKu.js";const y={},b={id:"frontmatter-title-관련",tabindex:"-1"},S={class:"header-anchor",href:"#frontmatter-title-관련"},x={class:"table-of-contents"},T={href:"https://tanstack.com/start/latest",target:"_blank",rel:"noopener noreferrer"},q={href:"https://tanstack.com/router/latest",target:"_blank",rel:"noopener noreferrer"},j={class:"hint-container note"},I={href:"https://astro.build/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://svelte.dev/tutorial/kit/universal-load-functions",target:"_blank",rel:"noopener noreferrer"},C={class:"hint-container info"},A={href:"https://github.com/arackaf/tanstack-start-blog-dataloading",target:"_blank",rel:"noopener noreferrer"},L={href:"https://tanstack.com/router/latest/docs/framework/react/start/getting-started",target:"_blank",rel:"noopener noreferrer"},z={href:"https://github.com/TanStack/router/blob/main/examples%2Freact%2Fstart-basic-react-query%2Fapp%2Frouter.tsx",target:"_blank",rel:"noopener noreferrer"},W={href:"https://tanstack.com/router/latest/docs/framework/react/start/server-functions",target:"_blank",rel:"noopener noreferrer"},N={href:"https://github.com/nksaraf/vinxi",target:"_blank",rel:"noopener noreferrer"},O={href:"https://tanstack.com/router/latest/docs/framework/react/start/server-functions",target:"_blank",rel:"noopener noreferrer"},B={href:"https://tanstack.com/router/latest/docs/framework/react/api/router/awaitComponent#await-component",target:"_blank",rel:"noopener noreferrer"},P={href:"https://tanstack.com/start/latest",target:"_blank",rel:"noopener noreferrer"};function D(m,n){const c=r("VPCard"),o=r("router-link"),u=r("SiteInfo"),p=r("VPIcon"),l=r("RouteLink");return w(),g("div",null,[s("h1",b,[s("a",S,[s("span",null,v(m.$frontmatter.title)+" 관련",1)])]),t(c,d(k({title:"React.js > Article(s)",desc:"Article(s)",link:"/programming/js-react/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",x,[s("ul",null,[s("li",null,[t(o,{to:"#why-server-rendering"},{default:e(()=>n[0]||(n[0]=[a("Why Server Rendering?")])),_:1,__:[0]}),s("ul",null,[s("li",null,[t(o,{to:"#server-side-rendering"},{default:e(()=>n[1]||(n[1]=[a("Server Side Rendering")])),_:1,__:[1]})]),s("li",null,[t(o,{to:"#streaming"},{default:e(()=>n[2]||(n[2]=[a("Streaming")])),_:1,__:[2]})]),s("li",null,[t(o,{to:"#why-did-we-ever-do-client-rendering"},{default:e(()=>n[3]||(n[3]=[a("Why did we ever do client-rendering?")])),_:1,__:[3]})])])]),s("li",null,[t(o,{to:"#why-is-tanstack-start-different"},{default:e(()=>n[4]||(n[4]=[a("Why is TanStack Start different?")])),_:1,__:[4]}),s("ul",null,[s("li",null,[t(o,{to:"#an-impedance-mismatch-is-born"},{default:e(()=>n[5]||(n[5]=[a("An Impedance Mismatch is Born")])),_:1,__:[5]})]),s("li",null,[t(o,{to:"#where-to-from-here"},{default:e(()=>n[6]||(n[6]=[a("Where to, from here?")])),_:1,__:[6]})]),s("li",null,[t(o,{to:"#how-much-does-it-matter"},{default:e(()=>n[7]||(n[7]=[a("How much does it matter?")])),_:1,__:[7]})]),s("li",null,[t(o,{to:"#isomorphic-loaders"},{default:e(()=>n[8]||(n[8]=[a("Isomorphic Loaders")])),_:1,__:[8]})])])]),s("li",null,[t(o,{to:"#tanstack-start"},{default:e(()=>n[9]||(n[9]=[a("TanStack Start")])),_:1,__:[9]}),s("ul",null,[s("li",null,[t(o,{to:"#loading-data"},{default:e(()=>n[10]||(n[10]=[a("Loading Data")])),_:1,__:[10]})]),s("li",null,[t(o,{to:"#streaming-1"},{default:e(()=>n[11]||(n[11]=[a("Streaming")])),_:1,__:[11]})])])]),s("li",null,[t(o,{to:"#react-query"},{default:e(()=>n[12]||(n[12]=[a("React Query")])),_:1,__:[12]}),s("ul",null,[s("li",null,[t(o,{to:"#streaming-with-react-query"},{default:e(()=>n[13]||(n[13]=[a("Streaming with react-query")])),_:1,__:[13]})])])]),s("li",null,[t(o,{to:"#parting-thoughts"},{default:e(()=>n[14]||(n[14]=[a("Parting Thoughts")])),_:1,__:[14]})])])]),n[78]||(n[78]=s("hr",null,null,-1)),t(u,{name:"Introducing TanStack Start",desc:"TanStack Start enhances the TanStack Router by adding a server layer that improves performance through server-side rendering (SSR) and isomorphic loaders.",url:"https://frontendmasters.com/blog/introducing-tanstack-start/",logo:"https://frontendmasters.com/favicon.ico",preview:"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/4810"}),s("p",null,[n[18]||(n[18]=a("The best way to think about")),s("a",T,[t(p,{icon:"fas fa-globe"}),n[15]||(n[15]=a("TanStack Start"))]),n[19]||(n[19]=a("is that it’s a thin server layer atop the")),s("a",q,[t(p,{icon:"fas fa-globe"}),n[16]||(n[16]=a("TanStack Router"))]),n[20]||(n[20]=a("we")),t(l,{to:"/frontendmasters.com/introducing-tanstack-router.html"},{default:e(()=>n[17]||(n[17]=[s("strong",null,"already know and love",-1)])),_:1,__:[17]}),n[21]||(n[21]=a("; that means we don’t lose a single thing from TanStack Router. Not only that, but the nature of this server layer allows it to side-step the pain points other web meta-frameworks suffer from."))]),n[79]||(n[79]=s("p",null,"This is a post I’ve been looking forward to writing for a long time; it’s also a difficult one to write.",-1)),n[80]||(n[80]=s("p",null,"The goal (and challenge) will be to show why a server layer on top of a JavaScript router is valuable, andwhyTanStack Start’s implementation is unique compared to the alternatives (in a good way). From there, showing how TanStack Start actually works will be relatively straightforward. Let’s go!",-1)),s("div",j,[n[25]||(n[25]=s("p",{class:"hint-container-title"},"Note",-1)),s("p",null,[n[23]||(n[23]=a("Please keep in mind that, while this post discusses a lot of generic web performance issues, TanStack Start is still a React-specific meta-framework. It’s not a framework-agnostic tool like ")),s("a",I,[t(p,{icon:"iconfont icon-astro"}),n[22]||(n[22]=a("Astro"))]),n[24]||(n[24]=a("."))])]),n[81]||(n[81]=i('<hr><h2 id="why-server-rendering" tabindex="-1"><a class="header-anchor" href="#why-server-rendering"><span>Why Server Rendering?</span></a></h2><p>Client-rendered web applications, often called “Single Page Applications” or “SPAs” have been popular for a long time. With this type of app, the server sends down a mostly empty HTML page, possibly with some sort of splash image, loading spinner, or maybe some navigation components. It also includes, very importantly, script tags that load your framework of choice (React, Vue, Svelte, etc) and a bundle of your application code.</p><p>These apps were always fun to build, and in spite of the hate they often get, they (usually) worked just fine (any kind of software can be bad). Admittedly, they suffer a big disadvantage: initial render performance. Remember, the initial render of the page was just an empty shell of your app. This displayed while your script files loaded and executed, and once<em>those</em>scripts were run, your application code would most likely need to request data before your actual app could display. Under the covers, your app is doing something like this</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/csr-perf-flow.png?resize=772%2C874&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>The initial render of the page, from the web server, renders only an empty shell of your application. Then some scripts are requested, and then parsed and executed. When those application scripts run, you (likely) send some other requests for data. Once<em>that</em>is done, your page displays.</p><p>To put it more succinctly, with client-rendered web apps, when the user first loads your app, they’ll just get a loading spinner. Maybe your company’s logo above it, if they’re lucky.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/csr-user.png?resize=684%2C498&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>This is perhaps an overstatement. Users may not even notice the delay caused by these scripts loading (which are likely cached), or hydration, which is probably fast. Depending on the speed of their network, and the type of application, this stuff might not matter much.</p><p><em>Maybe.</em></p><p>But if our tools now make it easy to do better, why not do better?</p><h3 id="server-side-rendering" tabindex="-1"><a class="header-anchor" href="#server-side-rendering"><span>Server Side Rendering</span></a></h3><p>With SSR, the picture looks more like this</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-render.png?resize=788%2C884&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>The server sends down the complete, finished page that the user can see immediately. We do still need to load our scripts and hydrate, so our page can be<em>interactive</em>. But that’s usually fast, and the user will still have content to see while that happens.</p><p>Our hypothetical user now looks like this, since the server is responding with a full page the user can see.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-user.png?resize=796%2C506&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="streaming" tabindex="-1"><a class="header-anchor" href="#streaming"><span>Streaming</span></a></h3><p>We made one implicit assumption above: that our data was fast. If our data was slow to load, our server would be slow to respond. It’s bad for the user to be stuck looking at a loading spinner, but it’s even worse for the user to be stuck looking at a blank screen while the server churns.</p><p>As a solution for this, we can use something called “streaming,” or “out of order streaming” to be more precise. The user still requests all the data, as before, but we tell our server “don’t wait for this/these data, which are slow: render everything else, now, and send that slow data to the browser when it’s ready.”</p><p>All modern meta-frameworks support this, and our picture now looks like this</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-streaming-user.png?resize=822%2C500&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>To put a finer point on it, the server does still initiate the request for our slow data<em>immediately</em>, on the server during our initial navigation. It just doesn’t block the initial render, and instead<em>pushes down</em>the data when ready. We’ll look at streaming with Start later in this post.</p><h3 id="why-did-we-ever-do-client-rendering" tabindex="-1"><a class="header-anchor" href="#why-did-we-ever-do-client-rendering"><span>Why did we ever do client-rendering?</span></a></h3><p>I’m not here to tear down client-rendered apps. They were, and frankly<em>still are</em>an incredible way to ship deeply interactive user experiences with JavaScript frameworks like React and Vue. The fact of the matter is, server rendering a web app built with React was tricky to get right. You not only needed to server render and send down the HTML for the page the user requested, but also send down the<em>data</em>for that page, and hydrate everything<em>just right</em>on the client.</p><p>It’s hard to get right. But here’s the thing:<strong>getting this right is the one of the primary purposes of this new generation of meta-frameworks</strong>. Next, Nuxt, Remix, SvelteKit, and SolidStart are some of the more famous examples of these meta-frameworks. And now TanStack Start.</p><hr><h2 id="why-is-tanstack-start-different" tabindex="-1"><a class="header-anchor" href="#why-is-tanstack-start-different"><span>Why is TanStack Start different?</span></a></h2><p>Why do we need a new meta-framework? There’s many possible answers to that question, but I’ll give mine. Existing meta-frameworks suffer from some variation on the same issue. They’ll provide some mechanism to load data on the server. This mechanism is often called a “loader,” or in the case of Next, it’s just RSCs (React Server Components). In Next’s (older) pages directory, it’s the<code>getServerSideProps</code>function. The specifics don’t matter. What matters is, for each route, whether the initial load of the page, or client-side navigation via links, some server-side code will run, send down the data, and then render the new page.</p><h3 id="an-impedance-mismatch-is-born" tabindex="-1"><a class="header-anchor" href="#an-impedance-mismatch-is-born"><span>An Impedance Mismatch is Born</span></a></h3><p>Notice the two worlds that exist: the server, where data loading code will always run, and the client. It’s the difference and separation between these worlds that can cause issues.</p><p>For example, frameworks always provide some mechanism to mutate data, and then re-fetch to show updated state. Imagine your loader for a page loads some tasks, user settings, and announcements. When the user edits a task, and revalidates, these frameworks will almost always re-run the entire loader, and superfluously re-load the user’s announcements and user settings, in addition to tasks, even though tasks are the only thing that changed.</p><p>Are there fixes? Of course. Many frameworks will allow you to create extra loaders to spread the data loading across, and revalidate only<em>some</em>of them. Other frameworks encourage you to cache your data. These solutions all work, but come with their own tradeoffs. And remember, they’re solutions to a problem that meta-frameworks <em>created</em>, by having server-side loading code for every path in your app.</p><p>Or what about a loader that loads 5 different pieces of data? After the page loads, the user starts browsing around, occasionally coming back to that first page. These frameworks will usually cache that previously-displayed page, for a time. Or not. But it’s all or none. When the loader re-runs, all 5 pieces of data will re-fire, even if 4 of them can be cached safely.</p><p>You might think using a component-level data loading solution like react-query can help. react-query is great, but it doesn’t eliminate these problems. If you have two different pages that each have 5 data sources, of which 4 are shared in common, browsing from the first page to the second will cause the second page to re-request all 5 pieces of data, even though 4 of them are already present in client-side state from the first page. The server is unaware of what happens to exist on the client. The server is not keeping track of what state you have in your browser; in fact the “server” might just be a Lambda function that spins up, satisfies your request, and then dies off.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/extra-data.png?resize=724%2C800&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>In the picture, we can see a loader from the server sending down data for <code>queryB</code>, which we already have in our TanStack cache.</p><h3 id="where-to-from-here" tabindex="-1"><a class="header-anchor" href="#where-to-from-here"><span>Where to, from here?</span></a></h3><p>The root problem is that these meta-frameworks inevitably have server-only code running on each path, integrating with long-running client-side state. This leads to conflicts and inefficiencies which need to be managed. There’s ways of handling these things, which I touched on above. But it’s not a completely clean fit.</p><h3 id="how-much-does-it-matter" tabindex="-1"><a class="header-anchor" href="#how-much-does-it-matter"><span>How much does it matter?</span></a></h3><p>Let’s be clear right away: if this situation is killing performance of your site, you have bigger problems. If these extra calls are putting undue strain on your services, you have bigger problems.</p><p>That said, one of the first rules of distributed systems is to never trust your network. The more of these calls we’re firing off, the better the chances that some of them might randomly be slow for some reason beyond our control. Or fail.</p><p>We typically tolerate requesting more than we need in these scenarios because it’s hard to avoid with our current tooling. But I’m here to show you some new, better tooling that side-steps these issues altogether.</p><h3 id="isomorphic-loaders" tabindex="-1"><a class="header-anchor" href="#isomorphic-loaders"><span>Isomorphic Loaders</span></a></h3>',44)),s("p",null,[n[27]||(n[27]=a("In TanStack, we do have loaders. These are defined by TanStack Router. I wrote ")),t(l,{to:"/frontendmasters.com/introducing-tanstack-router.html"},{default:e(()=>n[26]||(n[26]=[s("strong",null,"a three-part series on Routerhere",-1)])),_:1,__:[26]}),n[28]||(n[28]=a(". If you haven’t read that, and aren’t familiar with Router, give it a quick look."))]),n[82]||(n[82]=s("p",null,[a("Start takes what we already have with Router, and adds server handling to it. On the initial load, your loader will run on the server, load your data, and send it down. On all subsequent client-side navigations, your loader will run"),s("em",null,"on the client"),a(", like it already does. That means all subsequent invocations of your loader will run on the client, and have access to any client-side state, cache, etc. If you like react-query, you’ll be happy to know that’s integrated too. Your react-query client can run on the server, to load, and send data down on the initial page load. On subsequent navigations, these loaders will run on the client, which means your react-query "),s("code",null,"queryClient"),a(" will have full access to the usual client-side cache react-query always uses. That means it will know what does, and does not need to be loaded.")],-1)),s("p",null,[n[30]||(n[30]=a("It’s honestly such a refreshing, simple, and most importantly, effective pattern that it’s hard not being annoyed none of the other frameworks thought of it first. Admittedly, ")),s("a",R,[t(p,{icon:"iconfont icon-svelte"}),n[29]||(n[29]=a("SvelteKit does have universal loaders"))]),n[31]||(n[31]=a(" which are isomorphic in the same way, but without a component-level query library like react-query integrated with the server."))]),n[83]||(n[83]=s("hr",null,null,-1)),n[84]||(n[84]=s("h2",{id:"tanstack-start",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#tanstack-start"},[s("span",null,"TanStack Start")])],-1)),n[85]||(n[85]=s("p",null,"Enough setup, let’s look at some code. TanStack Start is still in beta, so some of the setup is still a bit manual, for now.",-1)),s("div",C,[n[35]||(n[35]=s("p",{class:"hint-container-title"},"Info",-1)),s("p",null,[s("a",A,[n[32]||(n[32]=a("The repo for this postis here. (")),t(p,{icon:"iconfont icon-github"}),n[33]||(n[33]=s("code",null,"arackaf/tanstack-start-blog-dataloading",-1)),n[34]||(n[34]=a(")"))])]),t(u,{name:"arackaf/tanstack-start-blog-dataloading",desc:"Contribute to arackaf/tanstack-start-blog-dataloading development by creating an account on GitHub.",url:"https://github.com/arackaf/tanstack-start-blog-dataloading/",logo:"https://github.githubassets.com/favicons/favicon-dark.svg",preview:"https://opengraph.githubassets.com/bd24744c9732dfdb919a8f6a44e49c9c3cfae96574c37f0e146f39fd531c23da/arackaf/tanstack-start-blog-dataloading"})]),s("p",null,[n[40]||(n[40]=a("If you’d like to set something up yourself, check out")),s("a",L,[t(p,{icon:"fas fa-globe"}),n[36]||(n[36]=a("the getting started guide"))]),n[41]||(n[41]=a(". If you’d like to use react-query, be sure to add the library for that. You can see an example")),s("a",z,[n[37]||(n[37]=a("here (")),t(p,{icon:"iconfont icon-github"}),n[38]||(n[38]=s("code",null,"TanStack/router",-1)),n[39]||(n[39]=a(")"))]),n[42]||(n[42]=a(". Depending on when you read this, there might be a CLI to do all of this for you."))]),s("p",null,[n[44]||(n[44]=a("This post will continue to use the same code I used in my")),t(l,{to:"/frontendmasters.com/introducing-tanstack-router.html"},{default:e(()=>n[43]||(n[43]=[s("strong",null,"prior posts",-1)])),_:1,__:[43]}),n[45]||(n[45]=a("on TanStack Router. I set up a new Start project, copied over all the route code, and tweaked a few import paths since the default Start project has a slightly different folder structure. I also removed all of the artificial delays, unless otherwise noted. I want our data to be fast by default, and slow in a few places where we’ll use streaming to manage the slowness."))]),n[86]||(n[86]=s("p",null,"We’re not building anything new, here. We’re taking existing code, and moving the data loading up to the server in order to get it requested sooner, and improve our page load times. This means everything we already know and love about TanStack Router is still 100% valid.",-1)),n[87]||(n[87]=s("p",null,[a("Start does not replace Router; Start"),s("em",null,"improves"),a("Router.")],-1)),n[88]||(n[88]=s("h3",{id:"loading-data",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#loading-data"},[s("span",null,"Loading Data")])],-1)),n[89]||(n[89]=s("p",null,[a("All of the routes and loaders we set up with Router are still valid. Start sits on top of Router and adds server processing. Our loaders will execute on the server for the first load of the page, and then on the client as the user browses. But there’s a small problem. While the server environment these loaders will execute in does indeed have a"),s("code",null,"fetch"),a("function, there are differences between client-side fetch, and server-side fetch—for example, cookies, and fetching to relative paths.")],-1)),s("p",null,[n[47]||(n[47]=a("To solve this, Start lets you define a")),s("a",W,[t(p,{icon:"fas fa-globe"}),n[46]||(n[46]=a("server function"))]),n[48]||(n[48]=a(". Server functions can be called from the client, or from the server; but the server function itself always")),n[49]||(n[49]=s("em",null,"executes on",-1)),n[50]||(n[50]=a("the server. You can define a server function in the same file as your route, or in a separate file; if you do the former, TanStack will do the work of ensuring that server-only code does not ever exist in your client bundle."))]),n[90]||(n[90]=i(`<p>Let’s define a server function to load our tasks, and then call it from the tasks loader.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="getTaskList.jsx"><span>getTaskList.jsx</span></div><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx"><pre><code class="language-jsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getCookie <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vinxi/http&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createServerFn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@tanstack/start&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Task <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getTasksList <span class="token operator">=</span> <span class="token function">createServerFn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/api/tasks</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">Cookie</span><span class="token operator">:</span> <span class="token string">&quot;user=&quot;</span> <span class="token operator">+</span> result <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=&gt;</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res <span class="token keyword">as</span> Task<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>`,2)),s("p",null,[n[53]||(n[53]=a("We have access to a")),n[54]||(n[54]=s("code",null,"getCookie",-1)),n[55]||(n[55]=a("utility from the ")),s("a",N,[t(p,{icon:"iconfont icon-github"}),n[51]||(n[51]=s("code",null,"nksaraf/vinxi",-1))]),n[56]||(n[56]=a(" library on which Start is built. Server functions actually provide a lot more functionality than this simple example shows. Be sure to check out")),s("a",O,[t(p,{icon:"fas fa-globe"}),n[52]||(n[52]=a("the docs"))]),n[57]||(n[57]=a("to learn more."))]),n[91]||(n[91]=i(`<p>If you’re curious about this fetch call:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/api/tasks</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">Cookie</span><span class="token operator">:</span> <span class="token string">&quot;user=&quot;</span> <span class="token operator">+</span> result <span class="token punctuation">}</span> </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That’s how I’m loading data for this project, on the server. I have a separate project running a set of Express endpoints querying a simple SQLite database. You can fetch your data however you need from within these server functions, be it via an ORM like Drizzle, an external service endpoint like I have here, or you could connect right to a database and query what you need. But that latter option should probably be discouraged for production applications.</p><p>Now we can call our server function from our loader.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> context <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/tasks/index path loader. Loading tasks at + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>now <span class="token operator">-</span> context<span class="token punctuation">.</span>timestarted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms since start</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTasksList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> tasks <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That’s all there is to it. It’s almost anti-climactic. The page loads, as it did in the last post. Except now it server renders. You can shut JavaScript off, and the page will still load and display (and hyperlinks will still work).</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/tasks-page.png?resize=671%2C1024&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="streaming-1" tabindex="-1"><a class="header-anchor" href="#streaming-1"><span>Streaming</span></a></h3><p>Let’s make the individual task loading purposefully slow (we’ll just keep the delay that was already in there), so we can see how to stream it in. Here’s our server function to load a single task.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getTask <span class="token operator">=</span> <span class="token function">createServerFn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">validator</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> id<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/api/tasks/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=&gt;</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res <span class="token keyword">as</span> Task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note the<code>validator</code>function, which is how we strongly type our server function (and validate the inputs). But otherwise it’s more of the same.</p><p>Now let’s call it in our loader, and see about enabling streaming</p><p>Here’s our loader:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> context <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> taskId <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/tasks/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>taskId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> path loader. Loading at + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>now <span class="token operator">-</span> context<span class="token punctuation">.</span>timestarted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms since start</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> taskId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> task <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Did you catch it? We called<code>getTask</code><strong>without</strong>awaiting it. That means <code>task</code> is a promise, which Start and Router allow us to return from our loader (you could name it<code>taskPromise</code> if you like that specificity in naming).</p>`,15)),s("p",null,[n[60]||(n[60]=a("But how do we")),n[61]||(n[61]=s("em",null,"consume",-1)),n[62]||(n[62]=a("this promise, show loading state, and")),n[63]||(n[63]=s("code",null,"await",-1)),n[64]||(n[64]=a("the real value? There are two ways. TanStack Router defines an")),s("a",B,[t(p,{icon:"fas fa-globe"}),n[58]||(n[58]=s("code",null,"Await",-1)),n[59]||(n[59]=a("component"))]),n[65]||(n[65]=a(" for this. But if you’re using React 19, you can use the new")),n[66]||(n[66]=s("code",null,"use",-1)),n[67]||(n[67]=a("psuedo-hook."))]),n[92]||(n[92]=i(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="TaskView.jsx"><span>TaskView.jsx</span></div><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx"><pre><code class="language-jsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> use <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">TaskView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">task</span><span class="token operator">:</span> taskPromise <span class="token punctuation">}</span> <span class="token operator">=</span> Route<span class="token punctuation">.</span><span class="token function">useLoaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> isFetching <span class="token punctuation">}</span> <span class="token operator">=</span> Route<span class="token punctuation">.</span><span class="token function">useMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>taskPromise<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/app/tasks<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Back to tasks list</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-col gap-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">          Task </span><span class="token punctuation">{</span>task<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token punctuation">{</span>isFetching <span class="token operator">?</span> <span class="token string">&quot;Loading ...&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>task<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> </span>
<span class="line">          <span class="token attr-name">params</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">taskId</span><span class="token operator">:</span> task<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span>
<span class="line">          <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/app/tasks/$taskId/edit<span class="token punctuation">&quot;</span></span></span>
<span class="line">        <span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">          Edit</span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The <code>use</code> hookwill cause the component to suspend, and show the nearest<code>Suspense</code>boundary in the tree. Fortunately, the<code>pendingComponent</code>you set up in Router also doubles as a Suspense boundary. TanStack is impressively well integrated with modern React features.</p><p>Now when we load an individual task’s page, we’ll first see the overview data which loaded quickly, and server rendered, above the Suspense boundary for the task data we’re streaming</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/streaming-tasks.png?resize=692%2C662&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>When the task comes in, the promise will resolve, the server will push the data down, and our<code>use</code>call will provide data for our component.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/streaming-tasks-finish.png?resize=754%2C764&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h2 id="react-query" tabindex="-1"><a class="header-anchor" href="#react-query"><span>React Query</span></a></h2>`,8)),s("p",null,[n[68]||(n[68]=a("As before, let’s integrate react-query. And, as before, there’s not much to do. Since we added the")),t(p,{icon:"fa-brands fa-npm"}),n[69]||(n[69]=s("code",null,"@tanstack/react-router-with-query",-1)),n[70]||(n[70]=a("package when we got started, our")),n[71]||(n[71]=s("code",null,"queryClient",-1)),n[72]||(n[72]=a("will be available on the server, and will sync up with the ")),n[73]||(n[73]=s("code",null,"queryClient",-1)),n[74]||(n[74]=a(" on the client, and put data (or in-flight streamed promises) into cache."))]),n[93]||(n[93]=i(`<p>Let’s start with our main epics page. Our loader looked like this before:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> context<span class="token punctuation">,</span> deps <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> queryClient <span class="token operator">=</span> context<span class="token punctuation">.</span>queryClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  queryClient<span class="token punctuation">.</span><span class="token function">ensureQueryData</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">epicsQueryOptions</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>timestarted<span class="token punctuation">,</span> deps<span class="token punctuation">.</span>page<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  queryClient<span class="token punctuation">.</span><span class="token function">ensureQueryData</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">epicsCountQueryOptions</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>timestarted<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That would kick off the requests on the server, but let the page render, and then suspend in the component that called<code>useSuspenseQuery</code>—what we’ve been calling streaming.</p><p>Let’s change it to actually load our data in our loader, and server render the page instead. The change couldn’t be simpler.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> context<span class="token punctuation">,</span> deps <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> queryClient <span class="token operator">=</span> context<span class="token punctuation">.</span>queryClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">    queryClient<span class="token punctuation">.</span><span class="token function">ensureQueryData</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token function">epicsQueryOptions</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>timestarted<span class="token punctuation">,</span> deps<span class="token punctuation">.</span>page<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    queryClient<span class="token punctuation">.</span><span class="token function">ensureQueryData</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token function">epicsCountQueryOptions</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>timestarted<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note we’re awaiting a <code>Promise.allSettled</code> call here so the queries can run together. Make sure you don’t sequentially<code>await</code>each individual call, as that would create a waterfall, or use <code>Promise.all</code>, as that will quit immediately if any of the promises error out.</p><h3 id="streaming-with-react-query" tabindex="-1"><a class="header-anchor" href="#streaming-with-react-query"><span>Streaming with react-query</span></a></h3><p>As I implied above, to stream data with react-query, do the exact same thing, but<em>don’t</em><code>await</code>the promise. Let’s do that on the page for viewing an individual epic.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> context<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> queryClient<span class="token punctuation">,</span> timestarted <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  queryClient<span class="token punctuation">.</span><span class="token function">ensureQueryData</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">epicQueryOptions</span><span class="token punctuation">(</span>timestarted<span class="token punctuation">,</span> params<span class="token punctuation">.</span>epicId<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now if this page is loaded initially, the query for this data will start on the server and stream to the client. If the data are pending, our suspense boundary will show, triggered automatically by react-query’s<code>useSuspenseBoundary</code>hook.</p><p>If the user browses to this page from a different page, the loader will instead run on the client, but still fetch those same data from the same server function, and trigger the same suspense boundary.</p><hr><h2 id="parting-thoughts" tabindex="-1"><a class="header-anchor" href="#parting-thoughts"><span>Parting Thoughts</span></a></h2>`,13)),s("p",null,[n[76]||(n[76]=a("I hope this post was useful to you. It wasn’t a deep dive into ")),s("a",P,[t(p,{icon:"fas fa-globe"}),n[75]||(n[75]=a("TanStack Start"))]),n[77]||(n[77]=a(" — the docs are a better venue for that. Instead, I hope I was able to showwhyserver rendering can offer almost any web app a performance boost, and why TanStack Start is a superb tool for doing so. Not only does it simplify a great deal of things by running loaders isomorphically, but it even integrates wonderfully with react-query."))]),n[94]||(n[94]=s("p",null,"The react-query integration is especially exciting to me. It delivers component-level data fetching while still allowing for server fetching, and streaming—all without sacrificing one bit of convenience.",-1)),f(" TODO: add ARTICLE CARD "),t(c,d(k({title:"Introducing TanStack Start",desc:"TanStack Start enhances the TanStack Router by adding a server layer that improves performance through server-side rendering (SSR) and isomorphic loaders.",link:"https://chanhi2000.github.io/bookshelf/frontendmasters.com/introducing-tanstack-start.html",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16)])}const V=h(y,[["render",D]]),M=JSON.parse('{"path":"/frontendmasters.com/introducing-tanstack-start.html","title":"Introducing TanStack Start","lang":"en-US","frontmatter":{"lang":"en-US","title":"Introducing TanStack Start","description":"Article(s) > Introducing TanStack Start","icon":"fa-brands fa-react","category":["Node.js","React.js","Article(s)"],"tag":["blog","frontendmasters.com","node","nodejs","node-js","react","reactjs","react-js"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Introducing TanStack Start\\",\\"image\\":[\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/csr-perf-flow.png?resize=772%2C874&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/csr-user.png?resize=684%2C498&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-render.png?resize=788%2C884&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-user.png?resize=796%2C506&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/ssr-streaming-user.png?resize=822%2C500&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/extra-data.png?resize=724%2C800&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/tasks-page.png?resize=671%2C1024&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/streaming-tasks.png?resize=692%2C662&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/12/streaming-tasks-finish.png?resize=754%2C764&ssl=1\\"],\\"datePublished\\":\\"2024-12-18T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Adam Rackis\\",\\"url\\":\\"https://frontendmasters.com/blog/author/adamrackis/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/frontendmasters.com/introducing-tanstack-start.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Introducing TanStack Start"}],["meta",{"property":"og:description","content":"Article(s) > Introducing TanStack Start"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/4810"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/4810"}],["meta",{"name":"twitter:image:alt","content":"Introducing TanStack Start"}],["meta",{"property":"article:author","content":"Adam Rackis"}],["meta",{"property":"article:tag","content":"react-js"}],["meta",{"property":"article:tag","content":"reactjs"}],["meta",{"property":"article:tag","content":"react"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"frontendmasters.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-12-18T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Introducing TanStack Start"},{"property":"og:description","content":"Introducing TanStack Start"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/frontendmasters.com/introducing-tanstack-start.html"}]],"prev":"/programming/js-react/articles/README.md","date":"2024-12-18T00:00:00.000Z","isOriginal":false,"author":[{"name":"Adam Rackis","url":"https://frontendmasters.com/blog/author/adamrackis/"}],"cover":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/4810"},"git":{},"readingTime":{"minutes":12.64,"words":3791},"filePathRelative":"frontendmasters.com/introducing-tanstack-start.md","copyright":{"author":"Adam Rackis"}}');export{V as comp,M as data};
