import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as b,d as n,f as e,b as c,t as f,n as k,g as m,w as t,e as s,r,o as w}from"./app-BItykJLQ.js";const y={},S={id:"frontmatter-title-관련",tabindex:"-1"},q={class:"header-anchor",href:"#frontmatter-title-관련"},x={class:"table-of-contents"},Q={href:"https://github.com/stephencelis/SQLite.swift",target:"_blank",rel:"noopener noreferrer"},L={href:"https://koenig-media.raywenderlich.com/uploads/2020/01/SQLite-With-Swift-Getting-Started.zip",target:"_blank",rel:"noopener noreferrer"},T={id:"introducing-sqlite-swift",tabindex:"-1"},E={class:"header-anchor",href:"#introducing-sqlite-swift"},I={href:"https://github.com/stephencelis/SQLite.swift",target:"_blank",rel:"noopener noreferrer"},C={href:"https://github.com/stephencelis/SQLite.swift/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"},_={href:"https://koenig-media.raywenderlich.com/uploads/2020/01/SQLite-With-Swift-Getting-Started.zip",target:"_blank",rel:"noopener noreferrer"};function A(g,a){const u=r("VPCard"),o=r("router-link"),i=r("VPIcon"),h=r("SiteInfo"),d=r("Tabs");return w(),b("div",null,[n("h1",S,[n("a",q,[n("span",null,f(g.$frontmatter.title)+" 관련",1)])]),e(u,k(m({title:"Swift > Article(s)",desc:"Article(s)",link:"/programming/swift/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e(u,k(m({title:"SQLite > Article(s)",desc:"Article(s)",link:"/data-science/sqlite/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",x,[n("ul",null,[n("li",null,[e(o,{to:"#getting-started"},{default:t(()=>[...a[0]||(a[0]=[s("Getting Started",-1)])]),_:1})]),n("li",null,[e(o,{to:"#why-should-you-choose-sqlite"},{default:t(()=>[...a[1]||(a[1]=[s("Why Should You Choose SQLite?",-1)])]),_:1})]),n("li",null,[e(o,{to:"#the-c-api"},{default:t(()=>[...a[2]||(a[2]=[s("The C API",-1)])]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#opening-a-connection"},{default:t(()=>[...a[3]||(a[3]=[s("Opening a Connection",-1)])]),_:1})]),n("li",null,[e(o,{to:"#creating-a-table"},{default:t(()=>[...a[4]||(a[4]=[s("Creating a Table",-1)])]),_:1})]),n("li",null,[e(o,{to:"#inserting-data"},{default:t(()=>[...a[5]||(a[5]=[s("Inserting Data",-1)])]),_:1})]),n("li",null,[e(o,{to:"#challenge-multiple-inserts"},{default:t(()=>[...a[6]||(a[6]=[s("Challenge: Multiple Inserts",-1)])]),_:1})]),n("li",null,[e(o,{to:"#querying-contacts"},{default:t(()=>[...a[7]||(a[7]=[s("Querying Contacts",-1)])]),_:1})]),n("li",null,[e(o,{to:"#challenge-printing-every-row"},{default:t(()=>[...a[8]||(a[8]=[s("Challenge: Printing Every Row",-1)])]),_:1})]),n("li",null,[e(o,{to:"#updating-contacts"},{default:t(()=>[...a[9]||(a[9]=[s("Updating Contacts",-1)])]),_:1})]),n("li",null,[e(o,{to:"#deleting-contacts"},{default:t(()=>[...a[10]||(a[10]=[s("Deleting Contacts",-1)])]),_:1})]),n("li",null,[e(o,{to:"#handling-errors"},{default:t(()=>[...a[11]||(a[11]=[s("Handling Errors",-1)])]),_:1})]),n("li",null,[e(o,{to:"#closing-the-database-connection"},{default:t(()=>[...a[12]||(a[12]=[s("Closing the Database Connection",-1)])]),_:1})])])]),n("li",null,[e(o,{to:"#sqlite-with-swift"},{default:t(()=>[...a[13]||(a[13]=[s("SQLite With Swift",-1)])]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#wrapping-errors"},{default:t(()=>[...a[14]||(a[14]=[s("Wrapping Errors",-1)])]),_:1})]),n("li",null,[e(o,{to:"#wrapping-the-database-connection"},{default:t(()=>[...a[15]||(a[15]=[s("Wrapping the Database Connection",-1)])]),_:1})]),n("li",null,[e(o,{to:"#wrapping-the-prepare-call"},{default:t(()=>[...a[16]||(a[16]=[s("Wrapping the Prepare Call",-1)])]),_:1})]),n("li",null,[e(o,{to:"#creating-a-contact-struct"},{default:t(()=>[...a[17]||(a[17]=[s("Creating a Contact Struct",-1)])]),_:1})]),n("li",null,[e(o,{to:"#wrapping-the-table-creation"},{default:t(()=>[...a[18]||(a[18]=[s("Wrapping the Table Creation",-1)])]),_:1})]),n("li",null,[e(o,{to:"#wrapping-insertions"},{default:t(()=>[...a[19]||(a[19]=[s("Wrapping Insertions",-1)])]),_:1})]),n("li",null,[e(o,{to:"#wrapping-reads"},{default:t(()=>[...a[20]||(a[20]=[s("Wrapping Reads",-1)])]),_:1})])])]),n("li",null,[e(o,{to:"#introducing-sqlite-swift"},{default:t(()=>[a[21]||(a[21]=s("Introducing ",-1)),e(i,{icon:"fa-brands fa-swift"}),a[22]||(a[22]=s("SQLite.swift",-1))]),_:1})]),n("li",null,[e(o,{to:"#where-to-go-from-here"},{default:t(()=>[...a[23]||(a[23]=[s("Where to Go From Here?",-1)])]),_:1})])])]),a[66]||(a[66]=n("hr",null,null,-1)),e(h,{name:"SQLite With Swift Tutorial: Getting Started",desc:"In this SQLite with Swift tutorial, you’ll learn to use a SQLite database with Swift projects by creating tables and inserting, updating and deleting rows.",url:"https://kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started",logo:"https://assets.carolus.kodeco.com/assets/murakami/category-icons/category-saving-data-persistence-ios-09771a6a821ae79fa6653f51395c14d66cb117d87648bb17bd04f20f9ff48576.svg",preview:"https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-twitter.png"}),a[67]||(a[67]=c('<p>In software development, it doesn’t take long before you need to persist app data. Often, this comes in the form of data structures. But how do you store those structures efficiently?</p><p>Fortunately, some great minds have developed solutions for storing structured data in databases and writing language features to access that data. <strong>SQLite</strong> is available by default on iOS.</p><p>In fact, if you’ve used <a href="https://www.raywenderlich.com/145809/getting-started-core-data-tutorial" target="_blank" rel="noopener noreferrer">Core Data</a> before, you’ve already used SQLite. Core Data is just a layer on top of SQLite that provides a more convenient API.</p><p>In this SQLite with Swift tutorial, you’ll learn how to perform the following database operations:</p><ul><li>Create and connect to a database.</li><li>Create a table.</li><li>Insert, update, and delete rows.</li><li>Query the database.</li><li>Handle SQLite errors.</li></ul><p>After learning how to perform these fundamental operations, you’ll see how to wrap them in a Swift-like manner. This will let you write abstraction APIs for your apps and avoid working with the more complicated SQLite C APIs.</p>',6)),n("p",null,[a[25]||(a[25]=s("Finally, you’ll briefly learn about the popular open-source Swift wrapper ",-1)),n("a",Q,[e(i,{icon:"iconfont icon-github"}),a[24]||(a[24]=s("stephencelis/SQLite",-1))]),a[26]||(a[26]=s(". This will give you a basic understanding of how underlying frameworks work within a wrapper.",-1))]),a[68]||(a[68]=n("div",{class:"hint-container tip"},[n("p",{class:"hint-container-title"},"Note"),n("p",null,"Databases like SQLite are massive topics to cover, and covering how to use them is out of scope for this tutorial. This tutorial assumes that you have a basic understanding of relational databases and that you’re primarily here to learn to use SQLite with Swift.")],-1)),a[69]||(a[69]=n("hr",null,null,-1)),a[70]||(a[70]=n("h2",{id:"getting-started",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#getting-started"},[n("span",null,"Getting Started")])],-1)),n("p",null,[a[28]||(a[28]=s("Start by using the ",-1)),n("a",L,[e(i,{icon:"fas fa-download"}),a[27]||(a[27]=n("code",null,"[Download Materials]",-1))]),a[29]||(a[29]=s(" button at the top or bottom of this tutorial, then open ",-1)),e(i,{icon:"fas fa-file-lines"}),a[30]||(a[30]=n("code",null,"SQLiteTutorial.xcworkspace",-1)),a[31]||(a[31]=s(" from the starter folder. Next, open the ",-1)),e(i,{icon:"iconfont icon-select"}),a[32]||(a[32]=n("code",null,"[Tutorial]",-1)),a[33]||(a[33]=s(" playground from the ",-1)),e(i,{icon:"iconfont icon-select"}),a[34]||(a[34]=n("code",null,"[Project navigator]",-1)),a[35]||(a[35]=s(".",-1))]),a[71]||(a[71]=c(`<div class="hint-container tip"><p class="hint-container-title">Note</p><p>The project is in an Xcode workspace because it uses the <strong>SQLite3</strong> dependency as an embedded binary. This binary contains all the functionality for the SQLite code you’ll write in this tutorial.</p></div><p>Long-click the Play button at the bottom and notice that your playground runs manually instead of automatically:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_manually_run_playground_highlighted.png" alt="Manual Run drop-down menu" tabindex="0" loading="lazy"><figcaption>Manual Run drop-down menu</figcaption></figure><p>This means it will only execute when you explicitly invoke the execution by clicking the Play button.</p><p>You might also see a <code>destroyPart1Database()</code> call at the top of the page. You can safely ignore this since the database file self-destructs each time the playground runs. This ensures all statements execute successfully as you move through this SQLite with Swift tutorial.</p><hr><h2 id="why-should-you-choose-sqlite" tabindex="-1"><a class="header-anchor" href="#why-should-you-choose-sqlite"><span>Why Should You Choose SQLite?</span></a></h2><p>SQLite isn’t the only way to persist data on iOS. Besides <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreData/index.html" target="_blank" rel="noopener noreferrer">Core Data</a>, there are many other alternatives for data persistence including <a href="https://realm.io" target="_blank" rel="noopener noreferrer">Realm</a>, <a href="http://developer.couchbase.com/mobile/#couchbase-lite" target="_blank" rel="noopener noreferrer">Couchbase Lite</a>, <a href="https://firebase.google.com/docs" target="_blank" rel="noopener noreferrer">Firebase</a> and <a href="http://nshipster.com/nscoding" target="_blank" rel="noopener noreferrer">NSCoding</a>.</p><p>Each of these has its own pros and cons — including SQLite itself. There’s no silver bullet for data persistence. As the developer, it’s up to you to determine which option surpasses the others based on your app’s requirements.</p><p>SQLite has some advantages:</p><ul><li>Shipped with iOS, it adds no overhead to your app’s bundle.</li><li>SQLite released version 1.0 in August 2000, so it’s tried and tested.</li><li>It’s well-maintained with frequent releases.</li><li>Open-source.</li><li>It uses a query language that’s familiar to database developers and administrators.</li><li>Cross-platform.</li></ul><p>The cons of SQLite are subjective and opinionated, so that research is up to you!</p><p>Now that you’ve committed to finding out how SQLite works with Swift, it’s time to get to know some of the most basic SQLite APIs.</p><hr><h2 id="the-c-api" tabindex="-1"><a class="header-anchor" href="#the-c-api"><span>The C API</span></a></h2><p>This part of the SQLite with Swift tutorial walks you through the most common SQLite APIs. Wrapping the <strong>C API</strong> in Swift methods is ideal, but work through the <strong>C code</strong> first. You’ll wrap your C code in the second part of this tutorial.</p><h3 id="opening-a-connection" tabindex="-1"><a class="header-anchor" href="#opening-a-connection"><span>Opening a Connection</span></a></h3><p>Before doing anything, create a <strong>database connection</strong>.</p><p>Add the following function in your playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> db<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token keyword">let</span> part1DbPath <span class="token operator">=</span> part1DbPath <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;part1DbPath is nil.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token nil constant">nil</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_open</span><span class="token punctuation">(</span>part1DbPath<span class="token punctuation">,</span> <span class="token operator">&amp;</span>db<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Successfully opened connection to database at </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">part1DbPath</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> db</span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to open database.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token class-name">PlaygroundPage</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">finishExecution</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This function calls <code>sqlite3_open()</code>, which opens or creates a new database file. If it’s successful, it returns an <code>OpaquePointer</code>, which is a <strong>Swift type</strong> for <strong>C pointers</strong>. When you call this function, you’ll have to capture the returned pointer to interact with the database.</p><p>Many of the SQLite functions return an <code>Int32</code> result code, which is usually a constant in the SQLite library. For example, <code>SQLITE_OK</code> represents the result code <code>0</code>. Find a list of result codes on the <a href="https://www.sqlite.org/rescode.html" target="_blank" rel="noopener noreferrer">official SQLite site</a>.</p><p>Add the following to open the database:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,24)),n("p",null,[a[36]||(a[36]=s("Click the Play button to run the playground and watch the console output. If the console isn’t open, click the ",-1)),e(i,{icon:"iconfont icon-select"}),a[37]||(a[37]=n("code",null,"[Show the Debug area]",-1)),a[38]||(a[38]=s(" button to the left of the Play button:",-1))]),a[72]||(a[72]=c(`<figure><img src="https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_show_debug_area-2.png" alt="Showing the Debug area" tabindex="0" loading="lazy"><figcaption>Showing the Debug area</figcaption></figure><p>If <code>openDatabase()</code> succeeds, you’ll see some output similar to that below:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Successfully opened connection to database at /Users/username/Library/Developer/XCPGDevices/A1EF655D-E318-4CDC-A35A-54349AFE1E62/data/Containers/Data/Application/43A00877-DF24-4E86-8682-22876DEEAFE4/Documents/Part1.sqlite</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="creating-a-table" tabindex="-1"><a class="header-anchor" href="#creating-a-table"><span>Creating a Table</span></a></h3><p>Now that you have a connection to a database file, you can create a table. You’ll work with a very simple table to store contacts.</p><p>The table consists of two columns: <code>Id</code>, which is an <code>INT</code> and a <code>PRIMARY KEY</code>, and <code>Name</code>, which is a <code>CHAR(255)</code>.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-table.png" alt="The table with ID and Name headers and filled-out rows" tabindex="0" loading="lazy"><figcaption>The table with ID and Name headers and filled-out rows</figcaption></figure><p>Add the following statement, which contains an SQL statement to create the table. Note you’re using Swift’s multi-line syntax:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> createTableString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;&quot;</span>
<span class="line">CREATE TABLE Contact(</span>
<span class="line">Id INT PRIMARY KEY NOT NULL,</span>
<span class="line">Name CHAR(255));</span>
<span class="line">&quot;&quot;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, add this function:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">var</span> createTableStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> createTableString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>createTableStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> </span>
<span class="line">      <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 3</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>createTableStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nContact table created.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nContact table is not created.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nCREATE TABLE statement is not prepared.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// 4</span></span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>createTableStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Going over this, step-by-step:</p><p>Next, you check the returned status code to ensure the statement compiled successfully. If so, the process moves to step 3. Otherwise, you print a message noting the statement didn’t compile.</p><ol><li>First, you create a pointer to reference in the next step.</li><li><code>sqlite3_prepare_v2()</code> compiles the SQL statement into byte code and returns a status code — an important step before executing arbitrary statements against your database.</li><li><code>sqlite3_step()</code> runs the compiled statement. In this case, you only step once because this statement has a single result. Later in this tutorial, you’ll see when it’s necessary to step multiple times for a single statement.</li><li>You must always call <code>sqlite3_finalize()</code> on your compiled statement to delete it and avoid resource leaks. Once a statement finalizes, you should never use it again.</li></ol><div class="hint-container tip"><p class="hint-container-title">Note</p><p>If you want to learn more about what happened in step 2, check out the SQLite documentation about <a href="https://www.sqlite.org/c3ref/prepare.html" target="_blank" rel="noopener noreferrer">compiling an SQL statement</a>.</p></div><p>Now, add the following function call:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run your playground. You’ll see the following in your console output:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Contact table created.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now that you have a table, it’s time to add some data to it. You’re going to add a single row with an <code>Id</code> of <code>1</code> and <code>Name</code> of <code>Ray</code>.</p><h3 id="inserting-data" tabindex="-1"><a class="header-anchor" href="#inserting-data"><span>Inserting Data</span></a></h3><p>Add the following SQL statement:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> insertStatementString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;INSERT INTO Contact (Id, Name) VALUES (?, ?);&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This might look strange if you haven’t had much SQL experience. Why are the values represented by question marks?</p><p>Earlier, you used <code>sqlite3_prepare_v2()</code> to compile your statement. The <code>?</code> syntax tells the compiler that you’ll provide real values when you actually execute the statement.</p><p>This lets you compile statements ahead of time, which improves performance since compilation is a costly operation. You can then reuse the compiled statements with different values.</p><p>Next, create the following function:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> insertStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> insertStatementString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>insertStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> </span>
<span class="line">      <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">Int32</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">NSString</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Ray&quot;</span></span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    <span class="token function">sqlite3_bind_int</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 3</span></span>
<span class="line">    <span class="token function">sqlite3_bind_text</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>utf8String<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 4</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nSuccessfully inserted row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nCould not insert row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nINSERT statement is not prepared.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// 5</span></span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s how the function above works:</p><p>The first parameter of the function is the statement to bind to, while the second is a non-zero-based index for the position of the <code>?</code> you’re binding to. The third and final parameter is the value itself. This binding call returns a status code, but for now, you assume that it succeeds.</p><ol><li>First, compile the statement and verify that all is well.</li><li>Here, you define a value for the <code>?</code> placeholder. The function’s name — <code>sqlite3_bind_int()</code> — implies you’re binding an <code>Int</code> to the statement.</li><li>Perform the same binding process, but this time for a text value. There are two additional parameters on this call. For the purposes of this tutorial, simply pass <code>-1</code> and <code>nil</code> for them.</li><li>Use <code>sqlite3_step()</code> to execute the statement and verify that it finished.</li><li>Finalize the statement. If you were going to insert multiple contacts, you’d retain the statement and reuse it with different values.</li></ol><div class="hint-container tip"><p class="hint-container-title">Note</p><p>If you’d like, you can read more about <a href="https://www.sqlite.org/c3ref/bind_blob.html" target="_blank" rel="noopener noreferrer">binding parameters</a> on the SQLite website.</p></div><p>Next, call your new function:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run your playground and verify that you see the following in your console output:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Successfully inserted row.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="challenge-multiple-inserts" tabindex="-1"><a class="header-anchor" href="#challenge-multiple-inserts"><span>Challenge: Multiple Inserts</span></a></h3><p>Challenge time! Your task is to update <code>insert()</code> to insert an array of contacts.</p><p>As a hint, you’ll need to reset your compiled statement to its initial state by calling <code>sqlite3_reset()</code> before you execute it again.</p>`,39)),e(d,{data:[{id:"Before"},{id:"After"}],active:0},{title0:t(({value:l,isActive:p})=>[...a[39]||(a[39]=[s("Before",-1)])]),title1:t(({value:l,isActive:p})=>[...a[40]||(a[40]=[s("After",-1)])]),tab0:t(({value:l,isActive:p})=>[...a[41]||(a[41]=[n("div",{class:"language-swift line-numbers-mode","data-highlighter":"prismjs","data-ext":"swift"},[n("pre",null,[n("code",{class:"language-swift"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function-definition function"},"insert"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"var"),s(" insertStatement"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"OpaquePointer"),n("span",{class:"token operator"},"?")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 1")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_prepare_v2"),n("span",{class:"token punctuation"},"("),s("db"),n("span",{class:"token punctuation"},","),s(" insertStatementString"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token nil constant"},"nil"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_OK"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"let"),s(" id"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Int32"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"let"),s(" name"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"NSString"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Ray"')])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 2")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"sqlite3_bind_int"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" id"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 3")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"sqlite3_bind_text"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(" name"),n("span",{class:"token punctuation"},"."),s("utf8String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token nil constant"},"nil"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 4")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_step"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_DONE"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nSuccessfully inserted row."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nCould not insert row."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nINSERT statement is not prepared."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 5")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"sqlite3_finalize"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])]),tab1:t(({value:l,isActive:p})=>[...a[42]||(a[42]=[n("div",{class:"language-swift line-numbers-mode","data-highlighter":"prismjs","data-ext":"swift"},[n("pre",null,[n("code",{class:"language-swift"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function-definition function"},"insert"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"var"),s(" insertStatement"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"OpaquePointer"),n("span",{class:"token operator"},"?")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 1")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"let"),s(" names"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"NSString"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Ray"')]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Chris"')]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Martha"')]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Danielle"')]),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_prepare_v2"),n("span",{class:"token punctuation"},"("),s("db"),n("span",{class:"token punctuation"},","),s(" insertStatementString"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token nil constant"},"nil"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_OK"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\n"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 2")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),s("index"),n("span",{class:"token punctuation"},","),s(" name"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"in"),s(" names"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enumerated"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 3")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" id "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"Int32"),n("span",{class:"token punctuation"},"("),s("index "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"sqlite3_bind_int"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" id"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"sqlite3_bind_text"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(" name"),n("span",{class:"token punctuation"},"."),s("utf8String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token nil constant"},"nil"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_step"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_DONE"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Successfully inserted row."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Could not insert row."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 4")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"sqlite3_reset"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"sqlite3_finalize"),n("span",{class:"token punctuation"},"("),s("insertStatement"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nINSERT statement is not prepared."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"As you can see, this is similar to the code you already had, with these notable differences:",-1),n("ol",null,[n("li",null,"You have an array of contacts now, rather than a single constant."),n("li",null,"The array enumerates once for each contact."),n("li",null,"You now generate the index from the index of the enumeration, which corresponds to the placement of the contact’s name in the array."),n("li",null,"The SQL statement resets at the end of each enumeration so that next one can use it.")],-1)])]),_:1}),a[73]||(a[73]=c(`<p>Great, you’ve now mastered adding data to your database. In the next section of this tutorial, you’ll learn how to access that data when you need it.</p><h3 id="querying-contacts" tabindex="-1"><a class="header-anchor" href="#querying-contacts"><span>Querying Contacts</span></a></h3><p>Now that you’ve inserted some rows, it’d be nice to verify they’re really there.</p><p>Add the following to the playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> queryStatementString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;SELECT * FROM Contact;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This query retrieves all records from the contact table. Using a <code>*</code> returns all columns.</p><p>Now, add the following function to the query:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> queryStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> queryStatementString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>queryStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_ROW</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 3</span></span>
<span class="line">      <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">sqlite3_column_int</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token comment">// 4</span></span>
<span class="line">      <span class="token keyword">guard</span> <span class="token keyword">let</span> queryResultCol1 <span class="token operator">=</span> <span class="token function">sqlite3_column_text</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Query result is nil&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> queryResultCol1<span class="token punctuation">)</span></span>
<span class="line">      <span class="token comment">// 5</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nQuery Result:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">id</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> | </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nQuery returned no results.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 6</span></span>
<span class="line">    <span class="token keyword">let</span> errorMessage <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> <span class="token function">sqlite3_errmsg</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nQuery is not prepared </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">errorMessage</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// 7</span></span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Taking each numbered comment in turn:</p><ol><li>You prepare the statement.</li><li>Next, you execute the statement. Note that you’re now checking for the status code <code>SQLITE_ROW</code>, which means that you retrieved a row when you stepped through the result.</li><li>Now, you read the values from the returned row. Given what you know about the table’s structure and your query, you can access the row’s values column-by-column. The first column is an <code>Int</code>, so you use <code>sqlite3_column_int()</code> and pass in the statement and a zero-based column index. You assign the returned value to the locally-scoped <code>id</code> constant.</li><li>Here, you fetch the text value from the <code>Name</code> column. This is a bit messy due to the C API. First, you capture the value as <code>queryResultCol1</code> so you can convert it to a proper Swift string on the next line.</li><li>Print the results.</li><li>Print an error, if any. Want to get adventurous? Change the table name in <code>queryStatementString</code> and see what happens.</li><li>You finalize the statement. Now, call your new function:</li></ol><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run your playground. You’ll see the following output in your console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Query Result:</span>
<span class="line">1 | Ray</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>WOOt! It looks like your data made it to the database after all, unless you got adventurous.</p><h3 id="challenge-printing-every-row" tabindex="-1"><a class="header-anchor" href="#challenge-printing-every-row"><span>Challenge: Printing Every Row</span></a></h3><p>Your task is to update <code>query()</code> to print out every contact in the table.</p>`,16)),e(d,{data:[{id:"Before"},{id:"After"}],active:0},{title0:t(({value:l,isActive:p})=>[...a[43]||(a[43]=[s("Before",-1)])]),title1:t(({value:l,isActive:p})=>[...a[44]||(a[44]=[s("After",-1)])]),tab0:t(({value:l,isActive:p})=>[...a[45]||(a[45]=[n("div",{class:"language-swift line-numbers-mode","data-highlighter":"prismjs","data-ext":"swift"},[n("pre",null,[n("code",{class:"language-swift"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function-definition function"},"query"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"var"),s(" queryStatement"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"OpaquePointer"),n("span",{class:"token operator"},"?")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 1")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_prepare_v2"),n("span",{class:"token punctuation"},"("),s("db"),n("span",{class:"token punctuation"},","),s(" queryStatementString"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("queryStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token nil constant"},"nil"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s()]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token constant"},"SQLITE_OK"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 2")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_step"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_ROW"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 3")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" id "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sqlite3_column_int"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 4")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"guard"),s(),n("span",{class:"token keyword"},"let"),s(" queryResultCol1 "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sqlite3_column_text"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Query result is nil"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" name "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"("),s("cString"),n("span",{class:"token punctuation"},":"),s(" queryResultCol1"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 5")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nQuery Result:"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"'),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"id"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"}," | "),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"name"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nQuery returned no results."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token comment"},"// 6")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"let"),s(" errorMessage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"("),s("cString"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token function"},"sqlite3_errmsg"),n("span",{class:"token punctuation"},"("),s("db"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nQuery is not prepared '),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"errorMessage"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 7")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"sqlite3_finalize"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])]),tab1:t(({value:l,isActive:p})=>[...a[46]||(a[46]=[n("div",{class:"language-swift line-numbers-mode","data-highlighter":"prismjs","data-ext":"swift"},[n("pre",null,[n("code",{class:"language-swift"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function-definition function"},"query"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"var"),s(" queryStatement"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"OpaquePointer"),n("span",{class:"token operator"},"?")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"sqlite3_prepare_v2"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("    db"),n("span",{class:"token punctuation"},","),s()]),s(`
`),n("span",{class:"line"},[s("    queryStatementString"),n("span",{class:"token punctuation"},","),s()]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s()]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token operator"},"&"),s("queryStatement"),n("span",{class:"token punctuation"},","),s()]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token nil constant"},"nil")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_OK"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\n"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"while"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"sqlite3_step"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"SQLITE_ROW"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" id "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sqlite3_column_int"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"guard"),s(),n("span",{class:"token keyword"},"let"),s(" queryResultCol1 "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sqlite3_column_text"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Query result is nil."')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" name "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"("),s("cString"),n("span",{class:"token punctuation"},":"),s(" queryResultCol1"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"Query Result:"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"'),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"id"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"}," | "),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"name"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token keyword"},"let"),s(" errorMessage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"("),s("cString"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token function"},"sqlite3_errmsg"),n("span",{class:"token punctuation"},"("),s("db"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token function"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-literal"},[n("span",{class:"token string"},'"\\nQuery is not prepared '),n("span",{class:"token interpolation-punctuation punctuation"},"\\("),n("span",{class:"token interpolation"},"errorMessage"),n("span",{class:"token interpolation-punctuation punctuation"},")"),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token function"},"sqlite3_finalize"),n("span",{class:"token punctuation"},"("),s("queryStatement"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[s("Note that instead of using a single step to retrieve the first row as you did before, you use a "),n("code",null,"while"),s(" loop to execute the step, which will happen as long as the return code is "),n("code",null,"SQLITE_ROW"),s(". When you reach the last row, the return code will be "),n("code",null,"SQLITE_DONE"),s(", breaking the loop.")],-1)])]),_:1}),a[74]||(a[74]=c(`<p>So now, you have created a database and can add contacts to it. But what if you need to make changes to any of those contacts? You’ll tackle that issue in the next section.</p><h3 id="updating-contacts" tabindex="-1"><a class="header-anchor" href="#updating-contacts"><span>Updating Contacts</span></a></h3><p>Your next step is to update an existing row. Get started by creating the <code>UPDATE</code> statement:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> updateStatementString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;UPDATE Contact SET Name = &#39;Adam&#39; WHERE Id = 1;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Here, you’re using real values instead of <code>?</code> placeholders. You’d usually use the placeholders and bind the statements properly, but this tutorial will skip those steps for brevity.</p><p>Next, add the following function to the playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> updateStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> updateStatementString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>updateStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> </span>
<span class="line">      <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>updateStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nSuccessfully updated row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nCould not update row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nUPDATE statement is not prepared&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>updateStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is a similar flow to what you’ve seen before: prepare, step and finalize.</p><p>Next, add the following to your playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>This executes your new function, then calls your previously-defined <code>query()</code> function so that you can see the results:</p><p>Successfully updated row.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Query Result:</span>
<span class="line">1 | Adam</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Congratulations on updating your first row! How easy was that?</p><p>You’re doing great! You can now create a table, add contacts to it and update those contacts. In the next step, you’ll learn how to delete those contacts.</p><h3 id="deleting-contacts" tabindex="-1"><a class="header-anchor" href="#deleting-contacts"><span>Deleting Contacts</span></a></h3><p>The final step on the path to becoming an SQLite ninja is to delete the row you created. Again, you’ll use the familiar pattern of prepare, step and finalize.</p><p>Add the following to the playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> deleteStatementString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;DELETE FROM Contact WHERE Id = 1;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, add the following function to execute the statement:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> deleteStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> deleteStatementString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>deleteStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> </span>
<span class="line">      <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>deleteStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nSuccessfully deleted row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nCould not delete row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nDELETE statement could not be prepared&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>deleteStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Are you feeling it now? Prepare, step and finalize.</p><p>Execute this new function as below:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Run your playground and you should see the following output in your console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Successfully deleted row.</span>
<span class="line">Query returned no results.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Note</p><p>If you completed the <strong>Multiple Inserts</strong> challenge above, your output will look different from that above due to rows still being present in the table.</p></div><p>So you’ve now mastered working with your table, but what about when things inevitably go wrong? In the next section, you’ll learn how to deal with errors.</p><h3 id="handling-errors" tabindex="-1"><a class="header-anchor" href="#handling-errors"><span>Handling Errors</span></a></h3><p>Hopefully, you’ve managed to avoid SQLite errors up to this point. But the time will come when you make a call that doesn’t make sense or simply won’t compile.</p><p>Handling error message when these things happen saves a lot of development time. It also gives you the opportunity to present meaningful error messages to your users.</p><p>To start, you need an error to handle. Add the following statement, which is intentionally malformed:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> malformedQueryString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;SELECT Stuff from Things WHERE Whatever;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, add a function to execute this malformed statement:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">prepareMalformedQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> malformedStatement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> malformedQueryString<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>malformedStatement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> </span>
<span class="line">      <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nThis should not have happened.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    <span class="token keyword">let</span> errorMessage <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> <span class="token function">sqlite3_errmsg</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nQuery is not prepared! </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">errorMessage</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 3</span></span>
<span class="line">  <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>malformedStatement<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s how you’re going to force an error:</p><ol><li>Prepare the statement, which will fail and will NOT return <code>SQLITE_OK</code>.</li><li>Get the error message from the database using <code>sqlite3_errmsg()</code>. This returns a textual description of the most recent error. You then print the error to the console.</li><li>Finalize the statement.</li></ol><p>Call the function to see the error message:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">prepareMalformedQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run your playground. You’ll see the following output in your console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Query is not prepared! no such table: Things</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Well, that’s actually helpful — you obviously cannot run a <code>SELECT</code> statement on a table that doesn’t exist! Despite the intentional error that you created, you should use this example as a pattern for handling other errors from SQLite. Nice job!</p><h3 id="closing-the-database-connection" tabindex="-1"><a class="header-anchor" href="#closing-the-database-connection"><span>Closing the Database Connection</span></a></h3><p>When you’re done with a database connection, you’re responsible for closing it. But beware — there are a number of things you must do before you can successfully close your database, as described in the <a href="https://www.sqlite.org/c3ref/close.html" target="_blank" rel="noopener noreferrer">SQLite documentation</a>.</p><p>Call the close function:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">sqlite3_close</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run your playground. You’ll see a status code of 0 on the results sidebar, which represents <code>SQLITE_OK</code>.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_close_connection.png" alt="Successful close call" tabindex="0" loading="lazy"><figcaption>Successful close call</figcaption></figure><p>Great, your close call succeeded!</p><p>You’ve successfully created a database, added a table, added rows to the table, queried rows, updated rows and even deleted a row, all using the SQLite C APIs from Swift. Great job!</p><p>In the next section, you’ll see how to wrap some of these calls in Swift.</p><hr><h2 id="sqlite-with-swift" tabindex="-1"><a class="header-anchor" href="#sqlite-with-swift"><span>SQLite With Swift</span></a></h2><p>As a Swift developer, you might feel a little uneasy about the first part of this tutorial. The good news is you can take the power of Swift and wrap those C routines to make things easier for yourself.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2017/09/swift-weights-320x320.png" alt="swift-weights" tabindex="0" loading="lazy"><figcaption>swift-weights</figcaption></figure><p>For this part of the SQLite with Swift tutorial, click the <strong>Making It Swift</strong> link at the bottom of the playground:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_making_it_to_swift_highlighted.png" alt="Where to find the Making It Swift link" tabindex="0" loading="lazy"><figcaption>Where to find the Making It Swift link</figcaption></figure><h3 id="wrapping-errors" tabindex="-1"><a class="header-anchor" href="#wrapping-errors"><span>Wrapping Errors</span></a></h3><p>Getting errors from the C API is a bit awkward as a Swift developer. Checking a result code and then calling another function doesn’t make sense in this new world. It would make more sense if functions that fail threw an error. Your next step will be to make that happen in your code.</p><p>Add the following:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token class-name">OpenDatabase</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token class-name">Prepare</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token class-name">Step</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token class-name">Bind</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is a custom <code>Error</code> enum that covers four of the main operations you’re using that can fail. Note how each case has an associated value to hold the error message.</p><h3 id="wrapping-the-database-connection" tabindex="-1"><a class="header-anchor" href="#wrapping-the-database-connection"><span>Wrapping the Database Connection</span></a></h3><p>Another not-so-Swifty aspect of the work you’ve done so far is those blasted <code>OpaquePointer</code> types. Your next step will be to take care of those.</p><p>Wrap up the database connection pointer in its own class, as shown below:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">let</span> dbPointer<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span>dbPointer<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>dbPointer <span class="token operator">=</span> dbPointer</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">deinit</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">sqlite3_close</span><span class="token punctuation">(</span>dbPointer<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This looks much better. When you need a database connection, you create a reference to a more meaningful type of <code>SQLiteDatabase</code> rather than using an <code>OpaquePointer</code>.</p><p>You’ll notice the initializer is <code>private</code>. That’s because you don’t want your Swift developers passing in that <code>OpaquePointer</code>. Instead, you let them instantiate this class with a path to the database file.</p><p>Add the following static method to <code>SQLiteDatabase</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> db<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token function">sqlite3_open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">&amp;</span>db<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">SQLiteDatabase</span><span class="token punctuation">(</span>dbPointer<span class="token punctuation">:</span> db<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 3</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> db <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">sqlite3_close</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> errorPointer <span class="token operator">=</span> <span class="token function">sqlite3_errmsg</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> errorPointer<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">OpenDatabase</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> message<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token class-name">OpenDatabase</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;No error message provided from sqlite.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what’s happening:</p><ol><li>You attempt to open the database at the provided path.</li><li>If successful, you return a new instance of <code>SQLiteDatabase</code>.</li><li>Otherwise, you defer closing the database if the status code is anything but <code>SQLITE_OK</code> and throw an error.</li></ol><p>Now you can create and open a database connection using much cleaner syntax.</p><p>Add the following outside the <code>SQLiteDatabase</code> class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> db<span class="token punctuation">:</span> <span class="token class-name">SQLiteDatabase</span></span>
<span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">    db <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">SQLiteDatabase</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> part2DbPath <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Successfully opened connection to database.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">OpenDatabase</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to open database.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token class-name">PlaygroundPage</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">finishExecution</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ah, much more Swift-like. Here, you wrap the attempt to open the database in a <code>do-try-catch</code> block and pass the error message from SQLite to the catch block, thanks to that custom enum you added earlier.</p><p>Run your playground and watch the console output. You’ll see the following:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Successfully opened connection to database.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, you can use and inspect the <code>db</code> instance as a proper and meaningful type.</p><p>Before moving on to writing methods that execute statements, it would be nice if <code>SQLiteDatabase</code> let you easily access SQLite error messages.</p><p>Add the following computed property to the <code>SQLiteDatabase</code> class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">fileprivate</span> <span class="token keyword">var</span> errorMessage<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token keyword">let</span> errorPointer <span class="token operator">=</span> <span class="token function">sqlite3_errmsg</span><span class="token punctuation">(</span>dbPointer<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> errorMessage <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> errorPointer<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> errorMessage</span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;No error message provided from sqlite.&quot;</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, you’ve added a computed property, which simply returns the most recent error SQLite knows about. If there is no error, it returns a generic message stating as much.</p><h3 id="wrapping-the-prepare-call" tabindex="-1"><a class="header-anchor" href="#wrapping-the-prepare-call"><span>Wrapping the Prepare Call</span></a></h3><p>Since you make prepare calls so often, it makes sense to wrap them like the other methods. As you move forward and add functionality to the <code>SQLiteDatabase</code> class, you’ll use class extensions.</p><p>Add the following extension. This will be useful in your future methods to invoke <code>sqlite3_prepare_v2()</code> on SQL statements:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line"> <span class="token keyword">func</span> <span class="token function-definition function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> statement<span class="token punctuation">:</span> <span class="token class-name">OpaquePointer</span><span class="token operator">?</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token function">sqlite3_prepare_v2</span><span class="token punctuation">(</span>dbPointer<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>statement<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> </span>
<span class="line">      <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">Prepare</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> errorMessage<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> statement</span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, you declare that <code>prepareStatement(_:)</code> can throw an error and then use <code>guard</code> to throw that error should <code>sqlite3_prepare_v2()</code> fail. Just like before, you pass the error message from SQLite to the relevant case of your custom enum.</p><h3 id="creating-a-contact-struct" tabindex="-1"><a class="header-anchor" href="#creating-a-contact-struct"><span>Creating a Contact Struct</span></a></h3><p>Add the following:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">struct</span> <span class="token class-name">Contact</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">Int32</span></span>
<span class="line">  <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">NSString</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In these examples, you’ll use the same <code>Contact</code> table as before, so it makes sense to define a proper <code>struct</code> to represent a contact. Next, you’ll learn to actually create the table for a <code>Contact</code></p><h3 id="wrapping-the-table-creation" tabindex="-1"><a class="header-anchor" href="#wrapping-the-table-creation"><span>Wrapping the Table Creation</span></a></h3><p>You’ll knock out the same database tasks as before, but this time you’ll use a “Swift-ier” approach.</p><p>To create a table, first, create the following <code>protocol</code> for that purpose in your playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">protocol</span> <span class="token class-name">SQLTable</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">var</span> createStatement<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, extend <code>Contact</code> to conform to this new protocol:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span> <span class="token class-name">SQLTable</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">var</span> createStatement<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;&quot;&quot;</span>
<span class="line">    CREATE TABLE Contact(</span>
<span class="line">      Id INT PRIMARY KEY NOT NULL,</span>
<span class="line">      Name CHAR(255)</span>
<span class="line">    );</span>
<span class="line">    &quot;&quot;&quot;</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code defines <code>createStatement</code> and adds a <code>CREATE TABLE</code> statement on <code>Contact</code> which is useful for keeping the code grouped together.</p><p>Now, you’re able to write the following method that accepts types that conform to <code>SQLTable</code> to create a table:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">createTable</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">SQLTable</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1</span></span>
<span class="line">    <span class="token keyword">let</span> createTableStatement <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">:</span> table<span class="token punctuation">.</span>createStatement<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>createTableStatement<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 3</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>createTableStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">Step</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> errorMessage<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">table</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> table created.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s a breakdown of what’s happening:</p><ol><li><code>prepareStatement()</code> throws, so you must use <code>try</code>. You don’t use a <code>do-try-catch</code> block because this method itself throws, so any error from <code>prepareStatement()</code> simply passes to the caller of <code>createTable()</code>.</li><li>With the power of <code>defer</code>, you ensure that your statements are always finalized, regardless of how this method exits its scope.</li><li><code>guard</code> lets you write a more expressive check for the SQLite status codes.</li></ol><p>Give your new method a try by adding the following:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">Contact</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>errorMessage<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, you simply attempt to create the <code>Contact</code> and catch an error, if there is one.</p><p>Run your playground. The following will appear in your console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Contact table created.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Fantastic! Isn’t that a much cleaner API to work with?</p><h3 id="wrapping-insertions" tabindex="-1"><a class="header-anchor" href="#wrapping-insertions"><span>Wrapping Insertions</span></a></h3><p>Moving along, it’s time to insert a row into the <code>Contact</code> table. Add the following method in your playground:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">insertContact</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token class-name">Contact</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> insertSql <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;INSERT INTO Contact (Id, Name) VALUES (?, ?);&quot;</span></span></span>
<span class="line">    <span class="token keyword">let</span> insertStatement <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">:</span> insertSql<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">NSString</span> <span class="token operator">=</span> contact<span class="token punctuation">.</span>name</span>
<span class="line">    <span class="token keyword">guard</span> </span>
<span class="line">      <span class="token function">sqlite3_bind_int</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span>  <span class="token operator">&amp;&amp;</span></span>
<span class="line">      <span class="token function">sqlite3_bind_text</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>utf8String<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> </span>
<span class="line">        <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> </span>
<span class="line">      <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">Bind</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> errorMessage<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>insertStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_DONE</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token class-name">SQLiteError</span><span class="token punctuation">.</span><span class="token class-name">Step</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> errorMessage<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Successfully inserted row.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now that you’ve got your SQLegs - see what I did there? - this code shouldn’t be too surprising. Given a <code>Contact</code> instance, you prepare a statement, bind the values, execute and finalize.</p><p>Again, using a potent mix of <code>defer</code>, <code>guard</code> and <code>throw</code> allows you to take advantage of modern Swift language features.</p><p>Call this new method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">insertContact</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Ray&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>errorMessage<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Run your playground. You’ll see the following in your console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Successfully inserted row.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="wrapping-reads" tabindex="-1"><a class="header-anchor" href="#wrapping-reads"><span>Wrapping Reads</span></a></h3><p>To wrap up the last section on creating the Swift wrapper, you’ll handle querying the database.</p><p>Add the following method, which will query the database:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">SQLiteDatabase</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">contact</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">Int32</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Contact</span><span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> querySql <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;SELECT * FROM Contact WHERE Id = ?;&quot;</span></span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> queryStatement <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">:</span> querySql<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token nil constant">nil</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">sqlite3_finalize</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token function">sqlite3_bind_int</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_OK</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token nil constant">nil</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token function">sqlite3_step</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">SQLITE_ROW</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token nil constant">nil</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">sqlite3_column_int</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> queryResultCol1 <span class="token operator">=</span> <span class="token function">sqlite3_column_text</span><span class="token punctuation">(</span>queryStatement<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Query result is nil.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token nil constant">nil</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cString<span class="token punctuation">:</span> queryResultCol1<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">NSString</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> id<span class="token punctuation">,</span> name<span class="token punctuation">:</span> name<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This method simply takes the ID of a contact and either returns that contact or <code>nil</code>, if there isn’t a contact with that ID. Again, these statements should feel somewhat familiar by now.</p><p>Write the code to query the first contact:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> first <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">first<span class="token punctuation">.</span>id</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">first<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Run your playground. You’ll see the following output in the console:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">1 Ray</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>By now, you’ve probably identified some calls you could create in a generic fashion and apply to entirely different tables. The point of the above exercise is to show how you can use Swift to wrap low-level C APIs. This is no simple task for SQLite; there are a ton of intricacies to SQLite that this tutorial didn’t cover.</p><p>You might be thinking, “Hasn’t someone already created a wrapper for this?” That’s what the final section is all about.</p><hr>`,130)),n("h2",T,[n("a",E,[n("span",null,[a[47]||(a[47]=s("Introducing ",-1)),e(i,{icon:"fa-brands fa-swift"}),a[48]||(a[48]=n("code",null,"SQLite.swift",-1))])])]),n("p",null,[a[50]||(a[50]=n("a",{href:"https://twitter.com/stephencelis",target:"_blank",rel:"noopener noreferrer"},"Stephen Celis",-1)),a[51]||(a[51]=s(" has graciously written a fully-featured Swift wrapper for SQLite named ",-1)),n("a",I,[e(i,{icon:"fa-brands fa-swift"}),a[49]||(a[49]=n("code",null,"SQLite.swift",-1))]),a[52]||(a[52]=s(". Check it out if you decide that SQLite fits the bill for data storage in your app.",-1))]),a[75]||(a[75]=n("p",null,"SQLite.swift provides an expressive way to represent tables. This lets you get started with SQLite without worrying about its underlying details and idiosyncrasies.",-1)),a[76]||(a[76]=n("p",null,"You may even consider wrapping SQLite.swift itself to create a high-level API for your app’s domain model.",-1)),n("p",null,[a[54]||(a[54]=s("Check out the [README.md for ",-1)),n("a",C,[e(i,{icon:"fa-brands fa-swift"}),a[53]||(a[53]=n("code",null,"SQLite.swift",-1))]),a[55]||(a[55]=s(" and decide for yourself if it has a place in your personal code toolbox.",-1))]),a[77]||(a[77]=n("hr",null,null,-1)),a[78]||(a[78]=n("h2",{id:"where-to-go-from-here",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#where-to-go-from-here"},[n("span",null,"Where to Go From Here?")])],-1)),n("p",null,[a[57]||(a[57]=s("Download the completed project by using the ",-1)),n("a",_,[e(i,{icon:"fas fa-download"}),a[56]||(a[56]=n("code",null,"[Download Materials]",-1))]),a[58]||(a[58]=s(" button at the top or bottom of this tutorial. There, you can see other common tasks that this tutorial didn’t have time to cover, including the implemented updates, deletes and multiple row handling.",-1))]),a[79]||(a[79]=n("p",null,"Debugging is another important part of using SQLite with Swift. In many cases, you’ll need some kind of database browser to see what’s going on under the hood. There are many different apps that can help with this. A quick internet search will show which ones are best for you.",-1)),n("p",null,[a[59]||(a[59]=s("You can also access your SQLite databases directly from your Terminal by typing ",-1)),e(i,{icon:"fas fa-database"}),a[60]||(a[60]=n("code",null,"sqlite3 file.db",-1)),a[61]||(a[61]=s(". From there, use the ",-1)),a[62]||(a[62]=n("code",null,".help",-1)),a[63]||(a[63]=s(" command to see a list of commands, or simply start executing SQL statements directly at the prompt. Find more information on the command-line SQLite client on the ",-1)),a[64]||(a[64]=n("a",{href:"https://www.sqlite.org/cli.html",target:"_blank",rel:"noopener noreferrer"},"main SQLite site",-1)),a[65]||(a[65]=s(".",-1))]),a[80]||(a[80]=n("p",null,"I hope you enjoyed this whirlwind introduction to working with SQLite and Swift! If you have any questions or comments, please join the discussion below.",-1))])}const N=v(y,[["render",A]]),O=JSON.parse('{"path":"/kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started.html","title":"SQLite With Swift Tutorial: Getting Started","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"SQLite With Swift Tutorial: Getting Started","description":"Article(s) > SQLite With Swift Tutorial: Getting Started","icon":"fa-brands fa-swift","category":["Swift","SQLite","Article(s)"],"tag":["blog","kodeco.com","swift","ios","xcode","sqlite"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SQLite With Swift Tutorial: Getting Started\\",\\"image\\":[\\"https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_manually_run_playground_highlighted.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_show_debug_area-2.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-table.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_close_connection.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2017/09/swift-weights-320x320.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2019/11/sqliteswift_making_it_to_swift_highlighted.png\\"],\\"datePublished\\":\\"2020-01-13T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"SQLite With Swift Tutorial: Getting Started"}],["meta",{"property":"og:description","content":"Article(s) > SQLite With Swift Tutorial: Getting Started"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-twitter.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-twitter.png"}],["meta",{"name":"twitter:image:alt","content":"SQLite With Swift Tutorial: Getting Started"}],["meta",{"property":"article:tag","content":"sqlite"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"ios"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"kodeco.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2020-01-13T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > SQLite With Swift Tutorial: Getting Started"},{"property":"og:description","content":"SQLite With Swift Tutorial: Getting Started"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started.html"}]],"prev":"/programming/swift/articles/README.md","date":"2020-01-13T00:00:00.000Z","isOriginal":false,"cover":"https://koenig-media.raywenderlich.com/uploads/2019/12/SQLite-twitter.png"},"git":{},"readingTime":{"minutes":17.87,"words":5361},"filePathRelative":"kodeco.com/6620276-sqlite-with-swift-tutorial-getting-started.md"}');export{N as comp,O as data};
