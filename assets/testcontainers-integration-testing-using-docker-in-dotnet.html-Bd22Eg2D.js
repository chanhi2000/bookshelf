import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,d as s,f as a,b as l,t as g,n as b,g as h,w as t,e,r as o,o as y}from"./app-BItykJLQ.js";const f={},w={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},C={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},I={class:"table-of-contents"},S={href:"https://dotnet.testcontainers.org/",target:"_blank",rel:"noopener noreferrer"},T={href:"https://github.com/m-jovanovic/testcontainers-sample",target:"_blank",rel:"noopener noreferrer"},A={href:"https://youtu.be/tj5ZCtvgXKY",target:"_blank",rel:"noopener noreferrer"};function x(u,n){const d=o("VPCard"),i=o("router-link"),c=o("SiteInfo"),r=o("RouteLink"),p=o("VPIcon"),k=o("VidStack");return y(),m("div",null,[s("h1",w,[s("a",C,[s("span",null,g(u.$frontmatter.title)+" ê´€ë ¨",1)])]),a(d,b(h({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",I,[s("ul",null,[s("li",null,[a(i,{to:"#what-is-testcontainers"},{default:t(()=>[...n[0]||(n[0]=[e("What is Testcontainers?",-1)])]),_:1})]),s("li",null,[a(i,{to:"#implementing-a-custom-webapplicationfactory"},{default:t(()=>[...n[1]||(n[1]=[e("Implementing a Custom WebApplicationFactory",-1)])]),_:1})]),s("li",null,[a(i,{to:"#creating-the-base-test-class"},{default:t(()=>[...n[2]||(n[2]=[e("Creating The Base Test Class",-1)])]),_:1})]),s("li",null,[a(i,{to:"#putting-it-all-together-writing-integration-tests"},{default:t(()=>[...n[3]||(n[3]=[e("Putting It All Together - Writing Integration Tests",-1)])]),_:1})]),s("li",null,[a(i,{to:"#running-integration-tests-in-ci-cd-pipelines"},{default:t(()=>[...n[4]||(n[4]=[e("Running Integration Tests In CI/CD Pipelines",-1)])]),_:1})]),s("li",null,[a(i,{to:"#takeaway"},{default:t(()=>[...n[5]||(n[5]=[e("Takeaway",-1)])]),_:1})])])]),n[23]||(n[23]=s("hr",null,null,-1)),a(c,{name:"Solving Race Conditions With EF Core Optimistic Locking",desc:"Modern software applications rarely work in isolation. On the contrary, a typical application will talk to several external systems like databases, messaging systems, cache providers, and many 3rd party services. And it's up to you to ensure everything functions correctly. Hopefully, I don't have to convince you about the value of writing tests. You should be writing tests. Period. However, I do want to discuss the value of integration testing. Unit tests are helpful to test business logic in isolation, without any external services. They are easy to write and provide almost instant feedback. But you can't be fully confident in your application without integration tests.",url:"https://milanjovanovic.tech/blog/testcontainers-integration-testing-using-docker-in-dotnet/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_053.png"}),n[24]||(n[24]=l("<p>Modern software applications rarely work in isolation. On the contrary, a typical application will talk to several external systems like databases, messaging systems, cache providers, and many 3rd party services. And it&#39;s up to you to ensure everything functions correctly.</p><p>Hopefully, I don&#39;t have to convince you about the value of writing tests.</p><p>You should be writing tests. Period.</p><p>However, I do want to discuss the <em>value</em> of <strong>integration testing</strong>.</p><p><strong>Unit tests</strong> are helpful to test business logic in isolation, without any external services. They are easy to write and provide almost instant feedback.</p><p>But you can&#39;t be fully confident in your application without <strong>integration tests</strong>.</p><p>So, in this week&#39;s newsletter, I&#39;ll show you how to use <strong>Docker</strong> for integration testing.</p><p>Here&#39;s what we will use to write <strong>integration tests</strong>:</p>",8)),s("ul",null,[n[7]||(n[7]=s("li",null,[s("strong",null,"Testcontainers")],-1)),n[8]||(n[8]=s("li",null,"Docker",-1)),s("li",null,[a(r,{to:"/milanjovanovic.tech/creating-data-driven-tests-with-xunit.html"},{default:t(()=>[...n[6]||(n[6]=[s("strong",null,"xUnit",-1)])]),_:1})])]),n[25]||(n[25]=s("p",null,"Let's dive in!",-1)),n[26]||(n[26]=s("hr",null,null,-1)),n[27]||(n[27]=s("h2",{id:"what-is-testcontainers",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#what-is-testcontainers"},[s("span",null,"What is Testcontainers?")])],-1)),s("p",null,[s("a",S,[a(p,{icon:"iconfont icon-csharp"}),n[9]||(n[9]=e("Testcontainers",-1))]),n[10]||(n[10]=e(" is a library for writing tests with throwaway Docker containers.",-1))]),n[28]||(n[28]=l(`<p>Why should you use it?</p><p>Integration testing is considered &quot;difficult&quot; because you have to maintain testing infrastructure. Before running tests, you need to make sure the database is up and running. You also have to seed any data required for the tests. If you have tests running in parallel on the same database, they could interfere with each other.</p><p>A possible solution could be using in-memory variations of the required services. But this isn&#39;t much different from using mocks. In-memory services might not have all the features of the production service.</p><p>Testcontainers solves this by using Docker to spin up real services for integration testing.</p><p>Here&#39;s an example of creating a <strong>SQL Server</strong> container:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name">MsSqlContainer</span> dbContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MsSqlBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithImage</span><span class="token punctuation">(</span><span class="token string">&quot;mcr.microsoft.com/mssql/server:2022-latest&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithPassword</span><span class="token punctuation">(</span><span class="token string">&quot;Strong_password_123!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can then use the <code>MsSqlContainer</code> instance to get a connection string for the database running inside the container.</p><p>Do you see how this is valuable for writing integration tests?</p><p>No more need for mocks or fake in-memory databases. Instead, you can use the real deal.</p><p>I won&#39;t do a deep dive into this library here, so refer to the documentation for more information.</p><hr><h2 id="implementing-a-custom-webapplicationfactory" tabindex="-1"><a class="header-anchor" href="#implementing-a-custom-webapplicationfactory"><span>Implementing a Custom WebApplicationFactory</span></a></h2><p><strong>ASP.NET Core</strong> provides an in-memory test server that we can use to spin up an application instance for running tests. The <code>Microsoft.AspNetCore.Mvc.Testing</code> package provides the <code>WebApplicationFactory</code> class that we will use as the base for our implementation.</p><p><code>WebApplicationFactory&lt;TEntryPoint&gt;</code> is used to create a <code>TestServer</code> for the integration tests.</p><p>The custom <code>IntegrationTestWebAppFactory</code> will do a few things:</p><ul><li>Create and configure a <code>MsSqlContainer</code> instance</li><li>Call <code>ConfigureTestServices</code> to set up EF Core with the container database</li><li>Start and stop the container instance with <code>IAsyncLifetime</code></li></ul><p><code>MsSqlContainer</code> has a <code>GetConnectionString</code> method to grab the connection string for the current container. Note that this can change between tests, as each test class will create a separate container instance. Test cases inside the same test class will use the same container instance. So keep that in mind if you need to do a cleanup between tests.</p><p>Another thing to keep in mind is <strong>database migrations</strong>. You will have to run them manually before every test to create the required database structure.</p><p>Starting the container instance is done asynchronously using <code>IAsyncLifetime</code>. The container is started inside <code>StartAsync</code> before any of the tests run. And it&#39;s stopped inside <code>StopAsync</code>.</p><p>Here&#39;s the complete code for <code>IntegrationTestWebAppFactory</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntegrationTestWebAppFactory</span></span>
<span class="line">    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">WebApplicationFactory<span class="token punctuation">&lt;</span>Program<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token class-name">IAsyncLifetime</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">MsSqlContainer</span> _dbContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MsSqlBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">WithImage</span><span class="token punctuation">(</span><span class="token string">&quot;mcr.microsoft.com/mssql/server:2022-latest&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">WithPassword</span><span class="token punctuation">(</span><span class="token string">&quot;Strong_password_123!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureWebHost</span><span class="token punctuation">(</span><span class="token class-name">IWebHostBuilder</span> builder<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        builder<span class="token punctuation">.</span><span class="token function">ConfigureTestServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> descriptorType <span class="token operator">=</span></span>
<span class="line">                <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">DbContextOptions<span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> descriptor <span class="token operator">=</span> services</span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>ServiceType <span class="token operator">==</span> descriptorType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>descriptor <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                services<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line">                options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>_dbContainer<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">InitializeAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> _dbContainer<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name">Task</span> <span class="token function">DisposeAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> _dbContainer<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="creating-the-base-test-class" tabindex="-1"><a class="header-anchor" href="#creating-the-base-test-class"><span>Creating The Base Test Class</span></a></h2><p>The base test class will implement a class fixture interface <code>IClassFixture</code>. It indicates the class contains tests and provides shared object instances across the test cases inside. This is a good place to instantiate any services that are required for most tests.</p><p>For example, I&#39;m creating an <code>IServiceScope</code> for resolving scoped services inside the tests.</p><ul><li><code>ISender</code> for sending commands and queries</li><li><code>ApplicationDbContext</code> for database setup or verifying results</li></ul><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseIntegrationTest</span></span>
<span class="line">    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IClassFixture<span class="token punctuation">&lt;</span>IntegrationTestWebAppFactory<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token class-name">IDisposable</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IServiceScope</span> _scope<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">readonly</span> <span class="token class-name">ISender</span> Sender<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">readonly</span> <span class="token class-name">ApplicationDbContext</span> DbContext<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token function">BaseIntegrationTest</span><span class="token punctuation">(</span><span class="token class-name">IntegrationTestWebAppFactory</span> factory<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _scope <span class="token operator">=</span> factory<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">CreateScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        Sender <span class="token operator">=</span> _scope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISender<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        DbContext <span class="token operator">=</span> _scope<span class="token punctuation">.</span>ServiceProvider</span>
<span class="line">            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _scope<span class="token punctuation">?.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        DbContext<span class="token punctuation">?.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With all the infrastructure in place, we&#39;re finally ready to write the tests.</p><hr><h2 id="putting-it-all-together-writing-integration-tests" tabindex="-1"><a class="header-anchor" href="#putting-it-all-together-writing-integration-tests"><span>Putting It All Together - Writing Integration Tests</span></a></h2><p>Here&#39;s a <code>ProductTests</code> class with an integration test inside.</p><p>I use the <em>Arrange-Act-Assert</em> pattern to structure tests:</p><ul><li><em>Arrange</em>: create the <code>CreateProduct.Command</code> instance</li><li><em>Act</em>: send the command using <code>ISender</code> and store the result</li><li><em>Assert</em>: use the result from the <em>Act</em> step to verify the database state</li></ul><p>The value of writing integration tests like this is that you can use the complete <strong>MediatR</strong> request pipeline. If you have any <code>IPipelineBehavior</code> wrapping the request, it will also be executed.</p><p>The same applies if you write your business logic inside service classes. Instead of resolving the <code>ISender</code>, you would resolve the specific services you want to test.</p><p>Most importantly, this test uses a real database instance running inside a <strong>Docker container</strong>.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductTests</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BaseIntegrationTest</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">ProductTests</span><span class="token punctuation">(</span><span class="token class-name">IntegrationTestWebAppFactory</span> factory<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Create_ShouldCreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Arrange</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateProduct<span class="token punctuation">.</span>Command</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Name <span class="token operator">=</span> <span class="token string">&quot;AMD Ryzen 7 7700X&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            Category <span class="token operator">=</span> <span class="token string">&quot;CPU&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            Price <span class="token operator">=</span> <span class="token number">223.99m</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Act</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> productId <span class="token operator">=</span> <span class="token keyword">await</span> Sender<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Assert</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> DbContext</span>
<span class="line">            <span class="token punctuation">.</span>Products</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Id <span class="token operator">==</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="running-integration-tests-in-ci-cd-pipelines" tabindex="-1"><a class="header-anchor" href="#running-integration-tests-in-ci-cd-pipelines"><span>Running Integration Tests In CI/CD Pipelines</span></a></h2><p>You can also run integration tests with <strong>Testcontainers</strong> inside <strong>CI/CD pipelines</strong>. The only requirement is that it supports Docker.</p><p><strong>GitHub Actions</strong> does support Docker. If you are hosting your project there, integration tests will work out of the box.</p>`,41)),s("p",null,[n[12]||(n[12]=e("You can learn more about ",-1)),a(r,{to:"/milanjovanovic.tech/how-to-build-ci-cd-pipeline-with-github-actions-and-dotnet.html"},{default:t(()=>[...n[11]||(n[11]=[s("strong",null,"building a CI/CD pipeline with GitHub Actions here.",-1)])]),_:1})]),n[29]||(n[29]=l(`<p>And if you want a plug-in solution, here&#39;s a GitHub Actions workflow you can use:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">name</span><span class="token punctuation">:</span> Run Tests ðŸš€</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">on</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">push</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">branches</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> main</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">run-tests</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3</span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup .NET</span>
<span class="line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>dotnet@v3</span>
<span class="line">        <span class="token key atrule">with</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">dotnet-version</span><span class="token punctuation">:</span> <span class="token string">&#39;7.0.x&#39;</span></span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Restore</span>
<span class="line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet restore ./Products.Api.sln</span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build</span>
<span class="line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet build ./Products.Api.sln <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>restore</span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Test</span>
<span class="line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet test ./Products.Api.sln <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="takeaway" tabindex="-1"><a class="header-anchor" href="#takeaway"><span>Takeaway</span></a></h2><p><strong>Testcontainers</strong> is an excellent solution for writing <strong>integration tests</strong> with Docker. You can spin up and configure any <strong>Docker</strong> image and use it from your application. This is far better than using mocks or in-memory variations because they lack many features.</p><p>If you have a CI/CD pipeline that supports Docker, Testcontainers will work out of the box.</p><p>Only a few integration tests will drastically improve your confidence in the system.</p>`,7)),s("p",null,[n[17]||(n[17]=e("You can grab the ",-1)),s("a",T,[n[13]||(n[13]=s("strong",null,"source code for this newsletter",-1)),n[14]||(n[14]=e(" (",-1)),a(p,{icon:"iconfont icon-github"}),n[15]||(n[15]=s("code",null,"m-jovanovic/testcontainers-sample",-1)),n[16]||(n[16]=e(")",-1))]),n[18]||(n[18]=e(" on my GitHub.",-1)),n[19]||(n[19]=s("br",null,null,-1)),n[20]||(n[20]=e("It's completely free, so what are you waiting for?",-1))]),a(c,{name:"m-jovanovic/testcontainers-sample",desc:"Sample project showing how to write integration tests with Testcontainers.",url:"https://github.com/m-jovanovic/testcontainers-sample",logo:"https://avatars.githubusercontent.com/u/34191235?s=96&v=4",preview:"https://opengraph.githubassets.com/f1f6b9942d2eeb4fdb07fe27c2cd8a3f92c0eacf5e60fbad2c11cc0168823a85/m-jovanovic/testcontainers-sample"}),s("p",null,[n[22]||(n[22]=e("And if you prefer video, here's a quick tutorial on ",-1)),s("a",A,[a(p,{icon:"fa-brands fa-youtube"}),n[21]||(n[21]=s("strong",null,"integration testing with Testcontainers.",-1))])]),a(k,{src:"youtube/tj5ZCtvgXKY"}),n[30]||(n[30]=s("p",null,"Hope this was valuable.",-1)),n[31]||(n[31]=s("p",null,"Stay awesome!",-1))])}const P=v(f,[["render",x]]),W=JSON.parse('{"path":"/milanjovanovic.tech/testcontainers-integration-testing-using-docker-in-dotnet.html","title":"Solving Race Conditions With EF Core Optimistic Locking","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Solving Race Conditions With EF Core Optimistic Locking","description":"Article(s) > Solving Race Conditions With EF Core Optimistic Locking","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Solving Race Conditions With EF Core Optimistic Locking\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_053.png\\"],\\"datePublished\\":\\"2023-09-02T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/testcontainers-integration-testing-using-docker-in-dotnet.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Solving Race Conditions With EF Core Optimistic Locking"}],["meta",{"property":"og:description","content":"Article(s) > Solving Race Conditions With EF Core Optimistic Locking"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_053.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_053.png"}],["meta",{"name":"twitter:image:alt","content":"Solving Race Conditions With EF Core Optimistic Locking"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2023-09-02T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Solving Race Conditions With EF Core Optimistic Locking"},{"property":"og:description","content":"Solving Race Conditions With EF Core Optimistic Locking"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/testcontainers-integration-testing-using-docker-in-dotnet.html"}]],"prev":"/programming/cs/articles/README.md","date":"2023-09-02T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_053.png"},"git":{},"readingTime":{"minutes":5.05,"words":1514},"filePathRelative":"milanjovanovic.tech/testcontainers-integration-testing-using-docker-in-dotnet.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{P as comp,W as data};
