import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,d as s,f as t,b as h,t as g,n as m,g as v,w as e,e as a,r as p,o as b}from"./app-BItykJLQ.js";const f="/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/11-Angular-Authentication-Login-Console-logs.png",y="/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/12-Logout-button-shows-for-the-Angular-Authentication.png",w="/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/13-Angular-Authentication-Session-Storage-User-Object.png",A="/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/14-Access-Token-Decoded.png",S="/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/15-Id-Token-Decoded.png",C={},I={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},L={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},x={class:"table-of-contents"},j={class:"hint-container info"},z={href:"https://github.com/CodeMazeBlog/angular-identityserver4/tree/angual-authentication-identityserver4",target:"_blank",rel:"noopener noreferrer"};function T(l,n){const u=p("VPCard"),o=p("router-link"),c=p("SiteInfo"),i=p("RouteLink"),r=p("VPIcon");return b(),k("div",null,[s("h1",I,[s("a",L,[s("span",null,g(l.$frontmatter.title)+" ê´€ë ¨",1)])]),t(u,m(v({title:"Angular.js > Article(s)",desc:"Article(s)",link:"/programming/js-angular/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",x,[s("ul",null,[s("li",null,[t(o,{to:"#completing-the-login-functionality-in-the-angular-authentication-process"},{default:e(()=>[...n[0]||(n[0]=[a("Completing the Login Functionality in the Angular Authentication Process",-1)])]),_:1}),s("ul",null,[s("li",null,[t(o,{to:"#adding-signin-redirect-callback-component"},{default:e(()=>[...n[1]||(n[1]=[a("Adding Signin-Redirect-Callback Component",-1)])]),_:1})])])]),s("li",null,[t(o,{to:"#adding-logout-functionality-to-the-angular-authentication-process"},{default:e(()=>[...n[2]||(n[2]=[a("Adding Logout Functionality to the Angular Authentication Process",-1)])]),_:1}),s("ul",null,[s("li",null,[t(o,{to:"#singout-redirect-callback-component-creation"},{default:e(()=>[...n[3]||(n[3]=[a("Singout-Redirect-Callback Component Creation",-1)])]),_:1})])])]),s("li",null,[t(o,{to:"#inspecting-tokens"},{default:e(()=>[...n[4]||(n[4]=[a("Inspecting Tokens",-1)])]),_:1})]),s("li",null,[t(o,{to:"#conclusion"},{default:e(()=>[...n[5]||(n[5]=[a("Conclusion",-1)])]),_:1})])])]),n[24]||(n[24]=s("hr",null,null,-1)),t(c,{name:"Angular Authentication Actions with IdentityServer4",desc:"In this article, we are going to learn about Angular authentication implementation with the Login and Logout actions, and menu modifications.",url:"https://code-maze.com/angular-authentication-actions-with-identityserver4/",logo:"/assets/image/code-maze.com/favicon.png",preview:"/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/banner.png"}),s("p",null,[n[7]||(n[7]=a("In ",-1)),t(i,{to:"/code-maze.com/angular-oauth2-oidc-configuration-identityserver4.html"},{default:e(()=>[...n[6]||(n[6]=[a("the previous article",-1)])]),_:1}),n[8]||(n[8]=a(", we have learned how to integrate an Angular application with IdentityServer4 and how to allow communication between these two projects. The configuration is prepared on both sides and as soon as we click the Login button, we get directed to the Login screen on the IDP level. But when we enter valid credentials, we get redirected to the Angular application on the Not Found (404) page. Thatâ€™s because we didnâ€™t finish the implementation of the Angular authentication actions. So, in this one, we are going to finish the Angular authentication implementation with the Login and Logout actions.",-1))]),s("p",null,[n[10]||(n[10]=a("That said, we strongly recommend ",-1)),t(i,{to:"/code-maze.com/angular-oauth2-oidc-configuration-identityserver4.html"},{default:e(()=>[...n[9]||(n[9]=[a("reading the previous article",-1)])]),_:1}),n[11]||(n[11]=a(" to keep track of all the things we implemented up until now.",-1))]),s("p",null,[n[13]||(n[13]=a("Additionally, if you want to read the ",-1)),t(i,{to:"/code-maze.com/identityserver-4-series.html"},{default:e(()=>[...n[12]||(n[12]=[a("entire IdentityServer4, OAuth2, and OIDC series",-1)])]),_:1}),n[14]||(n[14]=a(", feel free to do that and learn a lot more about the application security in ASP.NET Core.",-1))]),s("div",j,[n[20]||(n[20]=s("p",{class:"hint-container-title"},"Info",-1)),s("p",null,[n[18]||(n[18]=a("To download the source code for this article, you can visit the ",-1)),s("a",z,[n[15]||(n[15]=a("Angular Authentication with IdentityServer4 (",-1)),t(r,{icon:"iconfont icon-github"}),n[16]||(n[16]=s("code",null,"CodeMazeBlog/angular-identityserver4",-1)),n[17]||(n[17]=a(")",-1))]),n[19]||(n[19]=a(" repository.",-1))]),t(c,{name:"CodeMazeBlog/angular-identityserver4",desc:"This repo contains the source code for the 'Angular with IdentityServer4' series of articles on Code Maze",url:"https://github.com/CodeMazeBlog/angular-identityserver4/tree/angual-authentication-identityserver4",logo:"https://avatars.githubusercontent.com/u/29179238?v=4",preview:"https://opengraph.githubassets.com/1e5a2c66415eaf85520fb3b5661bb000341bc94f928955a5494d4a8d8e1a9e31/CodeMazeBlog/angular-identityserver4"})]),n[25]||(n[25]=h(`<p>So, letâ€™s start.</p><hr><h2 id="completing-the-login-functionality-in-the-angular-authentication-process" tabindex="-1"><a class="header-anchor" href="#completing-the-login-functionality-in-the-angular-authentication-process"><span>Completing the Login Functionality in the Angular Authentication Process</span></a></h2><p>If you inspect our work so far, you will find the code in the <code>AuthService</code> class and some modifications in the <code>app.component.ts</code> file to check for the authenticated user. This code provides the functionality to navigate to the IDP server and once we enter credentials, to navigate back to the Angular application. But as soon as we navigate back to the Angular application, we need to complete the signin process because we donâ€™t want to navigate the user to the Not Found page. To do that, we have to process the response from the <code>/authorization</code> endpoint and populate the user object with the id and access tokens.</p><p>That said, letâ€™s add a new function in the <code>AuthService</code> class:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">public</span> finishLogin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userManager<span class="token punctuation">.</span><span class="token function">signinRedirectCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_user <span class="token operator">=</span> user<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_loginChangedSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> user<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this function, we call the <code>signinRedirectCallback</code> function that processes the response from the <code>/authorization</code> endpoint and returns a promise. From that promise, we extract the user object and populate the <code>_user</code> property. Additionally, we call the <code>next</code> function from the observable to inform any subscribed component about the Angular authentication state change, and finally, return that user.</p><h3 id="adding-signin-redirect-callback-component" tabindex="-1"><a class="header-anchor" href="#adding-signin-redirect-callback-component"><span>Adding Signin-Redirect-Callback Component</span></a></h3><p>Now, we have to create the signin component, use this function, and react to the redirect action from the IDP server:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ng g c signin-redirect-callback <span class="token parameter variable">--skipTests</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We can remove the HTML and CSS files because we donâ€™t need them, and modify the <code>.ts</code> file:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared/services/auth.service&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  selector<span class="token operator">:</span> <span class="token string">&#39;app-signin-redirect-callback&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;div&gt;&lt;/div&gt;</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SigninRedirectCallbackComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> _authService<span class="token operator">:</span> AuthService<span class="token punctuation">,</span> <span class="token keyword">private</span> _router<span class="token operator">:</span> Router<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_authService<span class="token punctuation">.</span><span class="token function">finishLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> replaceUrl<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see, we only have an empty div element for the template part and thatâ€™s the reason why we removed the HTML file. Additionally, in the <code>ngOnInit</code> function, we call the <code>finishLogin</code> function from the <code>AuthService</code> and just navigate the user to the home page. We set the <code>replaceUrl</code> property to true because we want to remove this component from the navigation stack.</p><p>After that, we have to add the route to this component in the <code>app.module.ts</code> file:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">RouterModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> HomeComponent <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;company&#39;</span><span class="token punctuation">,</span> <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./company/company.module&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>CompanyModule<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;signin-callback&#39;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> SigninRedirectCallbackComponent <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;404&#39;</span><span class="token punctuation">,</span> component <span class="token operator">:</span> NotFoundComponent<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> redirectTo<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span> pathMatch<span class="token operator">:</span> <span class="token string">&#39;full&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;**&#39;</span><span class="token punctuation">,</span> redirectTo<span class="token operator">:</span> <span class="token string">&#39;/404&#39;</span><span class="token punctuation">,</span> pathMatch<span class="token operator">:</span> <span class="token string">&#39;full&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The value of the path property must match the value we assigned to the <code>redirect_uri</code> property of the <code>UserManager</code> settings in the <code>AuthService</code> class.</p><p>Now, we can test this.</p><ul><li>Letâ€™s start the IDP server and the Angular application</li><li>Once both started, we can click the Login link in the Angular menu</li><li>After the Login screen appears, we should enter valid credentials and click the Login button</li><li>Soon after, the application navigates us to the Home screen</li></ul><p>Excellent.</p><p>We can check the logs, to verify what happens behind the scenes:</p><figure><img src="`+f+`" alt="Angular Authentication Login Console logs" tabindex="0" loading="lazy"><figcaption>Angular Authentication Login Console logs</figcaption></figure><p>We can see the request to the <code>/token</code> endpoint that takes place after we finish the login action. Also, we can see the successful token validation and the call towards the <code>/userinfo</code> endpoint. The <code>given_name</code> and the <code>family_name</code> claims were returned to the client application.</p><hr><h2 id="adding-logout-functionality-to-the-angular-authentication-process" tabindex="-1"><a class="header-anchor" href="#adding-logout-functionality-to-the-angular-authentication-process"><span>Adding Logout Functionality to the Angular Authentication Process</span></a></h2><p>After we log in and land on the Home page, we can still see the Login link on the menu. This is not user-friendly at all, and there is no way to log out from the application (unless we manually clear the siteâ€™s data).</p><p>To fix this, letâ€™s open the <code>AuthService</code> class and add two functions inside:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">public</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>_userManager<span class="token punctuation">.</span><span class="token function">signoutRedirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token function-variable function">finishLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>_user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userManager<span class="token punctuation">.</span><span class="token function">signoutRedirectCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the <code>logout</code> function, we call the <code>signoutRedirect</code> function to redirect the flow to the IDP server to execute the logout action. Additionally, we create the <code>finishLogout</code> function, set the <code>_user</code> object to null, and call the <code>singoutRedirectCallback</code> function to finish the signout process.</p><p>Then, letâ€™s navigate to the <code>menu.component.html</code> file, modify the Login link, and add the Logout link:</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!isUserAuthenticated<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-link<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>gray</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isUserAuthenticated<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-link<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>gray</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We also have to modify the <code>menu.component.ts</code> file:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MenuComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">public</span> isUserAuthenticated<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> _authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_authService<span class="token punctuation">.</span>loginChanged</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>isUserAuthenticated <span class="token operator">=</span> res<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">public</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">public</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_authService<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the <code>ngOnInit</code> function, we subscribe to the <code>loginChanged</code> observable and set the <code>isUserAuthenticated</code> property. This will help our application decide which link to show (Login or Logout). Also, we have the <code>logout</code> function that just calls the <code>logout</code> function from the <code>AuthService</code> class.</p><h3 id="singout-redirect-callback-component-creation" tabindex="-1"><a class="header-anchor" href="#singout-redirect-callback-component-creation"><span>Singout-Redirect-Callback Component Creation</span></a></h3><p>Now, as we did with the <code>signin-redirect-callback</code> component, we are going to create the <code>signout-redirect-callback</code> component:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ng g c signout-redirect-callback <span class="token parameter variable">--skipTests</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After the creation, letâ€™s remove the <code>.html</code> and <code>.css</code> files and modify the <code>.ts</code> file:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared/services/auth.service&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  selector<span class="token operator">:</span> <span class="token string">&#39;app-signout-redirect-callback&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;div&gt;&lt;/div&gt;</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SignoutRedirectCallbackComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> _authService<span class="token operator">:</span> AuthService<span class="token punctuation">,</span> <span class="token keyword">private</span> _router<span class="token operator">:</span> Router<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>_authService<span class="token punctuation">.</span><span class="token function">finishLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> replaceUrl<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thatâ€™s pretty much it. We just navigate to the home page as soon as this component initializes.</p><p>Finally, we have to add the route to this component in the <code>app.module.ts</code> file:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">RouterModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> HomeComponent <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;company&#39;</span><span class="token punctuation">,</span> <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./company/company.module&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>CompanyModule<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;signin-callback&#39;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> SigninRedirectCallbackComponent <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;signout-callback&#39;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> SignoutRedirectCallbackComponent <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;404&#39;</span><span class="token punctuation">,</span> component <span class="token operator">:</span> NotFoundComponent<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> redirectTo<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span> pathMatch<span class="token operator">:</span> <span class="token string">&#39;full&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;**&#39;</span><span class="token punctuation">,</span> redirectTo<span class="token operator">:</span> <span class="token string">&#39;/404&#39;</span><span class="token punctuation">,</span> pathMatch<span class="token operator">:</span> <span class="token string">&#39;full&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Excellent.</p><p>Now, letâ€™s start our applications and login with valid credentials.</p><p>Soon after that, the application redirects us to the Home page and the Logout button will appear:</p><figure><img src="`+y+'" alt="Logout button shows for the Angular Authentication" tabindex="0" loading="lazy"><figcaption>Logout button shows for the Angular Authentication</figcaption></figure><p>Looks good.</p><p>Additionally, if we open the Developer Tools window and navigate to the Application tab, we can find the user object in the Session Storage menu:</p><figure><img src="'+w+'" alt="Angular Authentication Session Storage User Object" tabindex="0" loading="lazy"><figcaption>Angular Authentication Session Storage User Object</figcaption></figure><p>Finally, letâ€™s click the Logout button.</p><p>As soon as we do that, the application redirects us to the IDP level, and then back to the Home page with the Login link displayed. Of course, you can inspect the Session Storage to confirm that the user object is removed.</p><hr><h2 id="inspecting-tokens" tabindex="-1"><a class="header-anchor" href="#inspecting-tokens"><span>Inspecting Tokens</span></a></h2><p>If we decode the access token, we can see what it consists of:</p><figure><img src="'+A+'" alt="Access Token Decoded" tabindex="0" loading="lazy"><figcaption>Access Token Decoded</figcaption></figure><p>We can see the <code>not before (nbf)</code> and <code>expiry (exp)</code> properties both JSON time stamped. Then, we can see the <code>issuer (iss)</code> that points to the IDP server address. Of course, we wonâ€™t go through each of them, but you can pay attention to the <code>issuer (iss)</code> pointing to the IDP server URI, the <code>audience (aud)</code> that has the value of the API scope, <code>client_id</code>, the <code>subject identifier (sub)</code>, <code>scope</code> with all the supported scopes and <code>amr</code> (Authentication Methods References) with the password-based authentication (<code>pwd</code>) value.</p><p>We can also inspect the id_token:</p><figure><img src="'+S+'" alt="Id Token Decoded" tabindex="0" loading="lazy"><figcaption>Id Token Decoded</figcaption></figure><p>Here, we can see many properties we already saw in the access token. Just to mention one thing, this time the audience (aud) property has a value of the client id and not the API scope.</p><p>We can extract all this information in our Angular application by using the <code>getUser</code> function from the <code>UserManager</code> class. If you inspect the <code>isAuthenticated</code> function in the <code>AuthService</code> class, you can see that the <code>getUser</code> function returns a promise with the user object inside. Once we extract that user object, we can access all these properties.</p><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>Excellent job.</p><p>Now, we know how to create Login action with Angular and IdentityServer4 and what components we require to do so. Similarly, we have learned how to create a Logout action and what components it requires for the redirection purpose. Finally, we have inspected the id token and the access token to verify all the information they consist of.</p>',63)),s("p",null,[n[22]||(n[22]=a("In the next article, we are going to learn about ",-1)),t(i,{to:"/code-maze.com/secure-angular-calls-to-webapi-using-access-token.html"},{default:e(()=>[...n[21]||(n[21]=[a("using the access token to secure communication between the Angular application and Web API",-1)])]),_:1}),n[23]||(n[23]=a(".",-1))])])}const q=d(C,[["render",T]]),M=JSON.parse('{"path":"/code-maze.com/angular-authentication-actions-with-identityserver4.html","title":"Angular Authentication Actions with IdentityServer4","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Angular Authentication Actions with IdentityServer4","description":"Article(s) > Angular Authentication Actions with IdentityServer4","icon":"fa-brands fa-angular","category":["Node.js","Angular.js","C#","Article(s)"],"tag":["blog","code-maze.com","node","nodejs","node-js","angular","angularjs","angular-js","cs","c#","csharp"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Angular Authentication Actions with IdentityServer4\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/11-Angular-Authentication-Login-Console-logs.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/12-Logout-button-shows-for-the-Angular-Authentication.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/13-Angular-Authentication-Session-Storage-User-Object.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/14-Access-Token-Decoded.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/15-Id-Token-Decoded.png\\"],\\"datePublished\\":\\"2021-12-27T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/angular-authentication-actions-with-identityserver4.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Angular Authentication Actions with IdentityServer4"}],["meta",{"property":"og:description","content":"Article(s) > Angular Authentication Actions with IdentityServer4"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/banner.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/banner.png"}],["meta",{"name":"twitter:image:alt","content":"Angular Authentication Actions with IdentityServer4"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"angular-js"}],["meta",{"property":"article:tag","content":"angularjs"}],["meta",{"property":"article:tag","content":"angular"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"code-maze.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2021-12-27T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Angular Authentication Actions with IdentityServer4"},{"property":"og:description","content":"Angular Authentication Actions with IdentityServer4"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/angular-authentication-actions-with-identityserver4.html"}]],"prev":"/programming/js-angular/articles/README.md","date":"2021-12-27T00:00:00.000Z","isOriginal":false,"cover":"/assets/image/code-maze.com/angular-authentication-actions-with-identityserver4/banner.png"},"git":{},"readingTime":{"minutes":6.22,"words":1867},"filePathRelative":"code-maze.com/angular-authentication-actions-with-identityserver4.md"}');export{q as comp,M as data};
