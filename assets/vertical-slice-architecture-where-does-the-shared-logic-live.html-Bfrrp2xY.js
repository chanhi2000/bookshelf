import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as s,f as a,b as l,a as k,t as b,n as u,g as d,w as t,e as n,r,o as f}from"./app-BItykJLQ.js";const y={},w={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},S={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},T={class:"table-of-contents"};function C(h,e){const p=r("VPCard"),i=r("router-link"),m=r("SiteInfo"),o=r("RouteLink"),c=r("VPIcon");return f(),g("div",null,[s("h1",w,[s("a",S,[s("span",null,b(h.$frontmatter.title)+" ê´€ë ¨",1)])]),a(p,u(d({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",T,[s("ul",null,[s("li",null,[a(i,{to:"#the-guardrails-vs-the-open-road"},{default:t(()=>[...e[0]||(e[0]=[n("The Guardrails vs. The Open Road",-1)])]),_:1})]),s("li",null,[a(i,{to:"#the-trap-the-common-junk-drawer"},{default:t(()=>[...e[1]||(e[1]=[n('The Trap: The "Common" Junk Drawer',-1)])]),_:1})]),s("li",null,[a(i,{to:"#the-decision-framework"},{default:t(()=>[...e[2]||(e[2]=[n("The Decision Framework",-1)])]),_:1})]),s("li",null,[a(i,{to:"#the-three-tiers-of-sharing"},{default:t(()=>[...e[3]||(e[3]=[n("The Three Tiers of Sharing",-1)])]),_:1}),s("ul",null,[s("li",null,[a(i,{to:"#tier-1-technical-infrastructure-share-freely"},{default:t(()=>[...e[4]||(e[4]=[n("Tier 1: Technical Infrastructure (Share Freely)",-1)])]),_:1})]),s("li",null,[a(i,{to:"#tier-2-domain-concepts-share-and-push-logic-down"},{default:t(()=>[...e[5]||(e[5]=[n("Tier 2: Domain Concepts (Share and Push Logic Down)",-1)])]),_:1})]),s("li",null,[a(i,{to:"#tier-3-feature-specific-logic-keep-it-local"},{default:t(()=>[...e[6]||(e[6]=[n("Tier 3: Feature-Specific Logic (Keep It Local)",-1)])]),_:1})])])]),s("li",null,[a(i,{to:"#cross-feature-sharing"},{default:t(()=>[...e[7]||(e[7]=[n("Cross-Feature Sharing",-1)])]),_:1})]),s("li",null,[a(i,{to:"#when-duplication-is-the-right-call"},{default:t(()=>[...e[8]||(e[8]=[n("When Duplication Is the Right Call",-1)])]),_:1})]),s("li",null,[a(i,{to:"#the-practical-structure"},{default:t(()=>[...e[9]||(e[9]=[n("The Practical Structure",-1)])]),_:1})]),s("li",null,[a(i,{to:"#the-rules"},{default:t(()=>[...e[10]||(e[10]=[n("The Rules",-1)])]),_:1})]),s("li",null,[a(i,{to:"#takeaway"},{default:t(()=>[...e[11]||(e[11]=[n("Takeaway",-1)])]),_:1})])])]),e[41]||(e[41]=s("hr",null,null,-1)),a(m,{name:"Vertical Slice Architecture: Where Does the Shared Logic Live?",desc:"Deciding where shared logic lives is the most critical moment in Vertical Slice Architecture adoption, as choosing incorrectly reintroduces the coupling the architecture aims to eliminate. This article proposes a three-tier approach to sharing code that balances technical infrastructure, domain concepts, and local feature logic.",url:"https://milanjovanovic.tech/blog/vertical-slice-architecture-where-does-the-shared-logic-live",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_170.png"}),s("p",null,[a(o,{to:"/milanjovanovic.tech/vertical-slice-architecture.html"},{default:t(()=>[...e[12]||(e[12]=[s("strong",null,"Vertical Slice Architecture",-1)])]),_:1}),e[13]||(e[13]=n(" (VSA) seems like a breath of fresh air when you first encounter it. You stop jumping between seven layers to add a single field. You delete the dozens of projects in your solution. You feel liberated.",-1))]),e[42]||(e[42]=l('<p>But when you start implementing more complex features, the cracks begin to show.</p><p>You build a <code>CreateOrder</code> slice. Then <code>UpdateOrder</code>. Then <code>GetOrder</code>. Suddenly, you notice the repetition. The address validation logic is in three places. The pricing algorithm is needed by both Cart and Checkout.</p><p>You feel the urge to create a <code>Common</code> project or <code>SharedServices</code> folder. This is the most critical moment in your VSA adoption.</p><p>Choose wrong, and you&#39;ll reintroduce the coupling you were trying to escape. Choose right, and you maintain the independence that makes VSA worthwhile.</p><p>Here&#39;s how I approach <strong>shared code</strong> in <strong>Vertical Slice Architecture</strong>.</p><hr><h2 id="the-guardrails-vs-the-open-road" tabindex="-1"><a class="header-anchor" href="#the-guardrails-vs-the-open-road"><span>The Guardrails vs. The Open Road</span></a></h2><p>To understand why this is hard, we need to look at what we left behind.</p>',8)),s("p",null,[a(o,{to:"/milanjovanovic.tech/clean-architecture-the-missing-chapter.html"},{default:t(()=>[...e[14]||(e[14]=[s("strong",null,"Clean Architecture",-1)])]),_:1}),e[15]||(e[15]=n(" provides strict guardrails. It tells you exactly where code lives: Entities go in Domain, interfaces go in Application, implementations go in Infrastructure. It's safe. It prevents mistakes, but it also prevents shortcuts when they're appropriate.",-1))]),s("p",null,[a(o,{to:"/milanjovanovic.tech/vertical-slice-architecture-structuring-vertical-slices.html"},{default:t(()=>[...e[16]||(e[16]=[s("strong",null,"Vertical Slice Architecture",-1)])]),_:1}),e[17]||(e[17]=n(' removes the guardrails. It says, "Organize code by feature, not technical concern". This gives you speed and flexibility, but it shifts the burden of discipline onto ',-1)),e[18]||(e[18]=s("em",null,"you",-1)),e[19]||(e[19]=n(".",-1))]),e[43]||(e[43]=l(`<p>So what can you do about it?</p><hr><h2 id="the-trap-the-common-junk-drawer" tabindex="-1"><a class="header-anchor" href="#the-trap-the-common-junk-drawer"><span>The Trap: The &quot;Common&quot; Junk Drawer</span></a></h2><p>The path of least resistance is to create a project (or folder) named <code>Shared</code>, <code>Common</code>, or <code>Utils</code>.</p><p>This is almost always a mistake.</p><p>Imagine a <code>Common.Services</code> project with an <code>OrderCalculationService</code> class. It has a method for cart totals (used by Cart), another for historical revenue (used by Reporting), and a helper for invoice formatting (used by Invoices). Three unrelated concerns. Three different change frequencies. One class coupling them all together.</p><p>A <code>Common</code> project inevitably becomes a junk drawer for anything you can&#39;t be bothered to name properly. It creates a tangled web of dependencies where unrelated features are coupled together because they happen to use the same helper method.</p><p>You&#39;ve reintroduced the very coupling you tried to escape.</p><hr><h2 id="the-decision-framework" tabindex="-1"><a class="header-anchor" href="#the-decision-framework"><span>The Decision Framework</span></a></h2><p>When I hit a potential sharing situation, I ask three questions:</p><p><strong>1. Is this infrastructural or domain?</strong></p><p>Infrastructure (database contexts, logging, HTTP clients) almost always gets shared. Domain concepts need more scrutiny.</p><p><strong>2. How stable is this concept?</strong></p><p>If it changes once a year, share it. If it changes with every feature request, keep it local.</p><p><strong>3. Am I past the &quot;Rule of Three&quot;?</strong></p><p>Duplicating the same code once is fine. However, creating three duplicates should raise an eyebrow. Don&#39;t abstract until you hit three.</p><p>We solve this by refactoring our code. Let&#39;s look at some examples.</p><hr><h2 id="the-three-tiers-of-sharing" tabindex="-1"><a class="header-anchor" href="#the-three-tiers-of-sharing"><span>The Three Tiers of Sharing</span></a></h2><p>Instead of binary &quot;Shared vs. Not Shared,&quot; think in three tiers.</p><h3 id="tier-1-technical-infrastructure-share-freely" tabindex="-1"><a class="header-anchor" href="#tier-1-technical-infrastructure-share-freely"><span>Tier 1: Technical Infrastructure (Share Freely)</span></a></h3><p>Pure plumbing that affects all slices equally: logging adapters, database connection factories, auth middleware, the <a href="/milanjovanovic.tech/functional-error-handling-in-dotnet-with-the-result-pattern" target="_blank" rel="noopener noreferrer"><strong>Result pattern</strong></a>, validation pipelines.</p><p>Centralize this in a <code>Shared.Kernel</code> or <code>Infrastructure</code> project. Note that this can also be a folder within your solution. It rarely changes due to business requirements.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// âœ… Good Sharing: Technical Kernel</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">readonly</span> <span class="token keyword">record</span> <span class="token class-name"><span class="token keyword">struct</span></span> Result</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsSuccess <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Error <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token function">Result</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> isSuccess<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> error<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        IsSuccess <span class="token operator">=</span> isSuccess<span class="token punctuation">;</span></span>
<span class="line">        Error <span class="token operator">=</span> error<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Result</span> <span class="token function">Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Result</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tier-2-domain-concepts-share-and-push-logic-down" tabindex="-1"><a class="header-anchor" href="#tier-2-domain-concepts-share-and-push-logic-down"><span>Tier 2: Domain Concepts (Share and Push Logic Down)</span></a></h3><p>This is one of the best places to share logic. Instead of scattering business rules across slices, push them into entities and value objects.</p><p>Here&#39;s an example:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// âœ… Good Sharing: Entity with Business Logic</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">OrderStatus</span> Status <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>OrderLine<span class="token punctuation">&gt;</span></span> Lines <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanBeCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Pending<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Result</span> <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CanBeCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Failure</span><span class="token punctuation">(</span><span class="token string">&quot;Only pending orders can be cancelled.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        Status <span class="token operator">=</span> OrderStatus<span class="token punctuation">.</span>Cancelled<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now <code>CancelOrder</code>, <code>GetOrder</code>, and <code>UpdateOrder</code> all use the same business rules. The logic lives in one place.</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>This implies an important concept: <strong>different vertical slices can share the same domain model.</strong></p></div><h3 id="tier-3-feature-specific-logic-keep-it-local" tabindex="-1"><a class="header-anchor" href="#tier-3-feature-specific-logic-keep-it-local"><span>Tier 3: Feature-Specific Logic (Keep It Local)</span></a></h3><p>Logic shared between related slices, like <code>CreateOrder</code> and <code>UpdateOrder</code>, doesn&#39;t need to go global. Create a <code>Shared</code> folder (there&#39;s an exception to every rule) within the feature:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="file structure"><span>file structure</span></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ðŸ“‚ Features</span>
<span class="line">â””â”€â”€ðŸ“‚ Orders</span>
<span class="line">    â”œâ”€â”€ðŸ“‚ CreateOrder</span>
<span class="line">    â”œâ”€â”€ðŸ“‚ UpdateOrder</span>
<span class="line">    â”œâ”€â”€ðŸ“‚ GetOrder</span>
<span class="line">    â””â”€â”€ðŸ“‚ Shared</span>
<span class="line">        â”œâ”€â”€ðŸ“„ OrderValidator.cs</span>
<span class="line">        â””â”€â”€ðŸ“„ OrderPricingService.cs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This also has a hiddene benefit. If you delete the Orders feature, the shared logic goes with it. No zombie code left behind.</p><p>Let&#39;s explore some advanced scenarios most people overlook.</p><hr><h2 id="cross-feature-sharing" tabindex="-1"><a class="header-anchor" href="#cross-feature-sharing"><span>Cross-Feature Sharing</span></a></h2><p>What about <strong>sharing code between unrelated features</strong> in Vertical Slice Architecture?</p><p>The <code>CreateOrder</code> slice needs to check if a customer exists. <code>GenerateInvoice</code> needs to calculate tax. Orders and Customers both need to format notification messages.</p><p>This doesn&#39;t fit neatly into a feature&#39;s <code>Shared</code> folder. So where does it go?</p><p><strong>First, ask: do you actually need to share?</strong></p><p>Most cross-feature &quot;sharing&quot; is just data access in disguise.</p><p>If <code>CreateOrder</code> needs customer data, it queries the database directly. It doesn&#39;t call into the Customers feature. Each slice owns its data access. The <code>Customer</code> entity is shared (it lives in <code>Domain</code>), but there&#39;s no shared service between them.</p><p><strong>When you genuinely need shared logic</strong>, ask what it <em>is</em>:</p>`,45)),s("ul",null,[s("li",null,[e[20]||(e[20]=s("strong",null,"Domain logic",-1)),e[21]||(e[21]=n(" (business rules, calculations) â†’ ",-1)),a(c,{icon:"fas fa-folder-open"}),e[22]||(e[22]=s("code",null,"Domain/Services",-1))]),s("li",null,[e[23]||(e[23]=s("strong",null,"Infrastructure",-1)),e[24]||(e[24]=n(" (external APIs, formatting) â†’ ",-1)),a(c,{icon:"fas fa-folder-op"}),e[25]||(e[25]=s("code",null,"Infrastructure/Services",-1))])]),e[44]||(e[44]=l(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="Domain/Services/TaxCalculator.cs"><span>Domain/Services/TaxCalculator.cs</span></div><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaxCalculator</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> <span class="token function">CalculateTax</span><span class="token punctuation">(</span><span class="token class-name">Address</span> address<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">decimal</span></span> subtotal<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> rate <span class="token operator">=</span> <span class="token function">GetTaxRate</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>State<span class="token punctuation">,</span> address<span class="token punctuation">.</span>Country<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> subtotal <span class="token operator">*</span> rate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Both <code>CreateOrder</code> and <code>GenerateInvoice</code> can use it without coupling to each other.</p><p>Before creating any cross-feature service, ask: could this logic live on a domain entity instead? Most &quot;shared business logic&quot; is actually data access, domain logic that belongs on an entity, or premature abstraction.</p>`,3)),s("p",null,[e[28]||(e[28]=n("If you need to trigger a side effect in another feature, I recommend using ",-1)),a(o,{to:"/milanjovanovic.tech/event-driven-architecture-in-dotnet-with-rabbitmq.html"},{default:t(()=>[...e[26]||(e[26]=[s("strong",null,"messaging and events",-1)])]),_:1}),e[29]||(e[29]=n(". Alternatively, the feature you want to call into can explore a facade (",-1)),a(o,{to:"/milanjovanovic.tech/internal-vs-public-apis-in-modular-monoliths.html"},{default:t(()=>[...e[27]||(e[27]=[s("strong",null,"public API",-1)])]),_:1}),e[30]||(e[30]=n(") for that operation.",-1))]),e[45]||(e[45]=l(`<hr><h2 id="when-duplication-is-the-right-call" tabindex="-1"><a class="header-anchor" href="#when-duplication-is-the-right-call"><span>When Duplication Is the Right Call</span></a></h2><p>Sometimes &quot;shared&quot; code isn&#39;t actually shared. It just looks that way.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// Features/Orders/GetOrder</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">GetOrderResponse</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> Id<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">decimal</span></span> Total<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> Status<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Features/Orders/CreateOrder</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">CreateOrderResponse</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> Id<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">decimal</span></span> Total<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> Status<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>They&#39;re identical. The temptation to create a <code>SharedOrderDto</code> is overwhelming. Resist it.</p><p>Next week, <code>GetOrder</code> needs a tracking URL. But <code>CreateOrder</code> happens before shipping, so there&#39;s no URL yet. If you&#39;d shared the DTO, you&#39;d now have a nullable property that&#39;s confusingly empty half the time.</p><p><strong>Duplication is cheaper than the wrong abstraction.</strong></p><hr><h2 id="the-practical-structure" tabindex="-1"><a class="header-anchor" href="#the-practical-structure"><span>The Practical Structure</span></a></h2><p>Here&#39;s what a mature Vertical Slice Architecture project looks like:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="file structure"><span>file structure</span></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ðŸ“‚ src</span>
<span class="line">â””â”€â”€ðŸ“‚ Features</span>
<span class="line">â”‚   â”œâ”€â”€ðŸ“‚ Orders</span>
<span class="line">â”‚   â”‚   â”œâ”€â”€ðŸ“‚ CreateOrder</span>
<span class="line">â”‚   â”‚   â”œâ”€â”€ðŸ“‚ UpdateOrder</span>
<span class="line">â”‚   â”‚   â””â”€â”€ðŸ“‚ Shared          <span class="token comment"># Order-specific sharing</span></span>
<span class="line">â”‚   â”œâ”€â”€ðŸ“‚ Customers</span>
<span class="line">â”‚   â”‚   â”œâ”€â”€ðŸ“‚ GetCustomer</span>
<span class="line">â”‚   â”‚   â””â”€â”€ðŸ“‚ Shared          <span class="token comment"># Customer-specific sharing</span></span>
<span class="line">â”‚   â””â”€â”€ðŸ“‚ Invoices</span>
<span class="line">â”‚       â””â”€â”€ðŸ“‚ GenerateInvoice</span>
<span class="line">â””â”€â”€ðŸ“‚ Domain</span>
<span class="line">â”‚   â”œâ”€â”€ðŸ“‚ Entities</span>
<span class="line">â”‚   â”œâ”€â”€ðŸ“‚ ValueObjects</span>
<span class="line">â”‚   â””â”€â”€ðŸ“‚ Services            <span class="token comment"># Cross-feature domain logic</span></span>
<span class="line">â””â”€â”€ðŸ“‚ Infrastructure</span>
<span class="line">â”‚   â”œâ”€â”€ðŸ“‚ Persistence</span>
<span class="line">â”‚   â””â”€â”€ðŸ“‚ Services</span>
<span class="line">â””â”€â”€ðŸ“‚ Shared</span>
<span class="line">    â””â”€â”€ðŸ“‚ Behaviors</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li><strong>Features</strong> â€” Self-contained slices. Each owns its request/response models.</li><li><strong>Features/[Name]/Shared</strong> â€” Local sharing between related slices.</li><li><strong>Domain</strong> â€” Entities, value objects, and domain services. Shared business logic lives here.</li><li><strong>Infrastructure</strong> â€” Technical concerns.</li><li><strong>Shared</strong> â€” Cross-cutting behaviors only.</li></ul><hr><h2 id="the-rules" tabindex="-1"><a class="header-anchor" href="#the-rules"><span>The Rules</span></a></h2><p>After building several systems this way, here&#39;s what I&#39;ve landed on:</p>`,15)),s("ol",null,[e[37]||(e[37]=s("li",null,[s("strong",null,"Features own their request/response models."),n(" No exceptions.")],-1)),e[38]||(e[38]=s("li",null,[s("strong",null,"Push business logic into the domain."),n(" Entities and value objects are the best place to share business rules.")],-1)),s("li",null,[e[31]||(e[31]=s("strong",null,"Keep feature-family sharing local.",-1)),e[32]||(e[32]=n(" If only Order slices need it, keep it in ",-1)),a(c,{icon:"fas fa-folder-open"}),e[33]||(e[33]=s("code",null,"Features/Orders/Shared",-1)),e[34]||(e[34]=n(" (feel free to find a better name than ",-1)),e[35]||(e[35]=s("code",null,"Shared",-1)),e[36]||(e[36]=n(").",-1))]),e[39]||(e[39]=s("li",null,[s("strong",null,"Infrastructure is shared by default"),n(". Database contexts, HTTP clients, logging. These are technical concerns.")],-1)),e[40]||(e[40]=s("li",null,[s("strong",null,"Apply the Rule of Three."),n(" Don't extract until you have three real usages with identical, stable logic.")],-1))]),e[46]||(e[46]=l('<hr><h2 id="takeaway" tabindex="-1"><a class="header-anchor" href="#takeaway"><span>Takeaway</span></a></h2><p>Vertical Slice Architecture asks: &quot;What feature does <em>this</em> belong to?&quot;</p><p>The shared code question is really asking: &quot;What do I do when the answer is <em>multiple features</em>?&quot;</p><p>Acknowledge that some concepts genuinely span features. Give them a home based on their <em>nature</em> (domain, infrastructure, or cross-cutting behavior). Resist the urge to share everything just because you could.</p><p>The goal isn&#39;t zero duplication. It&#39;s code that&#39;s easy to change when requirements change.</p><p>And requirements always change.</p><hr>',8)),k(" TODO: add ARTICLE CARD "),a(p,u(d({title:"Vertical Slice Architecture: Where Does the Shared Logic Live?",desc:"Deciding where shared logic lives is the most critical moment in Vertical Slice Architecture adoption, as choosing incorrectly reintroduces the coupling the architecture aims to eliminate. This article proposes a three-tier approach to sharing code that balances technical infrastructure, domain concepts, and local feature logic.",link:"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/vertical-slice-architecture-where-does-the-shared-logic-live.html",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16)])}const j=v(y,[["render",C]]),A=JSON.parse('{"path":"/milanjovanovic.tech/vertical-slice-architecture-where-does-the-shared-logic-live.html","title":"Vertical Slice Architecture: Where Does the Shared Logic Live?","lang":"en-US","frontmatter":{"lang":"en-US","title":"Vertical Slice Architecture: Where Does the Shared Logic Live?","description":"Article(s) > Vertical Slice Architecture: Where Does the Shared Logic Live?","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Vertical Slice Architecture: Where Does the Shared Logic Live?\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_170.png\\"],\\"datePublished\\":\\"2025-11-29T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/vertical-slice-architecture-where-does-the-shared-logic-live.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Vertical Slice Architecture: Where Does the Shared Logic Live?"}],["meta",{"property":"og:description","content":"Article(s) > Vertical Slice Architecture: Where Does the Shared Logic Live?"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_170.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_170.png"}],["meta",{"name":"twitter:image:alt","content":"Vertical Slice Architecture: Where Does the Shared Logic Live?"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-11-29T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Vertical Slice Architecture: Where Does the Shared Logic Live?"},{"property":"og:description","content":"Vertical Slice Architecture: Where Does the Shared Logic Live?"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/vertical-slice-architecture-where-does-the-shared-logic-live.html"}]],"prev":"/programming/cs/articles/README.md","date":"2025-11-29T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_170.png"},"git":{},"readingTime":{"minutes":5.77,"words":1731},"filePathRelative":"milanjovanovic.tech/vertical-slice-architecture-where-does-the-shared-logic-live.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{j as comp,A as data};
