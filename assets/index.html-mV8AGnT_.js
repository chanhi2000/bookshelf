import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as y,d as n,f as t,b as p,a as f,t as w,n as m,g as v,w as a,e,r as u,o as x}from"./app-BItykJLQ.js";const A={},C={id:"frontmatter-title-관련",tabindex:"-1"},I={class:"header-anchor",href:"#frontmatter-title-관련"},T={class:"table-of-contents"},S={href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/",target:"_blank",rel:"noopener noreferrer"},q={href:"https://man7.org/linux/man-pages/man7/cgroups.7.html",target:"_blank",rel:"noopener noreferrer"},D={href:"https://makelinux.github.io/kernel/map/",target:"_blank",rel:"noopener noreferrer"},P={href:"https://man7.org/linux/man-pages/man2/open.2.html#:~:text=The%20open()%20system%20call",target:"_blank",rel:"noopener noreferrer"},L={href:"https://man7.org/linux/man-pages/man7/capabilities.7.html",target:"_blank",rel:"noopener noreferrer"},E={href:"https://man7.org/linux/man-pages/man7/cgroups.7.html",target:"_blank",rel:"noopener noreferrer"},N={href:"https://docs.docker.com/",target:"_blank",rel:"noopener noreferrer"},U={href:"https://podman.io/",target:"_blank",rel:"noopener noreferrer"},j={href:"https://cri-o.io/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://man7.org/linux/man-pages/man7/user_namespaces.7.html",target:"_blank",rel:"noopener noreferrer"},O={href:"https://docs.docker.com/engine/security/userns-remap/",target:"_blank",rel:"noopener noreferrer"},F={href:"https://docs.docker.com/engine/security/userns-remap/",target:"_blank",rel:"noopener noreferrer"},M={href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/",target:"_blank",rel:"noopener noreferrer"},K={href:"https://docs.docker.com/reference/dockerfile/#user",target:"_blank",rel:"noopener noreferrer"},W={href:"https://man7.org/linux/man-pages/man7/capabilities.7.html",target:"_blank",rel:"noopener noreferrer"},G={href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container",target:"_blank",rel:"noopener noreferrer"},B={href:"https://kernel.org/doc/Documentation/prctl/seccomp_filter.txt",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://docs.kernel.org/userspace-api/no_new_privs.html",target:"_blank",rel:"noopener noreferrer"},z={href:"https://kernel.org/doc/Documentation/prctl/seccomp_filter.txt",target:"_blank",rel:"noopener noreferrer"},V={href:"https://apparmor.net/",target:"_blank",rel:"noopener noreferrer"};function H(g,s){const d=u("VPCard"),r=u("router-link"),k=u("SiteInfo"),b=u("PDF"),o=u("VPIcon"),c=u("Tabs");return x(),y("div",null,[n("h1",C,[n("a",I,[n("span",null,w(g.$frontmatter.title)+" 관련",1)])]),t(d,m(v({title:"Kubernetes > Article(s)",desc:"Article(s)",link:"/devops/k8s/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",T,[n("ul",null,[n("li",null,[t(r,{to:"#table-of-contents"},{default:a(()=>[...s[0]||(s[0]=[e("Table of Contents",-1)])]),_:1})]),n("li",null,[t(r,{to:"#linux-primitives-beneath-kubernetes"},{default:a(()=>[...s[1]||(s[1]=[e("Linux Primitives Beneath Kubernetes",-1)])]),_:1})]),n("li",null,[t(r,{to:"#syscalls-the-kernel-s-api-surface"},{default:a(()=>[...s[2]||(s[2]=[e("Syscalls: The Kernel's API Surface",-1)])]),_:1})]),n("li",null,[t(r,{to:"#control-groups-cgroups-enforcing-resource-limits"},{default:a(()=>[...s[3]||(s[3]=[e("Control Groups (cgroups): Enforcing Resource Limits",-1)])]),_:1})]),n("li",null,[t(r,{to:"#namespaces-isolating-what-a-process-can-see"},{default:a(()=>[...s[4]||(s[4]=[e("Namespaces: Isolating What a Process Can See",-1)])]),_:1})]),n("li",null,[t(r,{to:"#from-kernel-primitives-to-developer-abstractions"},{default:a(()=>[...s[5]||(s[5]=[e("From Kernel Primitives to Developer Abstractions",-1)])]),_:1})]),n("li",null,[t(r,{to:"#linux-user-ids-and-permissions"},{default:a(()=>[...s[6]||(s[6]=[e("Linux User IDs and Permissions",-1)])]),_:1})]),n("li",null,[t(r,{to:"#user-namespaces-and-uid-mapping-in-containers"},{default:a(()=>[...s[7]||(s[7]=[e("User Namespaces and UID Mapping in Containers",-1)])]),_:1})]),n("li",null,[t(r,{to:"#how-docker-manages-uids"},{default:a(()=>[...s[8]||(s[8]=[e("How Docker Manages UIDs",-1)])]),_:1})]),n("li",null,[t(r,{to:"#runasuser-and-runasnonroot"},{default:a(()=>[...s[9]||(s[9]=[e("runAsUser and runAsNonRoot",-1)])]),_:1})]),n("li",null,[t(r,{to:"#linux-capabilities"},{default:a(()=>[...s[10]||(s[10]=[e("Linux Capabilities",-1)])]),_:1})]),n("li",null,[t(r,{to:"#allowprivilegeescalation"},{default:a(()=>[...s[11]||(s[11]=[e("allowPrivilegeEscalation",-1)])]),_:1})]),n("li",null,[t(r,{to:"#privileged-containers"},{default:a(()=>[...s[12]||(s[12]=[e("Privileged Containers",-1)])]),_:1})]),n("li",null,[t(r,{to:"#readonlyrootfilesystem"},{default:a(()=>[...s[13]||(s[13]=[e("readOnlyRootFilesystem",-1)])]),_:1})]),n("li",null,[t(r,{to:"#seccomp-profiles"},{default:a(()=>[...s[14]||(s[14]=[e("Seccomp Profiles",-1)])]),_:1})]),n("li",null,[t(r,{to:"#apparmor"},{default:a(()=>[...s[15]||(s[15]=[e("AppArmor",-1)])]),_:1})]),n("li",null,[t(r,{to:"#fsgroup-and-supplementalgroups"},{default:a(()=>[...s[16]||(s[16]=[e("fsGroup and supplementalGroups",-1)])]),_:1})]),n("li",null,[t(r,{to:"#how-fsgroup-works-with-csi-volumes"},{default:a(()=>[...s[17]||(s[17]=[e("How fsGroup Works with CSI Volumes",-1)])]),_:1})]),n("li",null,[t(r,{to:"#live-debugging-diagnosing-securitycontext-failures"},{default:a(()=>[...s[18]||(s[18]=[e("Live Debugging: Diagnosing SecurityContext Failures",-1)])]),_:1})]),n("li",null,[t(r,{to:"#troubleshooting-when-security-context-conflicts-with-container-behavior"},{default:a(()=>[...s[19]||(s[19]=[e("Troubleshooting: When Security Context Conflicts with Container Behavior",-1)])]),_:1})]),n("li",null,[t(r,{to:"#summary-and-best-practices"},{default:a(()=>[...s[20]||(s[20]=[e("Summary and Best Practices",-1)])]),_:1})])])]),s[199]||(s[199]=n("hr",null,null,-1)),t(k,{name:"From Linux Primitives to Kubernetes Security Contexts",desc:"Dive deep into Kubernetes Security Contexts and learn how to manage security settings for your pods and containers.",url:"https://learnkube.com/security-contexts",logo:"https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg",preview:"https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"}),t(b,{url:"https://static.learnkube.com/532c7f1e378ec57a7794b79d53d11d57.pdf"}),s[200]||(s[200]=p('<figure><img src="https://static.learnkube.com/e35dce29118ebe296671cab01d160a5c.png" alt="From Linux Primitives to Kubernetes Security Contexts" tabindex="0" loading="lazy"><figcaption>From Linux Primitives to Kubernetes Security Contexts</figcaption></figure><p>In Kubernetes, containers typically start with <strong>root privileges</strong>.</p><p>This happens because, by default, container processes run as <code>UID 0</code> unless overridden.</p><p>Kubernetes does not impose a non-root policy; it inherits whatever the image defines.</p><p>This isn&#39;t a bug, it&#39;s a design choice carried over from Docker.</p><p>While convenient during development, it introduces unnecessary risk in production environments.</p><p>If an attacker compromises the container, <strong>root access</strong> increases the likelihood of privilege escalation to the host.</p><p>The Kubernetes API offers several ways to restrict container privileges using the <strong>Security Context</strong>.</p><p>With it, you can control the user a container runs as, manage <strong>Linux capabilities</strong>, enforce read-only filesystems, and block privilege escalation.</p><p>However, despite its importance, <strong>Security Contexts</strong> are often misunderstood or misapplied.</p><p>Many teams discover these controls only after a security audit or scanner flags a running container.</p><p>The next steps are usually reactively patching the config, suppressing the warning and moving on.</p>',12)),n("p",null,[s[22]||(s[22]=e("Before we get into ",-1)),n("a",S,[t(o,{icon:"iconfont icon-k8s"}),s[21]||(s[21]=e("Kubernetes SecurityContexts",-1))]),s[23]||(s[23]=e(", we need to understand what they're actually configuring under the hood.",-1))]),s[201]||(s[201]=p('<hr><h2 id="table-of-contents" tabindex="-1"><a class="header-anchor" href="#table-of-contents"><span>Table of Contents</span></a></h2><ul><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#linux-primitives-beneath-kubernetes">Linux Primitives Beneath Kubernetes</a></li><li><a href="#syscalls-the-kernel-s-api-surface">Syscalls: The Kernel&#39;s API Surface</a></li><li><a href="#control-groups-cgroups-enforcing-resource-limits">Control Groups (cgroups): Enforcing Resource Limits</a></li><li><a href="#namespaces-isolating-what-a-process-can-see">Namespaces: Isolating What a Process Can See</a></li><li><a href="#from-kernel-primitives-to-developer-abstractions">From Kernel Primitives to Developer Abstractions</a></li><li><a href="#linux-user-ids-and-permissions">Linux User IDs and Permissions</a></li><li><a href="#user-namespaces-and-uid-mapping-in-containers">User Namespaces and UID Mapping in Containers</a></li><li><a href="#how-docker-manages-uids">How Docker Manages UIDs</a></li><li><a href="#runasuser-and-runasnonroot"><code>runAsUser</code> and <code>runAsNonRoot</code></a></li><li><a href="#linux-capabilities">Linux Capabilities</a></li><li><a href="#allowprivilegeescalation"><code>allowPrivilegeEscalation</code></a></li><li><a href="#privileged-containers">Privileged Containers</a></li><li><a href="#readonlyrootfilesystem">readOnlyRootFilesystem</a></li><li><a href="#seccomp-profiles">Seccomp Profiles</a></li><li><a href="#apparmor">AppArmor</a></li><li><a href="#fsgroup-and-supplementalgroups">fsGroup and supplementalGroups</a></li><li><a href="#how-fsgroup-works-with-csi-volumes">How fsGroup Works with CSI Volumes</a></li><li><a href="#live-debugging-diagnosing-securitycontext-failures">Live Debugging: Diagnosing SecurityContext Failures</a></li><li><a href="#troubleshooting-when-security-context-conflicts-with-container-behavior">Troubleshooting: When Security Context Conflicts with Container Behavior</a></li><li><a href="#summary-and-best-practices">Summary and Best Practices</a></li></ul><hr><h2 id="linux-primitives-beneath-kubernetes" tabindex="-1"><a class="header-anchor" href="#linux-primitives-beneath-kubernetes"><span>Linux Primitives Beneath Kubernetes</span></a></h2><p>A <strong>container in Kubernetes</strong> is just a regular Linux process.</p>',6)),n("p",null,[s[25]||(s[25]=e("It runs directly on the host's kernel, but it's isolated using namespaces (for things like networking, mounts, and process IDs) and ",-1)),n("a",q,[t(o,{icon:"fas fa-globe"}),s[24]||(s[24]=e("cgroups",-1))]),s[26]||(s[26]=e(" (for resource limits).",-1))]),s[202]||(s[202]=p('<p>It also gets its own virtual filesystem, which is an isolated root directory.</p><p>There&#39;s no virtual machine here.</p><p>It&#39;s just <strong>Linux, sandboxed</strong>.</p><p>That&#39;s why it really matters who the process runs as inside the container; especially if it&#39;s <code>root</code>.</p><p>The <strong>securityContext</strong> field in a pod spec is a declarative way to configure how that process interacts with the kernel.</p><p><strong>But Kubernetes doesn&#39;t enforce these settings itself.</strong></p><p>It passes them down to the container runtime, which translates them into kernel-level instructions at container start.</p><p>Every setting you apply in a pod spec ultimately maps to low-level kernel features like syscalls, namespaces, cgroups, or capabilities.</p><p>To configure these effectively, you need to understand what each one does.</p><p>So before touching YAML, let&#39;s dissect the kernel-level primitives that SecurityContexts rely on.</p><hr><h2 id="syscalls-the-kernel-s-api-surface" tabindex="-1"><a class="header-anchor" href="#syscalls-the-kernel-s-api-surface"><span>Syscalls: The Kernel&#39;s API Surface</span></a></h2><p>In Linux, user-space applications can&#39;t interact with hardware or kernel-managed resources directly.</p><p>Every interaction must go through the kernel, and the only sanctioned way to do that is via system calls.</p><p>System calls are predefined entry points that expose core kernel functionality.</p>',15)),t(c,{data:[{id:"1/3"},{id:"2/3"},{id:"3/3"}],active:0},{title0:a(({value:i,isActive:l})=>[...s[27]||(s[27]=[e("1/3",-1)])]),title1:a(({value:i,isActive:l})=>[...s[28]||(s[28]=[e("2/3",-1)])]),title2:a(({value:i,isActive:l})=>[...s[29]||(s[29]=[e("3/3",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[30]||(s[30]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/be7a7a42d500d60d85ff95a550147e18.svg",alt:"The kernel works as a middle-man between your app and the hardware. When your Java application accesses a file on the filesystem, it initiates a syscall to the Linux kernel.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The kernel works as a middle-man between your app and the hardware. When your Java application accesses a file on the filesystem, it initiates a syscall to the Linux kernel.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[31]||(s[31]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/c59552e508a9802dff5de01983790a72.svg",alt:"The Kernel knows how to access the underlying storage and lets your app retrieve the files. You could think of syscalls as API calls.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The Kernel knows how to access the underlying storage and lets your app retrieve the files. You could think of syscalls as API calls.")],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[32]||(s[32]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/3af70ded6be4dce280ffdcaac3500eb5.svg",alt:"Similarly, if your Node.js app has to initiate a network connection, it still has to go through the kernel with a system call.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Similarly, if your Node.js app has to initiate a network connection, it still has to go through the kernel with a system call.")],-1)])]),_:1}),s[203]||(s[203]=n("p",null,[e("You can think of system calls as the "),n("strong",null,"kernel's API"),e("—over 300 entry points grouped by what they do.")],-1)),s[204]||(s[204]=n("p",null,"Some handle files, some manage processes, others deal with networking or memory.",-1)),s[205]||(s[205]=n("p",null,"Each one has a unique ID in the kernel and takes specific arguments to tell the kernel exactly what to do.",-1)),n("figure",null,[s[36]||(s[36]=n("img",{src:"https://learnkube.com/a/fcdf8fc3577862cf163db7d71e5f51ca.svg",alt:'Linux kernel map<br/><VPIcon icon="fas fa-globe"/>You can find an interactive map for all kernels calls here.',tabindex:"0",loading:"lazy"},null,-1)),n("figcaption",null,[s[34]||(s[34]=e("Linux kernel map",-1)),s[35]||(s[35]=n("br",null,null,-1)),n("a",D,[t(o,{icon:"fas fa-globe"}),s[33]||(s[33]=e("You can find an interactive map for all kernels calls here.",-1))])])]),n("p",null,[s[39]||(s[39]=e("Take the ",-1)),n("a",P,[t(o,{icon:"fas fa-globe"}),s[37]||(s[37]=n("code",null,"open",-1)),s[38]||(s[38]=e(" syscall",-1))]),s[40]||(s[40]=e("—it needs a file path, an access mode like read or write, and permission bits.",-1))]),s[206]||(s[206]=p(`<p>You can see the exact options and signature by checking the manual:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">man</span> <span class="token number">2</span> <span class="token function">open</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">8</span> <span class="token string">&quot;SYNOPSIS&quot;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># SYNOPSIS</span></span>
<span class="line"><span class="token comment">#        #include &lt;fcntl.h&gt;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int open(const char *pathname, int flags, ...</span></span>
<span class="line"><span class="token comment">#                   /* mode_t mode */ );</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int creat(const char *pathname, mode_t mode);</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int openat(int dirfd, const char *pathname, int flags, ...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how it looks when a real application makes these calls:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">strace</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>openat <span class="token function">ls</span> /tmp <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-5</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/etc/ld.so.cache&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/lib/x86_64-linux-gnu/libselinux.so.1&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/tmp&quot;</span>, O_RDONLY<span class="token operator">|</span>O_NONBLOCK<span class="token operator">|</span>O_CLOEXEC<span class="token operator">|</span>O_DIRECTORY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or <code>socket</code>, which asks for a network domain like IPv4, a type like TCP, and the protocol you want to use.</p><p>You can inspect the socket and connect syscall signatures:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">man</span> <span class="token number">2</span> socket <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">8</span> <span class="token string">&quot;SYNOPSIS&quot;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># SYNOPSIS</span></span>
<span class="line"><span class="token comment">#        #include &lt;sys/socket.h&gt;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int socket(int domain, int type, int protocol);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how these work together in a real network request:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">strace</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>socket,connect <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://httpbin.org/ip <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;(socket|connect)&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">socket<span class="token punctuation">(</span>AF_INET, SOCK_STREAM, IPPROTO_TCP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span></span>
<span class="line">connect<span class="token punctuation">(</span><span class="token number">5</span>, <span class="token punctuation">{</span>sa_family<span class="token operator">=</span>AF_INET, <span class="token assign-left variable">sin_port</span><span class="token operator">=</span>htons<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>, <span class="token assign-left variable">sin_addr</span><span class="token operator">=</span>inet_addr<span class="token punctuation">(</span><span class="token string">&quot;192.168.2.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>, <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>socket()</code> call creates a TCP socket (<code>AF_INET</code> + <code>SOCK_STREAM</code>), then <code>connect()</code> establishes the connection to the remote server.</p><p>Even high-level code, like a simple network request in Node.js, still ends up triggering a <code>socket</code> syscall behind the scenes.</p><p><strong>This level of access gives user-space applications immense power.</strong></p><p>But it also exposes a large attack surface, especially when privileged capabilities are involved.</p>`,15)),n("p",null,[s[43]||(s[43]=e("For instance, the ",-1)),n("a",L,[t(o,{icon:"fas fa-globe"}),s[41]||(s[41]=n("code",null,"CAP_NET_ADMIN",-1)),s[42]||(s[42]=e(" capability",-1))]),s[44]||(s[44]=e(" capability unlocks dozens of networking syscalls ranging from setting interface flags to modifying routing tables.",-1))]),s[207]||(s[207]=n("p",null,"Each of those calls takes arguments that can be used in wildly different ways, depending on the context.",-1)),s[208]||(s[208]=n("p",null,"So two processes with the same capability can behave very differently, depending on which syscalls they invoke and how they use them.",-1)),s[209]||(s[209]=n("p",null,[n("strong",null,"This is where the problem starts: the kernel trusts that you know what you're doing.")],-1)),s[210]||(s[210]=n("p",null,"That's why Linux adds another layer to contain that risk: control groups, or cgroups.",-1)),s[211]||(s[211]=n("hr",null,null,-1)),s[212]||(s[212]=n("h2",{id:"control-groups-cgroups-enforcing-resource-limits",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#control-groups-cgroups-enforcing-resource-limits"},[n("span",null,"Control Groups (cgroups): Enforcing Resource Limits")])],-1)),n("p",null,[n("a",E,[t(o,{icon:"fas fa-globe"}),s[45]||(s[45]=e("Control groups",-1))]),s[46]||(s[46]=e(" are kernel-level mechanisms that restrict how much CPU, memory, I/O, and other resources a process—or a group of processes—can consume.",-1))]),s[213]||(s[213]=n("p",null,"They define how much of the system each one is allowed to use.",-1)),s[214]||(s[214]=n("p",null,"Say you're running a JVM application.",-1)),s[215]||(s[215]=n("p",null,[e("You can assign it to a "),n("code",null,"cgroup"),e(" that caps its memory at 256MB and restricts it to a single CPU core.")],-1)),s[216]||(s[216]=n("p",null,"Now take a second process—maybe a Node.js app. You can place it in a separate cgroup with its own constraints.",-1)),s[217]||(s[217]=n("p",null,[e("Each cgroup defines a "),n("strong",null,"resource boundary"),e(".")],-1)),s[218]||(s[218]=n("p",null,"You control how much each process gets, and the kernel enforces it.",-1)),t(c,{data:[{id:"1/4"},{id:"2/4"},{id:"3/4"},{id:"4/4"}],active:0},{title0:a(({value:i,isActive:l})=>[...s[47]||(s[47]=[e("1/4",-1)])]),title1:a(({value:i,isActive:l})=>[...s[48]||(s[48]=[e("2/4",-1)])]),title2:a(({value:i,isActive:l})=>[...s[49]||(s[49]=[e("3/4",-1)])]),title3:a(({value:i,isActive:l})=>[...s[50]||(s[50]=[e("4/4",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[51]||(s[51]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/2a4f54de9482a24ad9168d795b366911.svg",alt:"In this case, I have a control group for the JVM.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"In this case, I have a control group for the JVM.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[52]||(s[52]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/8073408f5aa250870831e8424e8495f7.svg",alt:"I can create a control group that limits access to CPU, memory, network bandwidth, etc.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"I can create a control group that limits access to CPU, memory, network bandwidth, etc.")],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[53]||(s[53]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/5fb7ed4a532839d3b559342e04d6d802.svg",alt:"Each process can have its control group. I could create a second control group for the Node.js app.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Each process can have its control group. I could create a second control group for the Node.js app.")],-1)])]),tab3:a(({value:i,isActive:l})=>[...s[54]||(s[54]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/386c29c1f90fec22694a4f0ce0b5aa0d.svg",alt:"I can fine-tune the settings for the new control group and further restrict the available resources for that process.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"I can fine-tune the settings for the new control group and further restrict the available resources for that process.")],-1)])]),_:1}),s[219]||(s[219]=p('<p><strong>This lets you isolate workloads by physical limits on what they can consume.</strong></p><p>But while cgroups enforce resource boundaries, they don&#39;t isolate what a process can see or interact with.</p><p>For that, Linux relies on another primitive: <strong>namespaces</strong>.</p><hr><h2 id="namespaces-isolating-what-a-process-can-see" tabindex="-1"><a class="header-anchor" href="#namespaces-isolating-what-a-process-can-see"><span>Namespaces: Isolating What a Process Can See</span></a></h2><p>While cgroups control how much a process can consume, <strong>namespaces</strong> control what a process can see.</p><p>They determine which part of the system a process believes it&#39;s running in.</p><p>For example, with <strong>network namespaces</strong>, a process only sees its own interfaces and traffic.</p><p>It can&#39;t see packets or sockets from outside its namespace.</p><p><strong>Namespaces isolate identity and scope</strong>.</p><p>With a <strong>mount namespace</strong>, a process sees a private filesystem view.</p>',11)),n("p",null,[s[55]||(s[55]=e("It might believe it sees ",-1)),t(o,{icon:"fas fa-folder-open"}),s[56]||(s[56]=n("code",null,"/etc",-1)),s[57]||(s[57]=e(", ",-1)),t(o,{icon:"fas fa-folder-open"}),s[58]||(s[58]=n("code",null,"/var",-1)),s[59]||(s[59]=e(", and ",-1)),t(o,{icon:"fas fa-folder-open"}),s[60]||(s[60]=n("code",null,"/home",-1)),s[61]||(s[61]=e(", but it's only accessing a container-specific overlay.",-1))]),t(c,{data:[{id:"1/4"},{id:"2/4"},{id:"3/4"},{id:"4/4"}],active:0},{title0:a(({value:i,isActive:l})=>[...s[62]||(s[62]=[e("1/4",-1)])]),title1:a(({value:i,isActive:l})=>[...s[63]||(s[63]=[e("2/4",-1)])]),title2:a(({value:i,isActive:l})=>[...s[64]||(s[64]=[e("3/4",-1)])]),title3:a(({value:i,isActive:l})=>[...s[65]||(s[65]=[e("4/4",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[66]||(s[66]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/abd0a2e760de387283d844e0c9b590b7.svg",alt:"Since kernel version 5.6, there are eight kinds of namespaces and the mount namespace is one of them.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Since kernel version 5.6, there are eight kinds of namespaces and the mount namespace is one of them.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[67]||(s[67]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/f4ad672dd92d863c0d5b324b954c20eb.svg",alt:"With the mount namespace, you can let the process believe it has access to all directories on the host, when in fact it does not.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"With the mount namespace, you can let the process believe it has access to all directories on the host, when in fact it does not.")],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[68]||(s[68]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/ae8392b36d19cf7486761af8fce97b6e.svg",alt:"The mount namespace is designed to isolate resources — in this case, the filesystem.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The mount namespace is designed to isolate resources — in this case, the filesystem.")],-1)])]),tab3:a(({value:i,isActive:l})=>[...s[69]||(s[69]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/7db84bc90ac80a944676bc7db80424bf.svg",alt:"Each process can see the same filesystem, while still being isolated from the others.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Each process can see the same filesystem, while still being isolated from the others.")],-1)])]),_:1}),s[220]||(s[220]=p(`<p><strong>As of Linux kernel 5.6, there are eight namespace types.</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">uname</span> <span class="token parameter variable">-r</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># 5.15.167.4-microsoft-standard-WSL2</span></span>
<span class="line"></span>
<span class="line">lsns</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># NS TYPE    NPROCS     PID USER</span></span>
<span class="line"><span class="token comment"># 4026531834 time       17  1035</span></span>
<span class="line"><span class="token comment"># 4026531835 cgroup     17  1035</span></span>
<span class="line"><span class="token comment"># 4026531837 user       17  1035</span></span>
<span class="line"><span class="token comment"># 4026531840 net        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532242 ipc        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532253 mnt        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532254 uts        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532255 pid        17  1035</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Each isolates a distinct dimension of system identity.</p><p>That means you can run multiple processes on the same machine, each in its own isolated environment, each with resource limits, and each believing it&#39;s alone.</p><p><strong>Together with cgroups, namespaces form the backbone of container isolation</strong>.</p><p>But configuring them manually is complex and error-prone.</p><p>Managing syscalls, cgroups, and namespaces directly is powerful—but not practical for day-to-day development.</p><p><em>What if you could abstract them into a simpler interface?</em></p><p>That&#39;s exactly what Docker did.</p><p>By combining Linux namespaces and cgroups with filesystem overlays and a clean CLI, Docker made it easy to define, package, and run isolated workloads.</p><hr><h2 id="from-kernel-primitives-to-developer-abstractions" tabindex="-1"><a class="header-anchor" href="#from-kernel-primitives-to-developer-abstractions"><span>From Kernel Primitives to Developer Abstractions</span></a></h2>`,12)),n("p",null,[n("a",N,[t(o,{icon:"fa-brands fa-docker"}),s[70]||(s[70]=e("Docker",-1))]),s[71]||(s[71]=e(" is a popular way to manage containers in a developer-friendly way.",-1))]),s[221]||(s[221]=n("p",null,"Docker is not the only way to run containers, though.",-1)),n("p",null,[s[74]||(s[74]=e("There are other tools that abstract control groups and namespaces, such as ",-1)),n("a",U,[t(o,{icon:"iconfont icon-podman"}),s[72]||(s[72]=e("Podman",-1))]),s[75]||(s[75]=e(" (Red Hat) and ",-1)),n("a",j,[t(o,{icon:"iconfont icon-cri-o"}),s[73]||(s[73]=e("CRI-O",-1))]),s[76]||(s[76]=e(" (Red Hat).",-1))]),s[222]||(s[222]=p('<p>Instead of managing syscalls, cgroups, and namespaces manually, you define a container image, run a single command, and the runtime sets everything up behind the scenes.</p><p>At their core, these platforms are just orchestration layers on top of three key Linux kernel features: <strong>Syscalls</strong>, <strong>Control Groups</strong> and <strong>namespaces</strong></p><p>When combined, these primitives give you secure, lightweight, isolated environments—<strong>containers</strong>.</p><p>At this point, we&#39;ve seen how Linux isolates containers using namespaces and resource controls.</p><p><strong>But isolation isn&#39;t just about what a process can see or consume.</strong></p><p>It&#39;s also about <strong>who the process is</strong>, and <strong>what permissions it has</strong>.</p><hr><h2 id="linux-user-ids-and-permissions" tabindex="-1"><a class="header-anchor" href="#linux-user-ids-and-permissions"><span>Linux User IDs and Permissions</span></a></h2><p>In Linux, every process runs with a <strong>User ID</strong>, or <code>UID</code>.</p><p>The UID is the kernel&#39;s primary access control mechanism.</p><p>It defines ownership and tells what the process can access or modify.</p>',11)),n("p",null,[s[77]||(s[77]=e("You can verify the configured boundaries on most systems by inspecting ",-1)),t(o,{icon:"fas fa-folder-open"}),s[78]||(s[78]=n("code",null,"/etc/",-1)),t(o,{icon:"fas fa-file-lines"}),s[79]||(s[79]=n("code",null,"login.defs",-1)),s[80]||(s[80]=e(".",-1))]),s[223]||(s[223]=p(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">grep</span> UID_ /etc/login.defs</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># UID_MIN                  1000</span></span>
<span class="line"><span class="token comment"># UID_MAX                 60000</span></span>
<span class="line"><span class="token comment"># #SYS_UID_MIN              100</span></span>
<span class="line"><span class="token comment"># #SYS_UID_MAX              999</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By convention, <code>UID 0</code> means <code>root</code>, which has full control over everything.</p><p>UIDs 1-999 are usually for system services running in the background.</p><p>UIDs 1000 and above are assigned to regular users and applications.</p><p>You can confirm this division by listing user accounts and their UIDs.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">awk</span> -F: <span class="token string">&#39;$3 &lt; 1000 { print $1, $3 }&#39;</span> /etc/passwd</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># root 0</span></span>
<span class="line"><span class="token comment"># daemon 1</span></span>
<span class="line"><span class="token comment"># bin 2</span></span>
<span class="line"><span class="token comment"># man 6</span></span>
<span class="line"><span class="token comment"># ...</span></span>
<span class="line"><span class="token comment"># _apt 100</span></span>
<span class="line"><span class="token comment"># sshd 105</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And those assigned to regular users:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">awk</span> -F: <span class="token string">&#39;$3 &gt;= 1000 { print $1, $3 }&#39;</span> /etc/passwd</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># nobody 65534</span></span>
<span class="line"><span class="token comment"># docker 1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Each time a process attempts a privileged operation, the Linux kernel checks its <code>UID</code> to decide whether that action should be allowed.</strong></p><p>In containerized environments, this creates a subtle risk.</p><p>Many containers still run as <code>UID 0</code>.</p><p>If that UID maps directly to the host, a compromised container could gain <strong>real root access</strong> on the node.</p><p>To prevent this, Linux introduces <strong>user namespaces</strong>.</p><hr><h2 id="user-namespaces-and-uid-mapping-in-containers" tabindex="-1"><a class="header-anchor" href="#user-namespaces-and-uid-mapping-in-containers"><span>User Namespaces and UID Mapping in Containers</span></a></h2>`,15)),n("p",null,[s[82]||(s[82]=e("The ",-1)),n("a",R,[t(o,{icon:"fas fa-globe"}),s[81]||(s[81]=e("user namespace",-1))]),s[83]||(s[83]=e(" lets you remap UIDs inside a container to unprivileged UIDs on the host.",-1))]),s[224]||(s[224]=n("p",null,[e("This means a process can run as "),n("code",null,"UID 0"),e(" (root) "),n("em",null,"inside"),e(" the container, while the kernel maps it to an unprivileged UID like 2000 "),n("em",null,"outside"),e(".")],-1)),s[225]||(s[225]=n("p",null,[e("From the container's perspective, the process is "),n("code",null,"root"),e(" and can do anything.")],-1)),s[226]||(s[226]=n("p",null,"But from the host's perspective, it's just a regular user with no elevated privileges.",-1)),t(c,{data:[{id:"1/3"},{id:"2/3"},{id:"3/3"}]},{title0:a(({value:i,isActive:l})=>[...s[84]||(s[84]=[e("1/3",-1)])]),title1:a(({value:i,isActive:l})=>[...s[85]||(s[85]=[e("2/3",-1)])]),title2:a(({value:i,isActive:l})=>[...s[86]||(s[86]=[e("3/3",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[87]||(s[87]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/219af075732ea2ad7bf79a3a8ce838bd.svg",alt:"On the host system, User 0 (root) has complete administrative privileges while regular users (1000-2000, 2000-4000) have limited permissions.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"On the host system, User 0 (root) has complete administrative privileges while regular users (1000-2000, 2000-4000) have limited permissions.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[88]||(s[88]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/cd62a2e690b06c0659b570c519e473da.svg",alt:"Container 1 creates a user namespace where host user 1000 is mapped to root (User 0) inside the container, providing administrative privileges within the isolated environment.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Container 1 creates a user namespace where host user 1000 is mapped to root (User 0) inside the container, providing administrative privileges within the isolated environment.")],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[89]||(s[89]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/fcaaf0aa811f986ba357f73b5ae6365c.svg",alt:"Multiple containers can run simultaneously with different user mappings - Container 1 maps host user 1000 to root, while Container 2 maps host user 2000 to root, maintaining isolation.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Multiple containers can run simultaneously with different user mappings - Container 1 maps host user 1000 to root, while Container 2 maps host user 2000 to root, maintaining isolation.")],-1)])]),_:1}),s[227]||(s[227]=n("p",null,[e("This "),n("strong",null,"UID mapping"),e(" prevents container processes from gaining root access to the host, even if they appear to be root in their own environment.")],-1)),s[228]||(s[228]=n("hr",null,null,-1)),s[229]||(s[229]=n("h2",{id:"how-docker-manages-uids",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#how-docker-manages-uids"},[n("span",null,"How Docker Manages UIDs")])],-1)),n("p",null,[n("a",O,[t(o,{icon:"fa-brands fa-docker"}),s[90]||(s[90]=e("Docker",-1))]),s[91]||(s[91]=e(" uses both namespaces and process UID settings to manage security inside containers.",-1))]),s[230]||(s[230]=n("p",null,[e("By default, the process runs with the UID defined in the container image—usually "),n("code",null,"UID 0"),e(".")],-1)),n("p",null,[s[93]||(s[93]=e("Unless ",-1)),n("a",F,[t(o,{icon:"fa-brands fa-docker"}),s[92]||(s[92]=e("user namespaces are explicitly enabled",-1))]),s[94]||(s[94]=e(", UID 0 inside the container is also UID 0 on the host.",-1))]),s[231]||(s[231]=p('<figure><img src="https://learnkube.com/a/be18e9e2649498e83be2d8301bb850f6.svg" alt="UID 0 in the container is mapped to UID 0 on the host" tabindex="0" loading="lazy"><figcaption>UID 0 in the container is mapped to UID 0 on the host</figcaption></figure><p>That&#39;s a problem.</p><p><strong>If the container is compromised, the attacker gains root-level privileges over any accessible host resources.</strong></p><p>This is why running containers as a <strong>non-root user</strong> is a critical best practice.</p><p>Even if isolation breaks, the process still has limited permissions.</p><hr><h2 id="runasuser-and-runasnonroot" tabindex="-1"><a class="header-anchor" href="#runasuser-and-runasnonroot"><span><code>runAsUser</code> and <code>runAsNonRoot</code></span></a></h2>',7)),n("p",null,[s[96]||(s[96]=e("Kubernetes builds on these kernel-level security controls using ",-1)),n("a",M,[t(o,{icon:"iconfont icon-k8s"}),s[95]||(s[95]=e("SecurityContext",-1))]),s[97]||(s[97]=e(".",-1))]),s[232]||(s[232]=p(`<p><code>runAsUser</code> and <code>runAsNonRoot</code> options in <strong>securityContext</strong> let you explicitly control the UID that a container process runs as.</p><p><code>runAsUser</code> sets the exact UID for the process:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This means the container will start as <code>UID 1000</code> instead of root.</strong></p><p>This setting will apply to all containers in the Pod unless overridden.</p><p>But you&#39;re not required to use 1000 specifically.</p><p>You can choose any UID that exists in the image and has access to the required files.</p>`,7)),n("p",null,[s[98]||(s[98]=e("Even if there's no matching entry in ",-1)),t(o,{icon:"fas fa-folder-open"}),s[99]||(s[99]=n("code",null,"/etc/",-1)),t(o,{icon:"fas fa-key"}),s[100]||(s[100]=n("code",null,"passwd",-1)),s[101]||(s[101]=e(", the kernel can still run the process as long as the UID is valid.",-1))]),s[233]||(s[233]=p(`<p>To make sure the container never runs as root—regardless of image defaults—Kubernetes offers the <code>runAsNonRoot</code> flag:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>If the container tries to start as UID 0, Kubernetes blocks it—even if <code>runAsUser</code> isn&#39;t explicitly set.</strong></p><p>For stronger guarantees, you can combine both fields:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This setting ensures the process runs as a specific non-root UID, and any future changes to the image or spec won&#39;t accidentally elevate privileges.</strong></p><p>Let&#39;s inspect a widely used official image that includes a non-root user by default:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-it</span> node:20-slim <span class="token function">cat</span> /etc/passwd</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># node:x:1000:1000::/home/node:/bin/bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This shows that the <code>node</code> user is predefined with UID 1000. However, this only defines the user.</p><p>To check which user the image actually runs as by default, inspect the runtime UID:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> node:20-slim <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># uid=0(root) gid=0(root) groups=0(root)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Despite defining a node user, the container runs as root by default.</p>`,12)),n("p",null,[s[103]||(s[103]=e("To enforce non-root execution, you must either modify the ",-1)),n("a",K,[t(o,{icon:"fa-brands fa-docker"}),s[102]||(s[102]=e("Dockerfile",-1))]),s[104]||(s[104]=e(" to include:",-1))]),s[234]||(s[234]=p(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token environment constant">USER</span> <span class="token function">node</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Or override it in Kubernetes.</p><p>To achieve this let&#39;s create a minikube cluster.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">minikube start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,4)),n("p",null,[s[105]||(s[105]=e("Then apply the following ",-1)),t(o,{icon:"iconfont icon-yaml"}),s[106]||(s[106]=n("code",null,"node-nonroot.yaml",-1)),s[107]||(s[107]=e(" file:",-1))]),s[235]||(s[235]=p(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="node-nonroot.yaml"><span>node-nonroot.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>nonroot</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>slim</span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can verify if <code>runAsUser: 1000</code> is respected and overrides the image&#39;s root default:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> node-nonroot.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/node-nonroot created</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-nonroot -- <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># uid=1000(node) gid=1000(node) groups=1000(node)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Running a container as a non-root user is a solid start, but some applications still need access to specific system-level operations to function properly.</p><p><em>That&#39;s where Linux capabilities come in.</em></p><hr><h2 id="linux-capabilities" tabindex="-1"><a class="header-anchor" href="#linux-capabilities"><span>Linux Capabilities</span></a></h2>`,7)),n("p",null,[n("a",W,[t(o,{icon:"fas fa-globe"}),s[108]||(s[108]=e("Capabilities",-1))]),s[109]||(s[109]=e(" define which privileged operations a process is allowed to perform.",-1))]),s[236]||(s[236]=p("<p>Rather than granting full root access, the Linux kernel splits root privileges into fine-grained units like <code>CHOWN</code>, <code>NET_ADMIN</code>, and <code>SYS_PTRACE</code>.</p><p><strong>Each capability grants just one class of operations.</strong></p><p>In a traditional Linux system, the root user has full access to everything.</p><p>But under the hood, many of these powers are broken out into smaller units called <strong>capabilities</strong>.</p><p>They are like a menu of root powers.</p>",5)),t(c,{data:[{id:"1/2"},{id:"2/2"}]},{title0:a(({value:i,isActive:l})=>[...s[110]||(s[110]=[e("1/2",-1)])]),title1:a(({value:i,isActive:l})=>[...s[111]||(s[111]=[e("2/2",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[112]||(s[112]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/3f09a092f3be11f3a5ad1628d754586f.svg",alt:"User 0 (root) has all capabilities by default, including the full range of privileged operations from  to .",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("User 0 (root) has all capabilities by default, including the full range of privileged operations from "),n("code",null,"CHOWN"),e(" to "),n("code",null,"NET_BIND_SERVICE"),e(".")])],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[113]||(s[113]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/5c399bad12e1202ad138851a8a0973de.svg",alt:"User 1000 has limited capabilities like  but lacks most root privileges.",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("User 1000 has limited capabilities like "),n("code",null,"NET_BIND_SERVICE"),e(" but lacks most root privileges.")])],-1)])]),_:1}),s[237]||(s[237]=p("<p><strong>You can assign only the entries your process needs, and drop the rest.</strong></p><p>Let&#39;s say your application needs to change file ownership using the chown system call.</p><p>Normally, only root can change file ownership using the <strong>chown syscall</strong>.</p><p>But instead of running the entire container as <code>UID 0</code>, you can selectively grant just the capability required to perform that action.</p><p>One of those fine-grained capabilities is <code>CAP_CHOWN</code>, which allows a process to change file ownership—even if it&#39;s not root.</p>",5)),n("p",null,[s[115]||(s[115]=e("Kubernetes exposes this through the ",-1)),n("a",G,[t(o,{icon:"iconfont icon-k8s"}),s[114]||(s[114]=e("securityContext.capabilities",-1))]),s[116]||(s[116]=e(" field.",-1))]),s[238]||(s[238]=p(`<p>You can run the container as a non-root UID and add just the <code>CHOWN</code> capability.</p><p>Kubernetes doesn&#39;t let you change security settings like <code>securityContext.capabilities</code> of a Pod after it&#39;s created.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="node-cap-chown.yaml"><span>node-cap-chown.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>cap<span class="token punctuation">-</span>chown</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>slim</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">0</span></span>
<span class="line">      <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>We explicitly drop all capabilities first to ensure a clean baseline, then add back only <code>CHOWN</code>.</strong></p><p>Let&#39;s delete the existing Pod and recreate it with the updated spec:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl delete pod node-nonroot <span class="token parameter variable">--force</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod &quot;node-nonroot&quot; force deleted</span></span>
<span class="line"></span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> node-cap-chown.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/node-cap-chown created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>The container still runs as a non-root user, but now it can perform a privileged operation.</strong></p><p>Let&#39;s confirm the container is not root, but it can perform <code>chown</code>.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># id=0(root) gid=0(root) groups=0(root)</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;touch /tmp/test &amp;&amp; ls -l /tmp/test&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#-rw-r--r-- 1 root root 0 Jul  5 08:53 /tmp/test</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;chown 1234:1234 /tmp/test &amp;&amp; ls -l /tmp/test&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># -rw-r--r-- 1 1234 1234 0 Jul  5 08:53 /tmp/test</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The container is running as UID 0 with only <code>CHOWN</code> allowed.</p><p>The next step is to verify that the container has only the <code>CHOWN</code> capability—and nothing more.</p><p>Let&#39;s run a few root-only operations from inside the container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs tmpfs /mnt</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># mount: /mnt: permission denied.</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;2024-01-01&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># date: cannot set date: Operation not permitted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Both <code>mount</code> and <code>date -s</code> fail.</p><p>These syscalls <code>mount()</code> and <code>settimeofday()</code> needs capabilities like <code>CAP_SYS_ADMIN</code> or <code>CAP_SYS_TIME</code>, which we haven&#39;t granted.</p><p>Now let&#39;s confirm the capabilities at the kernel level:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">cat</span> /proc/1/status <span class="token operator">|</span> <span class="token function">grep</span> CapEff</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># CapEff: 0000000000000001</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Decode it to human-readable form:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">printf</span> <span class="token string">&quot;%x<span class="token entity" title="\\n">\\n</span>&quot;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> capsh <span class="token parameter variable">--decode</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 0x0000000000000001=cap_chown</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The container runs as a non-root user with only the <code>CHOWN</code> capability.</p><p><em>So, how does Kubernetes enforce this?</em></p><p>It doesn&#39;t.</p><p>Well, not directly.</p><p>You declare your intent in the <code>securityContext</code>, but enforcement happens deeper in the stack.</p><p><strong>The kubelet passes the configuration to the container runtime and the runtime applies the requested capabilities when launching the container.</strong></p><p>This is done via the Linux <code>capset()</code> system call.</p><p>From that point on, the Linux kernel handles enforcement.</p>`,27)),t(c,{data:[{id:"1/4"},{id:"2/4"},{id:"3/4"},{id:"4/4"}]},{title0:a(({value:i,isActive:l})=>[...s[117]||(s[117]=[e("1/4",-1)])]),title1:a(({value:i,isActive:l})=>[...s[118]||(s[118]=[e("2/4",-1)])]),title2:a(({value:i,isActive:l})=>[...s[119]||(s[119]=[e("3/4",-1)])]),title3:a(({value:i,isActive:l})=>[...s[120]||(s[120]=[e("4/4",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[121]||(s[121]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/23631e66d828e3cc9d6313c4441e1011.svg",alt:"The kubelet polls the control plane for pods. If it finds one, it downloads the spec.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The kubelet polls the control plane for pods. If it finds one, it downloads the spec.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[122]||(s[122]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/5e44d03eaaf7b6a8a92dff5c1600c948.svg",alt:"The Kubelet delegates container operations to runtime interfaces (CRI, CNI, CSI).",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The Kubelet delegates container operations to runtime interfaces (CRI, CNI, CSI).")],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[123]||(s[123]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/80c037eca089724e2e941baa2a5ad59e.svg",alt:"The container runtime sets capabilities on the kernel for enforcement.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The container runtime sets capabilities on the kernel for enforcement.")],-1)])]),tab3:a(({value:i,isActive:l})=>[...s[124]||(s[124]=[n("ul",null,[n("li",null,[n("img",{src:"https://learnkube.com/a/4d6005ebf2ca4ae55b2e6288c2445f10.svg",alt:"Linux kernel enforces capabilities for all containers through system calls.Linux kernel enforces capabilities for all containers through system calls.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Linux kernel enforces capabilities for all containers through system calls.Linux kernel enforces capabilities for all containers through system calls.")])],-1),n("p",null,"Linux kernel enforces capabilities for all containers through system calls.",-1)])]),_:1}),s[239]||(s[239]=n("p",null,[n("strong",null,"But figuring out which capabilities your application actually needs isn't always straightforward.")],-1)),s[240]||(s[240]=n("p",null,"Some tools document this clearly, but many don't—especially older or less-maintained ones.",-1)),s[241]||(s[241]=n("p",null,[e("A good starting point is to remove everything using "),n("code",null,'drop: ["ALL"]'),e(", then add capabilities back one by one until the container works.")],-1)),s[242]||(s[242]=n("p",null,"This trial-and-error approach is common and works well for simple setups.",-1)),n("p",null,[s[126]||(s[126]=e("If you need more precision, you can trace system calls using tools like ",-1)),n("a",B,[t(o,{icon:"fas fa-globe"}),s[125]||(s[125]=e("seccomp",-1))]),s[127]||(s[127]=e(" or audit logs.",-1))]),s[243]||(s[243]=p('<p>This lets you see exactly which capabilities the process tries to use at runtime.</p><p><strong>By running as a non-root user and enabling only the few capabilities your app truly needs, you reduce exposure without breaking functionality.</strong></p><p><em>But there&#39;s a remaining risk: what if the process tries to gain more privileges after it starts, even if it begins as a non-root user?</em></p><hr><h2 id="allowprivilegeescalation" tabindex="-1"><a class="header-anchor" href="#allowprivilegeescalation"><span><code>allowPrivilegeEscalation</code></span></a></h2><p>Some binaries are designed to do exactly that.</p><p>This is often done using mechanisms like <strong>setuid binaries</strong>, which are programs that automatically run with elevated privileges when executed.</p><p><strong>That means a container can start as a non-root user but still end up with root-level privileges mid-execution.</strong></p><p>Kubernetes addresses this with the <code>allowPrivilegeEscalation</code> setting.</p><p>Setting <code>allowPrivilegeEscalation: false</code> tells the container runtime not to allow the process to gain more privileges than it started with.</p>',10)),n("p",null,[s[129]||(s[129]=e("To do that, the container runtime sets the ",-1)),n("a",Y,[t(o,{icon:"fas fa-globe"}),s[128]||(s[128]=e("no_new_privs",-1))]),s[130]||(s[130]=e(" flag on the process at launch.",-1))]),s[244]||(s[244]=p(`<p>This flag is a <strong>kernel-enforced bit</strong> that locks privilege boundaries for the entire process tree.</p><p>You can verify that it&#39;s active by inspecting the container&#39;s main process.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">cat</span> /proc/1/status <span class="token operator">|</span> <span class="token function">grep</span> NoNewPrivs</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NoNewPrivs:	1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A value of <code>1</code> confirms that the process is explicitly prohibited from gaining any additional privileges—even if it executes a <strong>setuid binary</strong>.</p><p><strong>This is a Linux kernel feature that tells the kernel to deny any privilege escalation, even if the binary tries.</strong></p><p>It&#39;s simple, fast, and effective, especially in containers based on general-purpose Linux images, which often include tools like <code>sudo</code> or <code>su</code>.</p><p>Let&#39;s demonstrate what <code>allowPrivilegeEscalation: true</code> setting does with a practical example.</p><p>We&#39;ll create a container that runs as the <code>nobody</code> user and configure <code>sudo</code> to allow privilege escalation.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="privilege-escalation.yaml"><span>privilege-escalation.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> privilege<span class="token punctuation">-</span>escalation</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never</span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sudo<span class="token punctuation">-</span>container</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">      apt-get update &amp;&amp; apt-get install -y sudo</span>
<span class="line">      echo &quot;nobody ALL=(ALL) NOPASSWD: ALL&quot; &gt; /etc/sudoers.d/nobody</span>
<span class="line">      # Execute commands as the nobody user</span>
<span class="line">      su - nobody -s /bin/bash -c &#39;</span>
<span class="line">        echo &quot;Current user: $(whoami)&quot;</span>
<span class="line">        echo &quot;Current UID: $(id -u)&quot;</span>
<span class="line">        echo &quot;Attempting sudo whoami...&quot;</span>
<span class="line">        sudo whoami</span>
<span class="line">        echo &quot;sudo exit status: $?&quot;</span>
<span class="line">      &#39;</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># Explicitly allowing escalation</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When you run this pod, you&#39;ll see:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> privilege-escalation.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/privilege-escalation created</span></span>
<span class="line"></span>
<span class="line">kubectl get pod</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME                      READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span class="token comment"># privilege-escalation      1/1     Running   0          5s</span></span>
<span class="line"></span>
<span class="line">kubectl logs privilege-escalation</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: nobody</span></span>
<span class="line"><span class="token comment"># Current UID: 65534</span></span>
<span class="line"><span class="token comment"># Attempting sudo whoami...</span></span>
<span class="line"><span class="token comment"># root</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>nobody</code> user successfully escalated to root using sudo.</p><p>Now let&#39;s see what happens when we set <code>allowPriviliegeEscalation: false</code></p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Let&#39;s get the logs of the <code>privilege-escalation-false</code> pod:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl get pod</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME                      READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span class="token comment"># privilege-escalation-false   1/1     Running     0          3s</span></span>
<span class="line"></span>
<span class="line">kubectl logs privilege-escalation-false</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: nobody</span></span>
<span class="line"><span class="token comment"># Current UID: 65534</span></span>
<span class="line"><span class="token comment"># Attempting sudo whoami...</span></span>
<span class="line"><span class="token comment"># sudo: The &quot;no new privileges&quot; flag is set, which prevents sudo from running as root.</span></span>
<span class="line"><span class="token comment"># sudo: If sudo is running in a container, you may need to adjust the container configuration to disable the flag.</span></span>
<span class="line"><span class="token comment"># sudo exit status: 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>The kernel blocks the privilege escalation attempt.</strong></p><p>Even though <code>sudo</code> is installed and configured, the <code>no_new_privs</code> flag prevents the process from gaining root privileges.</p><p>This setting works hand-in-hand with <code>runAsNonRoot</code> and <strong>Linux capabilities</strong>.</p><p><strong>Even if a container includes a binary that would normally let it elevate to root, this flag ensures it won&#39;t be allowed to do so.</strong></p><p>It&#39;s especially useful for securing containers that use third-party tools or packages, where you might not know exactly what&#39;s inside.</p><p>For example, an image based on a general-purpose Linux distribution might contain <code>sudo</code> or <code>su</code> commands that could otherwise be misused.</p><p>In most production environments, it&#39;s safe—and recommended—to set <code>allowPrivilegeEscalation</code> to false for every container unless you have a clear, documented reason not to.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">  <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This container runs as a non-root user, cannot elevate privileges, and only has one additional capability.</strong></p><p><em>Just enough to perform a required task.</em></p><p>With privilege escalation locked down, the next layer of defense is the container&#39;s filesystem.</p><p>Even if an attacker gains access, they shouldn&#39;t be able to modify the container&#39;s binaries, drop malware, or tamper with startup logic.</p><p>But first, it&#39;s important to understand the worst-case scenario: containers that bypass all isolation.</p><hr><h2 id="privileged-containers" tabindex="-1"><a class="header-anchor" href="#privileged-containers"><span>Privileged Containers</span></a></h2><p><strong>Privileged containers</strong> override or nullify many kernel-level security mechanisms like seccomp, AppArmor, SELinux.</p><p>Setting <code>privileged: true</code> field in the <code>securityContext</code> field for the container, removes nearly all security boundaries between the container and the host.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Never do this unless absolutely necessary</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>A privileged container has access to all host devices, can see all processes on the host, and bypasses most security restrictions.</strong></p><p>It&#39;s equivalent to running with all Linux capabilities and more.</p><p>Under the hood, privileged mode disables multiple layers of isolation:</p>`,37)),n("ol",null,[s[137]||(s[137]=n("li",null,[n("strong",null,"It grants access to the host PID namespace,"),e(" so the container can see and interact with all system processes.")],-1)),s[138]||(s[138]=n("li",null,[n("strong",null,"It shares the host's network and device namespaces,"),e(" bypassing network isolation and exposing physical interfaces and hardware devices.")],-1)),n("li",null,[s[131]||(s[131]=n("strong",null,"It allows mount operations,",-1)),s[132]||(s[132]=e(" including remounting sensitive filesystems like ",-1)),t(o,{icon:"fas fa-folder-open"}),s[133]||(s[133]=n("code",null,"/proc",-1)),s[134]||(s[134]=e(", ",-1)),t(o,{icon:"fas fa-folder-open"}),s[135]||(s[135]=n("code",null,"/sys",-1)),s[136]||(s[136]=e(", or even the host root.",-1))])]),s[245]||(s[245]=p('<p>For cgroups, the process still runs within resource limits, but privileged containers can often manipulate cgroup settings themselves, potentially escaping restrictions or affecting other containers.</p><p><strong>The result is that privileged containers behave more like virtual machines than isolated processes.</strong></p><p>This is why they represent such a significant security risk.</p><p>In practice, privileged containers should be extremely rare and tightly controlled.</p><p><strong>The only legitimate use cases are typically system-level tools</strong> like: Container runtime components (like containerd), Network plugins that need to configure host networking, Storage drivers that manage host volumes.</p><p>If you believe your workload needs <code>privileged: true</code>, first validate whether granting a specific capability solves the problem.</p><p>If that doesn&#39;t work, document exactly why privileged access is required and implement compensating controls like network policies and admission controllers.</p><hr><h2 id="readonlyrootfilesystem" tabindex="-1"><a class="header-anchor" href="#readonlyrootfilesystem"><span>readOnlyRootFilesystem</span></a></h2><p><strong>Most containers don&#39;t need to write to their own filesystem after startup.</strong></p><p>In fact, allowing them to do so introduces unnecessary risk.</p><p>If an attacker compromises the container, a <strong>writable root filesystem</strong> makes it easier to drop malicious binaries, overwrite scripts, or tamper with logs and config files.</p><p>Kubernetes allows you to lock this down using the <code>readOnlyRootFilesystem</code> option.</p><p>Under the hood, this setting passes a <strong>read-only flag</strong> to the container runtime when the root filesystem mount is created.</p><p>The container runtime then ensures that the root of the container is mounted with <code>readOnly: true</code>.</p>',15)),n("p",null,[s[139]||(s[139]=e("Any write attempts to paths like ",-1)),t(o,{icon:"fas fa-folder-open"}),s[140]||(s[140]=n("code",null,"/bin",-1)),s[141]||(s[141]=e(", ",-1)),t(o,{icon:"fas fa-folder-open"}),s[142]||(s[142]=n("code",null,"/etc",-1)),s[143]||(s[143]=e(", or ",-1)),t(o,{icon:"fas fa-folder-open"}),s[144]||(s[144]=n("code",null,"/var",-1)),s[145]||(s[145]=e(" will fail unless a writable volume is mounted to override that location.",-1))]),s[246]||(s[246]=p(`<p>It&#39;s enforced entirely by the <strong>Linux kernel</strong>, so even if an attacker gains access, they can&#39;t persist changes to the image.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When <code>readOnlyRootFilesystem</code> is enabled, the container runtime mounts the container&#39;s root filesystem in <strong>read-only mode</strong>.</p><p>This is done at container startup, before any processes are launched, using the container&#39;s dedicated <strong>mount namespace</strong>.</p><p>That namespace provides an isolated view of the filesystem, and within it, the runtime uses the standard Linux <code>mount()</code> syscall with the <code>MS_RDONLY</code> flag.</p><p>This flag tells the kernel to treat the mount as read-only, just as if you had run <code>mount -o ro</code> on a physical system.</p><p>The <strong>Virtual File System (VFS)</strong> is the kernel subsystem that handles all file operations.</p><p>Internally, the kernel marks this mount with the <code>MNT_RDONLY</code> flag, which becomes visible and enforceable at the VFS layer.</p><p>When a process inside the container attempts a write operation, such as <code>write()</code>, <code>mkdir()</code>, or <code>unlink()</code>, the syscall passes through the VFS.</p><p>At this point, the VFS checks the mount flags.</p><p>If it sees <code>MNT_RDONLY</code> set, the kernel immediately rejects the request.</p><p>Even if an attacker has shell access or tries to execute payloads from within the container, they won&#39;t be able to write to any path unless a writable volume has been mounted over it.</p><p>They can&#39;t drop binaries, modify config files, or make any lasting changes to the image.</p><p>The <strong>root filesystem remains immutable</strong> for the lifetime of the container.</p><p>Not all applications are compatible with a fully read-only root.</p>`,15)),n("p",null,[s[146]||(s[146]=e("Some need to write logs to ",-1)),t(o,{icon:"fas fa-folder-open"}),s[147]||(s[147]=n("code",null,"/tmp",-1)),s[148]||(s[148]=e(", store runtime state in ",-1)),t(o,{icon:"fas fa-folder-open"}),s[149]||(s[149]=n("code",null,"/var/run",-1)),s[150]||(s[150]=e(", or generate temporary files in ",-1)),t(o,{icon:"fas fa-folder-open"}),s[151]||(s[151]=n("code",null,"/home",-1)),s[152]||(s[152]=e(".",-1))]),s[247]||(s[247]=p(`<p>In those cases, you can mount <strong>writable volumes</strong> at those paths to provide the necessary write access.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp</span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This configuration creates an isolated in-memory volume and gives the container a safe place to write while keeping the rest of the filesystem immutable.</strong></p><p>We&#39;ve now locked down who the container runs as, what it&#39;s allowed to do, and where it can write.</p><p><em>But that&#39;s only part of the picture.</em></p><p>Containers frequently interact with mounted volumes and those volumes bring their own permission and access challenges.</p><p><strong>Capabilities limit what a process can do, but they don&#39;t restrict which system calls a process can actually make.</strong></p><p>That&#39;s where Seccomp comes in.</p><hr><h2 id="seccomp-profiles" tabindex="-1"><a class="header-anchor" href="#seccomp-profiles"><span>Seccomp Profiles</span></a></h2>`,10)),n("p",null,[n("strong",null,[n("a",z,[t(o,{icon:"fas fa-globe"}),s[153]||(s[153]=e("Seccomp",-1))]),s[154]||(s[154]=e(" (short for secure computing mode) provides syscall-level control by attaching a BPF (Berkeley Packet Filter) program directly to a process.",-1))])]),s[248]||(s[248]=p("<p>Each time the process invokes a system call, the kernel intercepts it and hands the syscall number and arguments to the <strong>BPF filter</strong>.</p><p>This happens in <strong>kernel mode</strong>, just before the syscall is executed.</p><p>The filter can then allow the call, block it with an <code>EPERM</code>, terminate the process with a <code>SIGSYS</code>, or log the attempt for auditing.</p><p>Unlike capabilities, which act at a higher abstraction level, Seccomp operates on the <strong>syscall interface</strong>.</p><p>It lets you specify which syscalls a process is allowed to use and deny everything else by default.</p>",5)),t(c,{data:[{id:"1/4"},{id:"2/4"},{id:"3/4"},{id:"4/4"}],active:0},{title0:a(({value:i,isActive:l})=>[...s[155]||(s[155]=[e("1/4",-1)])]),title1:a(({value:i,isActive:l})=>[...s[156]||(s[156]=[e("2/4",-1)])]),title2:a(({value:i,isActive:l})=>[...s[157]||(s[157]=[e("3/4",-1)])]),title3:a(({value:i,isActive:l})=>[...s[158]||(s[158]=[e("4/4",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[159]||(s[159]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/4dbf8701996e839152727222e64f17b7.svg",alt:"JVM applications make system calls through the kernel to access system resources like the network.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"JVM applications make system calls through the kernel to access system resources like the network.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[160]||(s[160]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/f641beea53964c60434e21fc62725218.svg",alt:"The kernel uses capabilities to control privileged operations, checking permissions for specific syscalls like  and .",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("The kernel uses capabilities to control privileged operations, checking permissions for specific syscalls like "),n("code",null,"CHOWN"),e(" and "),n("code",null,"CAP_NET_ADMIN"),e(".")])],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[161]||(s[161]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/3929520349640bb4efa9f168d7dbc2fe.svg",alt:"Seccomp adds another security layer that can block specific syscalls like ioctl while allowing others through BPF filtering.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Seccomp adds another security layer that can block specific syscalls like ioctl while allowing others through BPF filtering.")],-1)])]),tab3:a(({value:i,isActive:l})=>[...s[162]||(s[162]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/86dd608ffe45dc2ef9ff56eaf74492a6.svg",alt:"Multiple syscalls can be filtered simultaneously, with seccomp allowing setsockopt while blocking ioctl, providing fine-grained syscall control.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Multiple syscalls can be filtered simultaneously, with seccomp allowing setsockopt while blocking ioctl, providing fine-grained syscall control.")],-1)])]),_:1}),s[249]||(s[249]=p(`<p><strong>In container runtimes, the default Seccomp profile explicitly allows just over 300 common syscalls required for typical container workloads.</strong></p><p>Everything else is blocked using <code>SCMP_ACT_ERRNO</code>, which causes the syscall to fail with a permission error.</p><p>Blocked syscalls include:</p><ul><li><code>mount</code> / <code>umount</code> – filesystem mounting</li><li><code>ptrace</code> – process tracing and debugging</li><li><code>reboot</code> – system reboot</li><li><code>setns</code> – namespace manipulation</li><li><code>keyctl</code> – kernel keyring access</li></ul><p>By default, Kubernetes applies no seccomp profile.</p><p>The <code>RuntimeDefault</code> seccomp profile allows only a minimal set of system calls required for basic container execution.</p><p>To apply the <code>RuntimeDefault</code> seccomp profile, the kubelet must be started with the <code>--seccomp-default</code> flag.</p><p>This enables <code>RuntimeDefault</code> as the default profile for all pods that do not explicitly specify one.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>When the kubelet starts a container with this setting, it passes the seccomp configuration to the container runtime via CRI.</strong></p><p>The runtime loads its built-in <strong>BPF filter program</strong> and attaches this filter to the container process using the <code>seccomp()</code> syscall.</p><p>From that point on, every syscall from the container is evaluated by the BPF program.</p><p>If you need more granular control, you can define a <strong>custom seccomp profile</strong>.</p><p>To achieve this, you need to create a JSON file on the node and reference it in the pod spec.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="app-specific.json"><span>app-specific.json</span></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;defaultAction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;architectures&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;SCMP_ARCH_X86_64&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;syscalls&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fstat&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ALLOW&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;connect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;accept&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token property">&quot;op&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_CMP_EQ&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This seccomp profile blocks all system calls by default using <code>SCMP_ACT_ERRNO</code> and explicitly allows basic file operations.</strong></p><p>It also permits socket-related calls only when the first argument (<code>domain</code>) is <code>2</code> (<code>AF_INET</code>, i.e., IPv4).</p><p>To reference it in your pod.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> Localhost</span>
<span class="line">    <span class="token key atrule">localhostProfile</span><span class="token punctuation">:</span> profiles/app<span class="token punctuation">-</span>specific.json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The most restrictive pod security configuration blocks all Linux capabilities and restricts syscalls to a minimal safe set:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If your application fails, the process usually receives an <code>EPERM</code> (Operation not permitted) error.</p><p>You can use <code>strace</code> to trace syscall activity inside the container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl debug <span class="token parameter variable">-it</span> your-pod <span class="token parameter variable">--image</span><span class="token operator">=</span>nicolaka/netshoot -- <span class="token function">strace</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>all your-command</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If audit logging is enabled, you can query the system audit logs for seccomp violations:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ausearch <span class="token parameter variable">-m</span> SECCOMP</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Start with the <code>RuntimeDefault</code> profile and only create custom profiles if you have specific security requirements or compliance needs.</p><p><strong>After confirming your application runs safely under baseline constraints, incrementally tighten syscall restrictions with a custom seccomp profile.</strong></p><p>Many applications work fine with the default restrictions, but some (especially those doing system-level operations) may need careful tuning.</p><hr><h2 id="apparmor" tabindex="-1"><a class="header-anchor" href="#apparmor"><span>AppArmor</span></a></h2>`,31)),n("p",null,[n("a",V,[t(o,{icon:"fas fa-globe"}),s[163]||(s[163]=e("AppArmor",-1))]),s[164]||(s[164]=e(" provides another layer of access control by restricting programs to a limited set of resources through path-based access control profiles.",-1))]),s[250]||(s[250]=p(`<p><strong>Unlike seccomp which filters system calls, AppArmor focuses on file system access, network access, and capability usage.</strong></p><p>For example, a container might use seccomp to block <code>mount()</code> syscalls completely, while AppArmor ensures that even if file operations are allowed, they can only access specific directories.</p><p>Kubernetes supports AppArmor through annotations, but it requires profiles to be loaded on each node beforehand.</p><p><strong>Most production environments rely on the combination of capabilities, seccomp, and Security Context settings rather than adding AppArmor complexity.</strong></p><p><em>You might wonder why we need both.</em></p><p>They operate at <strong>different levels</strong>.</p><p>AppArmor profiles can be applied at either the pod level or the container level.</p><p>When both are specified, the <strong>container-level profile</strong> takes precedence over the pod-level one.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">appArmorProfile</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This setting tells the container runtime to apply its default AppArmor profile to the container.</p><p><strong>That profile defines what files, paths, and kernel resources the process can access, using a declarative rule set enforced by the kernel.</strong></p><p>While AppArmor controls where and what a process can touch, <strong>Linux capabilities</strong> define whether the process is allowed to perform certain privileged operations.</p><p>AppArmor builds on capabilities by further restricting how those operations interact with the filesystem and system objects.</p><p>It doesn&#39;t grant privilege—it scopes it to safe, expected paths.</p>`,14)),n("p",null,[s[165]||(s[165]=e("For example, AppArmor may be used to allow a program to have read access to ",-1)),t(o,{icon:"fas fa-folder-open"}),s[166]||(s[166]=n("code",null,"/etc/",-1)),t(o,{icon:"fas fa-key"}),s[167]||(s[167]=n("code",null,"passwd",-1)),s[168]||(s[168]=e(", but not ",-1)),t(o,{icon:"fas fa-folder-open"}),s[169]||(s[169]=n("code",null,"/etc/",-1)),t(o,{icon:"fas fa-key"}),s[170]||(s[170]=n("code",null,"shadow",-1)),s[171]||(s[171]=e(".",-1))]),s[251]||(s[251]=n("p",null,[n("strong",null,"Seccomp"),e(" adds a third layer by filtering which system calls the process can execute, and under what conditions.")],-1)),t(c,{data:[{id:"1/3"},{id:"2/3"},{id:"3/3"}]},{title0:a(({value:i,isActive:l})=>[...s[172]||(s[172]=[e("1/3",-1)])]),title1:a(({value:i,isActive:l})=>[...s[173]||(s[173]=[e("2/3",-1)])]),title2:a(({value:i,isActive:l})=>[...s[174]||(s[174]=[e("3/3",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[175]||(s[175]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/7d396d8ed2ba612d19a2fb85d209b4c9.svg",alt:"JVM applications with  can configure network interfaces, routing tables, and iptables rules through system calls to the kernel.",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("JVM applications with "),n("code",null,"CAP_NET_ADMIN"),e(" can configure network interfaces, routing tables, and iptables rules through system calls to the kernel.")])],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[176]||(s[176]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/6cb224662f002fd8d1c532185510e869.svg",alt:"AppArmor adds a second security layer that restricts syscalls to only work on virtual devices, for example.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"AppArmor adds a second security layer that restricts syscalls to only work on virtual devices, for example.")],-1),n("p",null,null,-1)])]),tab2:a(({value:i,isActive:l})=>[...s[177]||(s[177]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/6b164bccfb75ee7af564de3d57117fed.svg",alt:"Seccomp provides the final layer by filtering specific syscalls like  and .",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("Seccomp provides the final layer by filtering specific syscalls like "),n("code",null,"ioctl"),e(" and "),n("code",null,"setsockopt"),e(".")])],-1),n("p",null,null,-1)])]),_:1}),s[252]||(s[252]=p(`<p>So while capabilities check what kind of privilege a process has, and AppArmor checks where it can apply it, seccomp governs the <strong>syscall-level behavior</strong>.</p><hr><h2 id="fsgroup-and-supplementalgroups" tabindex="-1"><a class="header-anchor" href="#fsgroup-and-supplementalgroups"><span><code>fsGroup</code> and <code>supplementalGroups</code></span></a></h2><p>Even with the container process running as a <strong>non-root user</strong>, file access can still become a problem, especially when working with <strong>mounted volumes</strong>.</p><p>Many Kubernetes volumes, such as those backed by NFS, Ceph, or even emptyDir, are shared between containers or pods.</p><p>These volumes often come with default ownership settings that don&#39;t match the user your container is running as.</p><p>The result? <strong>Permission denied errors</strong> occur when your application tries to read or write files.</p><p>To fix this, Kubernetes provides <code>fsGroup</code>.</p><p>When <code>fsGroup</code> is set, the kubelet takes care of applying it during <strong>volume mount</strong>.</p><p>It recursively changes the group ownership (GID) of the mounted volume&#39;s files to match the provided fsGroup, using <code>chgrp</code> under the hood.</p><p>It also ensures that any new files created by the container will inherit that <strong>group ID</strong>, making them accessible to the process even if it runs as a non-root user.</p><p>This only affects <strong>mounted volumes</strong> - not the image&#39;s internal filesystem - and doesn&#39;t require changes inside the container image itself.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>It also ensures that any files created within those volumes are owned by that group, allowing non-root processes to access them as long as they&#39;re part of the same group.</p><p>Let&#39;s say your container runs as UID 1000, and you set <code>fsGroup: 2000</code>, here&#39;s what happens next.</p><p>When a Pod with <code>fsGroup</code> is scheduled to a node, the <strong>kubelet&#39;s volume manager</strong> prepares the volume mount points.</p><p>Before the container runtime starts the container, the kubelet executes <strong>volume setup operations</strong> on the host.</p><p>The kubelet mounts the volume from its source (e.g., NFS, hostPath, etc.) to a staging path on the host.</p><p>The kubelet then applies the ownership and permission changes based on fsGroup using <strong>host-level system calls</strong>.</p><p>It uses the equivalent of <code>chown -R :2000</code> on the mounted volume.</p><p>If <code>fsGroupChangePolicy</code> is set to <code>OnRootMismatch</code>, it only changes ownership if the root directory&#39;s group doesn&#39;t match the <code>fsGroup</code>.</p><p>Only after the ownership changes are complete does the kubelet instruct the container runtime to start the container with the volume mounted.</p>`,22)),t(c,{data:[{id:"1/4"},{id:"2/4"},{id:"3/4"},{id:"4/4"}]},{title0:a(({value:i,isActive:l})=>[...s[178]||(s[178]=[e("1/4",-1)])]),title1:a(({value:i,isActive:l})=>[...s[179]||(s[179]=[e("2/4",-1)])]),title2:a(({value:i,isActive:l})=>[...s[180]||(s[180]=[e("3/4",-1)])]),title3:a(({value:i,isActive:l})=>[...s[181]||(s[181]=[e("4/4",-1)])]),tab0:a(({value:i,isActive:l})=>[...s[182]||(s[182]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/ccb425a87cfe714b1030c6f138553ff6.svg",alt:"Kubelet receives a pod with fsGroup 2000 and instructs the container runtime to start the container with the volume mounted.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Kubelet receives a pod with fsGroup 2000 and instructs the container runtime to start the container with the volume mounted.")],-1)])]),tab1:a(({value:i,isActive:l})=>[...s[183]||(s[183]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/2148666d18da9b98e4382050d93509d1.svg",alt:"The kubelet mounts the volume to a staging path and applies the fsGroup ownership using .",tabindex:"0",loading:"lazy"}),n("figcaption",null,[e("The kubelet mounts the volume to a staging path and applies the fsGroup ownership using "),n("code",null,"chown -R :2000"),e(".")])],-1)])]),tab2:a(({value:i,isActive:l})=>[...s[184]||(s[184]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/c62aa9e0e0cc79d11e68aa09e8e672d9.svg",alt:"The container starts as UID 1000 while the volume ownership changes are applied by the kubelet on the host.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The container starts as UID 1000 while the volume ownership changes are applied by the kubelet on the host.")],-1)])]),tab3:a(({value:i,isActive:l})=>[...s[185]||(s[185]=[n("figure",null,[n("img",{src:"https://learnkube.com/a/9d75d1dbde3ec0c09a05eef08a5156ef.svg",alt:"The container can now read and write to the volume since it's part of group 2000, which owns the mounted files.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"The container can now read and write to the volume since it's part of group 2000, which owns the mounted files.")],-1)])]),_:1}),s[253]||(s[253]=p(`<p><strong>This is especially useful for logging directories that need to be shared across containers, database volumes that expect specific permissions, web servers that serve files from a mounted volume.</strong></p><p>If your application needs access to multiple groups, Kubernetes also supports <code>supplementalGroups</code>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This adds additional <strong>GIDs</strong> to the process&#39;s group list.</p><p>It&#39;s worth noting that both <code>fsGroup</code> and <code>supplementalGroups</code> affect <strong>volumes only</strong>.</p><p>They do not change permissions inside the container image itself—only the volumes mounted at runtime.</p><p>With this, you can safely manage shared file access without resorting to running as root or globally relaxing file permissions.</p><hr><h2 id="how-fsgroup-works-with-csi-volumes" tabindex="-1"><a class="header-anchor" href="#how-fsgroup-works-with-csi-volumes"><span>How fsGroup Works with CSI Volumes</span></a></h2><p>The <strong>Container Storage Interface (CSI)</strong> transforms how Kubernetes handles volume permissions compared to traditional in-tree volumes.</p><p>This affects how <code>fsGroup</code> settings get applied to mounted storage.</p><p>When a pod with a CSI volume specifies an <code>fsGroup</code>, the kubelet communicates with the <strong>CSI driver</strong> through a Unix socket.</p><p><strong>Unlike with in-tree volumes where the kubelet handles everything, CSI drivers take over significant responsibilities.</strong></p><p>The driver mounts storage to a <strong>staging path</strong> first, then to the final target path where containers access it.</p><p>Whether the <code>fsGroup</code> gets applied depends on the driver&#39;s <strong>declared capabilities</strong>.</p><p>Since Kubernetes v1.19, CSI drivers explicitly report their <code>fsGroup</code> support through the <code>CSI_VOLUME_FSGROUP_POLICY</code> capability.</p><p>CSI drivers implement one of <strong>three distinct policies</strong>:</p><ol><li>With the <code>None</code> policy, the driver doesn&#39;t support permission modifications at all. The kubelet won&#39;t attempt any ownership changes, leaving permissions as-is on the volume.</li><li>Under the <code>File</code> policy, the kubelet behaves similarly to in-tree volumes, recursively changing ownership and permissions on all files and directories to match the specified fsGroup.</li><li>The <code>ReadWriteOnceWithFSType</code> policy represents a middle ground. The kubelet only applies fsGroup changes when the volume has a specified filesystem type and uses the <strong>ReadWriteOnce access mode</strong>.</li></ol><p>This flexible approach solves several real-world problems:</p><ul><li><strong>Recursive permission changes</strong> on large volumes can severely impact performance and delay pod startup.</li><li>Many <strong>distributed storage systems</strong> implement permissions differently than Linux&#39;s user/group model.</li><li><strong>Enterprise storage platforms</strong> often have specialized security requirements that would conflict with blanket permission changes.</li></ul><figure><img src="https://learnkube.com/a/97fccaca51ca06540a85ca3180dd6684.png" alt="Flowchart outlining secure container configuration in Kubernetes, including user settings, capabilities, filesystem access, and seccomp profile" tabindex="0" loading="lazy"><figcaption>Flowchart outlining secure container configuration in Kubernetes, including user settings, capabilities, filesystem access, and seccomp profile</figcaption></figure><hr><h2 id="live-debugging-diagnosing-securitycontext-failures" tabindex="-1"><a class="header-anchor" href="#live-debugging-diagnosing-securitycontext-failures"><span>Live Debugging: Diagnosing SecurityContext Failures</span></a></h2><p>Security settings make more sense when they&#39;re tied to actual use cases.</p><p>Let&#39;s look at a few possible scenarios where <strong>Kubernetes Security Contexts</strong> helped solve concrete problems without compromising functionality.</p><p>The first example is a <strong>Legacy Monitoring Tool</strong>.</p><p>A team could be migrating an older monitoring agent into Kubernetes.</p><p>The agent needs <strong>low-level access</strong> to inspect processes and collect network metrics.</p><p>Initially, the container ran as root to make this work, but this created security concerns during audits.</p><p>Instead of keeping full root access, the team should drop all capabilities and add only what is needed.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">    <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;SYS_PTRACE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NET_ADMIN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The container worked exactly as before, but with a <strong>dramatically reduced risk profile</strong>.</p><p><strong>Second example is a backup process that needs <code>chown</code>.</strong></p><p>A database backup job is failing in Kubernetes because file ownership needs to be changed on a <strong>mounted volume</strong>.</p><p>Running the container as root fixed it, but isn&#39;t acceptable from a <strong>compliance perspective</strong>.</p><p>Instead, you can keep the container running as a non-root user and add the <code>CHOWN</code> capability.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Combined with <code>fsGroup</code>, the container could manage file ownership correctly without <strong>elevated privileges</strong>.</p><p>Third use case is <strong>Read-Only containers</strong> for public-facing apps.</p><p>A frontend application serving static files is containerized and exposed to the internet.</p><p>As a precaution, the container running the application is configured to run with a <strong>read-only root filesystem</strong>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>An <code>emptyDir</code> volume is used and mounted to <code>/tmp</code> to handle temporary files.</p><p>This setting protects the container from <strong>unauthorized file modifications</strong> in case of compromise, while keeping the application fully functional.</p><p>A key implementation detail here is <strong>volume setup and ownership adjustments</strong> are handled by the kubelet on the host, not inside the container.</p><p><strong>The kubelet runs as root and has the necessary privileges to create volumes, mount them into the container&#39;s namespace, and adjust file ownership to match the container&#39;s <code>runAsUser</code> and <code>runAsGroup</code>.</strong></p><p>The container itself doesn&#39;t need any elevated privileges to access these volumes.</p><p>The ownership changes are <strong>ephemeral</strong>—they persist only for the lifetime of the Pod&#39;s volumes and are scoped to the container&#39;s view of the filesystem.</p><p>Now, let&#39;s walk through a real troubleshooting scenario where a <strong>container security context</strong> silently breaks your workload.</p><hr><h2 id="troubleshooting-when-security-context-conflicts-with-container-behavior" tabindex="-1"><a class="header-anchor" href="#troubleshooting-when-security-context-conflicts-with-container-behavior"><span>Troubleshooting: When Security Context Conflicts with Container Behavior</span></a></h2><p>You deploy a Node.js application that needs to write logs, but the pod keeps crashing with <strong>permission errors</strong>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-app.yaml"><span>nodejs-app.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>app</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span>e</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">        const fs = require(&#39;fs&#39;);</span>
<span class="line">        const path = &#39;/var/log/app.log&#39;;</span>
<span class="line">        fs.writeFileSync(path, &#39;Starting app&#39;);</span>
<span class="line">        console.log(&#39;App started&#39;);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Deploy this pod and check the status:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> nodejs-app.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/nodejs-app created</span></span>
<span class="line"></span>
<span class="line">kubectl get pod nodejs-app</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME         READY   STATUS      RESTARTS      AGE</span></span>
<span class="line"><span class="token comment"># nodejs-app   0/1     Completed   2 (21s ago)   91s</span></span>
<span class="line"></span>
<span class="line">kubectl logs nodejs-app</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Error: EACCES: permission denied, open &#39;/var/log/app.log&#39;</span></span>
<span class="line"><span class="token comment">#     at Object.openSync (node:fs:596:3)</span></span>
<span class="line"><span class="token comment">#     at Object.writeFileSync (node:fs:2322:35)</span></span>
<span class="line"><span class="token comment">#     at [eval]:1:30</span></span>
<span class="line"><span class="token comment">#     at runScriptInThisContext (node:internal/vm:143:10)</span></span>
<span class="line"><span class="token comment">#     at node:internal/process/execution:100:14</span></span>
<span class="line"><span class="token comment">#     at [eval]-wrapper:6:24</span></span>
<span class="line"><span class="token comment">#     at runScript (node:internal/process/execution:83:62)</span></span>
<span class="line"><span class="token comment">#     at evalScript (node:internal/process/execution:114:10)</span></span>
<span class="line"><span class="token comment">#     at node:internal/main/eval_string:30:3 {</span></span>
<span class="line"><span class="token comment">#   errno: -13,</span></span>
<span class="line"><span class="token comment">#   syscall: &#39;open&#39;,</span></span>
<span class="line"><span class="token comment">#   code: &#39;EACCES&#39;,</span></span>
<span class="line"><span class="token comment">#   path: &#39;/var/log/app.log&#39;</span></span>
<span class="line"><span class="token comment"># }</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># Node.js v18.20.8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let&#39;s investigate what&#39;s happening inside the container:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-debug.yaml"><span>nodejs-debug.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>debug</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> debug</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">      echo &quot;Current user: $(whoami)&quot;</span>
<span class="line">      echo &quot;User ID: $(id -u)&quot;</span>
<span class="line">      echo &quot;Group ID: $(id -g)&quot;</span>
<span class="line">      echo &quot;Groups: $(id -G)&quot;</span>
<span class="line">      ls -la /var/log/</span>
<span class="line">      touch /var/log/test.log 2&gt;&amp;1 || echo &quot;Cannot write to /var/log&quot;</span>
<span class="line">      sleep 3600</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The output reveals:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl logs nodejs-debug</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: node</span></span>
<span class="line"><span class="token comment"># User ID: 1000</span></span>
<span class="line"><span class="token comment"># Group ID: 1000</span></span>
<span class="line"><span class="token comment"># Groups: 1000 2000</span></span>
<span class="line"><span class="token comment"># drwxr-xr-x 1 root root 4096 May 30 10:00 /var/log/</span></span>
<span class="line"><span class="token comment"># Cannot write to /var/log</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,59)),n("p",null,[s[186]||(s[186]=e("The ",-1)),t(o,{icon:"fas fa-folder-open"}),s[187]||(s[187]=n("code",null,"/var/log",-1)),s[188]||(s[188]=e(" directory is owned by root and not writable by our user!",-1))]),s[254]||(s[254]=p(`<p>First solution is using a writable volume.</p><p>Let&#39;s add an <code>emptyDir</code> volume for logs:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-fixed-volume.yaml"><span>nodejs-fixed-volume.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>fixed<span class="token punctuation">-</span>volume</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log</span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          echo &quot;Volume permissions:&quot;</span>
<span class="line">          ls -la /var/log</span></span>
<span class="line"></span>
<span class="line">          node <span class="token punctuation">-</span>e &quot;</span>
<span class="line">            const fs = require(&#39;fs&#39;);</span>
<span class="line">            fs.writeFileSync(&#39;/var/log/app.log&#39;<span class="token punctuation">,</span> &#39;App started successfully<span class="token tag">!&#39;);</span></span>
<span class="line">            console.log(&#39;Success<span class="token tag">!</span> Log written&#39;);</span>
<span class="line">          &quot;</span>
<span class="line">          echo &quot;Log contents<span class="token punctuation">:</span>&quot;</span>
<span class="line">          cat /var/log/app.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Let&#39;s apply the file:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> nodejs-fixed-volume.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/nodejs-fixed-volume created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Stream the logs:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl logs nodejs-fixed-volume</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Volume permissions: total 12</span></span>
<span class="line"><span class="token comment"># drwxrwsrwx 2 root 2000 4096 Jul  4 07:44 .</span></span>
<span class="line"><span class="token comment"># drwxr-xr-x 1 root root 4096 May 20 00:00 ..</span></span>
<span class="line"><span class="token comment"># -rw-r--r-- 1 node 2000   25 Jul  4 07:45 app.log</span></span>
<span class="line"><span class="token comment"># Success! Log written</span></span>
<span class="line"><span class="token comment"># App started successfully!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This works!</p><p>The <code>fsGroup</code> ensures the volume is writable by our container.</p><p>Let&#39;s consider an alternative approach: adjusting the application&#39;s log path.</p><p>Sometimes it&#39;s easier to change where the app writes:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-home.yaml"><span>nodejs-home.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>home</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">        echo &quot;Home directory: $HOME&quot;</span>
<span class="line">        echo &quot;Home permissions:&quot;</span>
<span class="line">        ls -la &quot;$HOME&quot;</span>
<span class="line">        node -e &quot;</span>
<span class="line">          const fs = require(&#39;fs&#39;);</span>
<span class="line">          const path = process.env.HOME + &#39;/app.log&#39;;</span>
<span class="line">          fs.writeFileSync(path, &#39;Using home directory&#39;);</span>
<span class="line">          console.log(&#39;Success using home dir&#39;);</span>
<span class="line">        &quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><em>This works too!</em></p><p><strong>But for production, that&#39;s not enough.</strong></p><p>A production-ready solution combines all security best practices into a single configuration:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-production.yaml"><span>nodejs-production.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>production</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">    <span class="token key atrule">fsGroupChangePolicy</span><span class="token punctuation">:</span> <span class="token string">&quot;OnRootMismatch&quot;</span></span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">        <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs</span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /logs</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp</span>
<span class="line">      <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NODE_ENV</span>
<span class="line">          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;production&quot;</span></span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">-</span>e</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          const fs = require(&#39;fs&#39;);</span>
<span class="line">          const logFile = &#39;/logs/app.log&#39;;</span>
<span class="line">          // Verify we can write</span>
<span class="line">          fs.writeFileSync(logFile, \`App started at \${new Date().toISOString()}\\n\`);</span>
<span class="line">          console.log(&#39;Application running securely!&#39;);</span></span>
<span class="line"></span>
<span class="line">          // Simulate app work</span>
<span class="line">          setInterval(() =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            fs.appendFileSync(logFile<span class="token punctuation">,</span> \`Heartbeat at $<span class="token punctuation">{</span>new Date().toISOString()<span class="token punctuation">}</span>\\n\`);</span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span> 5000);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>`,16)),n("p",null,[s[189]||(s[189]=e("This version respects all security best practices, and ensures ",-1)),t(o,{icon:"fas fa-folder-open"}),s[190]||(s[190]=n("code",null,"/logs",-1)),s[191]||(s[191]=e(" and ",-1)),t(o,{icon:"fas fa-folder-open"}),s[192]||(s[192]=n("code",null,"/tmp",-1)),s[193]||(s[193]=e(" are writable while the root filesystem remains read-only.",-1))]),s[255]||(s[255]=n("p",null,[n("em",null,"So, what did we learn from these excercises?")],-1)),n("p",null,[n("strong",null,[s[194]||(s[194]=e("Many containerized applications attempt writes to system paths like ",-1)),t(o,{icon:"fas fa-folder-open"}),s[195]||(s[195]=n("code",null,"/var/log",-1)),s[196]||(s[196]=e(" or ",-1)),s[197]||(s[197]=n("code",null,"/run",-1)),s[198]||(s[198]=e(" due to defaults inherited from upstream Linux software.",-1))])]),s[256]||(s[256]=p('<p>With non-root users and a read-only root, those paths break.</p><p><code>fsGroup</code> fixes that by making volumes writable to your container&#39;s user.</p><p>Security needs layers—<code>runAsNonRoot</code>, <code>readOnlyRootFilesystem</code>, and dropped capabilities each block different risks.</p><p>Don&#39;t apply everything at once.</p><p>Add one control, test, then move to the next.</p><p>When things fail, use a debug shell.</p><p>Check <code>id</code>, <code>ls</code>, and try writing files to see what&#39;s blocked.</p><hr><h2 id="summary-and-best-practices" tabindex="-1"><a class="header-anchor" href="#summary-and-best-practices"><span>Summary and Best Practices</span></a></h2><p>Securing containers in Kubernetes isn&#39;t about one magic setting, it&#39;s about <strong>layering protections</strong> that make it harder for things to go wrong.</p><p>Treat <strong>Security Contexts</strong> as part of your architecture.</p><p>Here&#39;s how to achieve this effectively.</p><p>Start by avoiding root entirely.</p><p>Always set <code>runAsNonRoot: true</code> and define an explicit <code>runAsUser</code>.</p><p>Even though root inside a container isn&#39;t host root, it still carries <strong>unnecessary privilege</strong>.</p><p>Next, <strong>drop all Linux capabilities</strong> by default.</p><p>Most applications don&#39;t need them.</p><p>Use <code>drop: [&quot;ALL&quot;]</code> as your baseline, and add back only what&#39;s strictly required—like <code>NET_ADMIN</code> for <strong>low-level networking</strong>.</p><p><strong>Block privilege escalation</strong>.</p><p>Set <code>allowPrivilegeEscalation: false</code> to prevent processes from gaining extra rights via <strong>setuid binaries</strong> or other mechanisms.</p><p>Then <strong>lock down the root filesystem</strong>.</p><p>If the app doesn&#39;t need to write to its own image, use <code>readOnlyRootFilesystem: true</code>.</p><p>This stops attackers from modifying binaries or installing tools.</p><p>Mount <strong>temporary writable volumes</strong> (like emptyDir) only where necessary.</p><p>To make them accessible to non-root users, set <code>fsGroup</code> to match the container&#39;s runtime group ID.</p><p>Finally, don&#39;t trust <strong>third-party images</strong> by default.</p><p>Many assume root or lack minimal security settings.</p><p>Review base images carefully, override insecure defaults, and scan for embedded risks.</p><p>Each of these controls blocks a specific class of attacks—<strong>privilege escalation</strong>, <strong>lateral movement</strong>, and <strong>persistence</strong>.</p><p>Build incrementally, test behavior, and validate permissions at runtime.</p>',30)),f(" TODO: add ARTICLE CARD "),t(d,m(v({title:"From Linux Primitives to Kubernetes Security Contexts",desc:"Dive deep into Kubernetes Security Contexts and learn how to manage security settings for your pods and containers.",link:"https://chanhi2000.github.io/bookshelf/learnkube.com/security-contexts/",logo:"https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg",background:"rgba(102,152,204,0.2)"})),null,16)])}const X=h(A,[["render",H]]),Z=JSON.parse('{"path":"/learnkube.com/security-context/","title":"From Linux Primitives to Kubernetes Security Contexts","lang":"en-US","frontmatter":{"lang":"en-US","title":"From Linux Primitives to Kubernetes Security Contexts","description":"Article(s) > From Linux Primitives to Kubernetes Security Contexts","icon":"iconfont icon-k8s","category":["DevOps","Kubernetes","Article(s)"],"tag":["blog","learnkube.com","devops","kubernetes","k8s"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"From Linux Primitives to Kubernetes Security Contexts\\",\\"image\\":[\\"https://static.learnkube.com/e35dce29118ebe296671cab01d160a5c.png\\",\\"https://learnkube.com/a/be7a7a42d500d60d85ff95a550147e18.svg\\",\\"https://learnkube.com/a/c59552e508a9802dff5de01983790a72.svg\\",\\"https://learnkube.com/a/3af70ded6be4dce280ffdcaac3500eb5.svg\\",\\"https://makelinux.github.io/kernel/map/\\",\\"https://learnkube.com/a/2a4f54de9482a24ad9168d795b366911.svg\\",\\"https://learnkube.com/a/8073408f5aa250870831e8424e8495f7.svg\\",\\"https://learnkube.com/a/5fb7ed4a532839d3b559342e04d6d802.svg\\",\\"https://learnkube.com/a/386c29c1f90fec22694a4f0ce0b5aa0d.svg\\",\\"https://learnkube.com/a/abd0a2e760de387283d844e0c9b590b7.svg\\",\\"https://learnkube.com/a/f4ad672dd92d863c0d5b324b954c20eb.svg\\",\\"https://learnkube.com/a/ae8392b36d19cf7486761af8fce97b6e.svg\\",\\"https://learnkube.com/a/7db84bc90ac80a944676bc7db80424bf.svg\\",\\"https://learnkube.com/a/219af075732ea2ad7bf79a3a8ce838bd.svg\\",\\"https://learnkube.com/a/cd62a2e690b06c0659b570c519e473da.svg\\",\\"https://learnkube.com/a/fcaaf0aa811f986ba357f73b5ae6365c.svg\\",\\"https://learnkube.com/a/be18e9e2649498e83be2d8301bb850f6.svg\\",\\"https://learnkube.com/a/3f09a092f3be11f3a5ad1628d754586f.svg\\",\\"https://learnkube.com/a/5c399bad12e1202ad138851a8a0973de.svg\\",\\"https://learnkube.com/a/23631e66d828e3cc9d6313c4441e1011.svg\\",\\"https://learnkube.com/a/5e44d03eaaf7b6a8a92dff5c1600c948.svg\\",\\"https://learnkube.com/a/80c037eca089724e2e941baa2a5ad59e.svg\\",\\"https://learnkube.com/a/4d6005ebf2ca4ae55b2e6288c2445f10.svg\\",\\"https://learnkube.com/a/4dbf8701996e839152727222e64f17b7.svg\\",\\"https://learnkube.com/a/f641beea53964c60434e21fc62725218.svg\\",\\"https://learnkube.com/a/3929520349640bb4efa9f168d7dbc2fe.svg\\",\\"https://learnkube.com/a/86dd608ffe45dc2ef9ff56eaf74492a6.svg\\",\\"https://learnkube.com/a/7d396d8ed2ba612d19a2fb85d209b4c9.svg\\",\\"https://learnkube.com/a/6cb224662f002fd8d1c532185510e869.svg\\",\\"https://learnkube.com/a/6b164bccfb75ee7af564de3d57117fed.svg\\",\\"https://learnkube.com/a/ccb425a87cfe714b1030c6f138553ff6.svg\\",\\"https://learnkube.com/a/2148666d18da9b98e4382050d93509d1.svg\\",\\"https://learnkube.com/a/c62aa9e0e0cc79d11e68aa09e8e672d9.svg\\",\\"https://learnkube.com/a/9d75d1dbde3ec0c09a05eef08a5156ef.svg\\",\\"https://learnkube.com/a/97fccaca51ca06540a85ca3180dd6684.png\\"],\\"datePublished\\":\\"2025-08-01T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Dave Altena\\",\\"url\\":\\"https://www.linkedin.com/in/dave-altena/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/learnkube.com/security-context/"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"From Linux Primitives to Kubernetes Security Contexts"}],["meta",{"property":"og:description","content":"Article(s) > From Linux Primitives to Kubernetes Security Contexts"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"}],["meta",{"name":"twitter:image:alt","content":"From Linux Primitives to Kubernetes Security Contexts"}],["meta",{"property":"article:author","content":"Dave Altena"}],["meta",{"property":"article:tag","content":"k8s"}],["meta",{"property":"article:tag","content":"kubernetes"}],["meta",{"property":"article:tag","content":"devops"}],["meta",{"property":"article:tag","content":"learnkube.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-08-01T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > From Linux Primitives to Kubernetes Security Contexts"},{"property":"og:description","content":"From Linux Primitives to Kubernetes Security Contexts"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/learnkube.com/security-contexts/"}]],"prev":"/devops/k8s/articles/README.md","date":"2025-08-01T00:00:00.000Z","isOriginal":false,"author":[{"name":"Dave Altena","url":"https://www.linkedin.com/in/dave-altena/"}],"cover":"https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"},"git":{},"readingTime":{"minutes":30.15,"words":9046},"filePathRelative":"learnkube.com/security-context/README.md","copyright":{"author":"Dave Altena"}}');export{X as comp,Z as data};
