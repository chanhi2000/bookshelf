import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as f,d as a,f as e,b as r,t as v,n as d,g as k,w as t,e as s,r as l,o as h}from"./app-BItykJLQ.js";const b="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/azure-app-registration.png",y="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/upload-certificate.png",z="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/create-key-vault-basics.png",w="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/add-access-policy.png",A="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/add-secrets.png",C="/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/production-title.png",S={},V={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},T={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},K={class:"table-of-contents"},N={class:"hint-container info"},x={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration",target:"_blank",rel:"noopener noreferrer"},B={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration/tree/securing-data-locally",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/CodeMazeBlog/aspnet-core-configuration/tree/azure-key-vault",target:"_blank",rel:"noopener noreferrer"},P={href:"https://slproweb.com/products/Win32OpenSSL.html",target:"_blank",rel:"noopener noreferrer"},q={href:"https://code-maze.com/net-core-series/#configuration",target:"_blank",rel:"noopener noreferrer"};function E(g,n){const u=l("VPCard"),o=l("router-link"),c=l("SiteInfo"),p=l("RouteLink"),i=l("VPIcon");return h(),f("div",null,[a("h1",V,[a("a",T,[a("span",null,v(g.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(u,d(k({title:"Azure > Article(s)",desc:"Article(s)",link:"/devops/azure/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e(u,d(k({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),a("nav",K,[a("ul",null,[a("li",null,[e(o,{to:"#sintroduction-to-azure-key-vault"},{default:t(()=>[...n[0]||(n[0]=[s("sIntroduction to Azure Key Vault",-1)])]),_:1})]),a("li",null,[e(o,{to:"#connecting-to-azure-key-vault"},{default:t(()=>[...n[1]||(n[1]=[s("Connecting to Azure Key Vault",-1)])]),_:1}),a("ul",null,[a("li",null,[e(o,{to:"#creating-a-certificate-with-openssl"},{default:t(()=>[...n[2]||(n[2]=[s("Creating a certificate with OpenSSL",-1)])]),_:1})]),a("li",null,[e(o,{to:"#creating-azure-key-vault"},{default:t(()=>[...n[3]||(n[3]=[s("Creating Azure Key Vault",-1)])]),_:1})]),a("li",null,[e(o,{to:"#adding-secrets-to-azure-key-vault"},{default:t(()=>[...n[4]||(n[4]=[s("Adding Secrets to Azure Key Vault",-1)])]),_:1})])])]),a("li",null,[e(o,{to:"#adding-the-vault-to-our-application"},{default:t(()=>[...n[5]||(n[5]=[s("Adding the Vault to our Application",-1)])]),_:1})]),a("li",null,[e(o,{to:"#running-the-application"},{default:t(()=>[...n[6]||(n[6]=[s("Running the Application",-1)])]),_:1})]),a("li",null,[e(o,{to:"#sconclusion"},{default:t(()=>[...n[7]||(n[7]=[s("sConclusion",-1)])]),_:1})])])]),n[48]||(n[48]=a("hr",null,null,-1)),e(c,{name:"ASP.NET Core Configuration - Azure Key Vault",desc:"In this article, we're going to talk about how to protect our sensitive configuration data in the production environment with Azure Key Vault",url:"https://code-maze.com/aspnet-configuration-azure-key-vault/",logo:"/assets/image/code-maze.com/favicon.png",preview:"/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/banner.png"}),a("p",null,[n[9]||(n[9]=s("In this article, we‚Äôre going to talk about how to protect our sensitive configuration data in the production environment with Azure Key Vault. Previously we‚Äôve talked about the ",-1)),e(p,{to:"/code-maze.com/aspnet-configuration-securing-sensitive-data.html"},{default:t(()=>[...n[8]||(n[8]=[s("Secret Manager and environment variables",-1)])]),_:1}),n[10]||(n[10]=s(" which we can use to protect our data while in development.",-1))]),n[49]||(n[49]=a("p",null,"These methods are not suited for production because the values we keep that way are unencrypted and can be easily read if the security is compromised.",-1)),a("div",N,[n[26]||(n[26]=a("p",{class:"hint-container-title"},"Info",-1)),a("p",null,[n[22]||(n[22]=s("The source code for this article can be found on the ",-1)),a("a",x,[n[11]||(n[11]=s("ASP.NET Core Configuration repo on GitHub (",-1)),e(i,{icon:"iconfont icon-github"}),n[12]||(n[12]=a("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[13]||(n[13]=s(")",-1))]),n[23]||(n[23]=s(". If you wish to follow along, use the ",-1)),a("a",B,[e(i,{icon:"fas fa-code-branch"}),n[14]||(n[14]=a("code",null,"securing-data-locally",-1)),n[15]||(n[15]=s(" (",-1)),e(i,{icon:"iconfont icon-github"}),n[16]||(n[16]=a("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[17]||(n[17]=s(")",-1))]),n[24]||(n[24]=s(" branch. To check out the finished source code, check out the ",-1)),a("a",I,[e(i,{icon:"fas fa-code-branch"}),n[18]||(n[18]=a("code",null,"azure-key-vault",-1)),n[19]||(n[19]=s(" (",-1)),e(i,{icon:"iconfont icon-github"}),n[20]||(n[20]=a("code",null,"CodeMazeBlog/aspnet-core-configuration",-1)),n[21]||(n[21]=s(")",-1))]),n[25]||(n[25]=s(" branch.",-1))]),e(c,{name:"CodeMazeBlog/aspnet-core-configuration",desc:"This repo contains the source code for the ASP.NET Core Configuration Series of articles.",url:"https://github.com/CodeMazeBlog/aspnet-core-configuration",logo:"https://avatars.githubusercontent.com/u/29179238?v=4",preview:"https://opengraph.githubassets.com/e80292ed715f08922effe73e0902ccf220294b7d0a8e5c5759c861254e9e4e0f/CodeMazeBlog/aspnet-core-configuration"})]),n[50]||(n[50]=a("p",null,"Let‚Äôs dive in.",-1)),n[51]||(n[51]=a("hr",null,null,-1)),n[52]||(n[52]=a("h2",{id:"sintroduction-to-azure-key-vault",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#sintroduction-to-azure-key-vault"},[a("span",null,"sIntroduction to Azure Key Vault")])],-1)),n[53]||(n[53]=a("p",null,[s("One of the ways we can keep our secrets secret is by using the Azure Key Vault which is a "),a("strong",null,"cloud-based service that keeps cryptographic keys and secrets"),s(" that our applications and services use. In simple terms, it offers a safe way to store the key-value pairs that we use in our applications.")],-1)),a("p",null,[n[29]||(n[29]=s("It uses configuration data flattening as we‚Äôve seen with ",-1)),e(p,{to:"/code-maze.com/aspnet-configuration-securing-sensitive-data.html#secretmanager"},{default:t(()=>[...n[27]||(n[27]=[s("user secrets",-1)])]),_:1}),n[30]||(n[30]=s(" and ",-1)),e(p,{to:"/code-maze.com/aspnet-configuration-securing-sensitive-data.html#environmentvariables"},{default:t(()=>[...n[28]||(n[28]=[s("environment variables",-1)])]),_:1}),n[31]||(n[31]=s(".",-1))]),n[54]||(n[54]=r('<div class="hint-container note"><p class="hint-container-title">Note</p><p>In order to use the Azure Key Vault, <strong>you must have an active Microsoft Azure subscription</strong>.</p></div><p>Microsoft Azure Key Vault configuration provider is the one we‚Äôll use this time to migrate our configuration values to the cloud, and later on, connect to the vault and read those values.</p><p>The procedure is a bit different for Azure-hosted apps and for non-azure-hosted apps, but we‚Äôll focus on the latter because it‚Äôs more complicated. Microsoft Azure Key vault offers an easier way for Azure-hosted apps.</p><p>There are several steps we need to do in order to use the Azure Key Vault with non-Azure-hosted apps:</p><ul><li>Create Azure Subscription (we won‚Äôt talk about this one, we assume you have one)</li><li>Register Azure AD Application</li><li>Create a Certificate and Upload it to Azure AD</li><li>Create the Azure Key Vault</li><li>Import our Existing Secrets</li><li>Connect to the Key Vault through our ASP.NET Core Application</li></ul><p>Let‚Äôs start by laying some foundation first.</p><hr><h2 id="connecting-to-azure-key-vault" tabindex="-1"><a class="header-anchor" href="#connecting-to-azure-key-vault"><span>Connecting to Azure Key Vault</span></a></h2><p>In order to connect to our Azure Key Vault, we‚Äôll need to register an Azure app. To do that, head on to ‚ÄúAzure Active Directory‚Äù, then ‚ÄúApp Registration‚Äù and click on ‚ÄúNew Registration‚Äù.</p><p>The dialog should look like this:</p><figure><img src="'+b+'" alt="azure app registration" tabindex="0" loading="lazy"><figcaption>azure app registration</figcaption></figure><p>Just give your app a decent name, and click ‚ÄúRegister‚Äù. Once the app creation is over, you can find it in the apps list. Click on it, and check out the <strong>‚ÄúApplication (client) ID‚Äù. Write it down</strong>, since we‚Äôre going to need it later.</p><p>Next, since we want to connect to the app securely, we need to create and upload a certificate.</p><p>Certificate creation has a few steps, and we recommend using OpenSSL to do it since it has all the tools we need.</p><h3 id="creating-a-certificate-with-openssl" tabindex="-1"><a class="header-anchor" href="#creating-a-certificate-with-openssl"><span>Creating a certificate with OpenSSL</span></a></h3>',15)),a("ol",null,[a("li",null,[n[33]||(n[33]=s("If you don‚Äôt have OpenSSL on Windows ",-1)),a("a",P,[e(i,{icon:"fas fa-globe"}),n[32]||(n[32]=s("download it",-1))]),n[34]||(n[34]=s(" and - it",-1))]),n[35]||(n[35]=a("li",null,[s("Create a certificate by typing:"),a("br"),a("code",null,"openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365")],-1)),n[36]||(n[36]=a("li",null,[s("Create a .pfx file from the key and certificate files:"),a("br"),a("code",null,"openssl pkcs12 -export -out domain.name.pfx -inkey domain.name.key -in domain.name.crt")],-1)),n[37]||(n[37]=a("li",null,"Install pfx locally (double click and go through the wizard)",-1)),n[38]||(n[38]=a("li",null,"Upload cert.pem to Azure AD",-1))]),n[55]||(n[55]=r('<p>To complete step 5, go to the ‚ÄúCertificates &amp; secrets‚Äù in your app, and then ‚ÄúUpload certificate‚Äù.</p><figure><img src="'+y+'" alt="upload certificate" tabindex="0" loading="lazy"><figcaption>upload certificate</figcaption></figure><p><strong>Write down the certificate thumbprint</strong> once the upload is finished.</p><h3 id="creating-azure-key-vault" tabindex="-1"><a class="header-anchor" href="#creating-azure-key-vault"><span>Creating Azure Key Vault</span></a></h3><p>Now we can move on to creating our vault. Go to the Azure portal home and find the ‚ÄúKey vaults‚Äù service. Then go to ‚ÄúAdd‚Äù and fill in the basic stuff first:</p><figure><img src="'+z+'" alt="create azure key vault basics" tabindex="0" loading="lazy"><figcaption>create azure key vault basics</figcaption></figure><p>You need to fill in subscription, resource group, name, region, and pricing tier.</p><p>After that, navigate to the second tab, Access policy. Here‚Äôs where we need to add the app that we‚Äôve created previously. Select the ‚ÄúSecret Management‚Äù template, and from the ‚ÄúSecret permission‚Äù dropdown, select ‚ÄúGet‚Äù and ‚ÄúList‚Äù permissions.</p><figure><img src="'+w+'" alt="add azure key vault access policy" tabindex="0" loading="lazy"><figcaption>add azure key vault access policy</figcaption></figure><p>Since we‚Äôll add our secrets manually, make sure to add your user as a principal too, and give it permissions to set and delete secrets.</p><p>That‚Äôs it, move on to the ‚ÄúReview + create‚Äù tab and click on the ‚ÄúCreate‚Äù button.</p><p>Once the process is finished head over to the key vault you‚Äôve created and <strong>write down the ‚ÄúDNS Name‚Äù</strong>.</p><p>At this point you should have three pieces of information:</p><ul><li>Application ID</li><li>Certificate Thumbprint</li><li>DNS Name</li></ul><p>Now we can add our secrets to the vault.</p><h3 id="adding-secrets-to-azure-key-vault" tabindex="-1"><a class="header-anchor" href="#adding-secrets-to-azure-key-vault"><span>Adding Secrets to Azure Key Vault</span></a></h3><p>Now we can finally add our secrets.</p><p>Head over to the ‚ÄúSecrets‚Äù tab to the left, and add some secrets:</p><figure><img src="'+A+`" alt="add secrets" tabindex="0" loading="lazy"><figcaption>add secrets</figcaption></figure><p>The process is pretty much straightforward. If you have a problem viewing or adding secrets (grayed out generate/import), double-check your access policies, and click refresh.</p><p>As you can see, we‚Äôve added some secrets we‚Äôve used so far. We‚Äôve flattened the structure by using double dash <code>--</code>, and we‚Äôve changed the ‚ÄúWelcomeMessage‚Äù to ‚ÄúWelcome to the ProjectConfigurationDemo Home Page (Azure)‚Äù so we can easily see the change.</p><p>Now let‚Äôs go back to the code and connect our application to the key vault.</p><hr><h2 id="adding-the-vault-to-our-application" tabindex="-1"><a class="header-anchor" href="#adding-the-vault-to-our-application"><span>Adding the Vault to our Application</span></a></h2><p>In order to connect our application, we need to extend the configuration a bit.</p><p>First, we need to install a NuGet package to support our KeyVault integration:</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>AzureKeyVault <span class="token operator">-</span>Version 3<span class="token punctuation">.</span>1<span class="token punctuation">.</span>7</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After that, we need to add the values we‚Äôve written down while creating the vault in our appsettings.json:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token property">&quot;Azure&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ApplicationId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;85cce826-78e7-405e-8c32-301f71e1ad89&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;CertificateThumb&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6491383027629A9F43F6CB681F299D88293785E0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;KeyVault&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;DNS&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://codemazekeyvault.vault.azure.net/&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, we need to connect to add the Key Vault as a source in the <code>Program</code> class:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">    Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>webBuilder <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            webBuilder<span class="token punctuation">.</span>UseStartup<span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>Startup<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">ConfigureAppConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hostingContext<span class="token punctuation">,</span> configBuilder<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> builtConfig <span class="token operator">=</span> configBuilder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">X509Store</span><span class="token punctuation">(</span>StoreLocation<span class="token punctuation">.</span>CurrentUser<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                store<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>OpenFlags<span class="token punctuation">.</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name"><span class="token keyword">var</span></span> certs <span class="token operator">=</span> store<span class="token punctuation">.</span>Certificates</span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>X509FindType<span class="token punctuation">.</span>FindByThumbprint<span class="token punctuation">,</span> builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:CertificateThumb&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                configBuilder<span class="token punctuation">.</span><span class="token function">AddAzureKeyVault</span><span class="token punctuation">(</span></span>
<span class="line">                    builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:KeyVault:DNS&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:ApplicationId&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    certs<span class="token punctuation">.</span>OfType<span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>X509Certificate2<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                store<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is a standard way of adding an Azure Key Vault by using X509 certificate.</p><p>And since we‚Äôre adding the vault as the last configuration source, it will override all the previous ones like user secrets or environment variables.</p><p>Let‚Äôs see the results of our work.</p><hr><h2 id="running-the-application" tabindex="-1"><a class="header-anchor" href="#running-the-application"><span>Running the Application</span></a></h2><p>Now if we run the application, we can clearly see that our title has changed:</p><figure><img src="`+C+'" alt="production title" tabindex="0" loading="lazy"><figcaption>production title</figcaption></figure><p>Our title now shows (Azure) at the end, so that means we‚Äôve read the configuration from the key vault successfully.</p>',39)),a("p",null,[n[40]||(n[40]=s("In order to make this solution even better, we restrict our application to only add the key vault in the ",-1)),e(p,{to:"/code-maze.com/multiple-environments-in-asp-net-core.html"},{default:t(()=>[...n[39]||(n[39]=[s("production environment",-1)])]),_:1}),n[41]||(n[41]=s(":",-1))]),n[56]||(n[56]=r(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">  Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>webBuilder <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      webBuilder<span class="token punctuation">.</span>UseStartup<span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>Startup<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ConfigureAppConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> builder<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&lt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>HostingEnvironment<span class="token punctuation">.</span><span class="token function">IsProduction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> builtConfig <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">X509Store</span><span class="token punctuation">(</span>StoreLocation<span class="token punctuation">.</span>CurrentUser<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          store<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>OpenFlags<span class="token punctuation">.</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token class-name"><span class="token keyword">var</span></span> certs <span class="token operator">=</span> store<span class="token punctuation">.</span>Certificates</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>X509FindType<span class="token punctuation">.</span>FindByThumbprint<span class="token punctuation">,</span></span>
<span class="line">              builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:CertificateThumb&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          builder<span class="token punctuation">.</span><span class="token function">AddAzureKeyVault</span><span class="token punctuation">(</span></span>
<span class="line">            builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:KeyVault:DNS&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            builtConfig<span class="token punctuation">[</span><span class="token string">&quot;Azure:ApplicationId&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            certs<span class="token punctuation">.</span>OfType<span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>X509Certificate2<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          store<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),a("p",null,[n[43]||(n[43]=s("Now when we run our application locally, we‚Äôll use the user secrets defined in secrets.json, and we‚Äôll use Azure Key Vaults secrets in the ",-1)),e(p,{to:"/code-maze.com/multiple-environments-in-asp-net-core.html"},{default:t(()=>[...n[42]||(n[42]=[s("production environment",-1)])]),_:1}),n[44]||(n[44]=s(".",-1))]),n[57]||(n[57]=a("p",null,"That‚Äôs it, awesome isn‚Äôt it?",-1)),n[58]||(n[58]=a("hr",null,null,-1)),n[59]||(n[59]=a("h2",{id:"sconclusion",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#sconclusion"},[a("span",null,"sConclusion")])],-1)),n[60]||(n[60]=a("p",null,"In this article, we‚Äôve learned how to create an Azure Key Vault to store our secrets for a production environment. We‚Äôve also learned how to connect to the vault from our application and how to use key vault just when running the application in production.",-1)),a("p",null,[n[46]||(n[46]=s("This part wraps up our ASP.NET Core configuration series. You can find other parts of this series on the ",-1)),a("a",q,[e(i,{icon:"fas fa-globe"}),n[45]||(n[45]=s("ASP.NET Core Web API page",-1))]),n[47]||(n[47]=s(".",-1))])])}const O=m(S,[["render",E]]),R=JSON.parse('{"path":"/code-maze.com/aspnet-configuration-azure-key-vault.html","title":"ASP.NET Core Configuration - Azure Key Vault","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"ASP.NET Core Configuration - Azure Key Vault","description":"Article(s) > ASP.NET Core Configuration - Azure Key Vault","icon":"iconfont icon-microsoftazure","category":["DevOps","Microsoft","Azure","C#","Article(s)"],"tag":["blog","code-maze.com","devops","microsoft","azure","cs","c#","csharp"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ASP.NET Core Configuration - Azure Key Vault\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/azure-app-registration.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/upload-certificate.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/create-key-vault-basics.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/add-access-policy.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/add-secrets.png\\",\\"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/production-title.png\\"],\\"datePublished\\":\\"2021-12-27T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/aspnet-configuration-azure-key-vault.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"ASP.NET Core Configuration - Azure Key Vault"}],["meta",{"property":"og:description","content":"Article(s) > ASP.NET Core Configuration - Azure Key Vault"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/banner.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://chanhi2000.github.io/bookshelf/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/banner.png"}],["meta",{"name":"twitter:image:alt","content":"ASP.NET Core Configuration - Azure Key Vault"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"azure"}],["meta",{"property":"article:tag","content":"microsoft"}],["meta",{"property":"article:tag","content":"devops"}],["meta",{"property":"article:tag","content":"code-maze.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2021-12-27T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > ASP.NET Core Configuration - Azure Key Vault"},{"property":"og:description","content":"ASP.NET Core Configuration - Azure Key Vault"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/code-maze.com/aspnet-configuration-azure-key-vault.html"}]],"prev":"/devops/azure/articles/README.md","date":"2021-12-27T00:00:00.000Z","isOriginal":false,"cover":"/assets/image/code-maze.com/aspnet-configuration-azure-key-vault/banner.png"},"git":{},"readingTime":{"minutes":5.65,"words":1696},"filePathRelative":"code-maze.com/aspnet-configuration-azure-key-vault.md"}');export{O as comp,R as data};
