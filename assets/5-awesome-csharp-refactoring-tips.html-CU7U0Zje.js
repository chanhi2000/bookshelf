import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as b,d as s,f as e,b as i,t as h,n as d,g as k,w as t,e as a,r as o,o as g}from"./app-BVguHYKu.js";const f={},y={id:"frontmatter-title-관련",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-관련"},C={class:"table-of-contents"},I={href:"https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/primary-constructors",target:"_blank",rel:"noopener noreferrer"},T={href:"https://refactoring.guru/design-patterns/strategy",target:"_blank",rel:"noopener noreferrer"},L={href:"https://en.wikipedia.org/wiki/Single-responsibility_principle",target:"_blank",rel:"noopener noreferrer"},x={href:"https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/switch-expression",target:"_blank",rel:"noopener noreferrer"};function R(m,n){const r=o("VPCard"),p=o("router-link"),c=o("SiteInfo"),u=o("RouteLink"),l=o("VPIcon");return g(),b("div",null,[s("h1",y,[s("a",w,[s("span",null,h(m.$frontmatter.title)+" 관련",1)])]),e(r,d(k({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",C,[s("ul",null,[s("li",null,[e(p,{to:"#starting-point"},{default:t(()=>n[0]||(n[0]=[a("Starting Point")])),_:1,__:[0]})]),s("li",null,[e(p,{to:"#refactoring-the-validation"},{default:t(()=>n[1]||(n[1]=[a("Refactoring the Validation")])),_:1,__:[1]})]),s("li",null,[e(p,{to:"#refactoring-towards-dependency-injection"},{default:t(()=>n[2]||(n[2]=[a("Refactoring Towards Dependency Injection")])),_:1,__:[2]})]),s("li",null,[e(p,{to:"#refactoring-the-credit-limit-calculation"},{default:t(()=>n[3]||(n[3]=[a("Refactoring the Credit Limit Calculation")])),_:1,__:[3]})]),s("li",null,[e(p,{to:"#reviewing-the-refactoring-so-far"},{default:t(()=>n[4]||(n[4]=[a("Reviewing the Refactoring (So Far)")])),_:1,__:[4]})]),s("li",null,[e(p,{to:"#taking-it-further-pushing-logic-down"},{default:t(()=>n[5]||(n[5]=[a("Taking It Further - Pushing Logic Down")])),_:1,__:[5]})]),s("li",null,[e(p,{to:"#next-steps"},{default:t(()=>n[6]||(n[6]=[a("Next Steps")])),_:1,__:[6]})])])]),n[31]||(n[31]=s("hr",null,null,-1)),e(c,{name:"5 Awesome C# Refactoring Tip",desc:"Refactoring is a technique for restructuring existing code without changing its behavior. You can think of refactoring as a series of small code transformations. One change (refactoring) does little. But a sequence of refactors produces a significant transformation. There's no better way to learn refactoring than practicing. So I prepared a refactoring exercise for you.",url:"https://milanjovanovic.tech/blog/5-awesome-csharp-refactoring-tips/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_065.png"}),n[32]||(n[32]=i(`<p>Refactoring is a technique for restructuring existing code without changing its behavior. You can think of refactoring as a series of small code transformations.</p><p>One change (refactoring) does little. But a sequence of refactors produces a significant transformation.</p><p>There&#39;s no better way to learn refactoring than practicing.</p><p>So I prepared a refactoring exercise for you.</p><p>Today I&#39;m going to refactor some poorly written code.</p><p>And I&#39;ll show you 5 awesome refactoring techniques along the way:</p><ul><li>Extract method</li><li>Extract interface</li><li>Extract class</li><li>Functional code</li><li>Pushing logic down</li></ul><hr><h2 id="starting-point" tabindex="-1"><a class="header-anchor" href="#starting-point"><span>Starting Point</span></a></h2><p>We will refactor the <code>CustomerService</code> below to try to improve the code.</p><p>I want to achieve three goals with this refactor.</p><p>Or rather, I want to improve three qualities of the <code>CustomerService</code>:</p><ul><li>Testability</li><li>Readability</li><li>Maintainability</li></ul><p>To improve these qualities, we need to figure out what&#39;s preventing us from attaining them.</p><p>So, let&#39;s first understand what the <code>CustomerService</code> is doing on a high level:</p><ul><li>Validation of the input arguments</li><li>Fetching the <code>Company</code> and creating a new <code>Customer</code></li><li>Calculating if the <code>Customer</code> has a credit limit and the amount</li><li>Saving the <code>Customer</code> to the database if they meet a specific condition</li></ul><p>You can see quite a few things are happening inside the <code>AddCustomer</code> method.</p><p>It&#39;s almost 100 lines of code, which reduces readability.</p><p>It&#39;s difficult to test because we can&#39;t control any external dependencies.</p><p>It&#39;s impossible to extend the behavior of the <code>CustomerService</code> without changing the code.</p><p>But we can fix all these problems. Let me show you how.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerService</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">AddCustomer</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">int</span></span> companyId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;@&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> age <span class="token operator">=</span> now<span class="token punctuation">.</span>Year <span class="token operator">-</span> dateOfBirth<span class="token punctuation">.</span>Year<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>dateOfBirth<span class="token punctuation">.</span>Date <span class="token operator">&gt;</span> now<span class="token punctuation">.</span><span class="token function">AddYears</span><span class="token punctuation">(</span><span class="token operator">-</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            age <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">21</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> companyRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CompanyRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> company <span class="token operator">=</span> companyRepository<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Company <span class="token operator">=</span> company<span class="token punctuation">,</span></span>
<span class="line">            DateOfBirth <span class="token operator">=</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">            EmailAddress <span class="token operator">=</span> email<span class="token punctuation">,</span></span>
<span class="line">            Firstname <span class="token operator">=</span> firstName<span class="token punctuation">,</span></span>
<span class="line">            Surname <span class="token operator">=</span> lastName</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>company<span class="token punctuation">.</span>Type <span class="token operator">==</span> <span class="token string">&quot;VeryImportantClient&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Skip credit check</span></span>
<span class="line">            customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>company<span class="token punctuation">.</span>Type <span class="token operator">==</span> <span class="token string">&quot;ImportantClient&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Do credit check and double credit limit</span></span>
<span class="line">            customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> creditService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerCreditServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> creditLimit <span class="token operator">=</span> creditService<span class="token punctuation">.</span><span class="token function">GetCreditLimit</span><span class="token punctuation">(</span></span>
<span class="line">                customer<span class="token punctuation">.</span>Firstname<span class="token punctuation">,</span></span>
<span class="line">                customer<span class="token punctuation">.</span>Surname<span class="token punctuation">,</span></span>
<span class="line">                customer<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            creditLimit <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">            customer<span class="token punctuation">.</span>CreditLimit <span class="token operator">=</span> creditLimit<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Do credit check</span></span>
<span class="line">            customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> creditService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerCreditServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> creditLimit <span class="token operator">=</span> creditService<span class="token punctuation">.</span><span class="token function">GetCreditLimit</span><span class="token punctuation">(</span></span>
<span class="line">                customer<span class="token punctuation">.</span>Firstname<span class="token punctuation">,</span></span>
<span class="line">                customer<span class="token punctuation">.</span>Surname<span class="token punctuation">,</span></span>
<span class="line">                customer<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            customer<span class="token punctuation">.</span>CreditLimit <span class="token operator">=</span> creditLimit<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">&amp;&amp;</span> customer<span class="token punctuation">.</span>CreditLimit <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> customerRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        customerRepository<span class="token punctuation">.</span><span class="token function">AddCustomer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="refactoring-the-validation" tabindex="-1"><a class="header-anchor" href="#refactoring-the-validation"><span>Refactoring the Validation</span></a></h2><p>The first part of the code validating input parameters is pretty concise. It also follows the early return principle.</p><p>The validation consists of simple input validation and a calculation for the customer&#39;s age.</p><p>I would start with an <strong>extract method</strong> refactor to move the validation into one place.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;@&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> age <span class="token operator">=</span> now<span class="token punctuation">.</span>Year <span class="token operator">-</span> dateOfBirth<span class="token punctuation">.</span>Year<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>dateOfBirth<span class="token punctuation">.</span>Date <span class="token operator">&gt;</span> now<span class="token punctuation">.</span><span class="token function">AddYears</span><span class="token punctuation">(</span><span class="token operator">-</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    age <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">21</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Calculating the age isn&#39;t part of the validation flow, so I&#39;ll extract that into the <code>CalculateAge</code> method.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CalculateAge</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> now<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> age <span class="token operator">=</span> now<span class="token punctuation">.</span>Year <span class="token operator">-</span> dateOfBirth<span class="token punctuation">.</span>Year<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>dateOfBirth<span class="token punctuation">.</span>Date <span class="token operator">&gt;</span> now<span class="token punctuation">.</span><span class="token function">AddYears</span><span class="token punctuation">(</span><span class="token operator">-</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        age <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> age<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, I&#39;ll create the <code>IsValid</code> method to encapsulate all the validation rules. Instead of writing many <code>if-else</code> statements, I can write a single <code>bool</code> expression.</p><p>I also introduced a <code>minimumAge</code> constant to improve readability.</p><p>You can see how the <code>CalculateAge</code> method helps simplify the validation check.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsValid</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> minimumAge <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">           <span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">           <span class="token punctuation">(</span>email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;@&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> email<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">           <span class="token function">CalculateAge</span><span class="token punctuation">(</span>dateOfBirth<span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> minimumAge<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This simplifies the validation code in <code>AddCustomer</code> to:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsValid</span><span class="token punctuation">(</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> dateOfBirth<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="refactoring-towards-dependency-injection" tabindex="-1"><a class="header-anchor" href="#refactoring-towards-dependency-injection"><span>Refactoring Towards Dependency Injection</span></a></h2>`,38)),s("p",null,[n[8]||(n[8]=a("The next problem I want to solve is introducing ")),e(u,{to:"/milanjovanovic.tech/improving-aspnetcore-dependency-injection-with-scrutor.html"},{default:t(()=>n[7]||(n[7]=[a("dependency injection")])),_:1,__:[7]}),n[9]||(n[9]=a(" to the ")),n[10]||(n[10]=s("code",null,"CustomerService",-1)),n[11]||(n[11]=a("."))]),n[33]||(n[33]=i(`<p>Dependency injection allows us to achieve <strong>Inversion of Control (IoC).</strong></p><p>We depend only on interfaces at compile time and on implementations at run time.</p><p>The dependency injection pattern has a few important benefits.</p><p>You don&#39;t have to know how to initialize or dispose of external dependencies.</p><p>It also improves testability since you now depend on interfaces.</p><p>Interfaces can be mocked to make unit testing easier.</p><p>So let&#39;s update the <code>CustomerService</code> not to initialize the dependencies directly:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> companyRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CompanyRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> creditService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerCreditServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> customerRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Instead, we will inject them as constructor arguments.</p>`,9)),s("p",null,[n[13]||(n[13]=a("You can even use the ")),s("a",I,[e(l,{icon:"fa-brands fa-microsoft"}),n[12]||(n[12]=a("C# 12 primary constructor"))]),n[14]||(n[14]=a(" feature."))]),n[34]||(n[34]=i(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">CompanyRepository</span> companyRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CustomerCreditServiceClient</span> creditService<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The next step would be introducing interfaces for these dependencies. This comes down to an <strong>extract interface</strong> refactor.</p><hr><h2 id="refactoring-the-credit-limit-calculation" tabindex="-1"><a class="header-anchor" href="#refactoring-the-credit-limit-calculation"><span>Refactoring the Credit Limit Calculation</span></a></h2><p>The credit limit calculation is the most complicated part of the code.</p><p>There are different business rules based on the company type.</p><p>I try to notice patterns in the code before refactoring.</p><p>So here are a few of my observations.</p><p>Multiple <code>if-else</code> statements based on the <code>Type</code> property make me wonder if I&#39;ll need to extend this in the future.</p><p>Adding a new rule would mean another <code>if-else</code> check.</p>`,10)),s("p",null,[n[16]||(n[16]=a("The ")),s("a",T,[e(l,{icon:"fas fa-globe"}),n[15]||(n[15]=a("strategy pattern"))]),n[17]||(n[17]=a(" could be an alternative, but a ")),n[18]||(n[18]=s("code",null,"switch",-1)),n[19]||(n[19]=a(" statement will also work fine."))]),n[35]||(n[35]=i(`<p>Another thing that stands out is the <strong>code duplication</strong> in the last two blocks.</p><p>This usually means I can do an <strong>extract method</strong> refactoring to reduce code duplication.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>company<span class="token punctuation">.</span>Type <span class="token operator">==</span> <span class="token string">&quot;VeryImportantClient&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Skip credit check</span></span>
<span class="line">    customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>company<span class="token punctuation">.</span>Type <span class="token operator">==</span> <span class="token string">&quot;ImportantClient&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Do credit check and double credit limit</span></span>
<span class="line">    customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> creditService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerCreditServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> creditLimit <span class="token operator">=</span> creditService<span class="token punctuation">.</span><span class="token function">GetCreditLimit</span><span class="token punctuation">(</span></span>
<span class="line">        customer<span class="token punctuation">.</span>Firstname<span class="token punctuation">,</span></span>
<span class="line">        customer<span class="token punctuation">.</span>Surname<span class="token punctuation">,</span></span>
<span class="line">        customer<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    creditLimit <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    customer<span class="token punctuation">.</span>CreditLimit <span class="token operator">=</span> creditLimit<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Do credit check</span></span>
<span class="line">    customer<span class="token punctuation">.</span>HasCreditLimit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> creditService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerCreditServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> creditLimit <span class="token operator">=</span> creditService<span class="token punctuation">.</span><span class="token function">GetCreditLimit</span><span class="token punctuation">(</span></span>
<span class="line">        customer<span class="token punctuation">.</span>Firstname<span class="token punctuation">,</span></span>
<span class="line">        customer<span class="token punctuation">.</span>Surname<span class="token punctuation">,</span></span>
<span class="line">        customer<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    customer<span class="token punctuation">.</span>CreditLimit <span class="token operator">=</span> creditLimit<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The first thing I want to do is introduce an <code>enum</code> for the <code>CompanyType</code>.</p>`,4)),s("p",null,[n[21]||(n[21]=a("This is a ")),e(u,{to:"/milanjovanovic.tech/8-tips-to-write-clean-code.html"},{default:t(()=>n[20]||(n[20]=[a("clean coding principle")])),_:1,__:[20]}),n[22]||(n[22]=a(" I often use. It improves the readability and extensibility of the code."))]),n[36]||(n[36]=i(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CompanyType</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    Regular <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    ImportantClient <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    VeryImportantClient <span class="token operator">=</span> <span class="token number">2</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The next thing that bothers me is that the credit limit calculation doesn&#39;t belong to the <code>CustomerService</code>.</p>`,2)),s("p",null,[n[24]||(n[24]=a("It violates the ")),s("a",L,[e(l,{icon:"fa-brands fa-wikipedia-w"}),n[23]||(n[23]=a("single responsibility principle"))]),n[25]||(n[25]=a("."))]),n[37]||(n[37]=s("p",null,[a("So I want to introduce a dedicated "),s("code",null,"CreditLimitCalculator"),a(" using an "),s("strong",null,"extract class"),a(" refactoring.")],-1)),s("p",null,[n[27]||(n[27]=a("I replaced the ")),n[28]||(n[28]=s("code",null,"if-else",-1)),n[29]||(n[29]=a(" statements with a ")),s("a",x,[e(l,{icon:"fa-brands fa-microsoft"}),n[26]||(n[26]=a("switch expression"))]),n[30]||(n[30]=a(" that I can easily extend in the future."))]),n[38]||(n[38]=i(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreditLimitCalculator</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">CustomerCreditServiceClient</span> customerCreditServiceClient<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword">bool</span> HasCreditLimit<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token punctuation">?</span> CreditLimit<span class="token punctuation">)</span></span> <span class="token function">Calculate</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">Customer</span> customer<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">Company</span> company<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> company<span class="token punctuation">.</span>Type <span class="token keyword">switch</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            CompanyType<span class="token punctuation">.</span>VeryImportantClient <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            CompanyType<span class="token punctuation">.</span>ImportantClient <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token function">GetCreditLimit</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            _ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token function">GetCreditLimit</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> <span class="token function">GetCreditLimit</span><span class="token punctuation">(</span><span class="token class-name">Customer</span> customer<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> customerCreditServiceClient<span class="token punctuation">.</span><span class="token function">GetCreditLimit</span><span class="token punctuation">(</span></span>
<span class="line">            customer<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span></span>
<span class="line">            customer<span class="token punctuation">.</span>LastName<span class="token punctuation">,</span></span>
<span class="line">            customer<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="reviewing-the-refactoring-so-far" tabindex="-1"><a class="header-anchor" href="#reviewing-the-refactoring-so-far"><span>Reviewing the Refactoring (So Far)</span></a></h2><p>Let&#39;s pause momentarily and review the refactored version of the <code>CustomerService</code>.</p><p>I&#39;m confident you will find it more readable and easier to understand.</p><p>We can easily test this class and verify that the behavior is correct.</p><p>I would usually stop the refactoring at this point, since I&#39;m happy with the results.</p><p>But can we take this further?</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">CompanyRepository</span> companyRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CreditLimitCalculator</span> creditLimitCalculator<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">AddCustomer</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">int</span></span> companyId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsValid</span><span class="token punctuation">(</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> dateOfBirth<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> company <span class="token operator">=</span> companyRepository<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Company <span class="token operator">=</span> company<span class="token punctuation">,</span></span>
<span class="line">            DateOfBirth <span class="token operator">=</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">            EmailAddress <span class="token operator">=</span> email<span class="token punctuation">,</span></span>
<span class="line">            FirstName <span class="token operator">=</span> firstName<span class="token punctuation">,</span></span>
<span class="line">            LastName <span class="token operator">=</span> lastName</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">(</span>customer<span class="token punctuation">.</span>HasCreditLimit<span class="token punctuation">,</span> customer<span class="token punctuation">.</span>CreditLimit<span class="token punctuation">)</span> <span class="token operator">=</span></span>
<span class="line">            creditLimitCalculator<span class="token punctuation">.</span><span class="token function">Calculate</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> company<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>customer <span class="token keyword">is</span> <span class="token punctuation">{</span> HasCreditLimit<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">CreditLimit</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span> <span class="token number">500</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        customerRepository<span class="token punctuation">.</span><span class="token function">AddCustomer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="taking-it-further-pushing-logic-down" tabindex="-1"><a class="header-anchor" href="#taking-it-further-pushing-logic-down"><span>Taking It Further - Pushing Logic Down</span></a></h2><p>This part is optional, but I want to show you how to simplify the <code>CustomerService</code> by pushing logic into the domain.</p><p>What if we moved the responsibility of creating a <code>Customer</code> into the class?</p><p>I often use the <strong>static factory</strong> pattern to implement this.</p><p>The caveat is I have to take a dependency on <code>CreditLimitCalculator</code>.</p><p>I&#39;m trading off domain model purity to get business rules completeness.</p><p>I also added the <code>IsUnderCreditLimit</code> method to wrap the credit limit check.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Properties omited</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Customer</span> <span class="token function">Create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">Company</span> company<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">CreditLimitCalculator</span> creditLimitCalculator<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Company <span class="token operator">=</span> company<span class="token punctuation">,</span></span>
<span class="line">            DateOfBirth <span class="token operator">=</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">            EmailAddress <span class="token operator">=</span> email<span class="token punctuation">,</span></span>
<span class="line">            FirstName <span class="token operator">=</span> firstName<span class="token punctuation">,</span></span>
<span class="line">            LastName <span class="token operator">=</span> lastName</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">(</span>customer<span class="token punctuation">.</span>HasCreditLimit<span class="token punctuation">,</span> customer<span class="token punctuation">.</span>CreditLimit<span class="token punctuation">)</span> <span class="token operator">=</span></span>
<span class="line">            creditLimitCalculator<span class="token punctuation">.</span><span class="token function">Calculate</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> company<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> customer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsUnderCreditLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> HasCreditLimit <span class="token operator">&amp;&amp;</span> CreditLimit <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is what the <code>CustomerService</code> looks like now:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">CompanyRepository</span> companyRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">CreditLimitCalculator</span> creditLimitCalculator<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">AddCustomer</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">DateTime</span> dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">int</span></span> companyId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsValid</span><span class="token punctuation">(</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> dateOfBirth<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> company <span class="token operator">=</span> companyRepository<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>companyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span></span>
<span class="line">            company<span class="token punctuation">,</span></span>
<span class="line">            firstName<span class="token punctuation">,</span></span>
<span class="line">            lastName<span class="token punctuation">,</span></span>
<span class="line">            email<span class="token punctuation">,</span></span>
<span class="line">            dateOfBirth<span class="token punctuation">,</span></span>
<span class="line">            creditLimitCalculator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>customer<span class="token punctuation">.</span><span class="token function">IsUnderCreditLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        customerRepository<span class="token punctuation">.</span><span class="token function">AddCustomer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>What do you think about this implementation?</p><hr><h2 id="next-steps" tabindex="-1"><a class="header-anchor" href="#next-steps"><span>Next Steps</span></a></h2><p>First of all, congrats on making it to the end.</p><p>This was a much longer newsletter issue than usual.</p><p>What do you think of this format?</p><p>Writing unit tests before starting the refactoring would be a great idea.</p><p>Unit tests will help detect any changes in behavior.</p><p>Remember, refactoring is transforming the existing code without changing the behavior.</p><p>Here are a few ideas on how you could further refactor the code:</p>`,30)),e(c,{name:"Strategy",desc:"Strategy is a behavioral design pattern that lets you define a family of algorithms, put each of them into a separate class, and make their objects interchangeable.",url:"https://refactoring.guru/design-patterns/strategy",logo:"https://refactoring.guru/favicon.ico",preview:"https://refactoring.guru/images/refactoring/social/facebook-share-preview.png?id=dbf9e98269595be86eb668f365be6868"}),e(r,d(k({title:"Functional Error Handling in .NET With the Result Pattern",desc:"How should you handle errors in your code? This has been a topic of many discussions, and I want to share my opinion. One school of thought suggests using exceptions for flow control. This is not a good approach because it makes the code harder to reason about. The caller must know the implementation details and which exceptions to handle. Exceptions are for exceptional situations. Today, I want to show you how to implement error handling using the Result pattern. It's a functional approach to error handling, making your code more expressive.",link:"/milanjovanovic.tech/functional-error-handling-in-dotnet-with-the-result-pattern.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),n[39]||(n[39]=s("p",null,[a("If you want to try this refactoring exercise, you can find the complete "),s("strong",null,"source code here.")],-1)),e(c,{name:"m-jovanovic/refactoring-katas",desc:"This repository contains refactoring exercises in C#/.NET",url:"https://github.com/m-jovanovic/refactoring-katas",logo:"https://avatars.githubusercontent.com/u/34191235?s=48&v=4",preview:"https://opengraph.githubassets.com/2b6f373f3f5640ca3b49b9b16252cc2200c954190ec03f40e72d89123ce74c58/m-jovanovic/refactoring-katas"}),n[40]||(n[40]=s("p",null,"Hope this was helpful.",-1)),n[41]||(n[41]=s("p",null,"See you next week.",-1))])}const j=v(f,[["render",R]]),A=JSON.parse('{"path":"/milanjovanovic.tech/5-awesome-csharp-refactoring-tips.html","title":"5 Awesome C# Refactoring Tip","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"5 Awesome C# Refactoring Tip","description":"Article(s) > 5 Awesome C# Refactoring Tip","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"5 Awesome C# Refactoring Tip\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_065.png\\"],\\"datePublished\\":\\"2023-11-25T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanović\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/5-awesome-csharp-refactoring-tips.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"5 Awesome C# Refactoring Tip"}],["meta",{"property":"og:description","content":"Article(s) > 5 Awesome C# Refactoring Tip"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_065.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_065.png"}],["meta",{"name":"twitter:image:alt","content":"5 Awesome C# Refactoring Tip"}],["meta",{"property":"article:author","content":"Milan Jovanović"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2023-11-25T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > 5 Awesome C# Refactoring Tip"},{"property":"og:description","content":"5 Awesome C# Refactoring Tip"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/5-awesome-csharp-refactoring-tips.html"}]],"prev":"/programming/cs/articles/README.md","date":"2023-11-25T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanović","cover":"https://milanjovanovic.tech/blog-covers/mnw_065.png"},"git":{},"readingTime":{"minutes":6.57,"words":1970},"filePathRelative":"milanjovanovic.tech/5-awesome-csharp-refactoring-tips.md","copyright":{"author":"Milan Jovanović"}}');export{j as comp,A as data};
