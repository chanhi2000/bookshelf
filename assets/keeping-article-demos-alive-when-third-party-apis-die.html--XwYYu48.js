import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as e,b as p,a as g,t as b,n as u,g as d,w as o,e as a,r as l,o as f}from"./app-BItykJLQ.js";const y={},w={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},A={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},P={class:"table-of-contents"},x={href:"https://playwright.dev/docs/mock#mock-api-requests",target:"_blank",rel:"noopener noreferrer"},q={href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",target:"_blank",rel:"noopener noreferrer"},I={href:"https://axios-http.com/",target:"_blank",rel:"noopener noreferrer"},D={href:"https://digitalocean.com/products/functions",target:"_blank",rel:"noopener noreferrer"},T={href:"https://docs.digitalocean.com/products/functions/how-to/develop-functions/",target:"_blank",rel:"noopener noreferrer"},j={href:"https://docs.digitalocean.com/products/functions/how-to/create-functions/",target:"_blank",rel:"noopener noreferrer"},F={href:"https://docs.digitalocean.com/products/functions/reference/runtimes/node-js/#parameters",target:"_blank",rel:"noopener noreferrer"},R={href:"https://docs.digitalocean.com/products/functions/reference/runtimes/node-js/#returns",target:"_blank",rel:"noopener noreferrer"},S={href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Disposition#html_posting_multipartform-data_content_type",target:"_blank",rel:"noopener noreferrer"},W={href:"https://wiremock.org/",target:"_blank",rel:"noopener noreferrer"};function V(k,n){const c=l("VPCard"),i=l("router-link"),m=l("SiteInfo"),r=l("RouteLink"),t=l("VPIcon");return f(),h("div",null,[s("h1",w,[s("a",A,[s("span",null,b(k.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(c,u(d({title:"JavaScript > Article(s)",desc:"Article(s)",link:"/programming/js/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",P,[s("ul",null,[s("li",null,[e(i,{to:"#parallels-with-software-testing"},{default:o(()=>[...n[0]||(n[0]=[a("Parallels with software testing",-1)])]),_:1})]),s("li",null,[e(i,{to:"#decoupling-rest-api-dependencies"},{default:o(()=>[...n[1]||(n[1]=[a("Decoupling REST API dependencies",-1)])]),_:1})]),s("li",null,[e(i,{to:"#mocking-a-response-with-an-interceptor"},{default:o(()=>[...n[2]||(n[2]=[a("Mocking a response with an interceptor",-1)])]),_:1})]),s("li",null,[e(i,{to:"#mocked-api-server-with-serverless"},{default:o(()=>[...n[3]||(n[3]=[a("Mocked API server with serverless",-1)])]),_:1})]),s("li",null,[e(i,{to:"#closing-thoughts"},{default:o(()=>[...n[4]||(n[4]=[a("Closing thoughts",-1)])]),_:1})])])]),n[49]||(n[49]=s("hr",null,null,-1)),e(m,{name:"Keeping Article Demos Alive When Third-Party APIs Die",desc:"Is there a way to build demos that do not break when the services they rely on fail? How can we ensure educational demos stay available for as long as possible?",url:"https://css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die",logo:"https://css-tricks/favicon.svg",preview:"https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/nodes-pattern.png"}),s("p",null,[n[6]||(n[6]=a("After four years, the demos in my ",-1)),e(r,{to:"/css-tricks.com/headless-form-submission-with-the-wordpress-rest-api.html"},{default:o(()=>[...n[5]||(n[5]=[s("strong",null,"‚ÄúHeadless Form Submission with the WordPress REST API‚Äù",-1)])]),_:1}),n[7]||(n[7]=a(" article finally stopped working.",-1))]),n[50]||(n[50]=p('<p>The article includes CodePen embeds that demonstrate how to use the REST API endpoints of popular WordPress form plugins to capture and display validation errors and submission feedback when building a completely custom front-end. The pens relied on a WordPress site I had running in the background. But during a forced infrastructure migration, the site failed to transfer properly, and, even worse, I lost access to my account.</p><p>Sure, I <em>could</em> have contacted support or restored a backup elsewhere. But the situation made me wonder: what if this had not been WordPress? What if it were a third-party service I couldn‚Äôt self-host or fix? Is there a way to build demos that do not break when the services they rely on fail? How can we ensure educational demos stay available for as long as possible?</p><p>Or is this just inevitable? Are demos, like everything else on the web, doomed to break eventually?</p><hr><h2 id="parallels-with-software-testing" tabindex="-1"><a class="header-anchor" href="#parallels-with-software-testing"><span>Parallels with software testing</span></a></h2><p>Those who write tests for their code have long wrestled with similar questions, though framed differently. At the core, the issue is the same. Dependencies, especially third-party ones, become hurdles because they are outside the bounds of control.</p><p>Not surprisingly, the most reliable way to eliminate issues stemming from external dependencies is to remove the external service entirely from the equation, effectively decoupling from it. Of course, how this is done, and whether it‚Äôs always possible, depends on the context.</p><p>As it happens, techniques for handling dependencies can be just as useful when it comes to making demos more resilient.</p><p>To keep things concrete, I‚Äôll be using the mentioned CodePen demos as an example. But the same approach works just as well in many other contexts.</p><hr><h2 id="decoupling-rest-api-dependencies" tabindex="-1"><a class="header-anchor" href="#decoupling-rest-api-dependencies"><span>Decoupling REST API dependencies</span></a></h2><p>While there are many strategies and tricks, the two most common approaches to breaking reliance on a REST API are:</p><ol><li>Mocking the HTTP calls in code and, instead of performing real network requests, returning stubbed responses</li><li>Using a mock API server as a stand-in for the real service and serving predefined responses in a similar manner</li></ol><p>Both have trade-offs, but let‚Äôs look at those later.</p><hr><h2 id="mocking-a-response-with-an-interceptor" tabindex="-1"><a class="header-anchor" href="#mocking-a-response-with-an-interceptor"><span>Mocking a response with an interceptor</span></a></h2>',16)),s("p",null,[n[10]||(n[10]=a("Modern testing frameworks, whether for unit or end-to-end testing, such as ",-1)),e(r,{to:"/css-tricks.com/writing-tests-for-react-applications-using-jest-and-enzyme.html#mock-api-calls.md"},{default:o(()=>[...n[8]||(n[8]=[s("strong",null,"Jest",-1)])]),_:1}),n[11]||(n[11]=a(" or ",-1)),s("a",x,[e(t,{icon:"iconfont icon-playwright"}),n[9]||(n[9]=a("Playwright",-1))]),n[12]||(n[12]=a(", offer built-in mocking capabilities.",-1))]),s("p",null,[n[14]||(n[14]=a("However, we don‚Äôt necessarily need these, and we can‚Äôt use them in the pens anyway. Instead, we can monkey patch the ",-1)),s("a",q,[e(t,{icon:"fa-brands fa-firefox"}),n[13]||(n[13]=a("Fetch API",-1))]),n[15]||(n[15]=a(" to intercept requests and return mock responses. With monkey patching, when changing the original source code isn‚Äôt feasible, we can introduce new behavior by overwriting existing functions.",-1))]),n[51]||(n[51]=p(`<p>Implementing it looks like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">fetchWPFormsRestApiInterceptor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fetch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">async</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter">resource<span class="token punctuation">,</span></span>
<span class="line">  options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// To make sure we are dealing with the data we expect</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> resource <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>body <span class="token keyword">instanceof</span> <span class="token class-name">FormData</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">wp-json\\/contact-form-7</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">contactForm7Response</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">wp-json\\/gf</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">gravityFormsResponse</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">window<span class="token punctuation">.</span>fetch <span class="token operator">=</span> <span class="token function">fetchWPFormsRestApiInterceptor</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>fetch<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We override the default <code>fetch</code> with our own version that adds custom logic for specific conditions, and otherwise lets requests pass through unchanged.</p><p>The replacement function, <code>fetchWPFormsRestApiInterceptor</code>, acts like an interceptor. An interceptor is simply a pattern that modifies requests or responses based on certain conditions.</p>`,4)),s("p",null,[n[18]||(n[18]=a("Many HTTP libraries, like the once-popular ",-1)),s("a",I,[e(t,{icon:"iconfont icon-axios"}),n[16]||(n[16]=a("axios",-1))]),n[19]||(n[19]=a(", offer a convenient API to add ",-1)),e(r,{to:"/css-tricks.com/stay-dry-using-axios-for-api-requests.html#interceptors"},{default:o(()=>[...n[17]||(n[17]=[s("strong",null,"interceptors",-1)])]),_:1}),n[20]||(n[20]=a(" without resorting to monkey patching, which should be used sparingly. It‚Äôs all too easy to introduce subtle bugs unintentionally or create conflicts when managing multiple overrides.",-1))]),n[52]||(n[52]=p(`<p>With the interceptor in place, returning a fake response is as simple as calling the static JSON method of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" target="_blank" rel="noopener noreferrer"><code>Response</code></a> object:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">contactForm7Response</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Depending on the need, the response can be anything from plain text to a <code>Blob</code> or <code>ArrayBuffer</code>. It‚Äôs also possible to specify custom status codes and include additional headers.</p><p>For the CodePen demo, the response might be built like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">contactForm7Response</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> submissionSuccess <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">into</span><span class="token operator">:</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;mail_sent&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Thank you for your message. It has been sent.!&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">posted_data_hash</span><span class="token operator">:</span> <span class="token string">&quot;d52f9f9de995287195409fe6dcde0c50&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> submissionValidationFailed <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">into</span><span class="token operator">:</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;validation_failed&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span></span>
<span class="line">      <span class="token string">&quot;One or more fields have an error. Please check and try again.&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">posted_data_hash</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">invalid_fields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;somebodys-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">into</span><span class="token operator">:</span> <span class="token string">&quot;span.wpcf7-form-control-wrap.somebodys-name&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;This field is required.&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">idref</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">error_id</span><span class="token operator">:</span> <span class="token string">&quot;-ve-somebodys-name&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Or a more thorough way to check the validity of an email address</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[^\\s@]+@[^\\s@]+.[^\\s@]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;any-email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">into</span><span class="token operator">:</span> <span class="token string">&quot;span.wpcf7-form-control-wrap.any-email&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;The email address entered is invalid.&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">idref</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">error_id</span><span class="token operator">:</span> <span class="token string">&quot;-ve-any-email&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// The rest of the validations...</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token operator">!</span>submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span>length</span>
<span class="line">    <span class="token operator">?</span> submissionSuccess</span>
<span class="line">    <span class="token operator">:</span> submissionValidationFailed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At this point, any <code>fetch</code> call to a URL matching <code>wp-json/contact-form-7</code> returns the faked success or validation errors, depending on the form input.</p><p>Now let‚Äôs contrast that with the mocked API server approach.</p><hr><h2 id="mocked-api-server-with-serverless" tabindex="-1"><a class="header-anchor" href="#mocked-api-server-with-serverless"><span>Mocked API server with serverless</span></a></h2><p>Running a traditionally hosted mock API server reintroduces concerns around availability, maintenance, and cost. Even though the hype around serverless functions has quieted, we can sidestep these issues by using them.</p>`,10)),s("p",null,[n[22]||(n[22]=a("And with ",-1)),s("a",D,[e(t,{icon:"fa-brands fa-digital-oceans"}),n[21]||(n[21]=a("DigitalOcean Functions",-1))]),n[23]||(n[23]=a(" offering a generous free tier, creating mocked APIs is practically free and requires no more effort than manually mocking them.",-1))]),n[53]||(n[53]=s("p",null,"For simple use cases, everything can be done through the Functions control panel, including writing the code in the built-in editor. Check out this concise presentation video to see it in action:",-1)),s("p",null,[n[25]||(n[25]=a("For more complex needs, functions can be ",-1)),s("a",T,[e(t,{icon:"fa-brands fa-digital-oceans"}),n[24]||(n[24]=a("developed locally and deployed",-1))]),n[26]||(n[26]=a(" using ",-1)),n[27]||(n[27]=s("code",null,"doctl",-1)),n[28]||(n[28]=a(" (DigitalOcean‚Äôs CLI).",-1))]),s("p",null,[n[30]||(n[30]=a("To return the mocked response, it‚Äôs easier if we ",-1)),s("a",j,[e(t,{icon:"fa-brands fa-digital-oceans"}),n[29]||(n[29]=a("create a separate Function",-1))]),n[31]||(n[31]=a(" for each endpoint, since we can avoid adding unnecessary conditions. Fortunately, we can stick with JavaScript (Node.js), and starting with nearly the same base we used for ",-1)),n[32]||(n[32]=s("code",null,"contactForm7Response",-1)),n[33]||(n[33]=a(":",-1))]),n[54]||(n[54]=p(`<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),s("p",null,[n[36]||(n[36]=a("We must name the handler function ",-1)),n[37]||(n[37]=s("code",null,"main",-1)),n[38]||(n[38]=a(", which is invoked when the endpoint is called. The function receives the ",-1)),n[39]||(n[39]=s("code",null,"event",-1)),n[40]||(n[40]=a(" object as its first argument, containing the ",-1)),s("a",F,[e(t,{icon:"fa-brands fa-digital-oceans"}),n[34]||(n[34]=a("details of the request",-1))]),n[41]||(n[41]=a(". Once again, we could return anything, but to return the JSON response we need, it‚Äôs enough to simply ",-1)),s("a",R,[e(t,{icon:"fa-brands fa-digital-oceans"}),n[35]||(n[35]=a("return an object",-1))]),n[42]||(n[42]=a(".",-1))]),n[55]||(n[55]=p(`<p>We can reuse the same code for creating the response as-is. The only difference is that we have to extract the form input data from the <code>event</code> as <code>FormData</code> ourselves:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// How do we get the FormData from the event?</span></span>
<span class="line">  <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> submissionSuccess <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> submissionValidationFailed <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;somebodys-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Or a more thorough way to check the validity of an email address</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[^\\s@]+@[^\\s@]+.[^\\s@]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;any-email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// The rest of the validations...</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token operator">!</span>submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span>length</span>
<span class="line">    <span class="token operator">?</span> submissionSuccess</span>
<span class="line">    <span class="token operator">:</span> submissionValidationFailed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)),s("p",null,[n[44]||(n[44]=a("As far as converting the data, serverless functions typically expect JSON inputs, so for other data types an extra parsing step is required. As it happens, the forms in the CodePen demos are submitted as ",-1)),s("a",S,[e(t,{icon:"fa-brands fa-firefox"}),n[43]||(n[43]=s("code",null,"multipart/form-data",-1))]),n[45]||(n[45]=a(".",-1))]),n[56]||(n[56]=p(`<p>Without any libraries, we can convert a <code>multipart/form-data</code> string into a <code>FormData</code> by taking advantage of the <code>Response</code> API‚Äôs capabilities:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">convertMultipartFormDataToFormData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> matches <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\s*--(\\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> boundary <span class="token operator">=</span> matches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multipart/form-data; boundary=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>boundary<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The code is mostly focused on extracting the boundary variable. This is typically autogenerated, for example, when submitting a form in a browser.</p><p>The submitted raw data is available via <code>event.http.body</code>, but since it‚Äôs base64-encoded, we need to decode it first:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">convertMultipartFormDataToFormData</span><span class="token punctuation">(</span></span>
<span class="line">    Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>event<span class="token operator">?.</span>http<span class="token operator">?.</span>body <span class="token operator">??</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;base64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">    </span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token operator">!</span>submissionValidationFailed<span class="token punctuation">.</span>invalid_fields<span class="token punctuation">.</span>length</span>
<span class="line">    <span class="token operator">?</span> submissionSuccess</span>
<span class="line">    <span class="token operator">:</span> submissionValidationFailed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And that‚Äôs it. With this approach, all that‚Äôs left is to replace calls to the original APIs with calls to the mocked ones.</p><hr><h2 id="closing-thoughts" tabindex="-1"><a class="header-anchor" href="#closing-thoughts"><span>Closing thoughts</span></a></h2><p>Ultimately, both approaches help decouple the demos from the third-party API dependency. In terms of effort, at least for this specific example, they seem comparable.</p><p>It‚Äôs hard to beat the fact that there‚Äôs no external dependency with the manual mocking approach, not even on something we somewhat control, and everything is bundled together. In general, without knowing specific details, there are good reasons to favor this approach for small, self-contained demos.</p>`,10)),s("p",null,[n[47]||(n[47]=a("But using a mocked server API also has its advantages. A mocked server API can power not only demos, but also various types of tests. For more complex needs, a dedicated team working on the mocked server might prefer a different programming language than JavaScript, or they might opt to use a tool like ",-1)),s("a",W,[e(t,{icon:"fas fa-globe"}),n[46]||(n[46]=a("WireMock",-1))]),n[48]||(n[48]=a(" instead of starting from scratch.",-1))]),n[57]||(n[57]=s("p",null,"As with everything, it depends. There are many criteria to consider beyond what I‚Äôve just mentioned.",-1)),n[58]||(n[58]=s("p",null,"I also don‚Äôt think this approach necessarily needs to be applied by default. After all, I had the CodePen demos working for four years without any issues.",-1)),n[59]||(n[59]=s("p",null,"The important part is having a way to know when demos break (monitoring), and when they do, having the right tools at our disposal to handle the situation.",-1)),g(" TODO: add ARTICLE CARD "),e(c,u(d({title:"Keeping Article Demos Alive When Third-Party APIs Die",desc:"Is there a way to build demos that do not break when the services they rely on fail? How can we ensure educational demos stay available for as long as possible?",link:"https://chanhi2000.github.io/bookshelf/css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die.html",logo:"https://css-tricks/favicon.svg",background:"rgba(17,17,17,0.2)"})),null,16)])}const O=v(y,[["render",V]]),B=JSON.parse('{"path":"/css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die.html","title":"Keeping Article Demos Alive When Third-Party APIs Die","lang":"en-US","frontmatter":{"lang":"en-US","title":"Keeping Article Demos Alive When Third-Party APIs Die","description":"Article(s) > Keeping Article Demos Alive When Third-Party APIs Die","icon":"fa-brands fa-js","category":["JavaScript","Article(s)"],"tag":["blog","css-tricks.com","js","javascript"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Keeping Article Demos Alive When Third-Party APIs Die\\",\\"image\\":[\\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/nodes-pattern.png\\"],\\"datePublished\\":\\"2025-07-30T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"M√©sz√°ros R√≥bert\\",\\"url\\":\\"https://css-tricks.com/author/meszarosrob/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Keeping Article Demos Alive When Third-Party APIs Die"}],["meta",{"property":"og:description","content":"Article(s) > Keeping Article Demos Alive When Third-Party APIs Die"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/nodes-pattern.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/nodes-pattern.png"}],["meta",{"name":"twitter:image:alt","content":"Keeping Article Demos Alive When Third-Party APIs Die"}],["meta",{"property":"article:author","content":"M√©sz√°ros R√≥bert"}],["meta",{"property":"article:tag","content":"javascript"}],["meta",{"property":"article:tag","content":"js"}],["meta",{"property":"article:tag","content":"css-tricks.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-07-30T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Keeping Article Demos Alive When Third-Party APIs Die"},{"property":"og:description","content":"Keeping Article Demos Alive When Third-Party APIs Die"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die.html"}]],"prev":"/programming/css/articles/README.md","date":"2025-07-30T00:00:00.000Z","isOriginal":false,"author":[{"name":"M√©sz√°ros R√≥bert","url":"https://css-tricks.com/author/meszarosrob/"}],"cover":"https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/nodes-pattern.png"},"git":{},"readingTime":{"minutes":6.55,"words":1966},"filePathRelative":"css-tricks.com/keeping-article-demos-alive-when-third-party-apis-die.md","copyright":{"author":"M√©sz√°ros R√≥bert"}}');export{O as comp,B as data};
