import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as s,f as a,b as r,t as h,n as l,g as c,w as t,e,r as u,o as y}from"./app-BItykJLQ.js";const f={},b={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},E={class:"table-of-contents"},F={href:"https://learn.microsoft.com/en-us/ef/core/performance/efficient-querying#avoid-cartesian-explosion-when-loading-related-entities",target:"_blank",rel:"noopener noreferrer"};function q(d,n){const p=u("VPCard"),i=u("router-link"),m=u("SiteInfo"),o=u("RouteLink"),k=u("VPIcon");return y(),g("div",null,[s("h1",b,[s("a",w,[s("span",null,h(d.$frontmatter.title)+" ê´€ë ¨",1)])]),a(p,l(c({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",E,[s("ul",null,[s("li",null,[a(i,{to:"#query-splitting"},{default:t(()=>[...n[0]||(n[0]=[e("Query Splitting",-1)])]),_:1})]),s("li",null,[a(i,{to:"#bulk-updates-and-deletes"},{default:t(()=>[...n[1]||(n[1]=[e("Bulk Updates and Deletes",-1)])]),_:1})]),s("li",null,[a(i,{to:"#raw-sql-queries"},{default:t(()=>[...n[2]||(n[2]=[e("Raw SQL Queries",-1)])]),_:1})]),s("li",null,[a(i,{to:"#query-filters"},{default:t(()=>[...n[3]||(n[3]=[e("Query Filters",-1)])]),_:1})]),s("li",null,[a(i,{to:"#eager-loading"},{default:t(()=>[...n[4]||(n[4]=[e("Eager Loading",-1)])]),_:1})]),s("li",null,[a(i,{to:"#summary"},{default:t(()=>[...n[5]||(n[5]=[e("Summary",-1)])]),_:1})])])]),n[29]||(n[29]=s("hr",null,null,-1)),a(m,{name:"5 EF Core Features You Need To Know",desc:"EF Core is powerful, and knowing a few key features can save you lots of time and frustration. I've cherry-picked five essential features that you really need to know.",url:"https://milanjovanovic.tech/blog/5-ef-core-features-you-need-to-know/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_102.png"}),n[30]||(n[30]=r('<p>Okay, let&#39;s be honest. We all have a million things on our plates, and diving deep into every nook and cranny of EF Core might not be at the top of your priority list.</p><p>But here&#39;s the deal: EF Core is powerful, and knowing a few key features can save you lots of time and frustration.</p><p>So, I won&#39;t bombard you with every single EF Core feature under the sun.</p><p>Instead, I&#39;ve cherry-picked five essential ones that you really need to know.</p><p>We&#39;ll go through:</p><ul><li><strong>Query Splitting</strong> - your database&#39;s new best friend</li><li><strong>Bulk Updates and Deletes</strong> - efficiency on steroids</li><li><strong>Raw SQL Queries</strong> - when you need to go rogue</li><li><strong>Query Filters</strong> - keeping things nice and tidy</li><li><strong>Eager Loading</strong> - because lazy isn&#39;t so great</li></ul><p>Let&#39;s get started!</p><hr><h2 id="query-splitting" tabindex="-1"><a class="header-anchor" href="#query-splitting"><span>Query Splitting</span></a></h2>',9)),s("p",null,[a(o,{to:"/milanjovanovic.tech/how-to-improve-performance-with-ef-core-query-splitting.html"},{default:t(()=>[...n[6]||(n[6]=[s("strong",null,"Query splitting",-1)])]),_:1}),n[7]||(n[7]=e(" is one of those EF Core features that you rarely need.",-1))]),n[31]||(n[31]=s("p",null,"Until one day, you do.",-1)),n[32]||(n[32]=s("p",null,"Query splitting is helpful in scenarios where you're eager loading multiple collections.",-1)),s("p",null,[n[9]||(n[9]=e("It helps us avoid the ",-1)),s("a",F,[a(k,{icon:"fa-brands fa-microsoft"}),n[8]||(n[8]=e("cartesian explosion",-1))]),n[10]||(n[10]=e(" problem.",-1))]),n[33]||(n[33]=r(`<p>Let&#39;s say we want to retrieve a department with all its teams and employees. We might write a query like this:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name">Department</span> department <span class="token operator">=</span></span>
<span class="line">    context<span class="token punctuation">.</span>Departments</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Teams<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Employees<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Id <span class="token operator">==</span> departmentId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This translates to a single SQL query with two JOINs.</p><p>However, since these <code>JOIN</code> statements are on the same level, the database will return a <em>cross product</em>.</p><p>Each row from <code>Teams</code> will be joined with each row <code>Employees</code>.</p><p>In that case, the database returns many rows, significantly impacting performance.</p><p>Here&#39;s how we can avoid these performance issues with query splitting:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name">Department</span> department <span class="token operator">=</span></span>
<span class="line">    context<span class="token punctuation">.</span>Departments</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Teams<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Employees<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Id <span class="token operator">==</span> departmentId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">AsSplitQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With <code>AsSplitQuery</code>, EF Core will execute an additional SQL query for each collection navigation.</p><p>However, be cautious not to overuse query splitting.</p><p>I use split queries when I&#39;ve <em>measured</em> that they consistently perform better.</p><p>Split queries have more round trips to the database, which might be slower if database latency is high.</p><p>There is also no consistency guarantee across multiple SQL queries.</p><hr><h2 id="bulk-updates-and-deletes" tabindex="-1"><a class="header-anchor" href="#bulk-updates-and-deletes"><span>Bulk Updates and Deletes</span></a></h2>`,15)),s("p",null,[n[12]||(n[12]=e("EF Core 7 added two new APIs for performing ",-1)),a(o,{to:"/milanjovanovic.tech/how-to-use-the-new-bulk-update-feature-in-ef-core-7.html"},{default:t(()=>[...n[11]||(n[11]=[s("strong",null,"bulk updates and deletes",-1)])]),_:1}),n[13]||(n[13]=e(",",-1))]),n[34]||(n[34]=r(`<p><code>ExecuteUpdate</code> and <code>ExecuteDelete</code>.</p><p>They allow you to efficiently update a large number of rows in one round trip to the database.</p><p>Here&#39;s a practical example.</p><p>The company has decided to give a 5% raise to all employees in the &quot;Sales&quot; department.</p><p>Without bulk updates, we might iterate through each employee and update their salary individually:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> salesEmployees <span class="token operator">=</span> context<span class="token punctuation">.</span>Employees</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Department <span class="token operator">==</span> <span class="token string">&quot;Sales&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> employee <span class="token keyword">in</span> salesEmployees<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    employee<span class="token punctuation">.</span>Salary <span class="token operator">*=</span> <span class="token number">1.05m</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach involves multiple database roundtrips, which can be inefficient, especially for large datasets.</p><p>We can achieve the same in one roundtrip using <code>ExecuteUpdate</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">context<span class="token punctuation">.</span>Employees</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Department <span class="token operator">==</span> <span class="token string">&quot;Sales&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ExecuteUpdate</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">SetProperty</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Salary<span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Salary <span class="token operator">*</span> <span class="token number">1.05m</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This executes a single SQL <code>UPDATE</code> statement, directly modifying the salaries in the database without loading entities into memory, giving us improved performance.</p><p>Here&#39;s another example.</p><p>Let&#39;s say an e-commerce platform wants to delete all shopping carts older than one year.</p><p>Here&#39;s how we could do this with <code>ExecuteDelete</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">context<span class="token punctuation">.</span>Carts</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>o <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>CreatedOn <span class="token operator">&lt;</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddYears</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ExecuteDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This results in a single SQL <code>DELETE</code> statement, directly removing the old shopping carts from the database.</p><p>However, bulk updates bypass the EF change tracker.</p>`,16)),s("p",null,[n[15]||(n[15]=e("This could be problematic, and I wrote about the ",-1)),a(o,{to:"/milanjovanovic.tech/what-you-need-to-know-about-ef-core-bulk-updates.html"},{default:t(()=>[...n[14]||(n[14]=[s("strong",null,"caveats of bulk updates in this article",-1)])]),_:1}),n[16]||(n[16]=e(".",-1))]),n[35]||(n[35]=r(`<hr><h2 id="raw-sql-queries" tabindex="-1"><a class="header-anchor" href="#raw-sql-queries"><span>Raw SQL Queries</span></a></h2><p>EF Core 8 added a new feature that allows us to query unmapped types with raw SQL.</p><p>Suppose we want to retrieve data from a database view, stored procedure, or a table that doesn&#39;t directly correspond to any of our entity classes.</p><p>For example, we want to retrieve a sales summary for each product.</p><p>With EF Core 8, we can define a simple <code>ProductSummary</code> class representing the structure of the result set and query it directly:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductSummary</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ProductId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProductName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> TotalSales <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> productSummaries <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>Database</span>
<span class="line">    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SqlQuery</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProductSummary<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token interpolation-string"><span class="token string">@$&quot;&quot;&quot;</span>
<span class="line">        SELECT p.ProductId, p.ProductName, SUM(oi.Quantity * oi.UnitPrice) AS TotalSales</span>
<span class="line">        FROM Products p</span>
<span class="line">        JOIN OrderItems oi ON p.ProductId = oi.ProductId</span>
<span class="line">        WHERE p.CategoryId = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">categoryId</span><span class="token punctuation">}</span></span><span class="token string"></span>
<span class="line">        GROUP BY p.ProductId, p.ProductName</span>
<span class="line">        &quot;&quot;&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>SqlQuery</code> method returns an <code>IQueryable</code>, which allows you to compose raw SQL queries with LINQ.</p><p>This combines the power of raw SQL with the expressiveness of LINQ.</p><p>Remember to use parameterized queries to prevent SQL injection vulnerabilities.</p><p>The <code>SqlQuery</code> method accepts a <code>FormattableString</code>, which means you can safely use an interpolated string.</p><p>Each argument is converted to a SQL parameter.</p>`,12)),s("p",null,[n[18]||(n[18]=e("You can learn more about ",-1)),a(o,{to:"/milanjovanovic.tech/ef-core-raw-sql-queries.html"},{default:t(()=>[...n[17]||(n[17]=[s("strong",null,"raw SQL queries in this article",-1)])]),_:1}),n[19]||(n[19]=e(".",-1))]),n[36]||(n[36]=s("hr",null,null,-1)),n[37]||(n[37]=s("h2",{id:"query-filters",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#query-filters"},[s("span",null,"Query Filters")])],-1)),s("p",null,[a(o,{to:"/milanjovanovic.tech/how-to-use-global-query-filters-in-ef-core.html"},{default:t(()=>[...n[20]||(n[20]=[s("strong",null,"Query filters",-1)])]),_:1}),n[21]||(n[21]=e(" are like reusable ",-1)),n[22]||(n[22]=s("code",null,"WHERE",-1)),n[23]||(n[23]=e(" clauses you can apply to your entities.",-1))]),n[38]||(n[38]=s("p",null,"These filters are automatically added to LINQ queries whenever you retrieve entities of the corresponding type.",-1)),n[39]||(n[39]=s("p",null,"This saves you from repeatedly writing the same filtering logic in multiple places within your application.",-1)),n[40]||(n[40]=s("p",null,"Query Filters are commonly used for scenarios like:",-1)),s("ul",null,[s("li",null,[a(o,{to:"/milanjovanovic.tech/implementing-soft-delete-with-ef-core.html"},{default:t(()=>[...n[24]||(n[24]=[s("strong",null,"Soft Deletes",-1)])]),_:1}),n[25]||(n[25]=e(": Filter out records marked as deleted.",-1))]),s("li",null,[a(o,{to:"/milanjovanovic.tech/multi-tenant-applications-with-ef-core.html"},{default:t(()=>[...n[26]||(n[26]=[s("strong",null,"Multi-tenancy",-1)])]),_:1}),n[27]||(n[27]=e(": Filter data based on the current tenant.",-1))]),n[28]||(n[28]=s("li",null,"Row-level security: Restrict access to certain records based on user roles or permissions.",-1))]),n[41]||(n[41]=r(`<p>In a multi-tenant application, you often need to filter data based on the current tenant. Query filters allow us to handle this requirement easily:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// Associate products with tenants</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> TenantId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// The current TenantId is set based on the current request/context</span></span>
<span class="line">    modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasQueryFilter</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>TenantId <span class="token operator">==</span> _currentTenantId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Now, queries automatically filter based on the tenant:</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> productsForCurrentTenant <span class="token operator">=</span> context<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Configuring multiple query filters on the same entity will only apply the last one. You can combine multiple query filters using <code>&amp;&amp;</code> (AND) and <code>||</code> (OR) operators.</p><p>You can use <code>IgnoreQueryFilters</code> to bypass the filters in specific queries when needed.</p><hr><h2 id="eager-loading" tabindex="-1"><a class="header-anchor" href="#eager-loading"><span>Eager Loading</span></a></h2><p>Eager Loading is a feature in EF Core that allows you to load related entities along with your main entity in a single database query.</p><p>By fetching all necessary data in a single query, you can improve application performance.</p><p>This is especially true when dealing with complex object graphs or when lazy loading would result in many small, inefficient queries.</p><p>Here&#39;s an example <code>VerifyEmail</code> use case.</p><p>We want to load an <code>EmailVerificationToken</code> and eagerly load a <code>User</code> with the <code>Include</code> method because we want to modify both entities at the same time.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">VerifyEmail</span><span class="token punctuation">(</span><span class="token class-name">AppDbContext</span> context<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> tokenId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">EmailVerificationToken<span class="token punctuation">?</span></span> token <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>EmailVerificationTokens</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">FirstOrDefaultAsync</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Id <span class="token operator">==</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token keyword">is</span> <span class="token keyword">null</span> <span class="token operator">||</span> token<span class="token punctuation">.</span>ExpiresOnUtc <span class="token operator">&lt;</span> DateTime<span class="token punctuation">.</span>UtcNow <span class="token operator">||</span> token<span class="token punctuation">.</span>User<span class="token punctuation">.</span>EmailVerified<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        token<span class="token punctuation">.</span>User<span class="token punctuation">.</span>EmailVerified <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        context<span class="token punctuation">.</span>EmailVerificationTokens<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EF Core will generate a single SQL query that joins the <code>EmailVerificationToken</code> and <code>User</code> tables, retrieving all the necessary data in one go.</p><p>Eager loading (and query splitting, which we mentioned earlier) isn&#39;t a silver bullet. Consider using projections if you only need specific properties from related entities to avoid fetching unnecessary data.</p><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>So, there you have it!</p><p>Five EF Core features that, frankly, you can&#39;t afford <em>not</em> to know.</p><p>Remember, mastering EF Core takes time, but these features provide a solid foundation to build upon.</p><p>Another piece of advice is to deeply understand how your database works.</p><p>Mastering SQL also allows you to get the most value from EF Core.</p><p>While we focused on five key features, there are many other EF Core features worth exploring:</p>`,22)),a(p,l(c({title:"Solving Race Conditions With EF Core Optimistic Locking",desc:"How often do you think about concurrency conflicts when writing code? You write the code for a new feature, confirm that it works, and call it a day. But one week later, you find out you introduced a nasty bug because you didn't think about concurrency. The most common issue is race conditions with two competing threads executing the same function. If you don't consider this during development, you introduce the risk of leaving the system in a corrupted state.",link:"/milanjovanovic.tech/solving-race-conditions-with-ef-core-optimistic-locking.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),a(p,l(c({title:"EF Core Migrations: A Detailed Guide",desc:"In this newsletter, we'll break down the essentials of EF Migrations. We'll explore creating migrations, SQL scripts, applying migrations, migration tooling, and more.",link:"/milanjovanovic.tech/efcore-migrations-a-detailed-guide.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),a(p,l(c({title:"Unleash EF Core Performance With Compiled Queries",desc:"In this week's newsletter I want to introduce you to an interesting feature in EF Core called Compiled Queries. If you have queries that you execute frequently in your application with a different set of parameters, it can be helpful to explicitly compile the query and reuse it throughout the lifetime of your application. Compiled Queries are more performant than standard EF queries, because they can take advantage of some additional optimizations. Let me show you how to use Compiled Queries, and how much performance improvement to expect.",link:"/milanjovanovic.tech/unleash-ef-core-performance-with-compiled-queries.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),a(p,l(c({title:"Working With Transactions In EF Core",desc:"Every software engineer working with SQL databases needs to know about transactions. And since most of the time the SQL database will be abstracted by an ORM like EF Core, it's important to understand how you can work with transactions using the available abstractions.",link:"/milanjovanovic.tech/working-with-transactions-in-ef-core.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),a(p,l(c({title:"How To Use EF Core Interceptors",desc:"EF Core is my favorite ORM for .NET applications. Yet, its many fantastic features sometimes go unnoticed. For example, query splitting, query filters, and interceptors. EF interceptors are interesting because you can do powerful things with them. For example, you can hook into materialization, handle optimistic concurrency errors, or add query hints. The most practical use case is adding behavior when saving changes to the database.",link:"/milanjovanovic.tech/how-to-use-ef-core-interceptors.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),n[42]||(n[42]=s("p",null,"EF Core is continuously evolving, so keep an eye on the latest updates and releases to stay ahead.",-1)),n[43]||(n[43]=s("p",null,"Good luck out there, and see you next week.",-1))])}const S=v(f,[["render",q]]),C=JSON.parse('{"path":"/milanjovanovic.tech/5-ef-core-features-you-need-to-know.html","title":"5 EF Core Features You Need To Know","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"5 EF Core Features You Need To Know","description":"Article(s) > 5 EF Core Features You Need To Know","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"5 EF Core Features You Need To Know\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_102.png\\"],\\"datePublished\\":\\"2024-08-10T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/5-ef-core-features-you-need-to-know.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"5 EF Core Features You Need To Know"}],["meta",{"property":"og:description","content":"Article(s) > 5 EF Core Features You Need To Know"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_102.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_102.png"}],["meta",{"name":"twitter:image:alt","content":"5 EF Core Features You Need To Know"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-08-10T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > 5 EF Core Features You Need To Know"},{"property":"og:description","content":"5 EF Core Features You Need To Know"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/5-ef-core-features-you-need-to-know.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-08-10T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_102.png"},"git":{},"readingTime":{"minutes":6.64,"words":1993},"filePathRelative":"milanjovanovic.tech/5-ef-core-features-you-need-to-know.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{S as comp,C as data};
