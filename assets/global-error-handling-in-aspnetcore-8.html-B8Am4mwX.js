import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as v,d as s,f as e,b as c,t as g,n as b,g as h,w as t,e as a,r as o,o as y}from"./app-BItykJLQ.js";const w={},x={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},f={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},E={class:"table-of-contents"},H={href:"https://rfc-editor.org/rfc/rfc7807.html",target:"_blank",rel:"noopener noreferrer"},T={href:"https://learn.microsoft.com/en-us/aspnet/core/introduction-to-aspnet-core?view=aspnetcore-8.0",target:"_blank",rel:"noopener noreferrer"},S={href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.diagnostics.iexceptionhandler?view=aspnetcore-8.0",target:"_blank",rel:"noopener noreferrer"},C={href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.diagnostics.exceptionhandlermiddleware?view=aspnetcore-8.0",target:"_blank",rel:"noopener noreferrer"},A={href:"https://rfc-editor.org/rfc/rfc7807.html",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/dotnet/aspnetcore/issues/46280#issuecomment-1527898867",target:"_blank",rel:"noopener noreferrer"},P={href:"https://youtu.be/WCCkEe_Hy2Y",target:"_blank",rel:"noopener noreferrer"};function q(r,n){const u=o("VPCard"),i=o("router-link"),d=o("SiteInfo"),p=o("RouteLink"),l=o("VPIcon"),k=o("VidStack");return y(),v("div",null,[s("h1",x,[s("a",f,[s("span",null,g(r.$frontmatter.title)+" ê´€ë ¨",1)])]),e(u,b(h({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",E,[s("ul",null,[s("li",null,[e(i,{to:"#old-way-exception-handling-midleware"},{default:t(()=>[...n[0]||(n[0]=[a("Old Way: Exception Handling Midleware",-1)])]),_:1})]),s("li",null,[e(i,{to:"#new-way-iexceptionhandler"},{default:t(()=>[...n[1]||(n[1]=[a("New Way: IExceptionHandler",-1)])]),_:1})]),s("li",null,[e(i,{to:"#configuring-iexceptionhandler-implementations"},{default:t(()=>[...n[2]||(n[2]=[a("Configuring IExceptionHandler Implementations",-1)])]),_:1})]),s("li",null,[e(i,{to:"#chaining-exception-handlers"},{default:t(()=>[...n[3]||(n[3]=[a("Chaining Exception Handlers",-1)])]),_:1})]),s("li",null,[e(i,{to:"#takeaway"},{default:t(()=>[...n[4]||(n[4]=[a("Takeaway",-1)])]),_:1})])])]),n[52]||(n[52]=s("hr",null,null,-1)),e(d,{name:"Global Error Handling in ASP.NET Core 8",desc:"Exceptions are for exceptional situations. But they will inevitably happen in your applications, and you need to handle them. You can implement a global exception handling mechanism or handle only specific exceptions. ASP.NET Core gives you a few options on how to implement this. So which one should you choose? Today, I want to show you an old and new way to handle exceptions in ASP.NET Core 8.",url:"https://milanjovanovic.tech/blog/global-error-handling-in-aspnetcore-8/",logo:"https://milanjovanovic.tech/profile_favico.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_066.png"}),s("p",null,[n[6]||(n[6]=a("Exceptions are for exceptional situations. I even wrote about ",-1)),e(p,{to:"/milanjovanovic.tech/functional-error-handling-in-dotnet-with-the-result-pattern.html"},{default:t(()=>[...n[5]||(n[5]=[s("strong",null,"avoiding exceptions entirely.",-1)])]),_:1})]),n[53]||(n[53]=c('<p>But they will inevitably happen in your applications, and you need to handle them.</p><p>You can implement a global exception handling mechanism or handle only specific exceptions.</p><p>ASP.NET Core gives you a few options on how to implement this. So which one should you choose?</p><p>Today, I want to show you an <em>old</em> and <em>new</em> way to handle exceptions in ASP.NET Core 8.</p><hr><h2 id="old-way-exception-handling-midleware" tabindex="-1"><a class="header-anchor" href="#old-way-exception-handling-midleware"><span>Old Way: Exception Handling Midleware</span></a></h2><p>The standard to implement exception handling in ASP.NET Core is using middleware. Middleware allows you to introduce logic before or after executing HTTP requests. You can easily extend this to implement exception handling. Add a <code>try-catch</code> statement in the middleware and return an error HTTP response.</p>',7)),s("p",null,[n[8]||(n[8]=a("There are ",-1)),e(p,{to:"/milanjovanovic.tech/3-ways-to-create-middleware-in-asp-net-core.html"},{default:t(()=>[...n[7]||(n[7]=[s("strong",null,"3 ways to create middleware",-1)])]),_:1}),n[9]||(n[9]=a(" in ASP.NET Core:",-1))]),s("ul",null,[s("li",null,[n[11]||(n[11]=a("Using ",-1)),e(p,{to:"/milanjovanovic.tech/3-ways-to-create-middleware-in-asp-net-core.html#adding-middleware-with-request-delegates"},{default:t(()=>[...n[10]||(n[10]=[s("strong",null,"request delegates",-1)])]),_:1})]),s("li",null,[n[13]||(n[13]=a("By ",-1)),e(p,{to:"/milanjovanovic.tech/3-ways-to-create-middleware-in-asp-net-core.html#adding-middleware-by-convention"},{default:t(()=>[...n[12]||(n[12]=[s("strong",null,"convention",-1)])]),_:1})]),s("li",null,[e(p,{to:"/milanjovanovic.tech/3-ways-to-create-middleware-in-asp-net-core.html#adding-factory-based-middleware"},{default:t(()=>[...n[14]||(n[14]=[s("code",null,"IMiddleware",-1)])]),_:1})])]),n[54]||(n[54]=c(`<p>The convention-based approach requires you to define an <code>InvokeAsync</code> method.</p><p>Here&#39;s an <code>ExceptionHandlingMiddleware</code> defined by convention:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionHandlingMiddleware</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">RequestDelegate</span> _next<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ExceptionHandlingMiddleware<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">ExceptionHandlingMiddleware</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">RequestDelegate</span> next<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ExceptionHandlingMiddleware<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _next <span class="token operator">=</span> next<span class="token punctuation">;</span></span>
<span class="line">        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">InvokeAsync</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">await</span> <span class="token function">_next</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span></span>
<span class="line">                exception<span class="token punctuation">,</span> <span class="token string">&quot;Exception occurred: {Message}&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name"><span class="token keyword">var</span></span> problemDetails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProblemDetails</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                Status <span class="token operator">=</span> StatusCodes<span class="token punctuation">.</span>Status500InternalServerError<span class="token punctuation">,</span></span>
<span class="line">                Title <span class="token operator">=</span> <span class="token string">&quot;Server Error&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span></span>
<span class="line">                StatusCodes<span class="token punctuation">.</span>Status500InternalServerError<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">await</span> context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">WriteAsJsonAsync</span><span class="token punctuation">(</span>problemDetails<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),s("p",null,[n[16]||(n[16]=a("The ",-1)),n[17]||(n[17]=s("code",null,"ExceptionHandlingMiddleware",-1)),n[18]||(n[18]=a(" will catch any unhandled exception and return a ",-1)),s("a",H,[e(l,{icon:"fas fa-globe"}),n[15]||(n[15]=a("Problem Details",-1))]),n[19]||(n[19]=a(" response. You can decide how much information you want to return to the caller. In this example, I'm hiding the exception details.",-1))]),n[55]||(n[55]=c(`<p>You also need to add this middleware to the ASP.NET Core request pipeline:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseMiddleware</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ExceptionHandlingMiddleware<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="new-way-iexceptionhandler" tabindex="-1"><a class="header-anchor" href="#new-way-iexceptionhandler"><span>New Way: IExceptionHandler</span></a></h2>`,4)),s("p",null,[s("a",T,[e(l,{icon:"fa-brands fa-microsoft"}),n[20]||(n[20]=a("ASP.NET Core 8",-1))]),n[22]||(n[22]=a(" introduces a new ",-1)),s("a",S,[e(l,{icon:"fa-brands fa-microsoft"}),n[21]||(n[21]=s("code",null,"IExceptionHandler",-1))]),n[23]||(n[23]=a(" abstraction for managing exceptions. The built-in exception handler middleware uses ",-1)),n[24]||(n[24]=s("code",null,"IExceptionHandler",-1)),n[25]||(n[25]=a(" implementations to handle exceptions.",-1))]),n[56]||(n[56]=c(`<p>This interface has only one <code>TryHandleAsync</code> method.</p><p><code>TryHandleAsync</code> attempts to handle the specified exception within the ASP.NET Core pipeline. If the exception can be handled, it should return <code>true</code>. If the exception can&#39;t be handled, it should return <code>false</code>. This allows you to implement custom exception-handling logic for different scenarios.</p><p>Here&#39;s a <code>GlobalExceptionHandler</code> implementation:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IExceptionHandler</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>GlobalExceptionHandler<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">GlobalExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>GlobalExceptionHandler<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">ValueTask<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">TryHandleAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">HttpContext</span> httpContext<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">Exception</span> exception<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span></span>
<span class="line">            exception<span class="token punctuation">,</span> <span class="token string">&quot;Exception occurred: {Message}&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> problemDetails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProblemDetails</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Status <span class="token operator">=</span> StatusCodes<span class="token punctuation">.</span>Status500InternalServerError<span class="token punctuation">,</span></span>
<span class="line">            Title <span class="token operator">=</span> <span class="token string">&quot;Server error&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        httpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> problemDetails<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> httpContext<span class="token punctuation">.</span>Response</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">WriteAsJsonAsync</span><span class="token punctuation">(</span>problemDetails<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="configuring-iexceptionhandler-implementations" tabindex="-1"><a class="header-anchor" href="#configuring-iexceptionhandler-implementations"><span>Configuring IExceptionHandler Implementations</span></a></h2><p>You need two things to add an <code>IExceptionHandler</code> implementation to the ASP.NET Core request pipeline:</p>`,7)),s("ol",null,[n[29]||(n[29]=s("li",null,[a("Register the "),s("code",null,"IExceptionHandler"),a(" service with dependency injection")],-1)),s("li",null,[n[27]||(n[27]=a("Register the ",-1)),s("a",C,[e(l,{icon:"fa-brands fa-microsoft"}),n[26]||(n[26]=s("code",null,"ExceptionHandlerMiddleware",-1))]),n[28]||(n[28]=a(" with the request pipeline",-1))])]),s("p",null,[n[31]||(n[31]=a("You call the ",-1)),n[32]||(n[32]=s("code",null,"AddExceptionHandler",-1)),n[33]||(n[33]=a(" method to register the ",-1)),n[34]||(n[34]=s("code",null,"GlobalExceptionHandler",-1)),n[35]||(n[35]=a(" as a service. It's registered with a ",-1)),e(p,{to:"/milanjovanovic.tech/improving-aspnetcore-dependency-injection-with-scrutor.html"},{default:t(()=>[...n[30]||(n[30]=[s("strong",null,"singleton lifetime",-1)])]),_:1}),n[36]||(n[36]=a(". So be careful about injecting services with a different lifetime.",-1))]),s("p",null,[n[38]||(n[38]=a("I'm also calling ",-1)),n[39]||(n[39]=s("code",null,"AddProblemDetails",-1)),n[40]||(n[40]=a(" to generate a ",-1)),s("a",A,[e(l,{icon:"fas fa-globe"}),n[37]||(n[37]=a("Problem Details",-1))]),n[41]||(n[41]=a(" response for common exceptions.",-1))]),n[57]||(n[57]=c(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddExceptionHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GlobalExceptionHandler<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddProblemDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>You also need to call <code>UseExceptionHandler</code> to add the <code>ExceptionHandlerMiddleware</code> to the request pipeline:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="chaining-exception-handlers" tabindex="-1"><a class="header-anchor" href="#chaining-exception-handlers"><span>Chaining Exception Handlers</span></a></h2><p>You can add multiple <code>IExceptionHandler</code> implementations, and they&#39;re called in the order they are registered. A possible use case for this is using exceptions for flow control.</p><p>You can define custom exceptions like <code>BadRequestException</code> and <code>NotFoundException</code>. They correspond with the HTTP status code you would return from the API.</p><p>Here&#39;s a <code>BadRequestExceptionHandler</code> implementation:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">BadRequestExceptionHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IExceptionHandler</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>BadRequestExceptionHandler<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">BadRequestExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>BadRequestExceptionHandler<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">ValueTask<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">TryHandleAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">HttpContext</span> httpContext<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">Exception</span> exception<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token class-name">BadRequestException</span> badRequestException<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span></span>
<span class="line">            badRequestException<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;Exception occurred: {Message}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            badRequestException<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> problemDetails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProblemDetails</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Status <span class="token operator">=</span> StatusCodes<span class="token punctuation">.</span>Status400BadRequest<span class="token punctuation">,</span></span>
<span class="line">            Title <span class="token operator">=</span> <span class="token string">&quot;Bad Request&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            Detail <span class="token operator">=</span> badRequestException<span class="token punctuation">.</span>Message</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        httpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> problemDetails<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> httpContext<span class="token punctuation">.</span>Response</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">WriteAsJsonAsync</span><span class="token punctuation">(</span>problemDetails<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And here&#39;s a <code>NotFoundExceptionHandler</code> implementation:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">NotFoundExceptionHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IExceptionHandler</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>NotFoundExceptionHandler<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">NotFoundExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>NotFoundExceptionHandler<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">ValueTask<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">TryHandleAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">HttpContext</span> httpContext<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">Exception</span> exception<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token class-name">NotFoundException</span> notFoundException<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span></span>
<span class="line">            notFoundException<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;Exception occurred: {Message}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            notFoundException<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> problemDetails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProblemDetails</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Status <span class="token operator">=</span> StatusCodes<span class="token punctuation">.</span>Status404NotFound<span class="token punctuation">,</span></span>
<span class="line">            Title <span class="token operator">=</span> <span class="token string">&quot;Not Found&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            Detail <span class="token operator">=</span> notFoundException<span class="token punctuation">.</span>Message</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        httpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> problemDetails<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Value<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> httpContext<span class="token punctuation">.</span>Response</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">WriteAsJsonAsync</span><span class="token punctuation">(</span>problemDetails<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You also need to register both exception handlers by calling <code>AddExceptionHandler</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddExceptionHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BadRequestExceptionHandler<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddExceptionHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NotFoundExceptionHandler<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>BadRequestExceptionHandler</code> will execute first and try to handle the exception. If the exception isn&#39;t handled, <code>NotFoundExceptionHandler</code> will execute next and attempt to handle the exception.</p><hr><h2 id="takeaway" tabindex="-1"><a class="header-anchor" href="#takeaway"><span>Takeaway</span></a></h2><p>Using middleware for exception handling is an excellent solution in ASP.NET Core. However, it&#39;s great that we have new options using the <code>IExceptionHandler</code> interface. I will use the new approach in ASP.NET Core 8 projects.</p>`,17)),s("p",null,[n[43]||(n[43]=a("I'm very much against using exceptions for flow control. Exceptions are a last resort when you can't continue normal application execution. The ",-1)),e(p,{to:"/milanjovanovic.tech/functional-error-handling-in-dotnet-with-the-result-pattern.html"},{default:t(()=>[...n[42]||(n[42]=[s("strong",null,"Result pattern",-1)])]),_:1}),n[44]||(n[44]=a(" is a better alternative.",-1))]),s("p",null,[n[48]||(n[48]=a("Exceptions are also ",-1)),s("a",I,[n[45]||(n[45]=a("extremely expensive (",-1)),e(l,{icon:"iconfont icon-github"}),n[46]||(n[46]=s("code",null,"dotnet/aspnetcore",-1)),n[47]||(n[47]=a(")",-1))]),n[49]||(n[49]=a(", as David Fowler noted:",-1))]),n[58]||(n[58]=s("figure",null,[s("img",{src:"https://milanjovanovic.tech/blogs/mnw_066/fowler_comment.png?imwidth=3840",alt:"",tabindex:"0",loading:"lazy"}),s("figcaption")],-1)),s("p",null,[n[51]||(n[51]=a("If you want to get rid of exceptions in your code, ",-1)),s("a",P,[e(l,{icon:"fa-brands fa-youtube"}),n[50]||(n[50]=s("strong",null,"check out this video.",-1))])]),e(k,{src:"youtube/WCCkEe_Hy2Y"}),n[59]||(n[59]=s("p",null,"Thanks for reading, and stay awesome!",-1))])}const j=m(w,[["render",q]]),D=JSON.parse('{"path":"/milanjovanovic.tech/global-error-handling-in-aspnetcore-8.html","title":"Global Error Handling in ASP.NET Core 8","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Global Error Handling in ASP.NET Core 8","description":"Article(s) > Global Error Handling in ASP.NET Core 8","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Global Error Handling in ASP.NET Core 8\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_066/fowler_comment.png?imwidth=3840\\"],\\"datePublished\\":\\"2023-12-02T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/global-error-handling-in-aspnetcore-8.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Global Error Handling in ASP.NET Core 8"}],["meta",{"property":"og:description","content":"Article(s) > Global Error Handling in ASP.NET Core 8"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_066.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_066.png"}],["meta",{"name":"twitter:image:alt","content":"Global Error Handling in ASP.NET Core 8"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2023-12-02T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Global Error Handling in ASP.NET Core 8"},{"property":"og:description","content":"Global Error Handling in ASP.NET Core 8"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/global-error-handling-in-aspnetcore-8.html"}]],"prev":"/programming/cs/articles/README.md","date":"2023-12-02T00:00:00.000Z","isOriginal":false,"cover":"https://milanjovanovic.tech/blog-covers/mnw_066.png"},"git":{},"readingTime":{"minutes":4,"words":1200},"filePathRelative":"milanjovanovic.tech/global-error-handling-in-aspnetcore-8.md"}');export{j as comp,D as data};
