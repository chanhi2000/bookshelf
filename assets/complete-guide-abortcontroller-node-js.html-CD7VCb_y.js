import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,d as s,f as a,b as c,a as b,t as v,n as i,g as r,w as o,e,r as p,o as g}from"./app-BVguHYKu.js";const y="/bookshelf/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png",f={},w={id:"frontmatter-title-관련",tabindex:"-1"},A={class:"header-anchor",href:"#frontmatter-title-관련"},j={class:"table-of-contents"};function I(u,n){const l=p("VPCard"),t=p("router-link"),d=p("SiteInfo"),k=p("RouteLink");return g(),m("div",null,[s("h1",w,[s("a",A,[s("span",null,v(u.$frontmatter.title)+" 관련",1)])]),a(l,i(r({title:"Node.js > Article(s)",desc:"Article(s)",link:"/programming/js-node/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",j,[s("ul",null,[s("li",null,[a(t,{to:"#introduction"},{default:o(()=>n[0]||(n[0]=[e("Introduction")])),_:1,__:[0]})]),s("li",null,[a(t,{to:"#introduction-to-the-abortcontroller-api"},{default:o(()=>n[1]||(n[1]=[e("Introduction to the AbortController API")])),_:1,__:[1]})]),s("li",null,[a(t,{to:"#how-to-use-abortcontroller-in-node-js"},{default:o(()=>n[2]||(n[2]=[e("How to use AbortController in Node.js")])),_:1,__:[2]}),s("ul",null,[s("li",null,[a(t,{to:"#how-to-use-abortcontroller-with-the-fetch-api"},{default:o(()=>n[3]||(n[3]=[e("How to use AbortController with the Fetch API")])),_:1,__:[3]})]),s("li",null,[a(t,{to:"#how-to-use-abortcontroller-with-fs-readfile"},{default:o(()=>n[4]||(n[4]=[e("How to use AbortController with fs.readFile")])),_:1,__:[4]})])])]),s("li",null,[a(t,{to:"#introduction-to-abortsignal"},{default:o(()=>n[5]||(n[5]=[e("Introduction to AbortSignal")])),_:1,__:[5]})]),s("li",null,[a(t,{to:"#how-to-use-abortsignal-to-time-out-async-operations-in-node-js"},{default:o(()=>n[6]||(n[6]=[e("How to use AbortSignal to time out async operations in Node.js")])),_:1,__:[6]})]),s("li",null,[a(t,{to:"#how-to-implement-an-abortable-api-using-abortcontroller-and-abortsignal"},{default:o(()=>n[7]||(n[7]=[e("How to implement an abortable API using AbortController and AbortSignal")])),_:1,__:[7]})]),s("li",null,[a(t,{to:"#conclusion"},{default:o(()=>n[8]||(n[8]=[e("Conclusion")])),_:1,__:[8]})])])]),n[16]||(n[16]=s("hr",null,null,-1)),a(d,{name:"The complete guide to AbortController in Node.js",desc:"The AbortController API in Node.js is a wonderful new development - learn all about it in this comprehensive tutorial.",url:"https://blog.logrocket.com/complete-guide-abortcontroller-node-js",logo:"/assets/image/blog.logrocket.com/favicon.png",preview:"/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png"}),n[17]||(n[17]=c('<h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h2><p>JavaScript is a single-threaded programming language. Depending on the runtime environment, the JavaScript engine offloads asynchronous processes, such as making network requests, file system access, and other time-consuming jobs, to some APIs to achieve asynchrony.</p><figure><img src="'+y+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Ordinarily, we expect the result of an asynchronous operation to succeed or fail. However, the process can also take more time than anticipated, or you may no longer need the results when you receive them.</p><p>Therefore, it is logical to terminate an asynchronous operation that has taken more time than it should or whose result you don’t need. However, doing so natively in Node.js was a daunting challenge for a very long time.</p><p><code>AbortController</code> was introduced in Node v15.0.0 to address the above problem. It is for aborting certain asynchronous operations natively in Node. This tutorial will be a complete guide to the <code>AbortController</code> and <code>AbortSignal</code> APIs.</p><hr><h2 id="introduction-to-the-abortcontroller-api" tabindex="-1"><a class="header-anchor" href="#introduction-to-the-abortcontroller-api"><span>Introduction to the <code>AbortController</code> API</span></a></h2><p>As highlighted in the previous section, the <code>AbortController</code> API became part of Node in v15.0.0. It is a handy API for aborting some asynchronous processes, similar to the <code>AbortController</code> interface in the browser environment.</p><p>You need to create an instance of the <code>AbortController</code> class to use it:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>An instance of the <code>AbortController</code> class exposes the <code>abort</code> method and the <code>signal</code> property.</p><p>Invoking the <code>abort</code> method emits the <code>abort</code> event to notify the abortable API watching the controller about the cancellation. You can pass an optional reason for aborting to the <code>abort</code> method. If you don’t include a reason for the cancellation, it defaults to the <code>AbortError</code>.</p><p>To listen for the <code>abort</code> event, you need to add an event listener to the controller’s <code>signal</code> property using the <code>addEventListener</code> method so that you run some code in response to the <code>abort</code> event. An equivalent method for removing the event listener is the <code>removeEventListener</code> method.</p><p>The code below shows how to add and remove the <code>abort</code> event listener with the <code>addEventListener</code> and <code>removeEventListener</code> methods:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">abortEventListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>signal<span class="token punctuation">.</span>aborted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>signal<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> abortEventListener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">signal<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> abortEventListener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The controller’s <code>signal</code> has a <code>reason</code> property, which is the reason you pass to the <code>abort</code> method at cancellation. Its initial value is <code>undefined</code>. The value of the <code>reason</code> property changes to the reason you pass as an argument to the <code>abort</code> method or defaults to <code>AbortError</code> if you abort without providing a reason for the cancellation. Similarly, the signal’s <code>aborted</code> property with an initial value of <code>false</code> changes to <code>true</code> after aborting.</p><p>Unlike in the above example, practical use of the <code>AbortController</code> API involves passing the <code>signal</code> property to any cancelable asynchronous API. You can pass the same <code>signal</code> property to as many cancelable APIs. The APIs will then wait for the controller’s “signal” to abort the asynchronous operation when you invoke the <code>abort</code> method.</p><p>Most of the built-in cancellation-aware APIs implement the cancellation out of the box for you. You pass in the controller’s <code>signal</code> property to the API, and it aborts the process when you invoke the controller’s <code>abort</code> method.</p><p>However, to implement a custom cancelable promise-based functionality, you need to add an event listener which listens for the <code>abort</code> event and cancels the process from the event handler when the event is triggered.</p><hr><h2 id="how-to-use-abortcontroller-in-node-js" tabindex="-1"><a class="header-anchor" href="#how-to-use-abortcontroller-in-node-js"><span>How to use <code>AbortController</code> in Node.js</span></a></h2><p>As pointed out in the introduction, the <code>AbortController</code> API is a relatively new addition to Node. Therefore, a few asynchronous APIs support it at the moment. These APIs include the new Fetch API, timers, <code>fs.readFile</code>, <code>fs.writeFile</code>, <code>http.request</code>, and <code>https.request</code>.</p><p>We will learn how to use the AbortController API with some of the mentioned APIs. Because the APIs work withAbortController in a similar way, we shall only look at the Fetch and <code>fs.readFile</code> API.</p><h3 id="how-to-use-abortcontroller-with-the-fetch-api" tabindex="-1"><a class="header-anchor" href="#how-to-use-abortcontroller-with-the-fetch-api"><span>How to use <code>AbortController</code> with the Fetch API</span></a></h3>`,25)),s("p",null,[n[10]||(n[10]=e("Historically, ")),n[11]||(n[11]=s("code",null,"node-fetch",-1)),n[12]||(n[12]=e(" has been the de facto HTTP client for Node. With the introduction of ")),a(k,{to:"/blog.logrocket.com/fetch-api-node-js.html"},{default:o(()=>n[9]||(n[9]=[s("strong",null,"the Fetch API in Node.js",-1)])),_:1,__:[9]}),n[13]||(n[13]=e(", however, that is about to change. Though experimental at the time of writing, Fetch is one of the native APIs whose behavior you can control with the ")),n[14]||(n[14]=s("code",null,"AbortController",-1)),n[15]||(n[15]=e(" API."))]),n[18]||(n[18]=c(`<p>As explained above, you pass the <code>signal</code> property of the <code>AbortController</code> instance to any abortable, promise-based API like Fetch. The example below illustrates how you can use it with the <code>AbortController</code> API:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> signal <span class="token operator">=</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">fetchTodo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;AbortError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Operation timed out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">fetchTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The trivial example above illustrates how to use the <code>AbortController</code> API with the Fetch API in Node. However, in a real-world project, you don’t start an asynchronous operation and abort it immediately like in the code above.</p><p>It is also worth emphasizing that <code>fetch</code> is still an experimental feature in Node. Its features might change in future versions.</p><h3 id="how-to-use-abortcontroller-with-fs-readfile" tabindex="-1"><a class="header-anchor" href="#how-to-use-abortcontroller-with-fs-readfile"><span>How to use <code>AbortController</code> with <code>fs.readFile</code></span></a></h3><p>I n the previous section, we looked at using <code>AbortController</code> with the Fetch API. Similarly, you can use this API with the other cancelable APIs.</p><p>You can do this by passing the controller’s <code>signal</code> property to the API’s respective function. The code below shows how to use <code>AbortController</code> with <code>fs.readFile</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;node:fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;data.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal<span class="token punctuation">,</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;AbortError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Read file process aborted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Since the other cancelable APIs work similarly with <code>AbortController</code>, we won’t cover them here.</p><hr><h2 id="introduction-to-abortsignal" tabindex="-1"><a class="header-anchor" href="#introduction-to-abortsignal"><span>Introduction to <code>AbortSignal</code></span></a></h2><p>Each <code>AbortController</code> class instance has a corresponding <code>AbortSignal</code> class instance, accessible using the <code>signal</code> property. However, <code>AbortSignal</code> has functions such as the <code>AbortSignal.timeout</code> static method that you can also use independent of <code>AbortController</code>.</p><p>The <code>AbortSignal</code> class extends the <code>EventTarget</code> class and can receive the <code>abort</code> event. Therefore, you can use the <code>addEventListener</code> and <code>removeEventListener</code> methods to add and remove listeners for the <code>abort</code> event:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;First event handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Second event handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As in the above example, you can add as many event handlers as possible. Invoking the controller’s <code>abort</code> method will trigger all the event listeners. Removing the <code>abort</code> event listener after aborting the asynchronous process is standard practice to prevent memory leaks.</p><p>You can pass the optional third argument <code>{ once: true }</code> to <code>addEventListener</code> as we did above instead of using <code>removeEventListener</code> to remove the event listener. The optional third argument will ensure Node triggers the event listener once and remove it.</p><hr><h2 id="how-to-use-abortsignal-to-time-out-async-operations-in-node-js" tabindex="-1"><a class="header-anchor" href="#how-to-use-abortsignal-to-time-out-async-operations-in-node-js"><span>How to use <code>AbortSignal</code> to time out async operations in Node.js</span></a></h2><p>As mentioned above, in addition to using it with <code>AbortController</code>, the <code>AbortSignal</code> class has some handy methods you might need. One of these methods is the <code>AbortSignal.timeout</code> static method. As its name suggests, you can use it to abort cancelable asynchronous processes on timeout.</p><p>It takes the number of milliseconds as an argument and returns a signal you can use to timeout an abortable operation. The code below shows how you can implement it with the Fetch API:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> signal <span class="token operator">=</span> AbortSignal<span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">fetchTodo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;AbortError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Operation timed out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">fetchTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can use <code>AbortSignal.timeout</code> similarly with the other abortable APIs.</p><hr><h2 id="how-to-implement-an-abortable-api-using-abortcontroller-and-abortsignal" tabindex="-1"><a class="header-anchor" href="#how-to-implement-an-abortable-api-using-abortcontroller-and-abortsignal"><span>How to implement an abortable API using <code>AbortController</code> and <code>AbortSignal</code></span></a></h2><p>As highlighted in the previous section, several built-in asynchronous APIs have support for the <code>AbortController</code> API. However, you can also implement a custom abortable promise-based API that uses <code>AbortController</code>.</p><p>Like the built-in APIs, your API should take the <code>signal</code> property of an <code>AbortController</code> class instance as an argument as in the example below. It is standard practice for all APIs capable of using the <code>AbortController</code> API:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">myAbortableApi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token operator">?.</span>aborted <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>signal<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">abortEventListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Abort API from here</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> abortEventListener<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Run some asynchronous code</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token operator">?.</span>aborted <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>signal<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// Run more asynchronous code</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      signal<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> abortEventListener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the example above, we first checked whether the value of signal’s <code>aborted</code> property is <code>true</code>. If so, it means the controller’s <code>abort</code> method has been invoked. Therefore, we throw an error.</p><p>Like mentioned in the previous sections, you can register the <code>abort</code> event listener using the <code>addEventListener</code> method. To prevent memory leaks, we are passing the <code>{ once: true }</code> option as the third argument to the <code>addEventListener</code> method. It removes the event handler after handling the <code>abort</code> event.</p><p>Similarly, we removed the event listener using the <code>removeEventListener</code> in the <code>finally</code> block to prevent memory leaks. If you don’t remove it, and the <code>myAbortableApi</code> function runs successfully without aborting, the event listener you added will still be attached to the <code>signal</code> even after exiting the function.</p><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>Ordinarily, an asynchronous processes may succeed, fail, take longer than anticipated, or you may not need the results when you receive them. Therefore, it is logical to cancel an asynchronous operation that has taken more time than it should or whose results you don’t need. The <code>AbortController</code> API is a handy functionality for doing just that.</p><p>The <code>AbortController</code> API is globally available. Therefore, you don’t need to import it. An instance of the <code>AbortController</code> class exposes the <code>abort</code> method and the <code>signal</code> property. The <code>signal</code> property is an instance of the <code>AbortSignal</code> class. Each <code>AbortController</code> class instance has a corresponding AbortSignal class instance, which you can access using the controller’s <code>signal</code> property.</p><p>You pass the <code>signal</code> property to a cancelable asynchronous API and invoke the controller’s <code>abort</code> method to trigger the abort process. If the built-in APIs do not meet your use case, you can also implement a custom abortable API using <code>AbortController</code> and <code>AbortSignal</code>. However, follow the best practices hinted above to prevent memory leaks.</p><p>Did I miss anything? Leave a comment in the comments section below.</p>`,36)),b(" TODO: add ARTICLE CARD "),a(l,i(r({title:"The complete guide to AbortController in Node.js",desc:"The AbortController API in Node.js is a wonderful new development - learn all about it in this comprehensive tutorial.",link:"https://chanhi2000.github.io/bookshelf/blog.logrocket.com/complete-guide-abortcontroller-node-js.html",logo:"/assets/image/blog.logrocket.com/favicon.png",background:"rgba(112,76,182,0.2)"})),null,16)])}const T=h(f,[["render",I]]),q=JSON.parse('{"path":"/blog.logrocket.com/complete-guide-abortcontroller-node-js.html","title":"The complete guide to AbortController in Node.js","lang":"en-US","frontmatter":{"lang":"en-US","title":"The complete guide to AbortController in Node.js","description":"Article(s) > The complete guide to AbortController in Node.js","icon":"fa-brands fa-node","category":["Node.js","Article(s)"],"tag":["blog","blog.logrocket.com","node","nodejs","node-js"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"The complete guide to AbortController in Node.js\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png\\"],\\"datePublished\\":\\"2022-06-06T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Joseph Mawa\\",\\"url\\":\\"https://blog.logrocket.com/author/josephmawa/\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/blog.logrocket.com/complete-guide-abortcontroller-node-js.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"The complete guide to AbortController in Node.js"}],["meta",{"property":"og:description","content":"Article(s) > The complete guide to AbortController in Node.js"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://chanhi2000.github.io/bookshelf/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://chanhi2000.github.io/bookshelf/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png"}],["meta",{"name":"twitter:image:alt","content":"The complete guide to AbortController in Node.js"}],["meta",{"property":"article:author","content":"Joseph Mawa"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"blog.logrocket.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2022-06-06T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > The complete guide to AbortController in Node.js"},{"property":"og:description","content":"The complete guide to AbortController in Node.js"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/blog.logrocket.com/complete-guide-abortcontroller-node-js.html"}]],"prev":"/programming/js-node/articles/README.md","date":"2022-06-06T00:00:00.000Z","isOriginal":false,"author":[{"name":"Joseph Mawa","url":"https://blog.logrocket.com/author/josephmawa/"}],"cover":"/assets/image/blog.logrocket.com/complete-guide-abortcontroller-node-js/banner.png"},"git":{},"readingTime":{"minutes":6.44,"words":1933},"filePathRelative":"blog.logrocket.com/complete-guide-abortcontroller-node-js.md","copyright":{"author":"Joseph Mawa"}}');export{T as comp,q as data};
