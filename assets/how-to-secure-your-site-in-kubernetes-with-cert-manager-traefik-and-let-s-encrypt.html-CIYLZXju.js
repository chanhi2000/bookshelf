import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,d as n,f as t,b as o,a as f,t as g,n as y,g as h,w as r,e as s,r as l,o as b}from"./app-BVguHYKu.js";const k={},v={id:"frontmatter-title-관련",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-관련"},T={class:"table-of-contents"},S={class:"hint-container note"},N={href:"https://docs.digitalocean.com/products/kubernetes/quickstart",target:"_blank",rel:"noopener noreferrer"},x={href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux",target:"_blank",rel:"noopener noreferrer"},A={href:"https://docs.digitalocean.com/reference/doctl/how-to/install",target:"_blank",rel:"noopener noreferrer"},D={href:"https://helm.sh",target:"_blank",rel:"noopener noreferrer"},E={href:"https://helm.sh/docs/intro/install",target:"_blank",rel:"noopener noreferrer"},I={href:"https://docs.digitalocean.com/tutorials/build-deploy-first-image",target:"_blank",rel:"noopener noreferrer"},L={href:"https://www.namecheap.com",target:"_blank",rel:"noopener noreferrer"},C={href:"https://www.freenom.com/en/index.html?lang=en",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://docs.digitalocean.com/tutorials/dns-registrars",target:"_blank",rel:"noopener noreferrer"},P={href:"https://docs.digitalocean.com/reference/api/create-personal-access-token",target:"_blank",rel:"noopener noreferrer"},O={href:"https://en.wikipedia.org/wiki/Certificate_signing_request",target:"_blank",rel:"noopener noreferrer"},K={href:"https://en.wikipedia.org/wiki/Certificate_authority",target:"_blank",rel:"noopener noreferrer"},R={href:"https://letsencrypt.org",target:"_blank",rel:"noopener noreferrer"},H={href:"https://cert-manager.io",target:"_blank",rel:"noopener noreferrer"},M={href:"https://cert-manager.io/docs/installation",target:"_blank",rel:"noopener noreferrer"},q={href:"https://datatracker.ietf.org/doc/html/rfc8555",target:"_blank",rel:"noopener noreferrer"},j={href:"https://letsencrypt.org/docs/challenge-types",target:"_blank",rel:"noopener noreferrer"},F={href:"https://letsencrypt.org/docs/challenge-types/#dns-01-challenge",target:"_blank",rel:"noopener noreferrer"},U={href:"https://cert-manager.io/docs/concepts/issuer/",target:"_blank",rel:"noopener noreferrer"},V={class:"hint-container tip"},B={href:"https://cert-manager.io/docs/configuration/acme",target:"_blank",rel:"noopener noreferrer"},W={href:"https://docs.digitalocean.com/reference/api/create-personal-access-token/",target:"_blank",rel:"noopener noreferrer"},X={href:"https://en.wikipedia.org/wiki/Base64",target:"_blank",rel:"noopener noreferrer"},Z={id:"tutorial-cluster-config-ltutorial-cluster-config-lets-encrypt-do-dns-yaml",tabindex:"-1"},G={class:"header-anchor",href:"#tutorial-cluster-config-ltutorial-cluster-config-lets-encrypt-do-dns-yaml"},z={id:"tutorial-cluster-config-llets-encrypt-issuer-yaml",tabindex:"-1"},J={class:"header-anchor",href:"#tutorial-cluster-config-llets-encrypt-issuer-yaml"},Q={href:"https://cert-manager.io/docs/configuration/acme",target:"_blank",rel:"noopener noreferrer"},$={href:"https://cert-manager.io/docs/configuration/acme/dns01",target:"_blank",rel:"noopener noreferrer"},_={href:"https://en.wikipedia.org/wiki/Reverse_proxy",target:"_blank",rel:"noopener noreferrer"},ee={href:"https://traefik.io/traefik/",target:"_blank",rel:"noopener noreferrer"},ne={href:"https://en.wikipedia.org/wiki/Reverse_proxy",target:"_blank",rel:"noopener noreferrer"},se={href:"https://en.wikipedia.org/wiki/Load_balancing_(computing)",target:"_blank",rel:"noopener noreferrer"},te={href:"https://helm.sh/",target:"_blank",rel:"noopener noreferrer"},ae={href:"https://helm.sh/docs/topics/charts/",target:"_blank",rel:"noopener noreferrer"},oe={href:"https://linux.die.net/man/1/dig",target:"_blank",rel:"noopener noreferrer"},ie={href:"https://docs.digitalocean.com/tutorials/use-dig/",target:"_blank",rel:"noopener noreferrer"},re={href:"https://doc.traefik.io/traefik/",target:"_blank",rel:"noopener noreferrer"},le={href:"https://cert-manager.io/docs/",target:"_blank",rel:"noopener noreferrer"};function de(d,e){const u=l("VPCard"),i=l("router-link"),a=l("VPIcon"),p=l("SiteInfo");return b(),m("div",null,[n("h1",v,[n("a",w,[n("span",null,g(d.$frontmatter.title)+" 관련",1)])]),t(u,y(h({title:"Kubernetes > Article(s)",desc:"Article(s)",link:"/devops/k8s/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",T,[n("ul",null,[n("li",null,[t(i,{to:"#introduction"},{default:r(()=>e[0]||(e[0]=[s("Introduction")])),_:1,__:[0]})]),n("li",null,[t(i,{to:"#step-1-—-setting-up-cert-manager-in-your-cluster"},{default:r(()=>e[1]||(e[1]=[s("Step 1 — Setting Up cert-manager in Your Cluster")])),_:1,__:[1]})]),n("li",null,[t(i,{to:"#step-2-—-configuring-the-let-s-encrypt-certificate-issuer"},{default:r(()=>e[2]||(e[2]=[s("Step 2 — Configuring the Let’s Encrypt Certificate Issuer")])),_:1,__:[2]}),n("ul",null,[n("li",null,[t(i,{to:"#tutorial-cluster-config-ltutorial-cluster-config-lets-encrypt-do-dns-yaml"},{default:r(()=>[t(a,{icon:"iconfont icon-yaml"}),e[3]||(e[3]=s("tutorial-cluster-config/ltutorial-cluster-config/lets-encrypt-do-dns.yaml"))]),_:1,__:[3]})]),n("li",null,[t(i,{to:"#tutorial-cluster-config-llets-encrypt-issuer-yaml"},{default:r(()=>[t(a,{icon:"iconfont icon-yaml"}),e[4]||(e[4]=s("tutorial-cluster-config/llets-encrypt-issuer.yaml"))]),_:1,__:[4]})])])]),n("li",null,[t(i,{to:"#step-3-—-using-a-load-balancer-with-traefik"},{default:r(()=>e[5]||(e[5]=[s("Step 3 — Using a Load Balancer with Traefik")])),_:1,__:[5]})]),n("li",null,[t(i,{to:"#step-4-—-accessing-traefik-with-your-domain"},{default:r(()=>e[6]||(e[6]=[s("Step 4 — Accessing Traefik with Your Domain")])),_:1,__:[6]})]),n("li",null,[t(i,{to:"#step-5-—-creating-your-web-service"},{default:r(()=>e[7]||(e[7]=[s("Step 5 — Creating Your Web Service")])),_:1,__:[7]})]),n("li",null,[t(i,{to:"#step-6-—-making-your-web-service-available-and-secure"},{default:r(()=>e[8]||(e[8]=[s("Step 6 — Making Your Web Service Available and Secure")])),_:1,__:[8]})]),n("li",null,[t(i,{to:"#conclusion"},{default:r(()=>e[9]||(e[9]=[s("Conclusion")])),_:1,__:[9]})])])]),e[176]||(e[176]=n("hr",null,null,-1)),t(p,{name:"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt | DigitalOcean",desc:"Kubernetes is a popular way to host websites. As more websites interact with sensitive data, more browsers are requiring TLS to secure traffic. However, it c… ",url:"https://digitalocean.com/community/tutorials/how-to-secure-your-site-in-kubernetes-with-cert-manager-traefik-and-let-s-encrypt",logo:"https://digitalocean.com/_next/static/media/favicon.594d6067.ico",preview:"https://digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg"}),e[177]||(e[177]=o('<hr><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h2><p><a href="https://kubernetes.io" target="_blank" rel="noopener noreferrer">Kubernetes</a> is a popular way to host websites and other services that benefit from its reliability and scalability. As more websites interact with sensitive data, such as personal information or passwords, browsers are starting to require that all websites use <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener noreferrer">TLS</a> to secure their traffic. However, it can be difficult to manage all the moving parts required to host a TLS-based site, from acquiring TLS certificate to renewing those certificates on time and configuring your server to use them.</p><p>Fortunately, there are services you can run in your Kubernetes cluster to manage a lot of this complexity for you. You can use <a href="https://traefik.io/traefik" target="_blank" rel="noopener noreferrer">Traefik Proxy</a> (pronounced like “traffic”) as a network proxy with <a href="https://cert-manager.io" target="_blank" rel="noopener noreferrer">cert-manager</a> as the service that acquires and manages secure certificates. Using these services with <a href="https://letsencrypt.org" target="_blank" rel="noopener noreferrer">Let’s Encrypt</a>, a provider of free and automated secure certificates, reduces the burden of managing your certificates, typically to the point where you only need to do the initial setup.</p><p>In this tutorial, you will set up cert-manager, Traefik, and Let’s Encrypt in your Kubernetes cluster, along with an example website service, to acquire, renew, and use secure certificates with your website automatically.</p><p>If you’re looking for a managed Kubernetes hosting service, <a href="https://digitalocean.com/products/kubernetes" target="_blank" rel="noopener noreferrer">check out our simple, managed Kubernetes service built for growth.</a></p>',6)),n("div",S,[e[50]||(e[50]=n("p",{class:"hint-container-title"},"Prerequisites",-1)),n("ul",null,[n("li",null,[e[11]||(e[11]=s("A Kubernetes cluster accessible with ")),e[12]||(e[12]=n("code",null,"kubectl",-1)),e[13]||(e[13]=s(". If you need to create a cluster, DigitalOcean has a ")),n("a",N,[t(a,{icon:"fas fa-globe"}),e[10]||(e[10]=s("Kubernetes Quickstart"))]),e[14]||(e[14]=s("."))]),n("li",null,[e[18]||(e[18]=s("A recent version of ")),e[19]||(e[19]=n("code",null,"kubectl",-1)),e[20]||(e[20]=s(" for interacting with your cluster. See the product documentation for ")),n("a",x,[t(a,{icon:"fas fa-globe"}),e[15]||(e[15]=s("installing ")),e[16]||(e[16]=n("code",null,"kubectl",-1)),e[17]||(e[17]=s(" on Linux, MacOS, and Windows"))]),e[21]||(e[21]=s("."))]),n("li",null,[e[24]||(e[24]=s("A DigitalOcean account with doctl installed and configured. To set this up, see our product documentation for ")),n("a",A,[t(a,{icon:"fas fa-globe"}),e[22]||(e[22]=s("How To Install and Configure ")),e[23]||(e[23]=n("code",null,"doctl",-1))]),e[25]||(e[25]=s("."))]),n("li",null,[n("a",D,[t(a,{icon:"fas fa-globe"}),e[26]||(e[26]=s("Helm"))]),e[28]||(e[28]=s(" version 3 or greater. See the official documentation for ")),n("a",E,[t(a,{icon:"fas fa-globe"}),e[27]||(e[27]=s("installing Helm"))]),e[29]||(e[29]=s("."))]),n("li",null,[e[31]||(e[31]=s("Experience interacting with a Kubernetes cluster using ")),e[32]||(e[32]=n("code",null,"kubectl",-1)),e[33]||(e[33]=s(". To get started, follow our tutorial, ")),n("a",I,[t(a,{icon:"fas fa-globe"}),e[30]||(e[30]=s("Build and Deploy Your First Image to Your First Cluster"))]),e[34]||(e[34]=s("."))]),n("li",null,[e[37]||(e[37]=s("A registered domain name. This tutorial will use ")),e[38]||(e[38]=n("code",null,"your_domain",-1)),e[39]||(e[39]=s(". You can purchase a domain name from ")),n("a",L,[t(a,{icon:"fas fa-globe"}),e[35]||(e[35]=s("Namecheap"))]),e[40]||(e[40]=s(", get one for free with ")),n("a",C,[t(a,{icon:"fas fa-globe"}),e[36]||(e[36]=s("Freenom"))]),e[41]||(e[41]=s(", or use the domain registrar of your choice."))]),n("li",null,[e[43]||(e[43]=s("DNS set up for your domain name. This tutorial assumes you are using DigitalOcean DNS, but it is not a requirement. If you are using DigitalOcean, please see our ")),e[44]||(e[44]=n("a",{href:"https://docs.digitalocean.com/products/networking/dns/how-to/add-domains",target:"_blank",rel:"noopener noreferrer"},"DNS documentation",-1)),e[45]||(e[45]=s(" for details on how to add a domain and ")),n("a",Y,[t(a,{icon:"fas fa-globe"}),e[42]||(e[42]=s("How To Point to DigitalOcean Nameservers From Common Domain Registrars"))]),e[46]||(e[46]=s(" for information on using DigitalOcean DNS with common domain registrars."))]),n("li",null,[e[48]||(e[48]=s("A ")),n("a",P,[t(a,{icon:"fas fa-globe"}),e[47]||(e[47]=s("Personal Access Token"))]),e[49]||(e[49]=s(" with read and write access for DigitalOcean DNS, if you are using DigitalOcean for DNS. Other providers will have similar access tokens."))])])]),e[178]||(e[178]=n("hr",null,null,-1)),e[179]||(e[179]=n("h2",{id:"step-1-—-setting-up-cert-manager-in-your-cluster",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#step-1-—-setting-up-cert-manager-in-your-cluster"},[n("span",null,"Step 1 — Setting Up cert-manager in Your Cluster")])],-1)),n("p",null,[e[53]||(e[53]=s("Traditionally, when setting up secure certificates for a website, you would need to generate a ")),n("a",O,[t(a,{icon:"fa-brands fa-wikipedia-w"}),e[51]||(e[51]=s("certificate signing request"))]),e[54]||(e[54]=s(" and pay a trusted ")),n("a",K,[t(a,{icon:"fas fa-globe"}),e[52]||(e[52]=s("certificate authority"))]),e[55]||(e[55]=s(" to generate a certificate for you. You would then need to configure your web server to use that certificate and remember to go through that same process every year to keep your certificates up-to-date."))]),n("p",null,[e[58]||(e[58]=s("However, with the creation of ")),n("a",R,[t(a,{icon:"fas fa-globe"}),e[56]||(e[56]=s("Let’s Encrypt"))]),e[59]||(e[59]=s(" in 2014, it’s now possible to acquire free certificates through an automated process. These certificates are only valid for a few months instead of a year, though, so using an automated system to renew those certificates is a requirement. To handle that, you’ll use ")),n("a",H,[t(a,{icon:"fas fa-globe"}),e[57]||(e[57]=s("cert-manager"))]),e[60]||(e[60]=s(", a service designed to run in Kubernetes that automatically manages the lifecycle of your certificates."))]),e[180]||(e[180]=n("p",null,[s("In this section, you will set up "),n("code",null,"cert-manager"),s(" to run in your cluster in its own cert-manager namespace.")],-1)),n("p",null,[e[62]||(e[62]=s("First, ")),n("a",M,[t(a,{icon:"fas fa-globe"}),e[61]||(e[61]=s("install cert-manager"))]),e[63]||(e[63]=s(" using ")),e[64]||(e[64]=n("code",null,"kubectl",-1)),e[65]||(e[65]=s(" with cert-manager’s release file:"))]),e[181]||(e[181]=o(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.yaml</span>
<span class="line"><span class="token comment"># namespace/cert-manager created</span></span>
<span class="line"><span class="token comment"># customresourcedefinition.apiextensions.k8s.io/certificaterequests.cert-manager.io created</span></span>
<span class="line"><span class="token comment"># customresourcedefinition.apiextensions.k8s.io/certificates.cert-manager.io created</span></span>
<span class="line"><span class="token comment"># ...</span></span>
<span class="line"><span class="token comment"># deployment.apps/cert-manager-cainjector created</span></span>
<span class="line"><span class="token comment"># deployment.apps/cert-manager created</span></span>
<span class="line"><span class="token comment"># deployment.apps/cert-manager-webhook created</span></span>
<span class="line"><span class="token comment"># mutatingwebhookconfiguration.admissionregistration.k8s.io/cert-manager-webhook created</span></span>
<span class="line"><span class="token comment"># validatingwebhookconfiguration.admissionregistration.k8s.io/cert-manager-webhook created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By default, cert-manager will install in its own namespace named <code>cert-manager</code>. As the file is applied, a number of resources will be created in your cluster, which will appear in your output (some of the output is removed due to length):</p><p>In this section, you installed cert-manager to manage your secure certificates. Now, you need to set up a way to tell cert-manager how you want your certificates to be issued. In the next section, you’ll set up a Let’s Encrypt issuer in your cluster.</p><hr><h2 id="step-2-—-configuring-the-let-s-encrypt-certificate-issuer" tabindex="-1"><a class="header-anchor" href="#step-2-—-configuring-the-let-s-encrypt-certificate-issuer"><span>Step 2 — Configuring the Let’s Encrypt Certificate Issuer</span></a></h2>`,5)),n("p",null,[e[69]||(e[69]=s("Using a secure certificate for your website is a way to tell your users they can trust that the site they’re viewing came from your servers. To do this, the certificate authority must validate that you own the domain the certificate is for. Let’s Encrypt does this by using a standard called ")),n("a",q,[t(a,{icon:"fas fa-globe"}),e[66]||(e[66]=s("ACME"))]),e[70]||(e[70]=s(", which uses ")),n("a",j,[t(a,{icon:"fas fa-globe"}),e[67]||(e[67]=s("challenges"))]),e[71]||(e[71]=s(" to prove you own the domain you’re generating a certificate for. cert-manager supports both DNS and HTTP challenges for various providers, but in this tutorial, you’ll use the ")),n("a",F,[t(a,{icon:"fas fa-globe"}),e[68]||(e[68]=s("DNS-01"))]),e[72]||(e[72]=s(" challenge with DigitalOcean’s DNS provider."))]),n("p",null,[e[74]||(e[74]=s("In this section, you will create a ")),n("a",U,[t(a,{icon:"fas fa-globe"}),e[73]||(e[73]=n("code",null,"ClusterIssuer",-1))]),e[75]||(e[75]=s(" for your cluster to tell cert-manager how to issue certificates from Let’s Encrypt and which credentials to use to complete the DNS challenges required by Let’s Encrypt."))]),n("div",V,[e[79]||(e[79]=n("p",{class:"hint-container-title"},"Note",-1)),e[80]||(e[80]=n("p",null,[s("This tutorial assumes you are using DigitalOcean for your DNS provider and configures the "),n("code",null,"ClusterIssuer"),s(" with that assumption. cert-manager supports a number of different cloud providers for both HTTP and DNS challenges, so the same concepts can be applied to them.")],-1)),n("p",null,[e[77]||(e[77]=s("For more information about other providers supported by cert-manager, see the ")),n("a",B,[t(a,{icon:"fas fa-globe"}),e[76]||(e[76]=s("ACME Introduction"))]),e[78]||(e[78]=s(" in cert-manager’s documentation."))])]),e[182]||(e[182]=o(`<p>Before you create the <code>ClusterIssuer</code> for your cluster, you’ll want to create a directory for your cluster configuration. Use the <code>mkdir</code> command to create a directory and then <code>cd</code> to enter that directory:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> tutorial-cluster-config</span>
<span class="line"><span class="token builtin class-name">cd</span> tutorial-cluster-config</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,2)),n("p",null,[e[82]||(e[82]=s("Once you’ve created your directory, you’ll need the ")),n("a",W,[t(a,{icon:"fas fa-globe"}),e[81]||(e[81]=s("Personal Access Token"))]),e[83]||(e[83]=s(" for DNS access that you created as part of this tutorial’s prerequisites. A DigitalOcean access token will look similar to ")),e[84]||(e[84]=n("code",null,"dop_v1_4321...",-1)),e[85]||(e[85]=s(" with a long string of numbers."))]),f(" TODO code highlight to yellow "),n("p",null,[e[87]||(e[87]=s("To store your access token as a secret in Kubernetes, you’ll need to ")),n("a",X,[t(a,{icon:"fas fa-globe"}),e[86]||(e[86]=s("base-64"))]),e[88]||(e[88]=s(" encode it. To do this, you can use the echo command to pipe your token to the ")),e[89]||(e[89]=n("code",null,"base64",-1)),e[90]||(e[90]=s(" command, replacing the highlighted portion with your access token"))]),e[183]||(e[183]=o(`<p>This command will send your access token from <code>echo</code> to the <code>base64</code> command to encode it. The <code>-n</code> option ensures that a new line isn’t included at the end. Depending on your access token, you will receive output similar to the following:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&#39;dop_v1_4321...&#39;</span> <span class="token operator">|</span> base64</span>
<span class="line"><span class="token comment"># ZG9wX3YxX3RoaXNpc25vdGFyZWFsdG9rZW5idXRpbXB1dHRpbmdhYnVuY2hvZnN0dWZmaW5oZXJlc29sZW5ndGhzbWF0Y2g=</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>This output is your base-64 encoded access token. Copy this because you’ll be using it next.</p>`,3)),n("p",null,[e[91]||(e[91]=s("Using ")),e[92]||(e[92]=n("code",null,"nano",-1)),e[93]||(e[93]=s(" or your favorite editor, create and open a new file called ")),t(a,{icon:"iconfont icon-yaml"}),e[94]||(e[94]=n("code",null,"lets-encrypt-do-dns.yaml",-1)),e[95]||(e[95]=s(":"))]),n("h3",Z,[n("a",G,[n("span",null,[t(a,{icon:"iconfont icon-yaml"}),e[96]||(e[96]=n("code",null,"tutorial-cluster-config/ltutorial-cluster-config/lets-encrypt-do-dns.yaml",-1))])])]),e[184]||(e[184]=o(`<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager</span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> lets<span class="token punctuation">-</span>encrypt<span class="token punctuation">-</span>do<span class="token punctuation">-</span>dns</span>
<span class="line"><span class="token key atrule">data</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">access-token</span><span class="token punctuation">:</span> ZG9wX3Y<span class="token punctuation">...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This <code>Secret</code> will be called <code>lets-encrypt-do-dns</code> and is stored in the namespace <code>cert-manager</code>. In the <code>data</code> section, you include the base-64 encoded <code>access-token</code> you created earlier. This Secret securely stores the access token you will reference when creating the Let’s Encrypt issuer.</p><p>Next, save your file and apply it to the cluster using <code>kubectl apply</code>:</p><p>In the output, you’ll receive a message that your secret has been created in the cluster:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> lets-encrypt-do-dns.yaml</span>
<span class="line"><span class="token comment"># secret/lets-encrypt-do-dns created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,5)),n("p",null,[e[97]||(e[97]=s("Now, create a new file named ")),t(a,{icon:"iconfont icon-yaml"}),e[98]||(e[98]=n("code",null,"lets-encrypt-issuer.yaml",-1)),e[99]||(e[99]=s(" to contain cert-manager’s ")),e[100]||(e[100]=n("code",null,"ClusterIssuer",-1)),e[101]||(e[101]=s(", which you’ll use to issue your Let’s Encrypt certificates:"))]),e[185]||(e[185]=o(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">nano</span> lets-encrypt-issuer.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Add the following lines, entering your email address in the <code>spec.acme.email</code> field (this is the address Let’s Encrypt will associate with the certificates it provides):</p>`,2)),n("h3",z,[n("a",J,[n("span",null,[t(a,{icon:"iconfont icon-yaml"}),e[102]||(e[102]=n("code",null,"tutorial-cluster-config/llets-encrypt-issuer.yaml",-1))])])]),e[186]||(e[186]=o(`<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io/v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterIssuer</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> letsencrypt<span class="token punctuation">-</span>issuer</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">email</span><span class="token punctuation">:</span> your_email_address</span>
<span class="line">    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//acme<span class="token punctuation">-</span>v02.api.letsencrypt.org/directory</span>
<span class="line">    <span class="token key atrule">privateKeySecretRef</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> letsencrypt<span class="token punctuation">-</span>issuer<span class="token punctuation">-</span>account<span class="token punctuation">-</span>key</span>
<span class="line">    <span class="token key atrule">solvers</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token key atrule">dns01</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">digitalocean</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">tokenSecretRef</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">name</span><span class="token punctuation">:</span> lets<span class="token punctuation">-</span>encrypt<span class="token punctuation">-</span>do<span class="token punctuation">-</span>dns</span>
<span class="line">              <span class="token key atrule">key</span><span class="token punctuation">:</span> access<span class="token punctuation">-</span>token</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the first two lines, the <code>apiVersion</code> and <code>kind</code> say this Kubernetes resource is a cert-manager <code>ClusterIssuer</code>. Next, you name it <code>letsencrypt-issuer</code>. In this case, you didn’t include a <code>namespace</code> field because the resource is a <code>Cluster</code> resource, meaning it applies to the entire cluster instead of a single namespace.</p><p>Next, in the <code>spec</code> section, you define the acme challenge section to tell cert-manager this <code>ClusterIssuer</code> should use ACME to issue certificates using the <code>letsencrypt-issuer</code>. The <code>email</code> is your email address to which Let’s Encrypt will send any certificate-related communications, such as renewal reminders if there’s a problem and cert-manager doesn’t renew them in time. The <code>server</code> field specifies the URL to contact for requesting the ACME challenges and is set to the production Let’s Encrypt URL. After the <code>server</code> field, you include the <code>privateKeySecretRef</code> field with the name of the secret that cert-manager will use to store its generated private key for your cluster.</p>`,3)),n("p",null,[e[104]||(e[104]=s("One of the most important sections in the ")),e[105]||(e[105]=n("code",null,"spec.acme",-1)),e[106]||(e[106]=s(" section is the ")),e[107]||(e[107]=n("code",null,"solvers",-1)),e[108]||(e[108]=s(" section. In this section, you configure the ACME challenge solvers you want to use for the ")),e[109]||(e[109]=n("code",null,"letsencrypt-issuer",-1)),e[110]||(e[110]=s(". In this case, you include a single solver, the ")),e[111]||(e[111]=n("code",null,"dns01",-1)),e[112]||(e[112]=s(" solver. The first part of the solver configuration, the ")),e[113]||(e[113]=n("code",null,"selector",-1)),e[114]||(e[114]=s(", is configured to be ")),e[115]||(e[115]=n("code",null,"{}",-1)),e[116]||(e[116]=s(", which means “anything.” If you wanted to use different solvers for other certificates in your cluster, you could set up additional selectors in the same issuer. You can find more information about how to do this in cert-manager’s ")),n("a",Q,[t(a,{icon:"fas fa-globe"}),e[103]||(e[103]=s("ACME Introduction"))]),e[117]||(e[117]=s("."))]),n("p",null,[e[119]||(e[119]=s("Inside the ")),e[120]||(e[120]=n("code",null,"dns01",-1)),e[121]||(e[121]=s(" section, you add a ")),e[122]||(e[122]=n("code",null,"digitalocean",-1)),e[123]||(e[123]=s(" section to say this issuer should use DigitalOcean as the DNS-01 solver. If you are using a different cloud provider, this is where you would ")),n("a",$,[t(a,{icon:"fas fa-globe"}),e[118]||(e[118]=s("configure the other provider"))]),e[124]||(e[124]=s(". Inside this section, you include a ")),e[125]||(e[125]=n("code",null,"tokenSecretRef",-1)),e[126]||(e[126]=s(" to reference the ")),e[127]||(e[127]=n("code",null,"lets-encrypt-do-dns",-1)),e[128]||(e[128]=s()),e[129]||(e[129]=n("code",null,"access-token",-1)),e[130]||(e[130]=s(" field of the ")),e[131]||(e[131]=n("code",null,"Secret",-1)),e[132]||(e[132]=s(" you created earlier. cert-manager will use this access token when creating DNS records on your behalf."))]),e[187]||(e[187]=o(`<p>Once you’ve saved your issuer file, apply it to the cluster using <code>kubectl apply</code></p><p>The output will confirm that the <code>ClusterIssuer</code>, named <code>letsencrypt-issuer</code>, has been created:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> lets-encrypt-issuer.yaml</span>
<span class="line"><span class="token comment"># clusterissuer.cert-manager.io/letsencrypt-issuer created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),n("p",null,[e[134]||(e[134]=s("In this section, you set up cert-manager and configured it to issue certificates from Let’s Encrypt. However, no certificates are being requested, nothing is serving your website, and you don’t have a website service running in your cluster. In the next section, you’ll set up Traefik as the ")),n("a",_,[t(a,{icon:"fa-brands fa-wikipedia-w"}),e[133]||(e[133]=s("proxy"))]),e[135]||(e[135]=s(" between the outside world and your websites."))]),e[188]||(e[188]=n("hr",null,null,-1)),e[189]||(e[189]=n("h2",{id:"step-3-—-using-a-load-balancer-with-traefik",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#step-3-—-using-a-load-balancer-with-traefik"},[n("span",null,"Step 3 — Using a Load Balancer with Traefik")])],-1)),n("p",null,[n("a",ee,[t(a,{icon:"fas fa-globe"}),e[136]||(e[136]=s("Traefik"))]),e[139]||(e[139]=s(" is an open-source ")),n("a",ne,[t(a,{icon:"fa-brands fa-wikipedia-w"}),e[137]||(e[137]=s("proxy"))]),e[140]||(e[140]=s(" service designed to integrate with Kubernetes for website traffic and other network traffic coming in and out of your cluster. As your network traffic grows, you may want to increase the number of Traefik instances running in your cluster to spread out resource usage across different Kubernetes nodes. To use a single address to refer to multiple service instances like this, you can use a ")),n("a",se,[t(a,{icon:"fa-brands fa-wikipedia-w"}),e[138]||(e[138]=s("load balancer"))]),e[141]||(e[141]=s(" to accept the network connections and send them to the different Traefik instances, in effect balacing the network traffic load."))]),e[190]||(e[190]=n("p",null,"In this section, you’ll install Traefik into your cluster and prepare it to be used with the certificates managed by cert-manager and the website you’ll add in Step 5. You will also set up a load balancer, which will send incoming network traffic to your Traefik service from outside your cluster, as well as prepare you to handle multiple instance of Traefik, should you choose to run them.",-1)),n("p",null,[e[142]||(e[142]=s("First, create a namespace called ")),e[143]||(e[143]=n("code",null,"traefik",-1)),e[144]||(e[144]=s(" where you’ll install Traefik. To do this, open a file named ")),t(a,{icon:"iconfont icon-yaml"}),e[145]||(e[145]=n("code",null,"traefik-ns.yaml",-1)),e[146]||(e[146]=s(":"))]),e[191]||(e[191]=o(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">nano</span> traefik-ns.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Enter a Kubernetes <code>Namespace</code> resource:</p>`,2)),n("blockquote",null,[n("p",null,[e[147]||(e[147]=s(".")),t(a,{icon:"fas fa-folder-open"}),e[148]||(e[148]=n("code",null,"tutorial-cluster-config/",-1)),t(a,{icon:"iconfont icon-yaml"}),e[149]||(e[149]=n("code",null,"traefik-ns.yaml",-1))])]),e[192]||(e[192]=o(`<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> traefik</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After saving your file, apply it to your cluster using <code>kubectl apply</code>.</p><p>Once your command runs, the cluster’s output will confirm that the namespace has been created:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> traefik-ns.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># namespace/traefik created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4)),n("p",null,[e[152]||(e[152]=s("After creating the ")),e[153]||(e[153]=n("code",null,"traefik",-1)),e[154]||(e[154]=s(" namespace, you will install the Traefik service itself. For this, you’ll use a utility called ")),n("a",te,[t(a,{icon:"fas fa-globe"}),e[150]||(e[150]=s("Helm"))]),e[155]||(e[155]=s(". Helm is a package manager for Kubernetes that makes installing Kubernetes services similar to installing an app on your computer. In Helm, a package is called a ")),n("a",ae,[t(a,{icon:"fas fa-globe"}),e[151]||(e[151]=s("chart"))]),e[156]||(e[156]=s("."))]),e[193]||(e[193]=o(`<p>First, you’ll need to add the <code>traefik</code> Helm repository to your available repositories, which will allow Helm to find the <code>traefik</code> package.</p><p>Once the command completes, you’ll receive confirmation that the <code>traefik</code> repository has been added to your computer’s Helm repositories</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">helm repo <span class="token function">add</span> traefik https://helm.traefik.io/traefik</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># &quot;traefik&quot; has been added to your repositories</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, update your chart repositories.</p><p>The output will confirm that the traefik chart repository has been updated:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">helm repo update</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Hang tight while we grab the latest from your chart repositories...</span></span>
<span class="line"><span class="token comment"># ...Successfully got an update from the &quot;traefik&quot; chart repository</span></span>
<span class="line"><span class="token comment"># Update Complete. ⎈Happy Helming!⎈</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, install <code>traefik</code> into the <code>traefik</code> namespace you created in your cluster.</p><p>Once you run the command, output similar to the following will print to the screen:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">helm <span class="token function">install</span> <span class="token parameter variable">--namespace</span><span class="token operator">=</span>traefik traefik traefik/traefik</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME: traefik</span></span>
<span class="line"><span class="token comment"># LAST DEPLOYED: Sun Oct  2 16:32:57 2022</span></span>
<span class="line"><span class="token comment"># NAMESPACE: traefik</span></span>
<span class="line"><span class="token comment"># STATUS: deployed</span></span>
<span class="line"><span class="token comment"># REVISION: 1</span></span>
<span class="line"><span class="token comment"># TEST SUITE: None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are a lot of <code>traefik</code>s in this command, so let’s go over what each one does. The first <code>traefik</code> in your command, with <code>--namespace=traefik</code>, tells Helm to install Traefik in the <code>traefik</code> namespace you created earlier. Next, the highlighted <code>traefik</code> is the name you want to give to this installation of Traefik in your cluster. This way, if you have multiple installations of Traefik in the same cluster, you can give them different names, such as <code>traefik-website1</code> and <code>traefik-website2</code>. Since you’ll only have one Traefik installation in your cluster right now, you can just use the name <code>traefik</code>. The third <code>traefik/</code> is the repository you added earlier and want to install from. Finally, the last <code>traefik</code> is the name of the chart you want to install.</p><p>Once the Helm chart is installed, Traefik will begin downloading on your cluster. To see whether Traefik is up and running, run <code>kubectl get all</code> to see all the Traefik resources created in the <code>traefik</code> namespace.</p><p>Your output will appear similar to the output below:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl get <span class="token parameter variable">-n</span> traefik all</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME                           READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span class="token comment"># pod/traefik-858bb8459f-k4ztp   1/1     Running   0          94s</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># NAME              TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE</span></span>
<span class="line"><span class="token comment"># service/traefik   LoadBalancer   10.245.77.251   &lt;pending&gt;     80:31981/TCP,443:30188/TCP   94s</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># NAME                      READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span class="token comment"># deployment.apps/traefik   1/1     1            1           94s</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># NAME                                 DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span class="token comment"># replicaset.apps/traefik-858bb8459f   1         1         1       94s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Depending on your cluster and when you ran the previous command, some of the names and ages may be different. If you see <code>&lt;pending&gt;</code> under <code>EXTERNAL-IP</code> for your <code>service/traefik</code>, keep running the <code>kubectl get -n traefik all</code> command until an IP address is listed. The <code>EXTERNAL-IP</code> is the IP address the load balancer is available from on the internet. Once an IP address is listed, make note of that IP address as your <code>traefik_ip_address</code>. You’ll use this address in the next section to set up your domain.</p><p>In this section, you installed Traefik into your cluster and have an <code>EXTERNAL-IP</code> you can direct your website traffic to. In the next section, you’ll make the changes to your DNS to send traffic from your domain to the load balancer.</p><hr><h2 id="step-4-—-accessing-traefik-with-your-domain" tabindex="-1"><a class="header-anchor" href="#step-4-—-accessing-traefik-with-your-domain"><span>Step 4 — Accessing Traefik with Your Domain</span></a></h2><p>Now that you have Traefik set up in your cluster and accessible on the internet with a load balancer, you’ll need to update your domain’s DNS to point to your Traefik load balancer. Before you continue, be sure your domain is <a href="https://docs.digitalocean.com/products/networking/dns/how-to/add-domains/" target="_blank" rel="noopener noreferrer">added to your DigitalOcean account</a>. cert-manager will need to be able to update DNS settings for your domain using the access token you set up earlier. You’ll use doctl to set up your domain’s DNS records to point to Traefik’s load balancer.</p><div class="hint-container tip"><p class="hint-container-title">Note</p><p>This section assumes you’re using DigitalOcean as your DNS host. If you’re using a DNS host other than DigitalOcean, you’ll still create the same DNS record types with the same values, but you’ll need to refer to your DNS host’s documentation for how to add them.</p></div><p>First, create a DNS A record for your domain named <code>tutorial-proxy.your_domain</code> that points to your <code>traefik_ip_address</code>.</p><p>After running the command, you’ll receive confirmation that your record has been created:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">doctl compute domain records create your_domain --record-name tutorial-proxy --record-type A --record-data traefik_ip_address</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># ID           Type    Name              Data                  Priority    Port    TTL     Weight</span></span>
<span class="line"><span class="token comment"># 12345678     A       tutorial-proxy    traefik_ip_address    0           0       1800    0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A DNS <code>A</code> record tells the DNS to point a given hostname to a specific IP address. In this case, tutorial-proxy.<code>your_domain</code> will point to <code>traefik_ip_address</code>. So, if someone requests the website at tutorial-proxy.<code>your_domain</code>, the DNS servers will direct them to <code>traefik_ip_address</code>.</p><p>Now, create a <code>CNAME</code>-type DNS record named <code>tutorial-service.your_domain</code> and direct it to tutorial-proxy.<code>your_domain</code>. Since you’ll likely have several services running in your cluster at some point, using an A record to point each domain to your Traefik proxy could be a lot of work if you ever need to change your proxy’s IP address. Using a <code>CNAME</code> tells DNS to use the address of the domain it’s pointing to. In this case, the domain is <code>tutorial-proxy.your_domain</code>, so you only need to update your one A record to point to a new IP address instead of multiple A records.</p><p>To create the <code>CNAME</code> record, use the <code>doctl</code> command again. Be sure to include the trailing period (<code>.</code>) in <code>--record-data</code>.</p><p>After running the command, you will see output similar to the following:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">doctl compute domain records create your_domain <span class="token punctuation">\\</span></span>
<span class="line">  --record-name tutorial-service <span class="token punctuation">\\</span></span>
<span class="line">  --record-type CNAME <span class="token punctuation">\\</span></span>
<span class="line">  --record-data tutorial-proxy.your_domain</span>
<span class="line"></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># ID           Type     Name                Data                          Priority    Port    TTL     Weight</span></span>
<span class="line"><span class="token comment"># 12345679     CNAME    tutorial-service    tutorial-proxy.your_domain    0           0       1800    0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will create your <code>tutorial-service.your_domain</code> CNAME DNS record pointing to tutorial-proxy.<code>your_domain</code>. Now, when someone requests <code>tutorial-service.your_domain</code>, the DNS server will tell them to connect to the IP address <code>tutorial-proxy.your_domain</code> is pointing to. The trailing <code>.</code> in the <code>--record-data</code> tells the DNS server that it’s the end of the domain being provided and it shouldn’t append any other information on the end, similar to how a period (<code>.</code>) is used to end a sentence.</p><p>Since DigitalOcean is your primary DNS server, you can query the server directly to determine whether it’s set up correctly instead of waiting for other DNS servers on the internet to be updated. To verify your settings are coming through the DNS servers correctly, use the <code>dig</code> command to view what <code>ns1.digitalocean.com</code>, DigitalOcean’s primary DNS server, thinks the records should be:</p><div class="hint-container tip"><p class="hint-container-title">Note</p><p>If you are using a DNS host other than DigitalOcean, replace <code>ns1.digitalocean.com</code> in this command with one of the DNS servers your DNS host had you set up on your domain.</p></div>`,30)),n("p",null,[n("a",oe,[t(a,{icon:"fas fa-globe"}),e[157]||(e[157]=n("code",null,"dig",-1))]),e[159]||(e[159]=s(" is a utility that connects directly to DNS servers to “dig” into the DNS records to find the one you’re looking for. In this case, you provide ")),e[160]||(e[160]=n("code",null,"@ns1.digitalocean.com",-1)),e[161]||(e[161]=s(" to tell ")),e[162]||(e[162]=n("code",null,"dig",-1)),e[163]||(e[163]=s(" you want to query the ns1.digitalocean.com server for its DNS records. The ")),e[164]||(e[164]=n("code",null,"+noall +answer",-1)),e[165]||(e[165]=s(" options tell ")),e[166]||(e[166]=n("code",null,"dig",-1)),e[167]||(e[167]=s(" to only output a shorter response. (You can remove these two options if you want more information about the DNS query.) For more about ")),e[168]||(e[168]=n("code",null,"dig",-1)),e[169]||(e[169]=s(", check out our guide to ")),n("a",ie,[t(a,{icon:"fas fa-globe"}),e[158]||(e[158]=s("Retrieve DNS Information Using Dig"))]),e[170]||(e[170]=s("."))]),e[194]||(e[194]=o(`<p>Next, using <code>+domain=your_domain</code> tells <code>dig</code> to add <code>.your_domain</code> to the end of any hostnames provided to the command. Finally, <code>tutorial-proxy</code> and <code>tutorial-service</code> are the hostnames to look up. Since you’re using the <code>+domain</code> option, you don’t need to use the full phrase <code>tutorial-proxy.your_domain</code>, as it will automatically be added on the end.</p><p>You should receive output similar to the following, with your own values for <code>your_domain</code> and <code>traefik_ip_address</code>:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">dig</span> @ns1.digitalocean.com +noall +answer +domain<span class="token operator">=</span>your_domain tutorial-proxy tutorial-service</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># tutorial-proxy.your_domain.	1662	IN	A	traefik_ip_address</span></span>
<span class="line"><span class="token comment"># tutorial-service.your_domain. 1800	IN	CNAME	tutorial-proxy.your_domain.</span></span>
<span class="line"><span class="token comment"># tutorial-proxy.your_domain.	1800	IN	A	traefik_ip_address</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The first line of the output shows that <code>tutorial-proxy.your_domain</code> is an <code>A</code> (<code>IN A</code>) record that points to <code>traefik_ip_address</code>. The second confirms that <code>tutorial-service.your_domain</code> is a <code>CNAME</code> (<code>IN CNAME</code>) record that points to <code>tutorial-proxy.your_domain</code>. Finally, the last line is the query <code>dig</code> runs to find the address your <code>CNAME</code> record points to. Since it’s <code>tutorial-proxy.your_domain</code>, it will show the same <code>A</code> record IP address as before.</p><p>In this section, you added an <code>A</code>-type DNS record and a <code>CNAME</code>-type DNS record to your domain so that network clients, such as browsers, know where to go to connect to your Traefik service. In the next section, you’ll set up a temporary web server in your cluster to complete your configuration.</p><hr><h2 id="step-5-—-creating-your-web-service" tabindex="-1"><a class="header-anchor" href="#step-5-—-creating-your-web-service"><span>Step 5 — Creating Your Web Service</span></a></h2><hr><h2 id="step-6-—-making-your-web-service-available-and-secure" tabindex="-1"><a class="header-anchor" href="#step-6-—-making-your-web-service-available-and-secure"><span>Step 6 — Making Your Web Service Available and Secure</span></a></h2><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>In this tutorial, you installed a few different services in your Kubernetes cluster to make it easier to run a website with secure certificates. You installed the cert-manager service to handle the lifecycle of TLS certificates issued from Let’s Encrypt. You installed Traefik to make your websites available outside your cluster and to use the TLS certificates issued by Let’s Encrypt. Lastly, you created an Nginx website in your cluster to test your cert-manager and Traefik configurations.</p><p>Now that you have cert-manager and Traefik configured in your cluster, you could also set up more websites with different <code>Ingress</code> resources to serve many websites from the same cluster with a single cert-manager and Traefik installation.</p>`,13)),n("p",null,[e[173]||(e[173]=s("You can read the ")),n("a",re,[t(a,{icon:"fas fa-globe"}),e[171]||(e[171]=s("Traefik Proxy documentation"))]),e[174]||(e[174]=s(" for more about the different functionalities Traefik can provide in your cluster. ")),n("a",le,[t(a,{icon:"fas fa-globe"}),e[172]||(e[172]=s("cert-manager"))]),e[175]||(e[175]=s(" also has extensive documentation on how to use it with other types of Let’s Encrypt challenges, as well as sources other than Let’s Encrypt."))]),e[195]||(e[195]=n("p",null,[s("To continue configuring your Kubernetes cluster, check out our other "),n("a",{href:"https://digitalocean.com/community/tags/kubernetes",target:"_blank",rel:"noopener noreferrer"},"tutorials on Kubernetes"),s(".")],-1))])}const ce=c(k,[["render",de]]),me=JSON.parse('{"path":"/digitalocean.com/how-to-secure-your-site-in-kubernetes-with-cert-manager-traefik-and-let-s-encrypt.html","title":"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt","description":"Article(s) > How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt","icon":"iconfont icon-k8s","category":["DevOps","VM","Kubernetes","Article(s)"],"tag":["blog","digitalocean.com","kubernetes","k8s","kubctl","serverless"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt\\",\\"image\\":[\\"https://digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg\\"],\\"datePublished\\":\\"2022-11-18T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/digitalocean.com/how-to-secure-your-site-in-kubernetes-with-cert-manager-traefik-and-let-s-encrypt.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt"}],["meta",{"property":"og:description","content":"Article(s) > How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg"}],["meta",{"name":"twitter:image:alt","content":"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt"}],["meta",{"property":"article:tag","content":"serverless"}],["meta",{"property":"article:tag","content":"kubctl"}],["meta",{"property":"article:tag","content":"k8s"}],["meta",{"property":"article:tag","content":"kubernetes"}],["meta",{"property":"article:tag","content":"digitalocean.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2022-11-18T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt"},{"property":"og:description","content":"How To Secure Your Site in Kubernetes with cert-manager, Traefik, and Let’s Encrypt"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/digitalocean.com/how-to-secure-your-site-in-kubernetes-with-cert-manager-traefik-and-let-s-encrypt.html"}]],"prev":"/devops/k8s/articles/README.md","date":"2022-11-18T00:00:00.000Z","isOriginal":false,"cover":"https://digitalocean.com/_next/static/media/intro-to-cloud.d49bc5f7.jpeg"},"git":{},"readingTime":{"minutes":14.64,"words":4392},"filePathRelative":"digitalocean.com/how-to-secure-your-site-in-kubernetes-with-cert-manager-traefik-and-let-s-encrypt.md"}');export{ce as comp,me as data};
