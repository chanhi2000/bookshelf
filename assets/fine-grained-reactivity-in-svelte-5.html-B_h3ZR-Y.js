import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as v,d as s,f as t,b as r,a as h,t as b,n as i,g as l,w as e,e as a,r as u,o as y}from"./app-BVguHYKu.js";const f={},w={id:"frontmatter-title-관련",tabindex:"-1"},q={class:"header-anchor",href:"#frontmatter-title-관련"},j={class:"table-of-contents"},S={class:"hint-container info"},x={href:"https://kit.svelte.dev/docs/creating-a-project",target:"_blank",rel:"noopener noreferrer"},T={href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener noreferrer"},A={href:"https://css-tricks.com/typescript-discriminated-unions/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_properties",target:"_blank",rel:"noopener noreferrer"},C={href:"https://mobx.js.org/observable-state.html#available-annotations",target:"_blank",rel:"noopener noreferrer"},I={class:"hint-container info"};function W(k,n){const o=u("VPCard"),p=u("router-link"),g=u("SiteInfo"),d=u("RouteLink"),c=u("VPIcon");return y(),v("div",null,[s("h1",w,[s("a",q,[s("span",null,b(k.$frontmatter.title)+" 관련",1)])]),t(o,i(l({title:"Svelte.js > Article(s)",desc:"Article(s)",link:"/programming/js-svelte/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",j,[s("ul",null,[s("li",null,[t(p,{to:"#what-is-fine-grained-reactivity"},{default:e(()=>n[0]||(n[0]=[a("What is fine-grained reactivity?")])),_:1,__:[0]})]),s("li",null,[t(p,{to:"#premature-optimization-is-still-bad"},{default:e(()=>n[1]||(n[1]=[a("Premature optimization is still bad")])),_:1,__:[1]})]),s("li",null,[t(p,{to:"#getting-started"},{default:e(()=>n[2]||(n[2]=[a("Getting started")])),_:1,__:[2]})]),s("li",null,[t(p,{to:"#svelte-4"},{default:e(()=>n[3]||(n[3]=[a("Svelte 4")])),_:1,__:[3]})]),s("li",null,[t(p,{to:"#svelte-5"},{default:e(()=>n[4]||(n[4]=[a("Svelte 5")])),_:1,__:[4]}),s("ul",null,[s("li",null,[t(p,{to:"#why-did-this-happen"},{default:e(()=>n[5]||(n[5]=[a("Why did this happen?")])),_:1,__:[5]})])])]),s("li",null,[t(p,{to:"#false-coda"},{default:e(()=>n[6]||(n[6]=[a("False Coda")])),_:1,__:[6]})]),s("li",null,[t(p,{to:"#rediscovering-a-long-lost-javascript-feature"},{default:e(()=>n[7]||(n[7]=[a("Rediscovering a long-lost JavaScript feature")])),_:1,__:[7]})]),s("li",null,[t(p,{to:"#fine-grained-reactivity-in-svelte-5"},{default:e(()=>n[8]||(n[8]=[a("Fine-grained reactivity in Svelte 5")])),_:1,__:[8]})]),s("li",null,[t(p,{to:"#going-deeper"},{default:e(()=>n[9]||(n[9]=[a("Going deeper")])),_:1,__:[9]}),s("ul",null,[s("li",null,[t(p,{to:"#implementing-our-own-state-shallow-equivalent"},{default:e(()=>n[10]||(n[10]=[a("Implementing our own $state.shallow() equivalent")])),_:1,__:[10]})]),s("li",null,[t(p,{to:"#editing-tasks-this-way"},{default:e(()=>n[11]||(n[11]=[a("Editing tasks this way")])),_:1,__:[11]})]),s("li",null,[t(p,{to:"#tasks-array"},{default:e(()=>n[12]||(n[12]=[a("tasks array")])),_:1,__:[12]})])])]),s("li",null,[t(p,{to:"#sveltekit"},{default:e(()=>n[13]||(n[13]=[a("SvelteKit")])),_:1,__:[13]})]),s("li",null,[t(p,{to:"#wrapping-up"},{default:e(()=>n[14]||(n[14]=[a("Wrapping up")])),_:1,__:[14]})])])]),n[56]||(n[56]=s("hr",null,null,-1)),t(g,{name:"Fine-Grained Reactivity in Svelte 5",desc:"Svelte is already quite lightweight and fast, but Svelte 5 still overs big improvements in fine-grained reactivity, meaning re-rendering as absolutely little as possible. ",url:"https://frontendmasters.com/blog/fine-grained-reactivity-in-svelte-5",logo:"https://frontendmasters.com/favicon.ico",preview:"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/3438"}),n[57]||(n[57]=s("p",null,"We’ve been looking at the up and coming Svelte 5. We looked at basic features like state, props, and side effects. Then we looked at Snippets, which is a lightweight feature Svelte added for re-using bits of HTML within (for now) a single component.",-1)),s("div",S,[n[15]||(n[15]=s("p",{class:"hint-container-title"},"Article Series",-1)),t(o,i(l({title:"Introducing Svelte 5",desc:"Svelte 5 introduces significant improvements in reactivity, state management, and prop handling, maintaining its user-friendly Developer Experience (DX). ",link:"/frontendmasters.com/introducing-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16),t(o,i(l({title:"Snippets in Svelte 5",desc:"Out with slots, in with snippets.",link:"/frontendmasters.com/snippets-in-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16),t(o,i(l({title:"Fine-Grained Reactivity in Svelte 5",desc:"Svelte is already quite lightweight and fast, but Svelte 5 still overs big improvements in fine-grained reactivity, meaning re-rendering as absolutely little as possible. ",link:"/frontendmasters.com/fine-grained-reactivity-in-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16)]),n[58]||(n[58]=s("p",null,"In this post, we’ll take a close look at Svelte’s new fine-grained reactivity.",-1)),n[59]||(n[59]=s("hr",null,null,-1)),n[60]||(n[60]=s("h2",{id:"what-is-fine-grained-reactivity",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#what-is-fine-grained-reactivity"},[s("span",null,"What is fine-grained reactivity?")])],-1)),n[61]||(n[61]=s("p",null,[a("The best way to describe fine-grained reactivity is to show what it isn’t, and the best example of non-fine grained reactivity is React. In React, in "),s("em",null,"any"),a(" component, setting a single piece of state will cause the entire component, and all of the descendent components to re-render (unless they’re created with "),s("code",null,"React.memo"),a("). Even if the state you’re setting is rendered in a single, simple "),s("code",null,"<span>"),a(" tag in the component, and not used anywhere else at all, the entire world from that component on down will be re-rendered.")],-1)),s("p",null,[n[17]||(n[17]=a("This may seem absurdly wasteful, but in reality this is a consequence of the design features that made React popular when it was new: the data, values, callbacks, etc., that we pass through our component trees are all plain JavaScript. We pass plain, vanilla JavaScript objects, arrays and functions around our components and everything just works. At the time, this made an incredibly compelling case for React compared to alternatives like Angular 1 and Knockout. But since then, alternatives like Svelte have closed the gap. My")),t(d,{to:"/frontendmasters.com/introducing-svelte-5.html"},{default:e(()=>n[16]||(n[16]=[a("first post")])),_:1,__:[16]}),n[18]||(n[18]=a("on Svelte 5 showed just how simple, flexible, and most importantly ")),n[19]||(n[19]=s("em",null,"reliable",-1)),n[20]||(n[20]=a(" Svlete’s new state management primitives are. This post will show you the performance wins these primitives buy us."))]),n[62]||(n[62]=r('<hr><h2 id="premature-optimization-is-still-bad" tabindex="-1"><a class="header-anchor" href="#premature-optimization-is-still-bad"><span>Premature optimization is still bad</span></a></h2><p>This post will walk through some Svelte templates using trickery to snoop on just how much of a component is being re-rendered when we change state. This is<strong>not</strong>something you will usually do or care about. As always, write clear, understandable code, then optimize when needed (not before). Svelte 4 is considerably less efficient than Svelte 5, but still much more performant than what React does out of the box. And React is more than fast enough for the overwhelming majority of use cases —so it’s all relative.</p><p>Being <em>fast enough</em> doesn’t mean we can’t still look at how much of a better performance baseline Svelte now starts you off at. With a fast-growing ecosystem, and now an incredibly compelling performance story, hopefully this post will encourage you to at least look at Svelte for your next project.</p><p>If you’d like to try out the code we’ll be looking at in this post, it’s all in<a href="https://github.com/arackaf/svelte-fine-grained-reactivity" target="_blank" rel="noopener noreferrer">this repo</a>.</p><hr><h2 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started"><span>Getting started</span></a></h2>',7)),s("p",null,[n[22]||(n[22]=a("The code we’ll be looking at is from a ")),s("a",x,[t(c,{icon:"iconfont icon-svelte"}),n[21]||(n[21]=a("SvelteKit scaffolded project"))]),n[23]||(n[23]=a(". If you’ve never used Svelte")),n[24]||(n[24]=s("em",null,"Kit",-1)),n[25]||(n[25]=a("before that’s totally fine. We’re not really using any SvelteKit features until the very end of this post, and even then it’s just re-hashing what we’ll have already covered."))]),n[63]||(n[63]=r(`<p>Throughout this post, we’re going to be inspecting if and when individual bindings in a component are re-evaluated when we change state. There’s various ways to do this, but the simplest, and frankly <em>dumbest</em>, is to force some global, non-reactive, always-changing state into these bindings. What do I mean by that? In the root page that hosts our site, I’m adding this:</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">  <span class="token keyword">var</span> __i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> <span class="token function-variable function">getCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> __i<span class="token operator">++</span><span class="token punctuation">;</span> </span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This adds a global<code>getCounter</code>function, as well as the<code>__i</code>variable.<code>getCounter</code>will always return the next value, and if we stick a call to it in our bindings, we’ll be able to snoop on when those bindings are being re-executed by Svelte. If you’re using TypeScript, you can avoid errors when calling this like so:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">declare</span> global <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">interface</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This post will look at different pages binding to the same data, declared mostly like this (we’ll note differences as we go).</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task B&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Medium&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task C&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task D&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Mike&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Medium&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task E&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task F&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task G&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Steve&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task H&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task I&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task J&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task K&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Medium&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And we’ll render these tasks with this markup:</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  {#each tasks as t}</span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{t.id + getCounter()}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        &lt;button onclick={() =&gt; (t.id += 10)} class=&quot;border p-2&quot;&gt;Update id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{t.title + getCounter()}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">       &lt;button onclick={() =&gt; (t.title += &#39;X&#39;)} class=&quot;border p-2&quot;&gt;Update title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{t.assigned + getCounter()}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        &lt;button onclick={() =&gt; (t.assigned += &#39;X&#39;)} class=&quot;border p-2&quot;&gt;Update assigned<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{t.importance + getCounter()}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        &lt;button onclick={() =&gt; (t.importance += &#39;X&#39;)} class=&quot;border p-2&quot;&gt;Update importance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  {/each}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The Svelte 4 code we’ll start with uses the<code>on:click</code>syntax for events, but everything else will be the same.</p><p>The calls to<code>getCounter</code> inside the bindings will let us see when those bindings are re-executed, since the call to<code>getCounter()</code>will always return a new value.</p><p>Let’s get started!</p><hr><h2 id="svelte-4" tabindex="-1"><a class="header-anchor" href="#svelte-4"><span>Svelte 4</span></a></h2><p>We’ll render the content we saw above, using Svelte 4.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte4.png?resize=1024%2C399&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Plain and simple. But now let’s click any of those buttons, to modify one property, of one of those tasks—it doesn’t matter which.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte4-updated.png?resize=1024%2C387&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Notice that the entire component (every binding in the component) re-rendered. As inefficient as this seems, it’s<em>still</em>much better than what React does. It’s not remotely uncommon for a single state update to trigger<em>multiple</em>re-renders of<em>many</em>components.</p><p>Let’s see how Svelte 5 improves things.</p><hr><h2 id="svelte-5" tabindex="-1"><a class="header-anchor" href="#svelte-5"><span>Svelte 5</span></a></h2><p>For Svelte 5, the code is pretty much the same, except we declare our state like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token comment">// and so on ...&lt;/em&gt;</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We render the page, and see the same as before. If you’re following along in the repo, be sure to refresh the page after navigating, so the page will start over with the global counter.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5.png?resize=1024%2C395&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Now let’s change one piece of state, as before. We’ll update the title for Task C, the third one.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-updated.png?resize=1024%2C392&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Just like that, only the <em>single</em> piece of state we modified has re-rendered. Svelte was smart enough to leave everything else alone. 99% of the time this won’t make any difference, but if you’re rendering a<em>lot</em>of data on a page, this can be a substantial performance win.</p><h3 id="why-did-this-happen" tabindex="-1"><a class="header-anchor" href="#why-did-this-happen"><span>Why did this happen?</span></a></h3><p>This is the default behavior when we pass arrays and objects (and arrays of objects) into the<code>$state</code>rune, like we did with:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,31)),s("p",null,[n[27]||(n[27]=a("Svelte will read everything you pass, set up")),s("a",T,[t(c,{icon:"fa-brands fa-firefox"}),n[26]||(n[26]=a("Proxy"))]),n[28]||(n[28]=a("objects to track what changes, and update the absolute minimum amount of DOM nodes necessary."))]),n[64]||(n[64]=r(`<hr><h2 id="false-coda" tabindex="-1"><a class="header-anchor" href="#false-coda"><span>False Coda</span></a></h2><p>We could end the post here. Use the<code>$state</code>primitive to track your reactive data. Svelte will make it deeply reactive, and update whatever it needs to update when you change anything. This will be<em>just fine</em>the vast majority of the time.</p><p>But what if you’re writing a web application that has to manage a<em>ton</em>of data? Making everything deeply reactive is not without cost.</p><p>Let’s see how we can tell Svelte that only<em>some of</em>our data is reactive. I’ll stress again, laboring over this will almost never be needed. But it’s good to know how it works if it ever comes up.</p><hr><h2 id="rediscovering-a-long-lost-javascript-feature" tabindex="-1"><a class="header-anchor" href="#rediscovering-a-long-lost-javascript-feature"><span>Rediscovering a long-lost JavaScript feature</span></a></h2><p>Classes in JavaScript have gotten an unfortunately bad reputation. Classes are an outstanding way to declare the<em>structure</em>of a set of objects, which also happen to come with a built-in factory function for creating those objects. Not only that, but TypeScript is deeply integrated with them.</p><p>You can declare:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span></span>
<span class="line">  firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Not only will this provide you a factory function for creating instances of a Person, via<code>new Person(&#39;Adam&#39;, &#39;Rackis&#39;)</code>, but<code>Person</code>can also be used as a type within TypeScript. You can create variables or function parameters of type<code>Person</code>. It’s one of the few things that exist as a runtime construct and <em>also</em> a TypeScript type.</p><p>That said, if you find yourself reaching for<code>extends</code>in order to create deep inheritance hierarchies with classes, please please re-think your decisions.</p><p>Anyway, why am I bringing up classes in this post?</p><hr><h2 id="fine-grained-reactivity-in-svelte-5" tabindex="-1"><a class="header-anchor" href="#fine-grained-reactivity-in-svelte-5"><span>Fine-grained reactivity in Svelte 5</span></a></h2><p>If you have a performance-sensitive section of code where you need to mark some properties as non-reactive, you can do this by creating class instances rather than vanilla JavaScript objects. Let’s define a Task class for our tasks. For the properties we<em>want to</em>be reactive, we’ll set default values with the<code>$state()</code>rune. For properties we<em>don’t</em>want to be reactive, we won’t.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  title <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  assigned <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  importance <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">data</span><span class="token operator">:</span> Task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And then we just use that class</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token comment">// and so on&lt;/em&gt;</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19)),s("p",null,[n[30]||(n[30]=a("I simplified the class a bit by taking a raw object with all the properties of the class, and assigning those properties with")),n[31]||(n[31]=s("code",null,"Object.assign",-1)),n[32]||(n[32]=a(". The object literal is typed in the constructor as")),n[33]||(n[33]=s("code",null,"Task",-1)),n[34]||(n[34]=a(", the same as the class, but that’s fine because of TypeScript’s")),s("a",A,[t(c,{icon:"fas fa-globe"}),n[29]||(n[29]=a("structural typing"))]),n[35]||(n[35]=a("."))]),n[65]||(n[65]=s("p",null,[a("When we run that, we’ll see the same exact thing as before, except clicking the button to change the "),s("code",null,"id"),a(" will not re-render anything at all in our Svelte component. To be clear, the"),s("code",null,"id"),a("is still changing, but Svelte is not re-rendering. This demonstrates Svelte intelligently not wiring any kind of observability into that particular property.")],-1)),s("p",null,[n[37]||(n[37]=a("Side note: if you wanted to encapsulate / protect the")),n[38]||(n[38]=s("code",null,"id",-1)),n[39]||(n[39]=a(", you could declare ")),n[40]||(n[40]=s("code",null,"id",-1)),n[41]||(n[41]=a(" as")),n[42]||(n[42]=s("code",null,"#id",-1)),n[43]||(n[43]=a("to make it a")),s("a",R,[t(c,{icon:"fa-brands fa-firefox"}),n[36]||(n[36]=a("private property"))]),n[44]||(n[44]=a("and then expose the value with a getter function."))]),n[66]||(n[66]=s("hr",null,null,-1)),n[67]||(n[67]=s("h2",{id:"going-deeper",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#going-deeper"},[s("span",null,"Going deeper")])],-1)),n[68]||(n[68]=s("p",null,[a("What if you don’t want these tasks to be reactive at the individual property at all? What if we have a"),s("em",null,"lot"),a("of these tasks coming down, and you’re not going to be editing them? So rather than have Svelte set up reactivity for each of the tasks’ properties, you just want the array itself to be reactive.")],-1)),n[69]||(n[69]=s("p",null,"You basically want to be able to add or remove entries in your array, and have Svelte update the tasks that are rendered. But you don’t want Svelte setting up any kind of reactivity for each property on each task.",-1)),s("p",null,[n[46]||(n[46]=a("This is a common enough use case that other state management systems support this directly, for example, MobX’s")),s("a",C,[t(c,{icon:"fas fa-globe"}),n[45]||(n[45]=s("code",null,"observable.shallow",-1))]),n[47]||(n[47]=a(". Unfortunately Svelte does not have any such helper, as of yet. That said, it")),n[48]||(n[48]=s("em",null,"is",-1)),n[49]||(n[49]=a("currently being debated, so keep your eyes open for a")),n[50]||(n[50]=s("code",null,"$state.shallow()",-1)),n[51]||(n[51]=a("that would do what we’re about to show. But even if it does get added, implementing it ourselves will be a great way to kick the tires of Svelte’s new reactivity system. Let’s see how."))]),n[70]||(n[70]=r(`<h3 id="implementing-our-own-state-shallow-equivalent" tabindex="-1"><a class="header-anchor" href="#implementing-our-own-state-shallow-equivalent"><span>Implementing our own <code>$state.shallow()</code> equivalent</span></a></h3><p>We already saw how passing class instances to an array shut off fine-grained reactivity by default, leaving you to opt-in, as desired, by setting class fields to<code>$state()</code>. But our data are likely coming from a database, as plain (hopefully typed) JavaScript objects, unrelated to any class; more importantly we likely have zero desire to cobble together a class just for this.</p><p>So let’s simulate it. Let’s say that a database is providing our Task objects as JS objects. We (of course) have a type for this:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">type</span> <span class="token class-name">Task</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></span>
<span class="line">  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  assigned<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  importance<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We want to put those instances into an array that itself is reactive, but not the individual properties on the tasks. With a tiny bit of cleverness we can make it mostly painless.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">NonReactiveObjectGenerator</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">shallowObservable</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">NonReactiveObjectGenerator</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Our<code>NonReactiveObjectGenerator</code>class takes in any object, and then smears all that object’s properties onto itself. And our<code>shallowObservable</code>takes an array of whatever, and maps it onto instances of our<code>NonReactiveObjectGenerator</code>class. This will force each instance to be a class instance, with nothing reactive. The<code>as T</code>is us forcing TypeScript to treat these new instances as whatever type was passed in. This is accurate, but something TypeScript needs help understanding, since it’s not (as of now) able to read and understand our call to<code>Object.assign</code>in the class constructor.</p>`,7)),s("p",null,[n[53]||(n[53]=a("If you closely read my")),t(d,{to:"/frontendmasters.com/introducing-svelte-5.html#state"},{default:e(()=>n[52]||(n[52]=[a("first post")])),_:1,__:[52]}),n[54]||(n[54]=a("on Svelte 5, you might recall that you can’t directly return reactive state from a function, since the state will be read and unwrapped right at the call-site, and won’t be reactive any longer. Normally you’d have to do this:"))]),n[71]||(n[71]=r(`<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span>newData<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    result <span class="token operator">=</span> newData<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Why wasn’t that needed here? It’s true, the<code>$state()</code>value will be read at the function’s call site. So with…</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token function">shallowObservable</span><span class="token punctuation">(</span><span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>…the tasks<em>variable</em>will not be reactive. But the array itself will still be fully reactive. We can still call <code>push</code>, <code>pop</code>, <code>splice</code> and so on. If you can live without needing to re-assign to the variable, this is much simpler. But even if you do need to set the tasks variable to a fresh array of values, you still don’t even need to use variable assignment. Stay tuned.</p><p>I changed the initial tasks array to help out in a minute, but the rest is what you’d expect.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getTasks</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token comment">// ...&lt;/em&gt;</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token function">shallowObservable</span><span class="token punctuation">(</span><span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And with that, rendering should now work, and none of our properties are reactive. Clicking the edit buttons do nothing.</p><p>But we can now add a button to push a new task onto our array.</p><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span></span>
<span class="line">  <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    tasks<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token keyword">new</span> <span class="token class-name">NonReactiveObjectGenerator</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        id<span class="token operator">:</span> nextId<span class="token operator">++</span><span class="token punctuation">,</span></span>
<span class="line">        title<span class="token operator">:</span> <span class="token string">&#39;New task&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        assigned<span class="token operator">:</span> <span class="token string">&#39;Adam&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        importance<span class="token operator">:</span> <span class="token string">&#39;Low&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Task</span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">}</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">  Add new task</span>
<span class="line">&lt;/button&gt;</span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We can even add a delete button to each row.</p><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> tasks<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">  Delete</span>
<span class="line"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Yes, Svelte’s reactive array is smart enough to understand push and splice.</p><h3 id="editing-tasks-this-way" tabindex="-1"><a class="header-anchor" href="#editing-tasks-this-way"><span>Editing tasks this way</span></a></h3><p>You might be wondering if we can still actually edit the individual tasks. We assumed the tasks would be read-only, but what if that changes? We’ve been modifying the array and watching Svelte re-render correctly. Can’t we edit an individual task by just cloning the task, updating it, and then re-assigning to that index? The answer is yes, with a tiny caveat.</p><p>Overriding an array index (with a<em>new</em>object instance) does work, and makes Svelte update. But we can’t just do this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">tasks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> t <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Since that would make the new object, which is an object literal, deeply reactive. We have to keep using our class. This time, to keep the typings simple, and to keep the code smell that is the <code>NonReactiveObjectGenerator</code> class hidden as much as possible, I wrote up a helper function.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">cloneNonReactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NonReactiveObjectGenerator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As before, the type assertion is unfortunately needed. This same function could also be used for the add function we saw above, if you prefer.</p><p>To prove editing works, we’ll leave the entire template alone, except for the<code>importance</code>field, which we’ll modify like so</p><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx"><pre><code class="language-jsx"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>t<span class="token punctuation">.</span>importance <span class="token operator">+</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span></span>
<span class="line">      <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> taskClone <span class="token operator">=</span> <span class="token function">cloneNonReactive</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        taskClone<span class="token punctuation">.</span>importance <span class="token operator">+=</span> <span class="token string">&#39;X&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        tasks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneNonReactive</span><span class="token punctuation">(</span>taskClone<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span>
<span class="line">    <span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      Update importance</span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now running shows everything as it’s always been.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-shallow.png?resize=1024%2C470&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>If we click the button to change the id, title or assigned value, nothing changes, because we’re still mutating those properties directly (since I didn’t change anything) in order to demonstrate that they’re not reactive. But clicking the button to update the importance field runs the code above, and updates the<em>entire</em>row, showing any other changes we’ve made.</p><p>Here I clicked the button to update the title, twice, and then clicked the button to update the importance. The former did nothing, but the latter updated the component to show all changes.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-shallow-updated.png?resize=1024%2C457&amp;ssl=1" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="tasks-array" tabindex="-1"><a class="header-anchor" href="#tasks-array"><span>tasks array</span></a></h3><p>We saved a bit of convenience by returning our state value directly from our <code>shallowObservable</code> helper, but at the expense of not being able to assign directly to our array. Or did we?</p><p>If you know a bit of JavaScript, you might know…</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">tasks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>…is the old school way to clear an array. That works with Svelte; the Proxy object Svelte sets up to make our array observable works with that. Similarly, we can set the array to a fully new array of values (after clearing it like we just saw) like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>It’s up to you which approach you take, but hopefully Svelte ships a<code>$state.shallow</code>to provide the best of both worlds: the array would be reactive, and so would the binding, since we don’t have to pass it across a function boundary; it would be built directly into<code>$state</code>.</p><hr><h2 id="sveltekit" tabindex="-1"><a class="header-anchor" href="#sveltekit"><span>SvelteKit</span></a></h2><p>Let’s wrap up by briefly talking about how data from SvelteKit loaders is treated in terms of reactivity. In short, it’s exactly how you’d expect. First and foremost, if you return a raw array of objects from your loader like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">tasks</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token comment">// ...&lt;/em&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">assigned</span><span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">importance</span><span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then none of that data will be reactive in your component. This is to be expected. To make data reactive, you need to wrap it in<code>$state()</code>. As of now, you can’t call<code>$state</code>in a loader, only in a universal Svelte file (something that ends in<code>.svelte.ts</code>). Hopefully in the future Svelte will allow us to have loaders named<code>+page.svelte.ts</code>but for now we can throw something like this in a<code>reactive-utils.svelte.ts</code>file.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> makeReactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then import it and use it in our loader.</p><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> makeReactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./reactive-utils.svelte&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    tasks<span class="token operator">:</span> <span class="token function">makeReactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task A&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;Low&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">// ...&lt;/em&gt;</span>
<span class="line">      </span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">&quot;Task L&quot;</span><span class="token punctuation">,</span> assigned<span class="token operator">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> importance<span class="token operator">:</span> <span class="token string">&quot;High&quot;</span> <span class="token punctuation">}</span><span class="token plain-text">,</span>
<span class="line">    ]),</span>
<span class="line">  };</span>
<span class="line">};</span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now those objects will support the same fine-grained reactivity we saw before. To customize which properties are reactive, you’d swap in class instances, instead of vanilla object literals, again just like we saw. All the same rules apply.</p><p>If you’re wondering why we did this…</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> makeReactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>…rather than this…</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> makeReactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">$state</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>… the answer is that the latter is simply disallowed. Svelte forces you to only put<code>$state()</code>calls into assignments. It cannot appear as a return value like this. The reason is that while returning $state variables directly across a function boundary works fine for objects and arrays, doing this for primitive values (strings or numbers) would produce a senseless result. The variable could not be re-assigned (same as we saw with the array), but as a primitive, there’d be no other way to edit it. It would just be a non-reactive constant.</p><p>Svelte forcing you to take that extra step, and assign $state to a variable before returning, is intended to help prevent you from making that mistake.</p><hr><h2 id="wrapping-up" tabindex="-1"><a class="header-anchor" href="#wrapping-up"><span>Wrapping up</span></a></h2><p>One of the most exciting features of Svelte 5 is the fine-grained reactivity it adds. Svelte was already lightweight, and faster than most, if not all of the alternatives. These additions in version 5 only improve on that. When added to the state management improvements we’ve already covered in prior posts, Svelte 5 really becomes a serious framework option.</p><p>Consider it for your next project.</p>`,52)),s("div",I,[n[55]||(n[55]=s("p",{class:"hint-container-title"},"Article Series",-1)),t(o,i(l({title:"Introducing Svelte 5",desc:"Svelte 5 introduces significant improvements in reactivity, state management, and prop handling, maintaining its user-friendly Developer Experience (DX). ",link:"/frontendmasters.com/introducing-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16),t(o,i(l({title:"Snippets in Svelte 5",desc:"Out with slots, in with snippets.",link:"/frontendmasters.com/snippets-in-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16),t(o,i(l({title:"Fine-Grained Reactivity in Svelte 5",desc:"Svelte is already quite lightweight and fast, but Svelte 5 still overs big improvements in fine-grained reactivity, meaning re-rendering as absolutely little as possible. ",link:"/frontendmasters.com/fine-grained-reactivity-in-svelte-5.md",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16)]),h(" TODO: add ARTICLE CARD "),t(o,i(l({title:"Fine-Grained Reactivity in Svelte 5",desc:"Svelte is already quite lightweight and fast, but Svelte 5 still overs big improvements in fine-grained reactivity, meaning re-rendering as absolutely little as possible. ",link:"https://chanhi2000.github.io/bookshelf/frontendmasters.com/fine-grained-reactivity-in-svelte-5.html",logo:"https://frontendmasters.com/favicon.ico",background:"rgba(188,75,52,0.2)"})),null,16)])}const O=m(f,[["render",W]]),G=JSON.parse('{"path":"/frontendmasters.com/fine-grained-reactivity-in-svelte-5.html","title":"Fine-Grained Reactivity in Svelte 5","lang":"en-US","frontmatter":{"lang":"en-US","title":"Fine-Grained Reactivity in Svelte 5","description":"Article(s) > Fine-Grained Reactivity in Svelte 5","icon":"iconfont icon-svelte","category":["Node.js","Svelte.js","Article(s)"],"tag":["blog","frontendmasters.com","node","nodejs","node-js","svelte","sveltejs","svelte-js"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Fine-Grained Reactivity in Svelte 5\\",\\"image\\":[\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte4.png?resize=1024%2C399&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte4-updated.png?resize=1024%2C387&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5.png?resize=1024%2C395&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-updated.png?resize=1024%2C392&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-shallow.png?resize=1024%2C470&ssl=1\\",\\"https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2024/08/svelte5-shallow-updated.png?resize=1024%2C457&ssl=1\\"],\\"datePublished\\":\\"2024-08-14T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Adam Rackis\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/frontendmasters.com/fine-grained-reactivity-in-svelte-5.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Fine-Grained Reactivity in Svelte 5"}],["meta",{"property":"og:description","content":"Article(s) > Fine-Grained Reactivity in Svelte 5"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/3438"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/3438"}],["meta",{"name":"twitter:image:alt","content":"Fine-Grained Reactivity in Svelte 5"}],["meta",{"property":"article:author","content":"Adam Rackis"}],["meta",{"property":"article:tag","content":"svelte-js"}],["meta",{"property":"article:tag","content":"sveltejs"}],["meta",{"property":"article:tag","content":"svelte"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"frontendmasters.com"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-08-14T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Fine-Grained Reactivity in Svelte 5"},{"property":"og:description","content":"Fine-Grained Reactivity in Svelte 5"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/frontendmasters.com/fine-grained-reactivity-in-svelte-5.html"}]],"prev":"/programming/js-svelte/articles/README.md","date":"2024-08-14T00:00:00.000Z","isOriginal":false,"author":"Adam Rackis","cover":"https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/3438"},"git":{},"readingTime":{"minutes":13.64,"words":4092},"filePathRelative":"frontendmasters.com/fine-grained-reactivity-in-svelte-5.md","copyright":{"author":"Adam Rackis"}}');export{O as comp,G as data};
