import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,d as s,f as t,b as l,a as b,t as h,n as d,g as k,w as p,e as a,r as i,o as f}from"./app-BVguHYKu.js";const y={},w={id:"frontmatter-title-관련",tabindex:"-1"},q={class:"header-anchor",href:"#frontmatter-title-관련"},x={class:"table-of-contents"},S={href:"https://start.spring.io",target:"_blank",rel:"noopener noreferrer"},C={href:"https://youtu.be/_hfBv0a09Jc",target:"_blank",rel:"noopener noreferrer"},F={href:"https://kotlinlang.org/docs/coroutines-guide.html",target:"_blank",rel:"noopener noreferrer"},G={href:"https://docs.spring.io/spring-boot/docs/2.0.x/reference/html/boot-features-webclient.html",target:"_blank",rel:"noopener noreferrer"},A={href:"https://github.com/kittinunf/fuel",target:"_blank",rel:"noopener noreferrer"},I={class:"hint-container info"},j={href:"https://renatomrcosta.github.io/Nonblocking-Spring-MVC",target:"_blank",rel:"noopener noreferrer"};function N(g,n){const c=i("VPCard"),o=i("router-link"),r=i("SiteInfo"),e=i("VPIcon"),u=i("KotlinPlayground");return f(),m("div",null,[s("h1",w,[s("a",q,[s("span",null,h(g.$frontmatter.title)+" 관련",1)])]),t(c,d(k({title:"Spring > Article(s)",desc:"Article(s)",link:"/programming/java-spring/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",x,[s("ul",null,[s("li",null,[t(o,{to:"#the-servlet-container"},{default:p(()=>n[0]||(n[0]=[a("The Servlet Container")])),_:1,__:[0]})]),s("li",null,[t(o,{to:"#creating-the-service"},{default:p(()=>n[1]||(n[1]=[a("Creating the Service")])),_:1,__:[1]}),s("ul",null,[s("li",null,[t(o,{to:"#creating-the-endpoints"},{default:p(()=>n[2]||(n[2]=[a("Creating the endpoints")])),_:1,__:[2]})])])]),s("li",null,[t(o,{to:"#stressing-it"},{default:p(()=>n[3]||(n[3]=[a("Stressing it")])),_:1,__:[3]})]),s("li",null,[t(o,{to:"#so-what-then"},{default:p(()=>n[4]||(n[4]=[a("So what, then?")])),_:1,__:[4]})]),s("li",null,[t(o,{to:"#non-blocking-for-the-win"},{default:p(()=>n[5]||(n[5]=[a("Non-blocking for the win")])),_:1,__:[5]})]),s("li",null,[t(o,{to:"#coroutines-or-how-i-stopped-worrying-about-non-blocking-code-and-started-loving-the-code"},{default:p(()=>n[6]||(n[6]=[a("Coroutines, or how I stopped worrying about non-blocking code and started loving the code")])),_:1,__:[6]})]),s("li",null,[t(o,{to:"#migrating-towards-coroutines"},{default:p(()=>n[7]||(n[7]=[a("Migrating towards coroutines")])),_:1,__:[7]}),s("ul",null,[s("li",null,[t(o,{to:"#from-non-blocking-to-reactive"},{default:p(()=>n[8]||(n[8]=[a("From non-blocking to reactive")])),_:1,__:[8]})]),s("li",null,[t(o,{to:"#in-conclusion"},{default:p(()=>n[9]||(n[9]=[a("In Conclusion")])),_:1,__:[9]})])])])])]),n[44]||(n[44]=s("hr",null,null,-1)),t(r,{name:"Why Non-Blocking?",desc:"From blocking to non-blocking with Kotlin, Coroutines and Spring Boot",url:"https://kt.academy/article/nonblocking_spring_mvc",logo:"https://kt.academy/logo.png",preview:"https://marcinmoskala.com/kt-academy-articles/renatocosta/promotion/nonblocking_spring_mvc.jpg"}),n[45]||(n[45]=l('<p>Non-blocking systems have become more commonplace and accessible due to the rich choice of tools and programming approaches. But in my current experience, programmers used to a more traditional blocking approach tend to quickly become confused about non-blocking or reactive systems, at times even confusing the terms &quot;non-blocking&quot; with &quot;asynchronicity&quot;.</p><p>In this article we will review the current status of blocking systems by building and examining a simple Spring Boot application. We will talk about how they behave. Then we will introduce Kotlin Coroutines, and how they can help us to model our non-blocking services.</p><hr><h2 id="the-servlet-container" tabindex="-1"><a class="header-anchor" href="#the-servlet-container"><span>The Servlet Container</span></a></h2><p>In traditional Servlet container web services, every incoming request is served by its own thread. In our Spring Boot environment, this is what we get out of the box when importing the <code>spring-web-starter</code> (also known as Spring Web MVC). A Tomcat container is included, and some sensible defaults configured when using this dependency:</p><p><em>Spring Web Dependency</em></p><p>By default, a spring-web application configures 10 &quot;warm&quot; threads and a ceiling of 200 max-threads for incoming requests:</p><figure><img src="https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F2.png&amp;w=3840&amp;q=75" alt="Sensible Defaults" tabindex="0" loading="lazy"><figcaption>Sensible Defaults</figcaption></figure><p>In other words: If you have 3 incoming requests, there are 3 threads in use. If you have 100 incoming requests, 100 threads in use, and so on.</p><figure><img src="https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F3.png&amp;w=3840&amp;q=75" alt="Request visualization with Tomcat" tabindex="0" loading="lazy"><figcaption>Request visualization with Tomcat</figcaption></figure><p>Let us create a very simple Spring MVC service: We will implement a simple Rest Controller with two endpoints: One will return a simple greeting, and the other a collection of greetings after processing our request. We will also cap this Spring service to have a <em>maximum of 10 threads total</em>. This will allow us to experiment exhausting them without running extensive test suites.</p><hr><h2 id="creating-the-service" tabindex="-1"><a class="header-anchor" href="#creating-the-service"><span>Creating the Service</span></a></h2><p>We will create a service that returns <em>customized greetings</em> to users based on their request.</p>',14)),s("p",null,[n[11]||(n[11]=a("Either go to ")),s("a",S,[t(e,{icon:"iconfont icon-spring"}),n[10]||(n[10]=a("https://start.spring.io"))]),n[12]||(n[12]=a(" to create your project, or use the much more practical ")),t(e,{icon:"iconfont icon-select"}),n[13]||(n[13]=s("code",null,"[New Project Window]",-1)),n[14]||(n[14]=a(" -> ")),n[15]||(n[15]=s("code",null,"[Spring Initializr]",-1)),n[16]||(n[16]=a(" in IDEA:"))]),n[46]||(n[46]=s("figure",null,[s("img",{src:"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F4.png&w=3840&q=75",alt:"Spring Initializr",tabindex:"0",loading:"lazy"}),s("figcaption",null,"Spring Initializr")],-1)),s("p",null,[n[17]||(n[17]=a("We will add solely the spring-web dependency for the time being. After it is generated, add the following to the ")),t(e,{icon:"fas fa-file-lines"}),n[18]||(n[18]=s("code",null,"application.properties",-1)),n[19]||(n[19]=a(" (or ")),t(e,{icon:"iconfont icon-yaml"}),n[20]||(n[20]=s("code",null,"application.yml",-1)),n[21]||(n[21]=a(") file in ")),t(e,{icon:"fas fa-folder-open"}),n[22]||(n[22]=s("code",null,"/src/resources",-1)),n[23]||(n[23]=a(":"))]),n[47]||(n[47]=l(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="src/main/resources/application.properties"><span>src/main/resources/application.properties</span></div><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties"><pre><code class="language-properties"><span class="line"><span class="token key attr-name">server.tomcat.threads.max</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></span>
<span class="line"><span class="token key attr-name">server.tomcat.threads.min-spare</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><h3 id="creating-the-endpoints" tabindex="-1"><a class="header-anchor" href="#creating-the-endpoints"><span>Creating the endpoints</span></a></h3><p>We will create very simple endpoints, and quite literally mock complex behavior for brevity&#39;s sake. Our controller shall have two get methods:</p><ul><li><code>/greeting</code> -&gt; will return all possible greetings in our system</li><li><code>/greeting/{id}</code> -&gt; will return a greeting if the id valid, otherwise a 404. The important thing about our service is that searching for greetings is contrived to be an &#39;expensive&#39; operation. Think of it as accessing a remote service, a third-party API or a database: there&#39;s obviously some network and processing overhead to get the necessary result.</li></ul><p>A prototype of how it could look like is as follows:</p><p>Data Model representation:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Greeting.kt"><span>Greeting.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> text<span class="token operator">:</span> String<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div><p>Service providing those greetings:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="GreetingService.kt"><span>GreetingService.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> GreetingService <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> hardCodedGreetings <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Hello there!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Howdy Partner!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Well, that&#39;s a fine how do you do!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get all greetings&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000</span><span class="token punctuation">)</span> <span class="token comment">// Simulates a really slow amount of work, 1 sec of total pause</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">also</span>  <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got all greetings!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Greeting<span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get a specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000</span><span class="token punctuation">)</span> <span class="token comment">// Simulates a really slow amount of work, 1 sec of total pause</span></span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>id <span class="token operator">==</span> id <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Our controller:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="GreetingController.kt"><span>GreetingController.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@RestController</span></span>
<span class="line"><span class="token annotation builtin">@RequestMapping</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">GreetingController</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> greetingService<span class="token operator">:</span> GreetingService<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation builtin">@GetMapping</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token operator">=</span> greetingService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token annotation builtin">@GetMapping</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/{id}&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation builtin">@PathVariable</span> id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ResponseEntity<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token operator">=</span></span>
<span class="line">    greetingService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id <span class="token operator">=</span> id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> greeting <span class="token operator">-&gt;</span></span>
<span class="line">    ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">?:</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Note that we also implemented a little helper function to print the current thread name + a log message:</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">trace</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> Any<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">msg</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When running our application, one can navigate to <code>http://localhost:8080/greeting</code> to play around with our setup. Our service is up and running! Whatever could go wrong?</p><hr><h2 id="stressing-it" tabindex="-1"><a class="header-anchor" href="#stressing-it"><span>Stressing it</span></a></h2><p>Given what we know about the Servlet behavior, and that our application is configured to only serve requests using a maximum of 10 threads, what would happen if we got something like 50 requests simultaneously?</p><p>Let us run a small script. For instance, this dummy JavaScript code that you can run in the Chrome console:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/greeting&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F5.png&amp;w=3840&amp;q=75" alt="Notice the work being &#39;chunked&#39; in batches of 10" tabindex="0" loading="lazy"><figcaption>Notice the work being &#39;chunked&#39; in batches of 10</figcaption></figure><p>Look at our server console: As soon as all threads are blocked, the remaining requests must wait until the work done in order to occupy another free slot. In your browser&#39;s network tab, you may also notice that the requests take much longer in total, given their waiting time:</p><figure><img src="https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F6.png&amp;w=3840&amp;q=75" alt="8 seconds of wait + 1 second request" tabindex="0" loading="lazy"><figcaption>8 seconds of wait + 1 second request</figcaption></figure><hr><h2 id="so-what-then" tabindex="-1"><a class="header-anchor" href="#so-what-then"><span>So what, then?</span></a></h2><p>This example was certainly very contrived! A request that takes a full second, and a dearth of threads are not normally common indeed. But I hope this may have triggered your consideration for problems in larger scale. Even if you dimension your Tomcat to serve 1000 threads, you will still be at the mercy of such issues when waiting for external calls.</p><p>The actual problem is that creating and managing threads is expensive, at least in our JVM World. Even if we nowadays live in the land of plenty, where machines are provisioned and we can just throw more memory and CPU at the problem until it vanishes, we certainly need a better approach to manage our throughput without depending on spawning thousands of threads when we try to scale our services.</p><hr><h2 id="non-blocking-for-the-win" tabindex="-1"><a class="header-anchor" href="#non-blocking-for-the-win"><span>Non-blocking for the win</span></a></h2><p>In our code, we have contrived a blocking call (in this case, a <code>Thread.sleep</code> call) to block the worker thread. In essence, this is the same as using a <code>RestTemplate</code> call, or a <code>java.net.HttpClient</code> call. Those Components and APIs are <code>blocking</code>, in the sense that they occupy the calling thread until they have a meaningful result.</p><p>Let&#39;s then move our delay behavior out of our Service classes, and utilize an external delay API:</p><p>Configures the client</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="HttpClientConfiguration.kt"><span>HttpClientConfiguration.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@Configuration</span></span>
<span class="line"><span class="token keyword">class</span> HttpClientConfiguration <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation builtin">@Bean</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">javaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient <span class="token operator">=</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Implements the delay call</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="DelayService.kt"><span>DelayService.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">DelayService</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> javaClient<span class="token operator">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> request <span class="token operator">=</span> HttpRequest<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT_URL</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">DELAY_SECONDS</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">    javaClient<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HttpResponse<span class="token punctuation">.</span>BodyHandlers<span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ENDPOINT_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://httpbin.org/delay&quot;</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> DELAY_SECONDS <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Changes the call in our Service class</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="GreetingService.kt"><span>GreetingService.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">GreetingService</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> delayService<span class="token operator">:</span> DelayService<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> hardCodedGreetings <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Hello there!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Howdy Partner!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Well, that&#39;s a fine how do you do!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get all greetings&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    delayService<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got all greetings!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Greeting<span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get a specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    delayService<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>id <span class="token operator">==</span> id <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If you re-run our caller Script example from above, the behavior will still be the same: the HTTP Request still blocks.</p><p>One could then utilize then some sort of strategy (as using the Async APIs with a Completable Future) to avoid blocking the calling thread: By subscribing some sort of callback to the remote call we can defer the resolution:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="DelayService.kt"><span>DelayService.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">DelayService</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> javaClient<span class="token operator">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> request <span class="token operator">=</span> HttpRequest<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT_URL</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">DELAY_SECONDS</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">val</span> future <span class="token operator">=</span> javaClient<span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HttpResponse<span class="token punctuation">.</span>BodyHandlers<span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    future<span class="token punctuation">.</span><span class="token function">thenAccept</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Waiting finished with status </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">it<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ENDPOINT_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://httpbin.org/delay&quot;</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> DELAY_SECONDS <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>While we improve by not blocking unnecessarily in the remote request, we lose in introducing some complexity on how to deal with the particular completable future introduced by whichever library our Client is utilizing. How could we improve our situation even further?</p><hr><h2 id="coroutines-or-how-i-stopped-worrying-about-non-blocking-code-and-started-loving-the-code" tabindex="-1"><a class="header-anchor" href="#coroutines-or-how-i-stopped-worrying-about-non-blocking-code-and-started-loving-the-code"><span>Coroutines, or how I stopped worrying about non-blocking code and started loving the code</span></a></h2>`,42)),s("p",null,[n[26]||(n[26]=a("Coroutines (or more specifically Kotlin Coroutines) are basically devices that allow the non-blocking execution of code, and this code can be suspended and later resumed. In a really reductive nutshell, coroutines are akin to lightweight-threads. If you haven't been introduced yet, I highly recommend watching ")),s("a",C,[t(e,{icon:"fa-brands fa-youtube"}),n[24]||(n[24]=a("Roman Elizarov's talk in Kotlin Conf 2017"))]),n[27]||(n[27]=a(", and also having a look at the ")),s("a",F,[t(e,{icon:"iconfont icon-jetbrains"}),n[25]||(n[25]=a("amazing documentation provided by Jetbrains"))]),n[28]||(n[28]=a("."))]),n[48]||(n[48]=s("p",null,"One important statement you can take away from this intro: Nowadays, waiting gracefully is probably more important than raw computation! And providing an idiomatic and intuitive way to wait gracefully is one of the superpowers coroutines grant us!",-1)),n[49]||(n[49]=s("p",null,"So, how can we tell if coroutines are truly akin to lightweight threads? Let's run a small code sample to figure it out.",-1)),n[50]||(n[50]=s("p",null,"Take the following piece of code: With it, we shall build a list of threads and run then concurrently, contriving a 1 second long piece of work, joining them at the end, and see how long our parallel process took in total. An analogous piece of code for coroutines follows in the bottom:",-1)),t(u,{title:"Experiment%20(1)",key:"46fb146c",settings:"%7B%7D",files:"eJxlUc1OwzAMfhWr7LBJqBuPwGE3uE3iQDmkqUfNUqdKXBUx9d1xkrIdqCq1/uJ8P/Z7RcPog8Ak5OqZpD9+o9XC84kGbHg9vnhxxLX1bKcQkKWWPqDpGm74PDEMhni7g2vDAPs9nHqK0DpvLzCTc4CZFB/BcAfS4wqoCojKlKYWYQzEgh34SYCUVWGKqKpdTMwDmjgFTM5e81ERzJLPoLUok/RggKehxQD+DCQ4xCIQRzNzDUdj+wwXlJiEjKMfhCkSf2Z/xbtet77TCp2fi9KLimyfDoc1a3rKJO41aPyE1NEhjqn5sLufSTAWt01V5qxZSzM8bEia6ta4lJ+l9pz93tg16pshXRjrxrLXVT+nUz6dSudZZ+rDJcVp8exDGq23iJ0if0wk9ZdPa1ul0mepjYserv9t6jo2V5JliOpSe/WtPn4B9CDBlw=="}),t(u,{title:"Experiment%20(2)",key:"2fcb9d31",settings:"%7B%7D",files:"eJx9UstOwzAQ/JVV4NBKkJZPAKkXBLfeCAfH2TarOuvIdpRC1X9nbbdREI8oUuzx7Mx4N28Fdb11AQ42GOJjqa2zQyBGXzZo1EfFfxOMGli3/zHcwE/G6gPxfqLJkSmDUxq/QyOFdnNELRvLW+rkuOLdwNAp4sUSThUDrFawbclDHVVhJGMAUw3egeIGQosXQEQgiEom1Qi9Iw7YgGQDElWByaO23Pio3KHyg8No/JqOsuGvlrWjZo/JLKFyveTOlu8nYIqRk2mHKiAomNoDXttebhlNZo26+ibnR5AkQVxDK6U8dDU6sDuggJ3PYXyvRi5ho3Sb4IwSUyBl6BNh8FF1ChvLtW1kh8aOV68XsVk8rNeXPucnD3iOAKS/IjLXyzmcBrqoijxBafOzreHmlkJVzHjn6/KySJ9zqYy3cPqpIWO6PVE4d15UIlne4v0LB+TtWw=="}),n[51]||(n[51]=s("p",null,"If one runs these pieces of code with 100 units of work, we almost universally reach the 1 second + some overhead amount of execution time. Now imagine we needed to run 10 million units of work: The coroutine enabled code easily handles it, while most laptops will certainly buckle under the memory requirements from the Thread example!",-1)),n[52]||(n[52]=s("p",null,"Now, if we have an inexpensive model for using threads in coroutines, can we take advantage of it in our servers?",-1)),n[53]||(n[53]=s("hr",null,null,-1)),n[54]||(n[54]=s("h2",{id:"migrating-towards-coroutines",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#migrating-towards-coroutines"},[s("span",null,"Migrating towards coroutines")])],-1)),s("p",null,[n[29]||(n[29]=a("Since Spring Boot 2.4, even servlet based services have support for coroutines! To get started, let's add the appropriate dependencies to our ")),t(e,{icon:"iconfont icon-gradle"}),n[30]||(n[30]=s("code",null,"build.gradle",-1)),n[31]||(n[31]=a(" file:"))]),n[55]||(n[55]=l(`<div class="code-block-with-title"><div class="code-block-title-bar" data-title="build.gradle.kt"><span>build.gradle.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">val</span> coroutinesVersion <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;1.5.2&quot;</span></span> </span>
<span class="line"><span class="token function">implementation</span> <span class="token punctuation">(</span>dependencyNotation<span class="token operator">:</span> <span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">coroutinesVersion</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token comment">// adds the necessary depenencies to Tomcat servlets to behave non-blocking / suspending </span></span>
<span class="line"><span class="token function">implementation</span> <span class="token punctuation">(</span>dependency Notation<span class="token operator">:</span> <span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-reactor:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">coroutinesVersion</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token comment">// Convenience Extension functions to deal with JDK8 futures </span></span>
<span class="line"><span class="token function">implementation</span> <span class="token punctuation">(</span>dependencyNotation<span class="token operator">:</span> <span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-jdk8:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">coroutinesVersion</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>And now, we can take advantage of two things:</p><ul><li>Adding the <code>suspend</code> keyword to our controller / function calls: This is, essentially, a contract we establish in our application, indicating that the operations therein will not block the caller thread.</li><li>Use a simple helper function to avoid having to define callbacks / operators in our non-blocking or asynchronous functions.</li></ul><p>Our code will look, in summary, like this:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="GreetingController.kt"><span>GreetingController.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token annotation builtin">@RestController</span></span>
<span class="line"><span class="token annotation builtin">@RequestMapping</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">GreetingController</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> greetingService<span class="token operator">:</span> GreetingService<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token annotation builtin">@GetMapping</span></span>
<span class="line">  <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token operator">=</span> greetingService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token annotation builtin">@GetMapping</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/{id}&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation builtin">@PathVariable</span> id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ResponseEntity<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token operator">=</span></span>
<span class="line">    greetingService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id <span class="token operator">=</span> id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> greeting <span class="token operator">-&gt;</span></span>
<span class="line">      ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token operator">?:</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">GreetingService</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> delayService<span class="token operator">:</span> DelayService<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> hardCodedGreetings <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Hello there!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Howdy Partner!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">Greeting</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Well, that&#39;s a fine how do you do!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Greeting<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get all greetings&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    delayService<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got all greetings!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Greeting<span class="token operator">?</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Starting work to get a specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    delayService<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> hardCodedGreetings<span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>id <span class="token operator">==</span> id <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Got specific greeting&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">val</span> text<span class="token operator">:</span> String<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">trace</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> Any<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;\\[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">msg</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation builtin">@Service</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token function">DelayService</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> javaClient<span class="token operator">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> request <span class="token operator">=</span> HttpRequest<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT_URL</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">DELAY_SECONDS</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">val</span> response <span class="token operator">=</span> javaClient</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HttpResponse<span class="token punctuation">.</span>BodyHandlers<span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Awaits without blocking!</span></span>
<span class="line">      <span class="token comment">// This line executes after the response is received</span></span>
<span class="line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Waiting finished with status </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ENDPOINT_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://httpbin.org/delay&quot;</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> DELAY_SECONDS <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation builtin">@Configuration</span></span>
<span class="line"><span class="token keyword">class</span> HttpClientConfiguration <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation builtin">@Bean</span></span>
<span class="line">  <span class="token keyword">fun</span> <span class="token function">javaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient <span class="token operator">=</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>`,5)),s("p",null,[n[34]||(n[34]=a("(As an aside, I would also recommend looking into alternatives to Java's HTTP client that plays nicer in a coroutine environment, such as Spring's ")),s("a",G,[t(e,{icon:"iconfont icon-spring"}),n[32]||(n[32]=a("WebClient"))]),n[35]||(n[35]=a(", ")),n[36]||(n[36]=s("a",{href:"https://ktor.io/",target:"_blank",rel:"noopener noreferrer"},"Ktor Client",-1)),n[37]||(n[37]=a(", ")),s("a",A,[t(e,{icon:"iconfont icon-github"}),n[33]||(n[33]=s("code",null,"kittinunf/fuel",-1))]),n[38]||(n[38]=a(", etc.)"))]),n[56]||(n[56]=l('<p>As one can see, now our delayService just uses an <code>await()</code> function to wait for the response of our remote request, while yielding the processing resources of its thread to other operations. It reads as simple imperative code, but waits gracefully for the response without blocking the Thread.</p><p>If you run our test script once again, look at how the result differs:</p><figure><img src="https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F8.png&amp;w=3840&amp;q=75" alt="Doing more with less resources!" tabindex="0" loading="lazy"><figcaption>Doing more with less resources!</figcaption></figure><p>Even though the amount of request vastly exceeds the number of available threads, we are able to gracefully handle the burst of requests with the available resources, no sweat!</p><h3 id="from-non-blocking-to-reactive" tabindex="-1"><a class="header-anchor" href="#from-non-blocking-to-reactive"><span>From non-blocking to reactive</span></a></h3><p>One may be asking themselves then, how can we go from here to truly reactive services? We are basically halfway there!</p><p>Using coroutines in Kotlin helps us to avoid dealing with complex Reactor / RxJava types and APIs. For instance: When we define a suspend request mapping returning a value (like <code>suspend fun get(): Greeting</code>), we are actually defining we return an equivalent value of <code>suspend fun get(): Mono&lt;Greeting&gt;</code>).</p><p>The coroutines specification allows developers to work with Kotlin idiomatically no matter what, even to work with more complex types such as <code>Flow</code> (the equivalent of Reactor&#39;s <code>Flux</code>).</p><p>Spring provides us with the <code>spring-webflux</code> starter that utilizes a Netty server framework instead of Tomcat. In this case, we don&#39;t define a thread-pool to handle our incoming requests, but it instead defines a CPU-bound thread-pool based on the machine&#39;s number of CPU Cores to serve all incoming requests. Normal laptops and even servers have appreciably less CPU cores than 200, so not blocking threads is an absolute must!</p><h3 id="in-conclusion" tabindex="-1"><a class="header-anchor" href="#in-conclusion"><span>In Conclusion</span></a></h3><p>There&#39;s much and more we could talk about the power and flexibility of using coroutines in our systems are able to provide us: We started from a typical Spring Web Servlet, with all our naive calls blocking our service. We transitioned into a non-blocking implementation by adding the coroutine support that Spring Boot provides out of the box, and appreciated how changing just a little in our setup we can extract much more from our current resources. We saw that asynchronous calls in our webclient are non-blocking, but also verified that there may be calls that do not block but behave synchronously (our await() call). And we hopefully demystified the basic usages of coroutines in conjunction with Spring Boot</p>',11)),s("div",I,[n[42]||(n[42]=s("p",{class:"hint-container-title"},"Info",-1)),n[43]||(n[43]=s("p",null,"The code for this project can be found here",-1)),t(r,{name:"renatomrcosta/why-nonblocking-spring-web-blogpost",desc:"Contribute to renatomrcosta/why-nonblocking-spring-web-blogpost development by creating an account on GitHub.",url:"https://github.com/renatomrcosta/why-nonblocking-spring-web-blogpost/",logo:"https://github.githubassets.com/favicons/favicon-dark.svg",preview:"https://opengraph.githubassets.com/ec63251ecec3ca8a814f666da005ef408d8fb3ed52c98cd116ade1787ed58d99/renatomrcosta/why-nonblocking-spring-web-blogpost"}),s("blockquote",null,[s("p",null,[n[40]||(n[40]=a("This article was originally published on ")),s("a",j,[t(e,{icon:"fas fa-globe"}),n[39]||(n[39]=a("Renato Costa's blog"))]),n[41]||(n[41]=a("."))])])]),b(" TODO: add ARTICLE CARD "),t(c,d(k({title:"Why Non-Blocking?",desc:"From blocking to non-blocking with Kotlin, Coroutines and Spring Boot",link:"https://chanhi2000.github.io/bookshelf/kt.academy/nonblocking_spring_mvc.html",logo:"https://kt.academy/logo.png",background:"rgba(243,139,49,0.2)"})),null,16)])}const B=v(y,[["render",N]]),E=JSON.parse('{"path":"/kt.academy/nonblocking-spring-mvc.html","title":"Why Non-Blocking?","lang":"en-US","frontmatter":{"lang":"en-US","title":"Why Non-Blocking?","description":"Article(s) > Why Non-Blocking?","icon":"iconfont icon-spring","category":["Java","Spring","Kotlin","Article(s)"],"tag":["blog","kt.academy","java","kotlin","spring","non-blocking"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Why Non-Blocking?\\",\\"image\\":[\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F2.png&w=3840&q=75\\",\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F3.png&w=3840&q=75\\",\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F4.png&w=3840&q=75\\",\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F5.png&w=3840&q=75\\",\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F6.png&w=3840&q=75\\",\\"https://kt.academy/_next/image?url=https%3A%2F%2Fmarcinmoskala.com%2Fkt-academy-articles%2Frenatocosta%2Fimages%2F2021-10-24%2F8.png&w=3840&q=75\\"],\\"datePublished\\":\\"2024-03-25T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Renato Costa\\",\\"url\\":\\"https://kt.academy/user/renatocosta\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kt.academy/nonblocking-spring-mvc.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Why Non-Blocking?"}],["meta",{"property":"og:description","content":"Article(s) > Why Non-Blocking?"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://marcinmoskala.com/kt-academy-articles/renatocosta/promotion/nonblocking_spring_mvc.jpg"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://marcinmoskala.com/kt-academy-articles/renatocosta/promotion/nonblocking_spring_mvc.jpg"}],["meta",{"name":"twitter:image:alt","content":"Why Non-Blocking?"}],["meta",{"property":"article:author","content":"Renato Costa"}],["meta",{"property":"article:tag","content":"non-blocking"}],["meta",{"property":"article:tag","content":"spring"}],["meta",{"property":"article:tag","content":"kotlin"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"kt.academy"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-03-25T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Why Non-Blocking?"},{"property":"og:description","content":"Why Non-Blocking?"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kt.academy/nonblocking_spring_mvc.html"}]],"prev":"/programming/java/articles/README.md","date":"2024-03-25T00:00:00.000Z","isOriginal":false,"author":[{"name":"Renato Costa","url":"https://kt.academy/user/renatocosta"}],"cover":"https://marcinmoskala.com/kt-academy-articles/renatocosta/promotion/nonblocking_spring_mvc.jpg"},"git":{},"readingTime":{"minutes":9.92,"words":2976},"filePathRelative":"kt.academy/nonblocking-spring-mvc.md","copyright":{"author":"Renato Costa"}}');export{B as comp,E as data};
