import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as a,b as k,a as v,t as b,n as r,g as p,w as c,e as n,r as t,o as y}from"./app-BItykJLQ.js";const g={},f={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},I={class:"table-of-contents"},A={class:"hint-container note"},z={href:"https://leanpub.com/effectivekotlin",target:"_blank",rel:"noopener noreferrer"},T={href:"https://amazon.com/Effective-Kotlin-Best-Practices-Developers-ebook/dp/B0CHBR5XPF/",target:"_blank",rel:"noopener noreferrer"};function M(d,e){const i=t("VPCard"),o=t("router-link"),u=t("SiteInfo"),l=t("VPIcon");return y(),h("div",null,[s("h1",f,[s("a",w,[s("span",null,b(d.$frontmatter.title)+" ê´€ë ¨",1)])]),a(i,r(p({title:"Java > Article(s)",desc:"Article(s)",link:"/programming/java/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",I,[s("ul",null,[s("li",null,[a(o,{to:"#using-visibility-modifiers"},{default:c(()=>[...e[0]||(e[0]=[n("Using visibility modifiers",-1)])]),_:1})]),s("li",null,[a(o,{to:"#summary"},{default:c(()=>[...e[1]||(e[1]=[n("Summary",-1)])]),_:1})])])]),e[10]||(e[10]=s("hr",null,null,-1)),a(u,{name:"Item 29: Minimize elementsâ€™ visibility",desc:"Why we should minimize elementsâ€™ visibility and how to do it.",url:"https://kt.academy/article/ek-element-visibility",logo:"https://kt.academy/logo.png",preview:"https://marcinmoskala.com/EffectiveKotlin-Book/promotion/element_visibility.jpg"}),s("div",A,[e[9]||(e[9]=s("p",{class:"hint-container-title"},"Note",-1)),s("p",null,[e[4]||(e[4]=n("This is a chapter from the book ",-1)),e[5]||(e[5]=s("a",{href:"/book/effectivekotlin",target:"_blank",rel:"noopener noreferrer"},"Effective Kotlin",-1)),e[6]||(e[6]=n(". You can find it on ",-1)),s("a",z,[a(l,{icon:"fas fa-globe"}),e[2]||(e[2]=n("LeanPub",-1))]),e[7]||(e[7]=n(" or ",-1)),s("a",T,[a(l,{icon:"fa-brands fa-amazon"}),e[3]||(e[3]=n("Amazon",-1))]),e[8]||(e[8]=n(".",-1))])]),e[11]||(e[11]=k(`<p>When we design an API, there are many reasons to prefer it to be as lean as possible. Letâ€™s specify the most important ones:</p><p><strong>It is easier to learn and maintain a smaller interface.</strong> Understanding a class is easier when there are only a few things we can do with it than when there are dozens. Maintenance is easier as well. When we make changes, we often need to understand the whole class. When fewer elements are visible, there is less to maintain and test.</p><p><strong>When we want to make changes, it is way easier to expose something new than to hide an existing element.</strong> All publicly visible elements are part of our public API, therefore they can be used externally. The longer an element has been visible for, the more external usages it has. As such, changing these elements will be harder because they will require updating all usages. Restricting visibility would be even more of a challenge because youâ€™ll need to carefully consider each usage and provide an alternative. Giving an alternative might not be simple, especially if this element was implemented by another developer. It might also be tough to find out now what the original business requirements were. If it is a public library, restricting some elements&#39; visibility might make some users angry because theyâ€™ll need to adjust their implementation and will face the same problems - theyâ€™ll need to implement alternative solutions probably years after they developed their code. It is much better to force developers to use a smaller API in the first place.</p><p><strong>A class cannot be responsible for its own state when properties that represent this state can be changed from the outside.</strong> We might have assumptions, that class state needs to satisfy. When this state can be directly changed from the outside, the current class cannot guarantee its invariants because it might be changed externally by someone who doesnâ€™t know anything about our internal contract. Take a look at <code>CounterSet</code> from the snippet below. We correctly restricted the visibility of the <code>elementsAdded</code> setter. Without this, someone from outside might change it to any value and we wouldnâ€™t be able to trust that this value really represents how many elements were added. Notice that only setters are private. This is a very useful trick.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="CounterSet.kt"><span>CounterSet.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">class</span> CounterSet<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">val</span> innerSet<span class="token operator">:</span> MutableSet<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">mutableSetOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">:</span> MutableSet<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">by</span> innerSet <span class="token punctuation">{</span></span>
<span class="line"> </span>
<span class="line">  <span class="token keyword">var</span> elementsAdded<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">set</span></span>
<span class="line">   </span>
<span class="line">  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">add</span><span class="token punctuation">(</span>element<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span></span>
<span class="line">    elementsAdded<span class="token operator">++</span></span>
<span class="line">    <span class="token keyword">return</span> innerSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">   </span>
<span class="line">  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">addAll</span><span class="token punctuation">(</span>elements<span class="token operator">:</span> Collection<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span></span>
<span class="line">    elementsAdded <span class="token operator">+=</span> elements<span class="token punctuation">.</span>size</span>
<span class="line">    <span class="token keyword">return</span> innerSet<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>For many cases, it is very helpful that all properties are encapsulated by default in Kotlin because we can always restrict the visibility of concrete accessors.</p><p>Protecting an objectâ€™s internal state is especially important when we have properties that depend on each other. For instance, in the <code>mutableLazy</code> delegate implementation below, we expect that if <code>initialized</code> is <code>true</code>, <code>value</code> is initialized and contains a value of type <code>T</code>. Whatever we do, the setter of <code>initialized</code> should not be exposed, because otherwise it cannot be trusted, which could lead to an ugly exception on a different property.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="MutableLazyHolder.kt"><span>MutableLazyHolder.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">class</span> MutableLazyHolder<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">val</span> initializer<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">var</span> value<span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">var</span> initialized <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">   </span>
<span class="line">  <span class="token keyword">fun</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>initialized<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      value <span class="token operator">=</span> <span class="token function">initializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      initialized <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> value <span class="token keyword">as</span> T</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">   </span>
<span class="line">  <span class="token keyword">fun</span> <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value</span>
<span class="line">    initialized <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>It is easier to track how a class changes when it has more restricted visibility.</strong> This makes the property state easier to understand and is especially important when we are dealing with concurrency. State changes are a problem for parallel programming, so it is better to control and restrict them as much as possible.</p><hr><h2 id="using-visibility-modifiers" tabindex="-1"><a class="header-anchor" href="#using-visibility-modifiers"><span>Using visibility modifiers</span></a></h2><p>To achieve a smaller interface from outside without internal sacrifices, we restrict elementsâ€™ visibility. In general, if there is no reason for an element to be visible, we prefer to hide it. This is why if there is no good reason to have less restrictive visibility, it is good practice to make the visibility of classes and elements as restrictive as possible. We do this using visibility modifiers.</p><p>For class members, these are the 4 visibility modifiers we can use together with their behavior:</p><ul><li><code>public</code> (default) - visible everywhere for clients who can see the declaring class.</li><li><code>private</code> - visible inside this class only.</li><li><code>protected</code> - visible inside this class and in subclasses.</li><li><code>internal</code> - visible inside this module for clients who see the declaring class. Top-level elements have 3 visibility modifiers:</li><li><code>public</code> (default) - visible everywhere.</li><li><code>private</code> - visible inside the same file only.</li><li><code>internal</code> - visible inside this module.</li></ul><p>Note that a module is not the same as a package. In Kotlin, a module is defined as a set of Kotlin sources compiled together. This might be:</p><ul><li>a Gradle source set,</li><li>a Maven project,</li><li>an IntelliJ IDEA module,</li><li>a set of files compiled with one invocation of the Ant task.</li></ul><p>If your module might be used by another module, change the visibility of public elements that you donâ€™t want to expose to <code>internal</code>. If an element is designed for inheritance and is only used in a class and subclasses, make it <code>protected</code>. If you use an element only in the same file or class, make it <code>private</code>. This convention is supported by Kotlin, which suggests restricting visibility to private if an element is used only locally:</p><figure><img src="https://marcinmoskala.com/EffectiveKotlin-Book/manuscript/resources/image_7.png&amp;w=1200&amp;q=75" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>This rule should not be applied to properties in classes that are designed primarily to hold data (data model classes, DTO). If your server returns a user with an age, and you decide to parse it, you donâ€™t need to hide it just because you donâ€™t use it at the moment. It is there to be used and it is better to have it visible. If you donâ€™t need it, get rid of this property entirely.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="User.kt"><span>User.kt</span></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">class</span> <span class="token function">User</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">val</span> surname<span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">val</span> age<span class="token operator">:</span> Int</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>One big limitation is that when we inherit an API, we cannot restrict the visibility of a member by overriding it. This is because the subclass can always be used as its superclass. This is just another reason to prefer composition instead of inheritance (<em>Item 36: Prefer composition over inheritance</em>).</p><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>The rule of thumb is that: <strong>Elementsâ€™ visibility should be as restrictive as possible</strong>. A public API consists of its visible elements, and we prefer it as lean as possible because:</p><ul><li>It is easier to learn and maintain a smaller interface.</li><li>When we want to make changes, it is way easier to expose something than to hide it.</li><li>A class cannot be responsible for its own state when properties that represent this state can be changed from outside.</li><li>It is easier to track how an API changes when it has more restricted visibility.</li></ul>`,25)),v(" TODO: add ARTICLE CARD "),a(i,r(p({title:"Item 29: Minimize elementsâ€™ visibility",desc:"Why we should minimize elementsâ€™ visibility and how to do it.",link:"https://chanhi2000.github.io/bookshelf/kt.academy/ek-element-visibility.html",logo:"https://kt.academy/logo.png",background:"rgba(243,139,49,0.2)"})),null,16)])}const _=m(g,[["render",M]]),P=JSON.parse('{"path":"/kt.academy/ek-element-visibility.html","title":"Item 29: Minimize elementsâ€™ visibility","lang":"en-US","frontmatter":{"lang":"en-US","title":"Item 29: Minimize elementsâ€™ visibility","description":"Article(s) > Item 29: Minimize elementsâ€™ visibility","icon":"iconfont icon-kotlin","category":["Java","Kotlin","Article(s)"],"tag":["blog","kt.academy","java","kotlin"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Item 29: Minimize elementsâ€™ visibility\\",\\"image\\":[\\"https://marcinmoskala.com/EffectiveKotlin-Book/manuscript/resources/image_7.png&w=1200&q=75\\"],\\"datePublished\\":\\"2024-05-06T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Marcin MoskaÅ‚a\\",\\"url\\":\\"https://kt.academy/user/marcinmoskala\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kt.academy/ek-element-visibility.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Item 29: Minimize elementsâ€™ visibility"}],["meta",{"property":"og:description","content":"Article(s) > Item 29: Minimize elementsâ€™ visibility"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://kt.academy/_next/image?url=https%3A//marcinmoskala.com/EffectiveKotlin-Book/promotion/element_visibility.jpg&w=640&q=75"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://kt.academy/_next/image?url=https%3A//marcinmoskala.com/EffectiveKotlin-Book/promotion/element_visibility.jpg&w=640&q=75"}],["meta",{"name":"twitter:image:alt","content":"Item 29: Minimize elementsâ€™ visibility"}],["meta",{"property":"article:author","content":"Marcin MoskaÅ‚a"}],["meta",{"property":"article:tag","content":"kotlin"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"kt.academy"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-05-06T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Item 29: Minimize elementsâ€™ visibility"},{"property":"og:description","content":"Item 29: Minimize elementsâ€™ visibility"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kt.academy/ek-element-visibility.html"}]],"prev":"/programming/java/articles/README.md","date":"2024-05-06T00:00:00.000Z","isOriginal":false,"author":[{"name":"Marcin MoskaÅ‚a","url":"https://kt.academy/user/marcinmoskala"}],"cover":"https://kt.academy/_next/image?url=https%3A//marcinmoskala.com/EffectiveKotlin-Book/promotion/element_visibility.jpg&w=640&q=75"},"git":{},"readingTime":{"minutes":4.57,"words":1371},"filePathRelative":"kt.academy/ek-element-visibility.md","copyright":{"author":"Marcin MoskaÅ‚a"}}');export{_ as comp,P as data};
