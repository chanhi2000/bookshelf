import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,d as s,f as e,b as r,t as b,n as c,g as u,w as i,e as a,r as p,o as h}from"./app-BItykJLQ.js";const f={},y={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},M={class:"table-of-contents"},T={href:"https://masstransit.io/",target:"_blank",rel:"noopener noreferrer"},C={href:"https://opentelemetry.io/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://rabbitmq.com/",target:"_blank",rel:"noopener noreferrer"},S={href:"https://azure.microsoft.com/en-us/products/service-bus",target:"_blank",rel:"noopener noreferrer"},x={href:"https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/reference-types",target:"_blank",rel:"noopener noreferrer"};function q(m,n){const l=p("VPCard"),t=p("router-link"),g=p("SiteInfo"),o=p("VPIcon"),d=p("VidStack");return h(),k("div",null,[s("h1",y,[s("a",w,[s("span",null,b(m.$frontmatter.title)+" ê´€ë ¨",1)])]),e(l,c(u({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",M,[s("ul",null,[s("li",null,[e(t,{to:"#why-use-masstransit"},{default:i(()=>[...n[0]||(n[0]=[a("Why Use MassTransit?",-1)])]),_:1})]),s("li",null,[e(t,{to:"#installing-and-configuring-masstransit-with-rabbitmq"},{default:i(()=>[...n[1]||(n[1]=[a("Installing and Configuring MassTransit with RabbitMQ",-1)])]),_:1})]),s("li",null,[e(t,{to:"#configuring-masstransit-with-azure-service-bus"},{default:i(()=>[...n[2]||(n[2]=[a("Configuring MassTransit with Azure Service Bus",-1)])]),_:1})]),s("li",null,[e(t,{to:"#using-the-masstransit-in-memory-transport"},{default:i(()=>[...n[3]||(n[3]=[a("Using the MassTransit In Memory Transport",-1)])]),_:1})]),s("li",null,[e(t,{to:"#message-types"},{default:i(()=>[...n[4]||(n[4]=[a("Message Types",-1)])]),_:1})]),s("li",null,[e(t,{to:"#publishing-and-consuming-messages"},{default:i(()=>[...n[5]||(n[5]=[a("Publishing and Consuming Messages",-1)])]),_:1})]),s("li",null,[e(t,{to:"#next-steps"},{default:i(()=>[...n[6]||(n[6]=[a("Next Steps",-1)])]),_:1})])])]),n[37]||(n[37]=s("hr",null,null,-1)),e(g,{name:"Using MassTransit with RabbitMQ and Azure Service Bus",desc:"MassTransit is an open-source distributed application framework for .NET. It provides a messaging abstraction on top of the supported message transports. In this week's issue, I'll show you how to use MassTransit.",url:"https://milanjovanovic.tech/blog/using-masstransit-with-rabbitmq-and-azure-service-bus/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_071.png"}),s("p",null,[s("a",T,[e(o,{icon:"fas fa-globe"}),n[7]||(n[7]=a("MassTransit",-1))]),n[8]||(n[8]=a(" is an open-source distributed application framework for .NET. It provides a messaging abstraction on top of the supported message transports. MassTransit lets you focus on adding business value instead of worrying about messaging complexity.",-1))]),n[38]||(n[38]=r('<p>MassTransit supports many message transport technologies. Here are a few that are popular:</p><ul><li>RabbitMQ</li><li>Azure Service Bus</li><li>Amazon SQS</li><li>Kafka</li></ul><p>In today&#39;s newsletter, I&#39;ll show you how to install and configure MassTransit in .NET. We&#39;ll connect MassTransit to a few message brokers - RabbitMQ and Azure Service Bus. And we will also cover how to publish and consume messages with MassTransit.</p><hr><h2 id="why-use-masstransit" tabindex="-1"><a class="header-anchor" href="#why-use-masstransit"><span>Why Use MassTransit?</span></a></h2><p>MassTransit solves many challenges of building distributed applications. You (almost) don&#39;t have to think about the underlying message transport. This allows you to focus on providing business value.</p><p>Here are a few things MassTransit does for you:</p>',7)),s("ul",null,[n[13]||(n[13]=s("li",null,[s("strong",null,"Message routing"),a(": Type-based publish/subscribe, automatic broker topology configuration")],-1)),n[14]||(n[14]=s("li",null,[s("strong",null,"Exception handling"),a(": Messages can be retried or moved to an error queue")],-1)),n[15]||(n[15]=s("li",null,[s("strong",null,"Dependency injection"),a(": Service collection configuration and scope service provider")],-1)),n[16]||(n[16]=s("li",null,[s("strong",null,"Request-Response"),a(": Handle requests with automatic response routing")],-1)),s("li",null,[n[10]||(n[10]=s("strong",null,"Observability",-1)),n[11]||(n[11]=a(": Native ",-1)),s("a",C,[e(o,{icon:"fas fa-globe"}),n[9]||(n[9]=a("Open Telemetry (OTEL)",-1))]),n[12]||(n[12]=a(" support",-1))]),n[17]||(n[17]=s("li",null,[s("strong",null,"Scheduling"),a(": Schedule message delivery using transport delay, Quartz.NET, or Hangfire")],-1)),n[18]||(n[18]=s("li",null,[s("strong",null,"Sagas"),a(": Reliable, durable, event-driven workflow orchestration")],-1))]),n[39]||(n[39]=s("p",null,"Let's see how to start using MassTransit.",-1)),n[40]||(n[40]=s("hr",null,null,-1)),n[41]||(n[41]=s("h2",{id:"installing-and-configuring-masstransit-with-rabbitmq",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#installing-and-configuring-masstransit-with-rabbitmq"},[s("span",null,"Installing and Configuring MassTransit with RabbitMQ")])],-1)),s("p",null,[n[20]||(n[20]=a("You need to install the ",-1)),n[21]||(n[21]=s("code",null,"MassTransit",-1)),n[22]||(n[22]=a(" library. If you already have a message transport, you can install the respective transport library. Let's add the ",-1)),n[23]||(n[23]=s("code",null,"MassTransit.RabbitMQ",-1)),n[24]||(n[24]=a(" library to configure ",-1)),s("a",A,[e(o,{icon:"iconfont icon-rabbitmq"}),n[19]||(n[19]=a("RabbitMQ",-1))]),n[25]||(n[25]=a(" as the transport mechanism.",-1))]),n[42]||(n[42]=r(`<div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token function">Install-Package</span> MassTransit</span>
<span class="line"></span>
<span class="line"><span class="token function">Install-Package</span> MassTransit<span class="token punctuation">.</span>RabbitMQ</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, you can configure the required services for <code>MassTransit</code>. The <code>AddMassTransit</code> method accepts a delegate where you can configure many settings. For example, you can set the messaging endpoints to use kebab case naming by calling <code>SetKebabCaseEndpointNameFormatter</code>. This is also where you configure the transport mechanism. Calling <code>UsingRabbitMq</code> allows you to connect RabbitMQ as the transport mechanism.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>busConfigurator <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> configurator<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        configurator<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> h <span class="token operator">=&gt;</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            h<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            h<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        configurator<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MassTransit takes care of setting up the required broker topology. RabbitMQ supports exchanges and queues, so messages are sent or published to exchanges. RabbitMQ routes those messages through exchanges to the appropriate queues.</p><p>You can start RabbitMQ locally inside a Docker container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> rabbitmq <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="configuring-masstransit-with-azure-service-bus" tabindex="-1"><a class="header-anchor" href="#configuring-masstransit-with-azure-service-bus"><span>Configuring MassTransit with Azure Service Bus</span></a></h2>`,8)),s("p",null,[s("a",S,[e(o,{icon:"iconfont icon-microsoftazure"}),n[26]||(n[26]=a("Azure Service Bus",-1))]),n[27]||(n[27]=a(" is a cloud-based message broker with support for queues and topics. MassTransit fully supports Azure Service Bus, including many advanced features and capabilities. However, you must be on the Standard or Premium tier of the Microsoft Azure Service Bus service.",-1))]),n[43]||(n[43]=r(`<p>To configure MassTransit to work with Azure Service Bus, you need to install the required transport library:</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token function">Install-Package</span> MassTransit<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>ServiceBus<span class="token punctuation">.</span>Core</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then, you can connect to Azure Service Bus by calling <code>UsingAzureServiceBus</code> and providing the connection string. Everything else remains the same. MassTransit takes care of configuring the broker topology. MassTransit sends messages to topics, and Azure Service Bus routes those messages to the appropriate queues.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>busConfigurator <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">UsingAzureServiceBus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> configurator<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        configurator<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;CONNECTION_STRING&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        configurator<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="using-the-masstransit-in-memory-transport" tabindex="-1"><a class="header-anchor" href="#using-the-masstransit-in-memory-transport"><span>Using the MassTransit In Memory Transport</span></a></h2><p>You can also configure MassTransit to use an in-memory transport. It&#39;s useful for testing, because it doesn&#39;t require a message broker to be running. Another advantage is that it&#39;s fast.</p><p>However, there&#39;s a big problem with the in-memory transport - <strong>it&#39;s not durable.</strong></p><p>If the message bus is stopped, all messages are lost. Don&#39;t use the in-memory transport for production systems.</p><p>It will only work on a single machine. So, it doesn&#39;t make sense for distributed applications.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>busConfigurator <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">UsingInMemory</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> configurator<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        configurator<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="message-types" tabindex="-1"><a class="header-anchor" href="#message-types"><span>Message Types</span></a></h2>`,13)),s("p",null,[n[29]||(n[29]=a("MassTransit requires message types to be ",-1)),s("a",x,[e(o,{icon:"fa-brands fa-microsoft"}),n[28]||(n[28]=a("reference types.",-1))]),n[30]||(n[30]=a(" So, you can use a ",-1)),n[31]||(n[31]=s("code",null,"class",-1)),n[32]||(n[32]=a(", ",-1)),n[33]||(n[33]=s("code",null,"record",-1)),n[34]||(n[34]=a(" or ",-1)),n[35]||(n[35]=s("code",null,"interface",-1)),n[36]||(n[36]=a(" to define a message.",-1))]),n[44]||(n[44]=r(`<p>You&#39;ll often create two types of messages: commands and events.</p><p>A command is an instruction to perform some action. Commands are intended to have exactly one consumer. Commands are expressed using verbs first: <code>CreateArticle</code>, <code>PublishArticle</code>, <code>ShareArticle</code>.</p><p>An event represents that something of significance happened. Events can have one or many consumers. Events should have a name in the past tense: <code>ArticleCreated</code>, <code>ArticlePublished</code>, <code>ArticleShared</code>.</p><p>Here&#39;s an example <code>ArticleCreated</code> message containing information about an article:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">ArticleCreated</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Content <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedOnUtc <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using <code>public set</code> or <code>public init</code> properties is recommended to avoid serialization problems with <code>System.Text.Json</code>.</p><hr><h2 id="publishing-and-consuming-messages" tabindex="-1"><a class="header-anchor" href="#publishing-and-consuming-messages"><span>Publishing and Consuming Messages</span></a></h2><p>You can use the <code>IPublishEndpoint</code> service to publish messages with MassTransit. The framework routes the message to the appropriate queue or topic based on the message type.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">app<span class="token punctuation">.</span><span class="token function">MapPost</span><span class="token punctuation">(</span><span class="token string">&quot;article&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">CreateArticleRequest</span> request<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IPublishEndpoint</span> publishEndpoint<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> publishEndpoint<span class="token punctuation">.</span><span class="token function">Publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArticleCreated</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        Title <span class="token operator">=</span> request<span class="token punctuation">.</span>Title<span class="token punctuation">,</span></span>
<span class="line">        Content <span class="token operator">=</span> request<span class="token punctuation">.</span>Content<span class="token punctuation">,</span></span>
<span class="line">        CreatedOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Accepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To consume an <code>ArticleCreated</code> message, you need to implement the <code>IConsumer</code> interface. The <code>IConsumer</code> has one <code>Consume</code> method where you place your business logic. The consumer also gives you access to the <code>ConsumeContext</code>, which you can use to send further messages.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleCreatedConsumer</span><span class="token punctuation">(</span><span class="token class-name">ApplicationDbContext</span> dbContext<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">:</span> IConsumer<span class="token operator">&lt;</span>ArticleCreatedEvent<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>ArticleCreatedEvent<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ArticleCreated</span> message <span class="token operator">=</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> article <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Article</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Id <span class="token operator">=</span> message<span class="token punctuation">.</span>Id<span class="token punctuation">,</span></span>
<span class="line">            Title <span class="token operator">=</span> message<span class="token punctuation">.</span>Title<span class="token punctuation">,</span></span>
<span class="line">            Content <span class="token operator">=</span> message<span class="token punctuation">.</span>Content<span class="token punctuation">,</span></span>
<span class="line">            CreatedOnUtc <span class="token operator">=</span> message<span class="token punctuation">.</span>CreatedOnUtc</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        dbContext<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> dbContext<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MassTransit doesn&#39;t automatically know that the <code>ArticleCreatedConsumer</code> exists. You have to configure the consumer when calling <code>AddMassTransit</code>. The <code>AddConsumer</code> method registers the consumer type with the bus.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>busConfigurator <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    busConfigurator<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ArticleCreatedConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="next-steps" tabindex="-1"><a class="header-anchor" href="#next-steps"><span>Next Steps</span></a></h2><p><strong>MassTransit</strong> is an excellent messaging library I often use when building distributed applications. The setup is straightforward, and there are only a few important abstractions. You need to know abstraction for publishing messages (<code>IPublishEndpoint</code>) and consuming messages (<code>IConsumer</code>). MassTransit takes care of doing the heavy lifting for you.</p><p>If you aren&#39;t already using it, I highly recommend adding MassTransit to your toolbox.</p><p>Here are some more practical <strong>MassTransit learning resources</strong>:</p>`,19)),e(d,{src:"youtube/NjsoykEOkrk"}),e(d,{src:"youtube/CTKWFMZVIWA"}),e(d,{src:"youtube/MzC0PgYocmk"}),e(l,c(u({title:"Implementing The Saga Pattern With Rebus And RabbitMQ",desc:"Designing long-lived processes in a distributed environment is an interesting engineering challenge. And a well known pattern for solving this problem is a Saga. A Saga is a sequence of local transactions, where each local transaction updates the Saga state and publishes a message triggering the next step in the Saga. Sagas come in two forms: Orchestrated Choreographed With an orchestrated Saga, there's a central component responsible for orchestrating the individual steps. In a choreographed Saga, processes work independently but coordinate with each other using events.",link:"/milanjovanovic.tech/implementing-the-saga-pattern-with-rebus-and-rabbitmq.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),e(l,c(u({title:"Orchestration vs Choreography",desc:"More than 63%+ of organizations said in a Dzone survey that they are adopting Microservices for some or all of their applications. As more businesses adopt the use of Microservice architectures, we as developers have to become more skilled with Microservices communication. Working with distributed systems is both fun and challenging at the same time. One of those challenges is designing effective communication between services. More centralization or less centralization? More coupling or less coupling? More control or less control? These are only a few questions you need to answer.",link:"/milanjovanovic.tech/orchestration-vs-choreography.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),e(l,c(u({title:"Messaging Made Easy With Azure Service Bus",desc:"If you're working in a distributed system, you need to be able to communicate between multiple services. There are a few ways that you can implement this. Depending on your chosen approach, you can either introduce tight coupling between your services or stay loosely coupled. Loose coupling is an important quality in a distributed system. It will allow you to evolve your services independently. So how do you implement loosely coupled communication between services?",link:"/milanjovanovic.tech/messaging-made-easy-with-azure-service-bus.md",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0,2)"})),null,16),n[45]||(n[45]=s("p",null,"That's all for today.",-1)),n[46]||(n[46]=s("p",null,"See you next week.",-1))])}const R=v(f,[["render",q]]),j=JSON.parse('{"path":"/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html","title":"Using MassTransit with RabbitMQ and Azure Service Bus","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Using MassTransit with RabbitMQ and Azure Service Bus","description":"Article(s) > Using MassTransit with RabbitMQ and Azure Service Bus","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Using MassTransit with RabbitMQ and Azure Service Bus\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_071.png\\"],\\"datePublished\\":\\"2024-01-06T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Using MassTransit with RabbitMQ and Azure Service Bus"}],["meta",{"property":"og:description","content":"Article(s) > Using MassTransit with RabbitMQ and Azure Service Bus"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_071.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_071.png"}],["meta",{"name":"twitter:image:alt","content":"Using MassTransit with RabbitMQ and Azure Service Bus"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-01-06T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Using MassTransit with RabbitMQ and Azure Service Bus"},{"property":"og:description","content":"Using MassTransit with RabbitMQ and Azure Service Bus"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-01-06T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_071.png"},"git":{},"readingTime":{"minutes":5.25,"words":1576},"filePathRelative":"milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{R as comp,j as data};
