import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,d as s,f as e,b as l,a as g,t as b,n as u,g as d,w as t,e as a,r as p,o as y}from"./app-BItykJLQ.js";const f={},w={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},A={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},q={class:"table-of-contents"},S={href:"https://learn.microsoft.com/en-us/dotnet/aspire/get-started/aspire-overview",target:"_blank",rel:"noopener noreferrer"},T={href:"https://learn.microsoft.com/en-us/dotnet/core/extensions/service-discovery",target:"_blank",rel:"noopener noreferrer"},P={href:"https://learn.microsoft.com/en-us/aspnet/core/blazor/hosting-models",target:"_blank",rel:"noopener noreferrer"},x={href:"https://learn.microsoft.com/en-us/dotnet/core/extensions/service-discovery",target:"_blank",rel:"noopener noreferrer"};function j(v,n){const r=p("VPCard"),o=p("router-link"),m=p("SiteInfo"),c=p("VPIcon"),i=p("RouteLink");return y(),h("div",null,[s("h1",w,[s("a",A,[s("span",null,b(v.$frontmatter.title)+" ê´€ë ¨",1)])]),e(r,u(d({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),s("nav",q,[s("ul",null,[s("li",null,[e(o,{to:"#understanding-service-discovery"},{default:t(()=>[...n[0]||(n[0]=[a("Understanding Service Discovery",-1)])]),_:1})]),s("li",null,[e(o,{to:"#practical-example-of-service-discovery"},{default:t(()=>[...n[1]||(n[1]=[a("Practical Example of Service Discovery",-1)])]),_:1})]),s("li",null,[e(o,{to:"#service-discovery-under-the-hood"},{default:t(()=>[...n[2]||(n[2]=[a("Service Discovery Under the Hood",-1)])]),_:1})]),s("li",null,[e(o,{to:"#service-discovery-with-yarp-as-a-proxy"},{default:t(()=>[...n[3]||(n[3]=[a("Service Discovery with YARP as a Proxy",-1)])]),_:1})]),s("li",null,[e(o,{to:"#conclusion"},{default:t(()=>[...n[4]||(n[4]=[a("Conclusion",-1)])]),_:1})])])]),n[39]||(n[39]=s("hr",null,null,-1)),e(m,{name:"How .NET Aspire Simplifies Service Discovery",desc:".NET Aspire revolutionizes distributed application development by simplifying service discovery through configuration-based approaches that eliminate the complexity of service-to-service communication.",url:"https://milanjovanovic.tech/blog/how-dotnet-aspire-simplifies-service-discovery",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_135.png"}),s("p",null,[n[6]||(n[6]=a("Unless you've been living under a rock, you know that ",-1)),s("a",S,[e(c,{icon:"fa-brands fa-microsoft   "}),n[5]||(n[5]=a(".NET Aspire",-1))]),n[7]||(n[7]=a(" is changing (for the better) how we build distributed applications in .NET. A simple way to think about Aspire: it makes all the difficult things in software development easy.",-1))]),s("p",null,[n[9]||(n[9]=a(".NET Aspire is a cloud-native application stack that simplifies the development and deployment of distributed applications. One of the key challenges when building multi-service applications is building reliable ",-1)),e(i,{to:"/milanjovanovic.tech/modular-monolith-communication-patterns.html"},{default:t(()=>[...n[8]||(n[8]=[s("strong",null,"communication between services",-1)])]),_:1}),n[10]||(n[10]=a(".",-1))]),s("p",null,[n[12]||(n[12]=a("In this week's newsletter, I want to focus on one aspect of .NET Aspire - ",-1)),e(i,{to:"/milanjovanovic.tech/service-discovery-in-microservices-with-net-and-consul.html"},{default:t(()=>[...n[11]||(n[11]=[s("strong",null,"service discovery",-1)])]),_:1}),n[13]||(n[13]=a(". Service discovery lets our services figure out how to locate other services they want to integrate with. .NET Aspire tackles this challenge with a simple, configuration-based approach that reduces complexity and boilerplate code.",-1))]),n[40]||(n[40]=s("hr",null,null,-1)),n[41]||(n[41]=s("h2",{id:"understanding-service-discovery",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#understanding-service-discovery"},[s("span",null,"Understanding Service Discovery")])],-1)),s("p",null,[s("a",T,[e(c,{icon:"fa-brands fa-microsoft"}),n[14]||(n[14]=a("Service discovery**",-1))]),n[15]||(n[15]=a(" is the process by which services in a distributed application locate and communicate with each other. As applications scale and evolve, keeping track of service endpoints becomes increasingly challenging. Services might run on different ports during development or be deployed to different environments in production, making hard-coded service URLs impractical.",-1))]),n[42]||(n[42]=l(`<p>Traditional approaches to service discovery often introduce complexity:</p><ul><li>Manual configuration of service endpoints that must be updated as environments change</li><li>Complex intermediary systems that require additional maintenance</li><li>Custom code to handle service resolution and connection management</li></ul><p>While many service discovery implementations rely on centralized registries, .NET Aspire takes a different approach by leveraging application configuration to connect services. This design choice simplifies the development experience while maintaining flexibility for various deployment scenarios. Aspire automatically takes care of wiring up the correct service URLs and injecting them into your application settings.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_135/aspire_service_discovery.png?imwidth=3840" alt="Diagram explaining how the .NET Aspire service discovery mechanism works." tabindex="0" loading="lazy"><figcaption>Diagram explaining how the .NET Aspire service discovery mechanism works.</figcaption></figure><hr><h2 id="practical-example-of-service-discovery" tabindex="-1"><a class="header-anchor" href="#practical-example-of-service-discovery"><span>Practical Example of Service Discovery</span></a></h2><p>To understand how .NET Aspire handles service discovery, let&#39;s look at a practical example of an application with multiple services:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> DistributedApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Add services to the app</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> apiService <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Projects<span class="token punctuation">.</span>WeatherApi<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> webFrontend <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Projects<span class="token punctuation">.</span>WebFrontend<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;web-frontend&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithReference</span><span class="token punctuation">(</span>apiService<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)),s("p",null,[n[18]||(n[18]=a("In this App Host definition, we're creating two services: a weather API and a web frontend. The ",-1)),n[19]||(n[19]=s("code",null,".WithReference()",-1)),n[20]||(n[20]=a(" method establishes a connection between these services, which enables service discovery. This simple declaration tells ",-1)),e(i,{to:"/milanjovanovic.tech/dotnet-aspire-a-game-changer-for-cloud-native-development.html"},{default:t(()=>[...n[16]||(n[16]=[s("strong",null,".NET Aspire",-1)])]),_:1}),n[21]||(n[21]=a(" that the web frontend depends on the weather API and needs to communicate with it. Note that the ",-1)),n[22]||(n[22]=s("code",null,"web-frontend",-1)),n[23]||(n[23]=a(" has to be a server-side application (like ",-1)),s("a",P,[e(c,{icon:"fa-brands fa-microsoft"}),n[17]||(n[17]=a("Blazor Server",-1))]),n[24]||(n[24]=a(") for Aspire to be able to inject the service URL.",-1))]),n[43]||(n[43]=l(`<p>With this configuration in place, the web frontend can now reach the API using the service name <code>weather-api</code> without additional service discovery code:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// Configures the default Aspire services, including service discovery</span></span>
<span class="line">builder<span class="token punctuation">.</span><span class="token function">AddServiceDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// In Program.cs of the web-frontend project</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;weather-api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// The service name &quot;weather-api&quot; automatically resolves to the correct address</span></span>
<span class="line">    client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This works because .NET Aspire manages the mapping between service names and their actual endpoints. When the application runs, service discovery ensures that requests to <code>http://weather-api</code> are routed to the appropriate destination.</p><hr><h2 id="service-discovery-under-the-hood" tabindex="-1"><a class="header-anchor" href="#service-discovery-under-the-hood"><span>Service Discovery Under the Hood</span></a></h2><p>The previous example contains a bit of &quot;magic&quot; that might not be immediately clear. The <code>AddServiceDefaults()</code> method configures the default services for the application, including service discovery.</p><p>If we were to configure everything manually, it would look something like this:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddServiceDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;weather-api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">AddServiceDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The first <code>AddServiceDiscovery()</code> method registers the necessary services to enable service discovery in the application. The second <code>AddServiceDiscovery()</code> method on the HTTP client configures it to use service discovery for resolving the base address. This means that when the HTTP client makes requests to <code>http://weather-api</code>, it will automatically resolve the correct endpoint based on the service discovery configuration.</p><p>We can also configure service discovery globally for all HTTP clients in the application:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">ConfigureHttpClientDefaults</span><span class="token punctuation">(</span><span class="token keyword">static</span> http <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Turn on service discovery by default</span></span>
<span class="line">    http<span class="token punctuation">.</span><span class="token function">AddServiceDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This configuration ensures that all HTTP clients in the application will use service discovery by default, eliminating the need to configure it for each client individually.</p><p>What Aspire does at runtime for all of this to work is inject a set of configuration values. The configuration value names are derived from the service names we defined in the App Host, plus the respective scheme (http or https). Here&#39;s an example of what the <code>weather-api</code> configuration might look like:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;Services&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;weather-api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;http&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;localhost:8080&quot;</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We can also configure service discovery to work with HTTPS by adding the <code>https</code> scheme to the service name:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// Specify the https scheme explicitly in the service name</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;weather-api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Alternatively, we can use the https+http scheme and let Aspire handle the conversion</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;weather-api-2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https+http://weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A significant advantage of Aspire&#39;s service discovery is its consistent behavior across environments:</p><ul><li>During development, services might run on localhost with different ports</li><li>In testing environments, services could be containerized</li><li>In production, services might be deployed to Kubernetes or other platforms</li></ul><p>Your code remains unchanged across these scenarios because the service name abstraction shields you from the underlying networking details.</p>`,19)),s("p",null,[n[26]||(n[26]=a("Note that you don't have to use .NET Aspire to benefit from ",-1)),s("a",x,[e(c,{icon:"fa-brands fa-microsoft"}),n[25]||(n[25]=a("service discovery",-1))]),n[27]||(n[27]=a(". It's available as a standalone library (",-1)),n[28]||(n[28]=s("code",null,"Microsoft.Extensions.ServiceDiscovery",-1)),n[29]||(n[29]=a(") and you can use it in any .NET application.",-1))]),n[44]||(n[44]=s("hr",null,null,-1)),n[45]||(n[45]=s("h2",{id:"service-discovery-with-yarp-as-a-proxy",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#service-discovery-with-yarp-as-a-proxy"},[s("span",null,"Service Discovery with YARP as a Proxy")])],-1)),s("p",null,[n[31]||(n[31]=a("A powerful application of .NET Aspire's service discovery capabilities is in API gateway scenarios using ",-1)),e(i,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:t(()=>[...n[30]||(n[30]=[s("strong",null,"YARP",-1)])]),_:1}),n[32]||(n[32]=a(" (Yet Another Reverse Proxy). Let's explore how to implement this pattern:",-1))]),n[46]||(n[46]=l(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// In the App Host</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> apiService <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Projects<span class="token punctuation">.</span>WeatherApi<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;weather-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> userService <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Projects<span class="token punctuation">.</span>UserApi<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;user-api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> proxyService <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Projects<span class="token punctuation">.</span>ApiGateway<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;api-gateway&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithReference</span><span class="token punctuation">(</span>apiService<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithReference</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We&#39;ll need to add the YARP NuGet package to the API gateway project:</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token function">Install-Package</span> Yarp<span class="token punctuation">.</span>ReverseProxy <span class="token comment"># Adds the YARP package</span></span>
<span class="line"><span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>ServiceDiscovery<span class="token punctuation">.</span>Yarp <span class="token comment"># Adds the YARP service discovery package</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>In the gateway project, we can configure YARP to use service discovery:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token comment">// In Program.cs of the api-gateway project</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Cofigures the service discovery services</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddServiceDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Add YARP services</span></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">LoadFromConfig</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;ReverseProxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// Configures a destination resolver that can use service discovery</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">AddServiceDiscoveryDestinationResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Configure the HTTP request pipeline</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">MapReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The YARP configuration in <code>appsettings.json</code> leverages the service names for endpoint resolution:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="appsettings.json"><span>appsettings.json</span></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ReverseProxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;weather-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;weather-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/weather/{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Transforms&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span> <span class="token property">&quot;PathRemovePrefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/weather&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;user-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/users/{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Transforms&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span> <span class="token property">&quot;PathRemovePrefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/users&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Clusters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;weather-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://weather-api&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;user-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://user-api&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This configuration creates an API gateway that:</p><ul><li>Routes requests with path <code>/weather/*</code> to the weather API service</li><li>Routes requests with path <code>/users/*</code> to the user API service</li><li>Uses service names (<code>weather-api</code> and <code>user-api</code>) that service discovery resolves at runtime</li></ul><p>The beauty of this approach is that the gateway doesn&#39;t need to know the actual endpoints of the backend services. It simply uses the service names, and .NET Aspire handles providing the configuration at runtime. This makes the gateway configuration more portable and easier to maintain as the application evolves.</p><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>.NET Aspire transforms service discovery from a complex infrastructure challenge into a straightforward configuration concern. By using a configuration-based approach rather than a centralized registry, it simplifies the development experience while maintaining the flexibility needed for various deployment scenarios.</p><p>The key advantages of Aspire&#39;s service discovery include:</p><ul><li>Declarative service relationships in the App Host</li><li>Simple service name resolution that works across environments</li><li>Seamless integration with the .NET ecosystem and dependency injection</li><li>Powerful applications in patterns like API gateways with YARP</li></ul><p>As the .NET Aspire stack continues to evolve, its approach to service discovery represents one of the ways it&#39;s making cloud-native development more accessible to .NET developers. By reducing the complexity of service-to-service communication, Aspire enables teams to focus on building features rather than wrestling with infrastructure concerns.</p>`,16)),s("p",null,[n[34]||(n[34]=a("If you want to explore more robust service discovery solutions for large-scale distributed systems, check out my previous article on ",-1)),e(i,{to:"/milanjovanovic.tech/service-discovery-in-microservices-with-net-and-consul.html"},{default:t(()=>[...n[33]||(n[33]=[s("strong",null,"implementing service discovery with Consul",-1)])]),_:1}),n[35]||(n[35]=a(". It provides a complementary approach for scenarios that might require a more traditional service registry.",-1))]),s("p",null,[n[37]||(n[37]=a("For those who found the YARP integration particularly interesting, my ",-1)),e(i,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:t(()=>[...n[36]||(n[36]=[s("strong",null,"Modular Monolith Architecture",-1)])]),_:1}),n[38]||(n[38]=a(" course dives deeper into building scalable applications with YARP as an API gateway. You'll learn how to leverage these patterns to create maintainable, evolvable systems regardless of whether you're using microservices or a monolith.",-1))]),n[47]||(n[47]=s("hr",null,null,-1)),g(" TODO: add ARTICLE CARD "),e(r,u(d({title:"How .NET Aspire Simplifies Service Discovery",desc:".NET Aspire revolutionizes distributed application development by simplifying service discovery through configuration-based approaches that eliminate the complexity of service-to-service communication.",link:"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-dotnet-aspire-simplifies-service-discovery.html",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16)])}const N=k(f,[["render",j]]),R=JSON.parse('{"path":"/milanjovanovic.tech/how-dotnet-aspire-simplifies-service-discovery.html","title":"How .NET Aspire Simplifies Service Discovery","lang":"en-US","frontmatter":{"lang":"en-US","title":"How .NET Aspire Simplifies Service Discovery","description":"Article(s) > How .NET Aspire Simplifies Service Discovery","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","csharp","c#","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How .NET Aspire Simplifies Service Discovery\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_135/aspire_service_discovery.png?imwidth=3840\\"],\\"datePublished\\":\\"2025-03-29T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-dotnet-aspire-simplifies-service-discovery.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"How .NET Aspire Simplifies Service Discovery"}],["meta",{"property":"og:description","content":"Article(s) > How .NET Aspire Simplifies Service Discovery"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_135.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_135.png"}],["meta",{"name":"twitter:image:alt","content":"How .NET Aspire Simplifies Service Discovery"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-03-29T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > How .NET Aspire Simplifies Service Discovery"},{"property":"og:description","content":"How .NET Aspire Simplifies Service Discovery"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-dotnet-aspire-simplifies-service-discovery.html"}]],"prev":"/programming/cs/articles/README.md","date":"2025-03-29T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_135.png"},"git":{},"readingTime":{"minutes":5.82,"words":1747},"filePathRelative":"milanjovanovic.tech/how-dotnet-aspire-simplifies-service-discovery.md","copyright":{"author":"Milan JovanoviÄ‡"}}');export{N as comp,R as data};
