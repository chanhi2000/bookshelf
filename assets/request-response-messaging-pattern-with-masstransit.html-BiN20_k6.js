import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as n,f as a,b as l,t as v,n as h,g as b,w as t,e,r as o,o as y}from"./app-BVguHYKu.js";const w={},f={id:"frontmatter-title-관련",tabindex:"-1"},R={class:"header-anchor",href:"#frontmatter-title-관련"},q={class:"table-of-contents"},T={href:"https://masstransit.io/documentation/concepts/requests",target:"_blank",rel:"noopener noreferrer"},M={href:"https://youtu.be/NjsoykEOkrk",target:"_blank",rel:"noopener noreferrer"};function P(c,s){const u=o("VPCard"),p=o("router-link"),d=o("SiteInfo"),i=o("RouteLink"),r=o("VPIcon"),m=o("VidStack");return y(),g("div",null,[n("h1",f,[n("a",R,[n("span",null,v(c.$frontmatter.title)+" 관련",1)])]),a(u,h(b({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"https://chanhi2000.github.io/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",q,[n("ul",null,[n("li",null,[a(p,{to:"#request-response-messaging-pattern-introduction"},{default:t(()=>s[0]||(s[0]=[e("Request-Response Messaging Pattern Introduction")])),_:1,__:[0]})]),n("li",null,[a(p,{to:"#getting-user-permissions-in-a-modular-monolith"},{default:t(()=>s[1]||(s[1]=[e("Getting User Permissions In a Modular Monolith")])),_:1,__:[1]})]),n("li",null,[a(p,{to:"#closing-thoughts"},{default:t(()=>s[2]||(s[2]=[e("Closing Thoughts")])),_:1,__:[2]})])])]),s[23]||(s[23]=n("hr",null,null,-1)),a(d,{name:"Request-Response Messaging Pattern With MassTransit",desc:"When building distributed systems with .NET, direct calls between services can create tight coupling. The request-response messaging pattern can allow distributed services to communicate in a loosely coupled way.",url:"https://milanjovanovic.tech/blog/request-response-messaging-pattern-with-masstransit/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_087.png"}),s[24]||(s[24]=n("p",null,"Building distributed applications might seem simple at first. It's just servers talking to each other. Right?",-1)),s[25]||(s[25]=n("p",null,"However, it opens a set of potential problems you must consider. What if the network has a hiccup? A service unexpectedly crashes? You try to scale, and everything crumbles under the load? This is where the way your distributed system communicates becomes critical.",-1)),s[26]||(s[26]=n("p",null,"Traditional synchronous communication, where services call each other directly, is inherently fragile. It creates tight coupling, making your whole application vulnerable to single points of failure.",-1)),s[27]||(s[27]=n("p",null,"To combat this, we can turn to distributed messaging (and introduce an entirely different set of problems, but that's a story for another issue).",-1)),s[28]||(s[28]=n("p",null,"One powerful tool for achieving this in the .NET world is MassTransit.",-1)),s[29]||(s[29]=n("p",null,"In this week's issue, we'll explore MassTransit's implementation of the request-response pattern.",-1)),s[30]||(s[30]=n("hr",null,null,-1)),s[31]||(s[31]=n("h2",{id:"request-response-messaging-pattern-introduction",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#request-response-messaging-pattern-introduction"},[n("span",null,"Request-Response Messaging Pattern Introduction")])],-1)),s[32]||(s[32]=n("p",null,"Let's start by explaining how the request-response messaging pattern works.",-1)),n("p",null,[s[4]||(s[4]=e("The request-response pattern is just like making a traditional function call but over the network. One service, the requester, sends a request message and waits for a corresponding response message. This is a ")),a(i,{to:"/milanjovanovic.tech/modular-monolith-communication-patterns.html"},{default:t(()=>s[3]||(s[3]=[n("strong",null,"synchronous communication approach",-1)])),_:1,__:[3]}),s[5]||(s[5]=e(" from the requester's side."))]),s[33]||(s[33]=l('<p>The good parts:</p><ul><li><strong>Loose Coupling</strong>: Services don&#39;t need direct knowledge of each other, only of the message contracts. This makes changes and scaling easier.</li><li><strong>Location Transparency</strong>: The requester doesn&#39;t need to know <em>where</em> the responder is located, leading to improved flexibility.</li></ul><p>The bad parts:</p><ul><li><strong>Latency</strong>: The overhead of messaging adds some additional latency.</li><li><strong>Complexity</strong>: Introducing a messaging system and managing the additional infrastructure can increase project complexity.</li></ul><figure><img src="https://milanjovanovic.tech/blogs/mnw_087/request_response.png?imwidth=3840" alt="Request response messaging pattern diagram." tabindex="0" loading="lazy"><figcaption>Request response messaging pattern diagram.</figcaption></figure><hr>',6)),n("p",null,[a(i,{to:"/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html"},{default:t(()=>s[6]||(s[6]=[n("strong",null,"MassTransit",-1)])),_:1,__:[6]}),s[8]||(s[8]=e(" supports the ")),n("a",T,[a(r,{icon:"fas fa-globe"}),s[7]||(s[7]=e("request-response"))]),s[9]||(s[9]=e(" messaging pattern out of the box. We can use a ")),s[10]||(s[10]=n("strong",null,"request client",-1)),s[11]||(s[11]=e(" to send requests and wait for a response. The request client is asynchronous and supports the ")),s[12]||(s[12]=n("code",null,"await",-1)),s[13]||(s[13]=e(" keyword. The request will also have a timeout of 30 seconds by default, to prevent waiting for the response for too long."))]),s[34]||(s[34]=l(`<p>Let&#39;s imagine a scenario where you have an order processing system that needs to fetch an order&#39;s latest status. We can fetch the status from an Order Management service. With MassTransit, you&#39;ll create a request client to initiate the process. This client will send a <code>GetOrderStatusRequest</code> message onto the bus.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">GetOrderStatusRequest</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> OrderId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>On the Order Management side, a responder (or consumer) will be listening for <code>GetOrderStatusRequest</code> messages. It receives the request, potentially queries a database to get the status, and then sends a <code>GetOrderStatusResponse</code> message back onto the bus. The original request client will be waiting for this response and can then process it accordingly.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetOrderStatusRequestConsumer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>GetOrderStatusRequest<span class="token punctuation">&gt;</span></span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>GetOrderStatusRequest<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Get the order status from a database.</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResponseAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GetOrderStatusResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Set the respective response properties.</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="getting-user-permissions-in-a-modular-monolith" tabindex="-1"><a class="header-anchor" href="#getting-user-permissions-in-a-modular-monolith"><span>Getting User Permissions In a Modular Monolith</span></a></h2>`,6)),n("p",null,[s[15]||(s[15]=e("Here's a real-world scenario where my team decided to implement this pattern. We were building a ")),a(i,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:t(()=>s[14]||(s[14]=[n("strong",null,"modular monolith",-1)])),_:1,__:[14]}),s[16]||(s[16]=e(", and one of the modules was responsible for managing user permissions. The other modules could call out to the Users module to get the user's permissions. And this works great while we are still inside a monolith system."))]),s[35]||(s[35]=l(`<p>However, at one point we needed to extract one module into a separate service. This meant that the communication with the Users module using simple method calls would no longer work.</p><p>Luckily, we were already using MassTransit and RabbitMQ for messaging inside the system.</p><p>So, we decided to use the MassTransit request-response feature to implement this.</p><p>The new service will inject an <code>IRequestClient&lt;GetUserPermissions&gt;</code>. We can use it to send a <code>GetUserPermissions</code> message and await a response.</p><p>A very powerful feature of MassTransit is that you can await more than one response message. In this example, we&#39;re waiting for a <code>PermissionsResponse</code> or an <code>Error</code> response. This is great, because we also have a way to handle failures in the consumer.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">PermissionService</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>GetUserPermissions<span class="token punctuation">&gt;</span></span> client<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">:</span> IPermissionService</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Result<span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetUserPermissionsAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">string</span></span> identityId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetUserPermissions</span><span class="token punctuation">(</span>identityId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Response<span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">,</span> Error<span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span></span>
<span class="line">            <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">,</span> Error<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">Response<span class="token punctuation">&lt;</span>Error<span class="token punctuation">&gt;</span></span> errorResponse<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Failure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>errorResponse<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">Response<span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">&gt;</span></span> permissionResponse<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> permissionResponse<span class="token punctuation">.</span>Message<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Failure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>NotFound<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the Users module, we can easily implement the <code>GetUserPermissionsConsumer</code>. It will respond with a <code>PermissionsResponse</code> if the permissions are found or an <code>Error</code> in case of a failure.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">GetUserPermissionsConsumer</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">IPermissionService</span> permissionService<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">:</span> IConsumer<span class="token operator">&lt;</span>GetUserPermissions<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>GetUserPermissions<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Result<span class="token punctuation">&lt;</span>PermissionsResponse<span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span></span>
<span class="line">            <span class="token keyword">await</span> permissionService<span class="token punctuation">.</span><span class="token function">GetUserPermissionsAsync</span><span class="token punctuation">(</span></span>
<span class="line">                context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>IdentityId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>IsSuccess<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">RespondAsync</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">RespondAsync</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="closing-thoughts" tabindex="-1"><a class="header-anchor" href="#closing-thoughts"><span>Closing Thoughts</span></a></h2><p>By embracing messaging patterns with MassTransit, you&#39;re building on a much sturdier foundation. Your .NET services are now less tightly coupled, giving you the flexibility to evolve them independently and weather those inevitable network glitches or service outages.</p>`,11)),n("p",null,[s[18]||(s[18]=e("The ")),n("a",M,[a(r,{icon:"fa-brands fa-youtube"}),s[17]||(s[17]=e("request-response pattern"))]),s[19]||(s[19]=e(" is a powerful tool in your messaging arsenal. MassTransit makes it remarkably easy to implement, ensuring that requests and responses are delivered reliably."))]),a(m,{src:"youtube/NjsoykEOkrk"}),n("p",null,[s[21]||(s[21]=e("We can use request-response to implement communication between modules in a ")),a(i,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:t(()=>s[20]||(s[20]=[n("strong",null,"modular monolith",-1)])),_:1,__:[20]}),s[22]||(s[22]=e(". However, don't take this to the extreme, or your system might suffer from increased latency."))]),s[36]||(s[36]=n("p",null,"Start small, experiment, and see how the reliability and flexibility of messaging can transform your development experience.",-1)),s[37]||(s[37]=n("p",null,"That's all for this week. Stay awesome!",-1))])}const j=k(w,[["render",P]]),S=JSON.parse('{"path":"/milanjovanovic.tech/request-response-messaging-pattern-with-masstransit.html","title":"Request-Response Messaging Pattern With MassTransit","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Request-Response Messaging Pattern With MassTransit","description":"Article(s) > Request-Response Messaging Pattern With MassTransit","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Request-Response Messaging Pattern With MassTransit\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_087/request_response.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-04-27T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanović\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/request-response-messaging-pattern-with-masstransit.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Request-Response Messaging Pattern With MassTransit"}],["meta",{"property":"og:description","content":"Article(s) > Request-Response Messaging Pattern With MassTransit"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"name":"twitter:image:alt","content":"Request-Response Messaging Pattern With MassTransit"}],["meta",{"property":"article:author","content":"Milan Jovanović"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2024-04-27T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > Request-Response Messaging Pattern With MassTransit"},{"property":"og:description","content":"Request-Response Messaging Pattern With MassTransit"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/request-response-messaging-pattern-with-masstransit.html"}]],"prev":"/programming/cs/articles/README.md","date":"2024-04-27T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanović","cover":"https://milanjovanovic.tech/blog-covers/mnw_087.png"},"git":{},"readingTime":{"minutes":3.7,"words":1111},"filePathRelative":"milanjovanovic.tech/request-response-messaging-pattern-with-masstransit.md","copyright":{"author":"Milan Jovanović"}}');export{j as comp,S as data};
