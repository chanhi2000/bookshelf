import{_ as v}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as g,d as n,f as e,b as i,a as r,t as k,n as u,g as d,w as t,e as a,r as l,o as b}from"./app-BItykJLQ.js";const y={},f={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},S={class:"table-of-contents"};function T(m,s){const c=l("VPCard"),o=l("router-link"),h=l("SiteInfo"),p=l("RouteLink");return b(),g("div",null,[n("h1",f,[n("a",w,[n("span",null,k(m.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(c,u(d({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",S,[n("ul",null,[n("li",null,[e(o,{to:"#the-hidden-dangers-of-the-god-method"},{default:t(()=>[...s[0]||(s[0]=[a('The Hidden Dangers of the "God Method"',-1)])]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#_1-temporal-coupling-latency"},{default:t(()=>[...s[1]||(s[1]=[a("1. Temporal Coupling (Latency)",-1)])]),_:1})]),n("li",null,[e(o,{to:"#_2-the-partial-failure-state"},{default:t(()=>[...s[2]||(s[2]=[a("2. The Partial Failure State",-1)])]),_:1})]),n("li",null,[e(o,{to:"#_3-violation-of-single-responsibility-srp"},{default:t(()=>[...s[3]||(s[3]=[a("3. Violation of Single Responsibility (SRP)",-1)])]),_:1})])])]),n("li",null,[e(o,{to:"#level-1-logical-decoupling-with-domain-events"},{default:t(()=>[...s[4]||(s[4]=[a("Level 1: Logical Decoupling with Domain Events",-1)])]),_:1})]),n("li",null,[e(o,{to:"#level-2-reliability-with-the-outbox-pattern"},{default:t(()=>[...s[5]||(s[5]=[a("Level 2: Reliability with the Outbox Pattern",-1)])]),_:1})]),n("li",null,[e(o,{to:"#level-3-distributed-consistency-with-sagas"},{default:t(()=>[...s[6]||(s[6]=[a("Level 3: Distributed Consistency with Sagas",-1)])]),_:1})]),n("li",null,[e(o,{to:"#summary-a-heuristic-for-decision-making"},{default:t(()=>[...s[7]||(s[7]=[a("Summary: A Heuristic for Decision Making",-1)])]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#_1-is-it-a-simple-notification"},{default:t(()=>[...s[8]||(s[8]=[a("1. Is it a simple notification?",-1)])]),_:1})]),n("li",null,[e(o,{to:"#_2-is-it-a-critical-business-dependency"},{default:t(()=>[...s[9]||(s[9]=[a("2. Is it a critical business dependency?",-1)])]),_:1})])])])])]),s[21]||(s[21]=n("hr",null,null,-1)),e(h,{name:"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services",desc:"Coupling isn't just about code structure; it's about failure boundaries. Discover how to ensure your critical business logic survives when external dependencies like email or analytics go down.",url:"https://milanjovanovic.tech/blog/the-false-comfort-of-the-happy-path-decoupling-your-services",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_169.png"}),s[22]||(s[22]=i(`<p><strong>Let&#39;s be honest: We&#39;ve all written this code.</strong></p><p>It&#39;s Monday morning, you have a deadline, and you need to implement a user registration feature. It&#39;s simple enough: save the user, send a welcome email, and track the signup in your analytics dashboard.</p><p>You write this:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">IUserRepository</span> userRepository<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">IEmailService</span> emailService<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">IAnalyticsService</span> analyticsService<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RegisterUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">await</span> userRepository<span class="token punctuation">.</span><span class="token function">SaveAsync</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 1. Directly coupled to email service (external API)</span></span>
<span class="line">        <span class="token keyword">await</span> emailService<span class="token punctuation">.</span><span class="token function">SendWelcomeEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. Directly coupled to analytics (this could be an external API)</span></span>
<span class="line">        <span class="token keyword">await</span> analyticsService<span class="token punctuation">.</span><span class="token function">TrackUserRegistration</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// What if we need to add more features?</span></span>
<span class="line">        <span class="token comment">// This method will keep growing...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It looks clean. It&#39;s readable. It works on your machine.</p><p>But this method is a <strong>ticking time bomb</strong>.</p><p>It assumes the ‚ÄúHappy Path‚Äù is the <em>only</em> path. It assumes the network is reliable, the email provider is up, and the analytics API is fast. In production, none of these are guaranteed.</p><p>Thinking further, I&#39;m sure you can imagine similar code in your own projects. It might not be this exact scenario, but the pattern is common: a single method that orchestrates multiple side effects in a linear fashion.</p><p>Let&#39;s break down why this code is dangerous and how we can refactor it into a robust, event-driven architecture.</p><hr><h2 id="the-hidden-dangers-of-the-god-method" tabindex="-1"><a class="header-anchor" href="#the-hidden-dangers-of-the-god-method"><span>The Hidden Dangers of the &quot;God Method&quot;</span></a></h2><p>There are three major issues hiding in those ten lines of code.</p><h3 id="_1-temporal-coupling-latency" tabindex="-1"><a class="header-anchor" href="#_1-temporal-coupling-latency"><span>1. Temporal Coupling (Latency)</span></a></h3><p>When a user clicks &quot;Register,&quot; they have to wait for:</p><ol><li>The Database <strong>+</strong></li><li>The SMTP Server <strong>+</strong></li><li>The Analytics API</li></ol><p>If your analytics provider is having a bad day and takes 3 seconds to respond, <strong>your user waits 3 seconds</strong>. You are punishing your user for the slowness of a background system they don&#39;t even care about.</p><h3 id="_2-the-partial-failure-state" tabindex="-1"><a class="header-anchor" href="#_2-the-partial-failure-state"><span>2. The Partial Failure State</span></a></h3><p>This is the <strong>most critical risk</strong>. Imagine this scenario:</p><ol><li><code>SaveAsync(user)</code> succeeds. The user is in the DB.</li><li><code>SendWelcomeEmail</code> succeeds. The user gets an email.</li><li><code>TrackUserRegistration</code> throws a <code>503 Service Unavailable</code>.</li></ol><div class="hint-container info"><p class="hint-container-title">What happens now?</p><p>If you wrap this in a transaction and rollback, you have deleted the user from the DB... <strong>but you already sent them a welcome email.</strong> The user tries to log in, but they don&#39;t exist. Now what?</p></div><p>If you <em>don&#39;t</em> rollback, you have a user in your system that is missing from your analytics. You have data inconsistency.</p><h3 id="_3-violation-of-single-responsibility-srp" tabindex="-1"><a class="header-anchor" href="#_3-violation-of-single-responsibility-srp"><span>3. Violation of Single Responsibility (SRP)</span></a></h3><p>You might argue that because we are using interfaces (<code>IEmailService</code>), we are decoupled. That is true for <em>implementation details</em>, but false for <em>orchestration</em>.</p><p>The <code>UserService</code> currently has two reasons to change:</p><ol><li><strong>Core Domain Logic:</strong> &quot;We now require a username in addition to email.&quot;</li><li><strong>Notification Policy:</strong> &quot;Marketing wants to send an SMS in addition to the Email.&quot;</li></ol><p>The <code>UserService</code> should strictly be responsible for the <strong>state change</strong> (creating the user). It should not be responsible for <strong>orchestrating the side effects</strong> of that change.</p><hr><h2 id="level-1-logical-decoupling-with-domain-events" tabindex="-1"><a class="header-anchor" href="#level-1-logical-decoupling-with-domain-events"><span>Level 1: Logical Decoupling with Domain Events</span></a></h2><p>The first step to fixing this is to invert the control. Instead of the <code>UserService</code> <em>commanding</em> other services to do things, it should simply <em>announce</em> that something happened.</p>`,29)),n("p",null,[s[11]||(s[11]=a("We can use ",-1)),e(p,{to:"/milanjovanovic.tech/how-to-use-domain-events-to-build-loosely-coupled-systems.html"},{default:t(()=>[...s[10]||(s[10]=[n("strong",null,"Domain Events",-1)])]),_:1}),s[12]||(s[12]=a(" to achieve this.",-1))]),s[23]||(s[23]=i(`<p>Here is the refactored <code>UserService</code>:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">IUserRepository</span> userRepository<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">IDomainEventDispatcher</span> dispatcher<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">IUnitOfWork</span> unitOfWork<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RegisterUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 1. Create the User Entity</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. Capture the side effect as an event object</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> userRegisteredEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserRegisteredEvent</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 3. Add the entity to the repository</span></span>
<span class="line">        <span class="token keyword">await</span> userRepository<span class="token punctuation">.</span><span class="token function">AddAsync</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 4. Dispatch the event (Assuming in-process dispatching here for simplicity)</span></span>
<span class="line">        <span class="token comment">// Note: Handlers for Email and Analytics are now completely separate classes.</span></span>
<span class="line">        <span class="token keyword">await</span> dispatcher<span class="token punctuation">.</span><span class="token function">Dispatch</span><span class="token punctuation">(</span>userRegisteredEvent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> unitOfWork<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>UserService</code> is now stable. Adding a &quot;Loyalty Points&quot; feature later doesn&#39;t require touching this method. You just add a new handler for the <code>UserRegisteredEvent</code>.</p><p><strong>However, we haven&#39;t solved the reliability problem yet.</strong> If the process crashes immediately after <code>Dispatch</code> but before <code>SaveChangesAsync</code> completes, we might send an email for a user that failed to save. Or, if we save first and dispatch later, we might save the user but lose the event if the server crashes.</p><hr><h2 id="level-2-reliability-with-the-outbox-pattern" tabindex="-1"><a class="header-anchor" href="#level-2-reliability-with-the-outbox-pattern"><span>Level 2: Reliability with the Outbox Pattern</span></a></h2><p>To fix this, we need <strong>Atomicity</strong>. Atomicity means that a set of operations either all succeed or all fail together.</p><p>We need to guarantee that if the <code>User</code> is saved, the <code>UserRegisteredEvent</code> is also saved.</p>`,8)),n("p",null,[s[14]||(s[14]=a("Enter the ",-1)),e(p,{to:"/milanjovanovic.tech/implementing-the-outbox-pattern.html"},{default:t(()=>[...s[13]||(s[13]=[n("strong",null,"Outbox Pattern",-1)])]),_:1}),s[15]||(s[15]=a(".",-1))]),s[24]||(s[24]=i(`<p>Instead of publishing the event immediately to a message bus, we save the event to an <code>OutboxMessages</code> table in the <strong>same database transaction</strong> as the user.</p><p>Here is the complete implementation logic:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RegisterUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. Create the Domain Event</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> domainEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserRegisteredEvent</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. Open a Transaction</span></span>
<span class="line">    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> transaction <span class="token operator">=</span> dbContext<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">BeginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">try</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 3. Save the User to the Users Table</span></span>
<span class="line">        dbContext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 4. Serialize the Event and Save to Outbox Table</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> outboxMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OutboxMessage</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            Type <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>UserRegisteredEvent<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            Content <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>domainEvent<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            OccurredOn <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span></span>
<span class="line">            ProcessedOn <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// Null means it hasn&#39;t been handled yet</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        dbContext<span class="token punctuation">.</span>OutboxMessages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>outboxMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 5. Commit BOTH changes atomically</span></span>
<span class="line">        <span class="token keyword">await</span> dbContext<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">await</span> transaction<span class="token punctuation">.</span><span class="token function">CommitAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">catch</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">await</span> transaction<span class="token punctuation">.</span><span class="token function">RollbackAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">throw</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),n("p",null,[s[17]||(s[17]=a("Now, a ",-1)),e(p,{to:"/milanjovanovic.tech/scheduling-background-jobs-with-quartz-net.html"},{default:t(()=>[...s[16]||(s[16]=[n("strong",null,"background worker",-1)])]),_:1}),s[18]||(s[18]=a(" (running in a separate process) polls the ",-1)),s[19]||(s[19]=n("code",null,"OutboxMessages",-1)),s[20]||(s[20]=a(" table. It picks up the message and publishes it to your message bus (RabbitMQ, Azure Service Bus, etc.).",-1))]),s[25]||(s[25]=i('<p>If the email service is down, the background worker just retries later. <strong>We have achieved At-Least-Once delivery.</strong></p><hr><h2 id="level-3-distributed-consistency-with-sagas" tabindex="-1"><a class="header-anchor" href="#level-3-distributed-consistency-with-sagas"><span>Level 3: Distributed Consistency with Sagas</span></a></h2><p>The Outbox pattern is perfect for side effects (fire-and-forget actions like emails). But what if the subsequent action is <strong>mandatory</strong>?</p><p><strong>Scenario:</strong> When a user registers, we <em>must</em> create a crypto-wallet for them in the <code>WalletService</code>. If the wallet creation fails (e.g., due to regulations), we cannot allow the user to exist in our system.</p><p>We can&#39;t just &quot;retry later&quot; if the <code>WalletService</code> says &quot;Fraud Detected.&quot; We need to <strong>undo</strong> the user creation.</p><p>This is a distributed transaction, and we handle it with the <a href="/milanjovanovic.tech/implementing-the-saga-pattern-with-masstransit" target="_blank" rel="noopener noreferrer"><strong>Saga Pattern</strong></a>. A Saga coordinates a series of steps. If one fails, it executes <strong>Compensating Transactions</strong> to undo the previous work.</p><p>Here is how the failure scenario looks when using a <a href="/milanjovanovic.tech/orchestration-vs-choreography" target="_blank" rel="noopener noreferrer"><strong>Choreography-based Saga</strong></a>:</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_169/saga_sequence_diagram.png?imwidth=3840" alt="A Saga Sequence Diagram showing UserService creating a user, WalletService attempting to create a wallet, failing, and UserService deleting the user as a compensation action." tabindex="0" loading="lazy"><figcaption>A Saga Sequence Diagram showing UserService creating a user, WalletService attempting to create a wallet, failing, and UserService deleting the user as a compensation action.</figcaption></figure>',9)),r(" TODO: mermaid Ìôî "),s[26]||(s[26]=i('<p>Here&#39;s the step-by-step breakdown of the flow:</p><ol><li><strong>UserService:</strong> Creates User ‚Üí Publishes <code>UserCreated</code></li><li><strong>WalletService:</strong> Listens to <code>UserCreated</code> ‚Üí Tries to create wallet <ul><li><em>Failure:</em> Wallet creation fails</li><li><em>Action:</em> Publishes <code>WalletCreationFailed</code></li></ul></li><li><strong>UserService:</strong> Listens to <code>WalletCreationFailed</code> ‚Üí <strong>Deletes/Deactivates the User</strong></li></ol><p>This ensures <strong>Eventual Consistency</strong>. The system might be inconsistent for a few seconds (the user exists without a wallet), but it will eventually settle into a valid state (the user is removed).</p><hr><h2 id="summary-a-heuristic-for-decision-making" tabindex="-1"><a class="header-anchor" href="#summary-a-heuristic-for-decision-making"><span>Summary: A Heuristic for Decision Making</span></a></h2><p>You don&#39;t need Sagas for everything. Over-engineering is just as bad as tight coupling. Use this simple rule of thumb:</p><h3 id="_1-is-it-a-simple-notification" tabindex="-1"><a class="header-anchor" href="#_1-is-it-a-simple-notification"><span>1. Is it a simple notification?</span></a></h3><p>(Email, Analytics, Cache Invalidation)</p><ul><li><strong>Use Domain Events + Outbox.</strong> It&#39;s okay if it happens 5 seconds later.</li></ul><h3 id="_2-is-it-a-critical-business-dependency" tabindex="-1"><a class="header-anchor" href="#_2-is-it-a-critical-business-dependency"><span>2. Is it a critical business dependency?</span></a></h3><p>(Payments, Inventory, Account Status)</p><ul><li><strong>Use a Saga.</strong> If step B fails, step A must be reverted.</li></ul><p>Coupling isn&#39;t just about code structure. It&#39;s about understanding and managing <strong>failure boundaries</strong>. If your Analytics Service goes down, it shouldn&#39;t prevent a user from registering. Build your systems to survive the unhappy path.</p><hr>',14)),r(" TODO: add ARTICLE CARD "),e(c,u(d({title:"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services",desc:"Coupling isn't just about code structure; it's about failure boundaries. Discover how to ensure your critical business logic survives when external dependencies like email or analytics go down.",link:"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/the-false-comfort-of-the-happy-path-decoupling-your-services.html",logo:"https://milanjovanovic.tech/profile_favicon.png",background:"rgba(79,70,229,0.2)"})),null,16)])}const C=v(y,[["render",T]]),I=JSON.parse('{"path":"/milanjovanovic.tech/the-false-comfort-of-the-happy-path-decoupling-your-services.html","title":"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services","lang":"en-US","frontmatter":{"lang":"en-US","title":"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services","description":"Article(s) > The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_169/saga_sequence_diagram.png?imwidth=3840\\"],\\"datePublished\\":\\"2025-11-22T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanoviƒá\\"}]}"],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/the-false-comfort-of-the-happy-path-decoupling-your-services.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services"}],["meta",{"property":"og:description","content":"Article(s) > The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_169.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_169.png"}],["meta",{"name":"twitter:image:alt","content":"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services"}],["meta",{"property":"article:author","content":"Milan Jovanoviƒá"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:published_time","content":"2025-11-22T00:00:00.000Z"}],[{"meta":null},{"property":"og:title","content":"Article(s) > The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services"},{"property":"og:description","content":"The False Comfort of the ‚ÄúHappy Path‚Äù: Decoupling Your Services"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/the-false-comfort-of-the-happy-path-decoupling-your-services.html"}]],"prev":"/programming/cs/articles/README.md","date":"2025-11-22T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanoviƒá","cover":"https://milanjovanovic.tech/blog-covers/mnw_169.png"},"git":{},"readingTime":{"minutes":5.29,"words":1588},"filePathRelative":"milanjovanovic.tech/the-false-comfort-of-the-happy-path-decoupling-your-services.md","copyright":{"author":"Milan Jovanoviƒá"}}');export{C as comp,I as data};
