<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization","image":["https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img1-basic-publisher-query.png?resize=1024%2C462&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img2-publisher-btree.png?resize=1024%2C294&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img3-small-publisher-query-plan.png?resize=1024%2C225&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img4-large-publisher-plan.png?resize=1024%2C449&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img5-publisher-title-index.png?resize=1024%2C347&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img6-fast-search-large-pub.png?resize=1024%2C150&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img7-multiple-publishers.png?resize=1024%2C447&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/always-sunny-meme.gif?resize=640%2C404&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img8-multiple-small-publishers.png?resize=1024%2C215&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img9-single-publisher-read.png?resize=1024%2C352&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img10-double-publisher-read.png?resize=1024%2C348&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img11-cte-append.png?resize=1024%2C257&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img11a-cte-append.png?resize=1024%2C130&ssl=1","https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img12-cross-join.png?resize=1024%2C268&ssl=1"],"datePublished":"2025-09-03T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Adam Rackis","url":"https://frontendmasters.com/blog/author/adamrackis/"}]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization"><meta property="og:description" content="Article(s) > Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization"><meta property="og:type" content="article"><meta property="og:image" content="https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/6882"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/6882"><meta name="twitter:image:alt" content="Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization"><meta property="article:author" content="Adam Rackis"><meta property="article:tag" content="postgresql"><meta property="article:tag" content="postgres"><meta property="article:tag" content="db"><meta property="article:tag" content="sql"><meta property="article:tag" content="data-science"><meta property="article:tag" content="frontendmasters.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2025-09-03T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization | 📚Bookshelf</title><meta name="description" content="Article(s) > Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">frontendmasters.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2025</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/inset-shadows-directly-on-img-elements-part-1.html" aria-label="Inset Shadows Directly on img Elements (Part 1)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Inset Shadows Directly on img Elements (Part 1)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/learn-media-queries.html" aria-label="How much do you really know about media queries?"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->How much do you really know about media queries?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-coyier-css-starter.html" aria-label="The Coyier CSS Starter"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->The Coyier CSS Starter<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/what-you-need-to-know-about-modern-css-2025-edition.html" aria-label="What You Need to Know about Modern CSS (2025 Edition)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->What You Need to Know about Modern CSS (2025 Edition)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/css-offset-and-animation-composition-for-rotating-menus.html" aria-label="CSS offset and animation-composition for Rotating Menus"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->CSS offset and animation-composition for Rotating Menus<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/choosing-the-right-model-in-cursor.html" aria-label="Choosing the Right Model in Cursor"><!--[--><i class="vp-icon iconfont icon-cursor" sizing="both"></i><!--]-->Choosing the Right Model in Cursor<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/getting-started-with-cursor.html" aria-label="Getting Started with Cursor"><!--[--><i class="vp-icon iconfont icon-cursor" sizing="both"></i><!--]-->Getting Started with Cursor<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html" aria-label="Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization"><!--[--><i class="vp-icon iconfont icon-postgresql" sizing="both"></i><!--]-->Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/intro-to-postgres-indexes.html" aria-label="Introduction to Postgres Indexes"><!--[--><i class="vp-icon iconfont icon-postgresql" sizing="both"></i><!--]-->Introduction to Postgres Indexes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-path-of-least-resistance-part-2.html" aria-label="The `-path` of Least Resistance (Part 2)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->The `-path` of Least Resistance (Part 2)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-path-of-least-resistance-part-1.html" aria-label="The `-path` of Least Resistance (Part 1)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->The `-path` of Least Resistance (Part 1)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/opening-a-details-element-from-the-url.html" aria-label="Opening a Details Element from the URL"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Opening a Details Element from the URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/very-early-playing-with-random-in-css.html" aria-label="Very Early Playing with random() in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Very Early Playing with random() in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/quick-dark-mode-toggles.html" aria-label="Quick Dark Mode Toggles"><!--[--><i class="vp-icon fa-brands fa-chrome" sizing="both"></i><!--]-->Quick Dark Mode Toggles<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/obsessing-over-smooth-radial-gradient-disc-edges.html" aria-label="Obsessing Over Smooth radial-gradient() Disc Edges"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Obsessing Over Smooth radial-gradient() Disc Edges<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/web-design-what-is-the-web-capable-of-that-is-hard-to-express-in-design-software.html" aria-label="Web Design: What is the web capable of that is hard to express in design software?"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->Web Design: What is the web capable of that is hard to express in design software?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/architecture-through-component-colocation.html" aria-label="A Nice Vanilla App Archicture Using Web Components and CSS Module Scripts"><!--[--><i class="vp-icon fa-brands fa-node" sizing="both"></i><!--]-->A Nice Vanilla App Archicture Using Web Components and CSS Module Scripts<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/using-the-custom-highlight-api.html" aria-label="Using the Custom Highlight API"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->Using the Custom Highlight API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/count-auto-fill-columns.html" aria-label="Get the number of auto-fit/auto-fill columns in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Get the number of auto-fit/auto-fill columns in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/infinite-marquee-animation-using-modern-css.html" aria-label="Infinite Marquee Animation using Modern CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Infinite Marquee Animation using Modern CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/should-we-never-use-non-logical-properties.html" aria-label="Should we NEVER use non-logical properties?"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Should we NEVER use non-logical properties?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-figcaption-problem.html" aria-label="The Figcaption Problem"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->The Figcaption Problem<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/introducing-zustand.html" aria-label="Introducing Zustand (State Management)"><!--[--><i class="vp-icon fa-brands fa-react" sizing="both"></i><!--]-->Introducing Zustand (State Management)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/adaptive-alerts-a-css-scroll-state-use-case.html" aria-label="Adaptive Alerts (a CSS scroll-state Use Case)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Adaptive Alerts (a CSS scroll-state Use Case)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/stacked-transforms.html" aria-label="Stacked Transforms"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Stacked Transforms<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/deploy-a-site-with-a-build-process-a-custom-domain-name.html" aria-label="Deploy a Site with a Build Process &amp; a Custom Domain Name"><!--[--><i class="vp-icon fas fa-network-wired" sizing="both"></i><!--]-->Deploy a Site with a Build Process &amp; a Custom Domain Name<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/view-transition-list-reordering-with-a-kick-flip.html" aria-label="View Transition List Reordering (with a Kick Flip)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->View Transition List Reordering (with a Kick Flip)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/satisfies-in-typescript.html" aria-label="Satisfies in TypeScript"><!--[--><i class="vp-icon iconfont icon-typescript" sizing="both"></i><!--]-->Satisfies in TypeScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/custom-select-that-comes-up-from-the-bottom-on-mobile.html" aria-label="Custom Select (that comes up from the bottom on mobile)"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Custom Select (that comes up from the bottom on mobile)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/step-gradients-with-a-given-number-of-steps.html" aria-label="Step Gradients with a Given Number of Steps"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Step Gradients with a Given Number of Steps<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/quantity-query-carousel.html" aria-label="Quantity Query Carousel"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Quantity Query Carousel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/understanding-css-corner-shape-and-the-power-of-the-superellipse.html" aria-label="Understanding CSScorner-shapeand the Power of the Superellipse"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Understanding CSScorner-shapeand the Power of the Superellipse<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/drawing-css-shapes-using-corner-shape.html" aria-label="Drawing CSS Shapes using corner-shape"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Drawing CSS Shapes using corner-shape<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/scope-in-css.html" aria-label="Scope in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Scope in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/grainy-gradients.html" aria-label="Grainy Gradients"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Grainy Gradients<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/1fr-1fr-vs-auto-auto-vs-50-50.html" aria-label="1fr 1fr vs auto auto vs 50% 50%"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->1fr 1fr vs auto auto vs 50% 50%<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/scroll-driven-letter-grid.html" aria-label="Scroll-Driven Letter Grid"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Scroll-Driven Letter Grid<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/firstchild-can-be-white-space.html" aria-label="firstChild can be white space"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->firstChild can be white space<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-simplest-way-to-deploy.html" aria-label="The Simplest Way to Deploy Your Own Updatable Portfolio Site"><!--[--><i class="vp-icon iconfont icon-github" sizing="both"></i><!--]-->The Simplest Way to Deploy Your Own Updatable Portfolio Site<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/css-spotlight-effect.html" aria-label="CSS Spotlight Effect"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->CSS Spotlight Effect<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/move-modal-in-on-a-shape.html" aria-label="Move Modal in on a… shape()"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Move Modal in on a… shape()<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/chatgpt-and-old-and-broken-code.html" aria-label="ChatGPT and the proliferation of obsolete and broken solutions to problems we hadn’t had for over half a decade before its launch"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->ChatGPT and the proliferation of obsolete and broken solutions to problems we hadn’t had for over half a decade before its launch<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/creating-blob-shapes-using-clip-path-shape.html" aria-label="Creating Blob Shapes using clip-path: shape()"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Creating Blob Shapes using clip-path: shape()<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/to-flip-or-not-to-flip.html" aria-label="Is there a Correct Answer? Flipping Layouts When Google Translate Swaps between a Left-to-Right Language and a Right-to-Left Language"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Is there a Correct Answer? Flipping Layouts When Google Translate Swaps between a Left-to-Right Language and a Right-to-Left Language<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/container-query-for-is-there-enough-space-outside-this-element.html" aria-label="Container Query for “is there enough space outside this element?”"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Container Query for “is there enough space outside this element?”<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/creating-flower-shapes-using-clip-path-shape.html" aria-label="Creating Flower Shapes using clip-path: shape()"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Creating Flower Shapes using clip-path: shape()<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/shape-a-new-powerful-drawing-syntax-in-css.html" aria-label="shape(): A New Powerful Drawing Syntax in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->shape(): A New Powerful Drawing Syntax in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/using-container-query-units-relative-to-an-outer-container.html" aria-label="Using Container Query Units Relative to an Outer Container"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Using Container Query Units Relative to an Outer Container<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/curved-box-cutouts-in-css.html" aria-label="Curved Box Cutouts in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Curved Box Cutouts in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/seeking-an-answer-why-cant-html-alone-do-includes.html" aria-label="Seeking an Answer: Why can’t HTML alone do includes?"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Seeking an Answer: Why can’t HTML alone do includes?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/react-internals-which-useeffect-runs-first.html" aria-label="React Internals: Which useEffect runs first?"><!--[--><i class="vp-icon fa-brands fa-react" sizing="both"></i><!--]-->React Internals: Which useEffect runs first?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/am-i-a-sadistic-developer-are-you.html" aria-label="Am I a Sadistic Developer? Are You?"><!--[--><i class="vp-icon fas fa-user-tie" sizing="both"></i><!--]-->Am I a Sadistic Developer? Are You?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/newfangled-browser-alternatives.html" aria-label="Newfangled Browser Alternatives"><!--[--><i class="vp-icon fa-brands fa-chrome" sizing="both"></i><!--]-->Newfangled Browser Alternatives<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/lessons-learned-from-recreating-a-styled-dialog.html" aria-label="Lessons Learned from Recreating a Styled Dialog"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Lessons Learned from Recreating a Styled Dialog<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-latest-in-the-how-are-we-going-to-do-masonry-debate-apple-says-item-flow.html" aria-label="The Latest in the “How are we going to do masonry?” Debate: Apple Says “Item Flow”"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->The Latest in the “How are we going to do masonry?” Debate: Apple Says “Item Flow”<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/using-currentcolor-in-2025.html" aria-label="Using currentColor in 2025"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Using currentColor in 2025<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/custom-progress-element-using-the-attr-function.html" aria-label="Custom progress element using the attr() function"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Custom progress element using the attr() function<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/css-bursts-with-conic-gradients.html" aria-label="CSS Bursts with Conic Gradients"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->CSS Bursts with Conic Gradients<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/reanimating-the-css-day-buttons.html" aria-label="Reanimating the CSS Day Buttons"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Reanimating the CSS Day Buttons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/expanding-css-shadow-effects.html" aria-label="Expanding CSS Shadow Effects - Frontend Masters Blog"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Expanding CSS Shadow Effects - Frontend Masters Blog<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/layered-text-headers.html" aria-label="Layered Text Headers"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Layered Text Headers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/one-thing-scope-can-do-is-reduce-concerns-about-source-order.html" aria-label="One Thing @scope Can Do is Reduce Concerns About Source Order"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->One Thing @scope Can Do is Reduce Concerns About Source Order<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/overlapping-inline-backgrounds.html" aria-label="A Deep Dive into the Inline Background Overlap Problem"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->A Deep Dive into the Inline Background Overlap Problem<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/chilled-out-text-underlines.html" aria-label="Chilled Out Text Underlines"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Chilled Out Text Underlines<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/the-moment-you-need-a-database.html" aria-label="The Moment You Need a Database"><!--[--><i class="vp-icon fas fa-database" sizing="both"></i><!--]-->The Moment You Need a Database<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/movies-as-images.html" aria-label="Movies as Images"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Movies as Images<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/custom-property-fallbacks.html" aria-label="Custom Property Fallbacks"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Custom Property Fallbacks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/examples-of-why-the-web-needs-anchored-popovers.html" aria-label="Examples of Why The Web Needs Anchored Popovers"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Examples of Why The Web Needs Anchored Popovers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/how-to-use-attr-in-css-for-columns-colors-and-font-size.html" aria-label="How to Use attr() in CSS for Columns, Colors, and Font-Size"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->How to Use attr() in CSS for Columns, Colors, and Font-Size<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/a-color-input-that-also-shows-the-value.html" aria-label="A Color Input That Also Shows the Value"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->A Color Input That Also Shows the Value<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/rainbow-selection-in-css.html" aria-label="Rainbow Selection in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Rainbow Selection in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/optimizing-images-for-web-performance.html" aria-label="Optimizing Images for Web Performance"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Optimizing Images for Web Performance<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/three-approaches-to-the-ampersand-selector-in-css.html" aria-label="Three Approaches to the “&amp;” (ampersand) Selector in CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Three Approaches to the “&amp;” (ampersand) Selector in CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/html-css-for-a-one-time-password-input.html" aria-label="HTML &amp; CSS for a One-Time Password Input"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->HTML &amp; CSS for a One-Time Password Input<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/notes-on-the-code-editors-with-ai-landscape.html" aria-label="Notes on the Code Editors with AI Landscape"><!--[--><i class="vp-icon iconfont icon-vscode" sizing="both"></i><!--]-->Notes on the Code Editors with AI Landscape<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/mapping-with-leaflet.html" aria-label="Mapping with Leaflet"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->Mapping with Leaflet<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/full-bleed-layout-with-modern-css.html" aria-label="Full-Bleed Layout with Modern CSS"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Full-Bleed Layout with Modern CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/creating-an-angled-slider.html" aria-label="Creating an Angled Slider"><!--[--><i class="vp-icon fa-brands fa-sass" sizing="both"></i><!--]-->Creating an Angled Slider<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/simplify-lazy-loading-with-intersection-observers-scrollmargin.html" aria-label="Simplify Lazy Loading With Intersection Observer’s ScrollMargin"><!--[--><i class="vp-icon fa-brands fa-js" sizing="both"></i><!--]-->Simplify Lazy Loading With Intersection Observer’s ScrollMargin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/css-wishlist-for-2025.html" aria-label="CSS Wishlist for 2025"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->CSS Wishlist for 2025<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/sharing-a-variable-across-html-css-and-javascript.html" aria-label="Sharing a Variable Across HTML, CSS, and JavaScript"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Sharing a Variable Across HTML, CSS, and JavaScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/bone-up-html-2025.html" aria-label="Relatively New Things You Should Know about HTML Heading Into 2025"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Relatively New Things You Should Know about HTML Heading Into 2025<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/frontendmasters.com/containers-context.html" aria-label="Containers &amp; Context"><!--[--><i class="vp-icon fa-brands fa-css3-alt" sizing="both"></i><!--]-->Containers &amp; Context<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2024</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/6882" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-postgresql" sizing="height"></i>Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://frontendmasters.com/blog/author/adamrackis/" target="_blank" rel="noopener noreferrer">Adam Rackis</a></span><span property="author" content="Adam Rackis"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">9/3/25</span><meta property="datePublished" content="2025-09-03T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 13 min</span><meta property="timeRequired" content="PT13M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3" role>Data Science</span><span class="page-category-item color4" role>PostgreSQL</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Data Science,PostgreSQL,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color8" role>frontendmasters.com</span><span class="page-tag-item color3" role>data-science</span><span class="page-tag-item color4" role>sql</span><span class="page-tag-item color5" role>db</span><span class="page-tag-item color7" role>postgres</span><span class="page-tag-item color2" role>postgresql</span><!--]--><meta property="keywords" content="blog,frontendmasters.com,data-science,sql,db,postgres,postgresql"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/data-science/postgres/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="/bookshelf/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">PostgreSQL > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#filtering-and-sorting" class="router-link-active router-link-exact-active">Filtering and sorting</a></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#more-publishers" class="router-link-active router-link-exact-active">More publishers!</a></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#searching-multiple-publishers" class="router-link-active router-link-exact-active">Searching multiple publishers</a><ul><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#why-did-the-publisher-id-change-the-plan" class="router-link-active router-link-exact-active">Why did the publisher id change the plan?</a></li></ul></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#crafting-a-better-query" class="router-link-active router-link-exact-active">Crafting a better query</a></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#how-does-this-scale" class="router-link-active router-link-exact-active">How does this scale?</a></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#version-2" class="router-link-active router-link-exact-active">Version 2</a><ul><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#let-s-run-it" class="router-link-active router-link-exact-active">Let’s run it!</a></li></ul></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#stepping-back" class="router-link-active router-link-exact-active">Stepping back</a></li><li><a aria-current="page" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html#parting-thoughts" class="router-link-active router-link-exact-active">Parting thoughts</a></li></ul></nav><hr><div class="vp-site-info" data-name="Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization"><a class="vp-site-info-navigator no-external-link-icon" title="Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization" href="https://frontendmasters.com/blog/advanced-postgresql-indexing/" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://frontendmasters.com/blog/wp-json/social-image-generator/v1/image/6882) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://frontendmasters.com/favicon.ico" alt loading="lazy" no-view><div class="vp-site-info-name">Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization</div><div class="vp-site-info-desc">Postgres creates an execution plan for how to retrieve the data you&#39;re asking for in a query. The execution plan is based in part on statistics from your data and indexes it has available. Just the right index and a bit of query tuning can have a huge payoff in performance gains that your users will notice.</div></div><!----></div><p>Welcome to part two of our exploration of Postgres indexes. Be sure to check out part one if you haven’t already. We’ll be picking up exactly where we left off.</p><div class="hint-container info"><p class="hint-container-title">Article Series</p><a class="route-link vp-card" href="/bookshelf/frontendmasters.com/intro-to-postgres-indexes.html" style="background:rgba(188,75,52,0.2);"><img class="vp-card-logo" src="https://frontendmasters.com/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Introduction to Postgres Indexes</div><hr><div class="vp-card-desc">This Part 1 (of a 2-part series) is a practical, hands-on, applicable approach to database indexes. We’ll cover what B Trees are with a focus on deeply understanding, and internalizing how they store data on disk, and how your database uses them to speed up queries. This will set us up nicely for part 2, […]</div></div></a><a class="route-link vp-card" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html" style="background:rgba(188,75,52,0.2);"><img class="vp-card-logo" src="https://frontendmasters.com/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization</div><hr><div class="vp-card-desc">Postgres creates an execution plan for how to retrieve the data you're asking for in a query. The execution plan is based in part on statistics from your data and indexes it has available. Just the right index and a bit of query tuning can have a huge payoff in performance gains that your users will notice.</div></div></a></div><p>We have the same books table as before, containing approximately 90 million records.</p><div class="hint-container note"><p class="hint-container-title">Editors’ note</p><p>Need to bone up on PostgreSQL all around? Our course <a href="https://frontendmasters.com/courses/sql/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Complete Intro to SQL &amp; PostgreSQL</a> from Brian Holt will be perfect for you.</p></div><hr><h2 id="filtering-and-sorting" tabindex="-1"><a class="header-anchor" href="#filtering-and-sorting"><span>Filtering and sorting</span></a></h2><p>Let’s dive right in. Imagine you work for a book distribution company. You’re responsible for publishers and need to query info on them. There are approximately 250,000 different publishers, with a wide variance in the number of books published by each, which we’ll explore.</p><p>Let’s start easy. You want to see the top 10 books, sorted alphabetically, for a single publisher.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> books</span>
<span class="line"><span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> <span class="token number">157595</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This publisher is relatively small, with only 65 books in its catalog. Nonetheless, the query is slow to run, taking almost <strong>four seconds</strong>.</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>If you followed the same steps from part 1 to create this same database, note that your ids will be different.</p></div><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img1-basic-publisher-query.png?resize=1024%2C462&amp;ssl=1" alt="A detailed execution plan showing the performance analysis of a query in Postgres, including sorting and filtering operations." tabindex="0" loading="lazy"><figcaption>A detailed execution plan showing the performance analysis of a query in Postgres, including sorting and filtering operations.</figcaption></figure><p>This is hardly surprising; there are a lot of rows in our table, and finding the rows for that publisher takes a while, since Postgres has to scan the entire heap.</p><p>So we add an index on, for now, just publisher.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_publisher <span class="token keyword">ON</span> books<span class="token punctuation">(</span>publisher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We can think of our index in this way. It just helps us identify all the book entries by publisher. To get the rest of the info on the book, we go to the heap.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img2-publisher-btree.png?resize=1024%2C294&amp;ssl=1" alt="A visual representation of a tree structure showing nodes and leaves, illustrating the hierarchical arrangement of data, likely related to a database index." tabindex="0" loading="lazy"><figcaption>A visual representation of a tree structure showing nodes and leaves, illustrating the hierarchical arrangement of data, likely related to a database index.</figcaption></figure><p>And now our same query is incredibly fast.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img3-small-publisher-query-plan.png?resize=1024%2C225&amp;ssl=1" alt="Execution plan displayed for a SQL query, includes cost, index conditions, number of rows, and execution time details." tabindex="0" loading="lazy"><figcaption>Execution plan displayed for a SQL query, includes cost, index conditions, number of rows, and execution time details.</figcaption></figure><p>Nothing surprising or interesting.</p><p>But now you need to run the same query, but on a different publisher, number 210537. This is the biggest publisher in the entire database, with over 2 million books. Let’s see how our index fares.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> books</span>
<span class="line"><span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> <span class="token number">210537</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img4-large-publisher-plan.png?resize=1024%2C449&amp;ssl=1" alt="A detailed query plan output for a PostgreSQL database showing execution details, including cost, rows returned, and time taken for sorting and scanning operations." tabindex="0" loading="lazy"><figcaption>A detailed query plan output for a PostgreSQL database showing execution details, including cost, rows returned, and time taken for sorting and scanning operations.</figcaption></figure><p>Actually, our index wasn’t used at all. Postgres just scanned the whole table, grabbing our publisher along the way, and then sorted the results to get the top 10. We’ll discuss why a little later, as we did in the prior post, but the short of it is that the <strong>random</strong> heap accesses from reading so many entries off of an index would be expensive; Postgres decided the scan would be cheaper. These decisions are all about tradeoffs and are governed by statistics and cost estimates.</p><p>Previously, we threw the “other” field into the <code>INCLUDE()</code> list, so the engine wouldn’t have to leave the index to get the other field it needed. In this case, we’re selecting <em>everything</em>. I said previously to be diligent in avoiding unnecessary columns in the <code>SELECT</code> clause for just this reason, but here, we assume we actually do need all these columns.</p><p>We probably don’t want to dump every single column into the <code>INCLUDE</code> list of the index: we’d basically just be redefining our table into an index.</p><p>But why do we need to read so many rows in the first place? We have a limit of 10 on our query. The problem, of course, is that we’re ordering on title. And Postgres needs to see all rows for a publisher (2 million rows in this case) in order to sort them, and grab the first 10. What if we built an index on <code>publisher</code>, <em>and then</em> <code>title</code>?</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_publisher_title <span class="token keyword">ON</span> books<span class="token punctuation">(</span>publisher<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That would look like this:</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img5-publisher-title-index.png?resize=1024%2C347&amp;ssl=1" alt="A diagram illustrating a B-tree structure for organizing books, showing nodes and leaves with book titles like &#39;Jane Eyre&#39; and &#39;War and Peace&#39; arranged hierarchically." tabindex="0" loading="lazy"><figcaption>A diagram illustrating a B-tree structure for organizing books, showing nodes and leaves with book titles like &#39;Jane Eyre&#39; and &#39;War and Peace&#39; arranged hierarchically.</figcaption></figure><p>If Postgres were to search for a specific publisher, it could just seek down to the start of that publisher’s books, and then read however many needed, right off the leaf nodes, couldn’t it? There could be 2 million book entries in the leaf nodes, but Postgres could just read the first 10, and be guaranteed that they’re the first 10, since that’s how the index is ordered.</p><p>Let’s try it.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img6-fast-search-large-pub.png?resize=1024%2C150&amp;ssl=1" alt="Execution plan showing the limit, index scan using idx_publisher_title on books, and the planning and execution times." tabindex="0" loading="lazy"><figcaption>Execution plan showing the limit, index scan using idx_publisher_title on books, and the planning and execution times.</figcaption></figure><p>We got the top 10 books, sorted, from a list of over two million in less than a fourth of a millisecond. Amazing!</p><hr><h2 id="more-publishers" tabindex="-1"><a class="header-anchor" href="#more-publishers"><span>More publishers!</span></a></h2><p>Now your boss comes and tells you to query the top 10 books, sorted alphabetically, as before, but over <strong>either</strong> publisher, combined. To be clear, the requirement is to take all books both publishers have published, combine them, then get the first ten, alphabetically.</p><p>Easy, you say assuredly, fresh off the high of seeing Postgres grab you that same data for your enormous publisher in under a millisecond.</p><p>You can put both publisher ids into an <code>IN</code> clause. Then, Postgres can search for each, one at a time, save the starting points of both, and then start reading forward on both, and sort of merge them together, taking the smaller title from either, until you have 10 books total.</p><p>Let’s try it!</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> books</span>
<span class="line"><span class="token keyword">WHERE</span> publisher <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">157595</span><span class="token punctuation">,</span> <span class="token number">210537</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Which produces this</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img7-multiple-publishers.png?resize=1024%2C447&amp;ssl=1" alt="Query plan output from a PostgreSQL execution showing the execution strategy and performance metrics." tabindex="0" loading="lazy"><figcaption>Query plan output from a PostgreSQL execution showing the execution strategy and performance metrics.</figcaption></figure><div class="hint-container info"><p class="hint-container-title">[Sad Trombone]</p><p>Let’s re-read my completely made-up, assumed chain of events Postgres would take, from above.</p><blockquote><p>Postgres can search for each, one at a time, save the starting points of both, and then start reading forward on both, and sort of merge them together, taking the smaller title from either, until you have 10 books total.</p></blockquote></div><p>It reads like the Charlie meme from Always Sunny in Philadelphia.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/always-sunny-meme.gif?resize=640%2C404&amp;ssl=1" alt="A scene from a television show featuring a man pointing at a chaotic board covered in papers, with red strings connecting different documents, emphasizing a frenzied investigation." tabindex="0" loading="lazy"><figcaption>A scene from a television show featuring a man pointing at a chaotic board covered in papers, with red strings connecting different documents, emphasizing a frenzied investigation.</figcaption></figure><p>If your description of what the database will do sounds like something that would fit with this meme, you’re probably overthinking things.</p><p>Postgres operates on very simple operations that it chains together. Index Scan, Gather Merge, Sort, Sequential Scan, etc.</p><hr><h2 id="searching-multiple-publishers" tabindex="-1"><a class="header-anchor" href="#searching-multiple-publishers"><span>Searching multiple publishers</span></a></h2><p>To be crystal clear, Postgres absolutely can search multiple keys from an index. Here’s the execution plan for the identical query from a moment ago, but with two small publishers for the publisher ids, which each have just a few hundred books</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img8-multiple-small-publishers.png?resize=1024%2C215&amp;ssl=1" alt="Query plan visualization showing execution details for a SQL command, including limit, sort key, and index scan operations with timing statistics." tabindex="0" loading="lazy"><figcaption>Query plan visualization showing execution details for a SQL command, including limit, sort key, and index scan operations with timing statistics.</figcaption></figure><p>It did indeed do an index scan, on that same index. It just matched two values at once.</p><p>Rather than taking one path down the B Tree, it takes multiple paths down the B Tree, based on the multiple key value matches.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">Index Cond: (publisher = ANY (&#39;{157595,141129}&#39;::integer[]))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That gives us <strong>all</strong> rows for <em>either</em> publisher. Then it needs to sort them, which it does next, followed by the limit.</p><p>Why does it need to sort them? When we have a <em>single</em> publisher, we <em>know</em> all values under that publisher are ordered.</p><p><em>Look</em> at the index.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img9-single-publisher-read.png?resize=1024%2C352&amp;ssl=1" alt="A flowchart representing a tree structure of book titles, with nodes for major titles like &#39;Jane Eyre&#39; and &#39;War and Peace,&#39; and leaves for individual entries, including &#39;The Great Gatsby&#39; and &#39;Moby Dick.&#39;" tabindex="0" loading="lazy"><figcaption>A flowchart representing a tree structure of book titles, with nodes for major titles like &#39;Jane Eyre&#39; and &#39;War and Peace,&#39; and leaves for individual entries, including &#39;The Great Gatsby&#39; and &#39;Moby Dick.&#39;</figcaption></figure><p>Imagine we searched for publisher 8. Postgres can go directly to the beginning of that publisher, and <em>just read</em>:</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">&quot;Animal Farm&quot;  </span>
<span class="line">&quot;Of Mice and Men&quot;  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Look what happens when we search for <em>two</em> publishers, 8 and also, now, 21.</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img10-double-publisher-read.png?resize=1024%2C348&amp;ssl=1" alt="A tree structure diagram representing a set of books, showing nodes with titles such as &#39;Jane Eyre&#39; and &#39;War and Peace&#39;, along with leaf nodes containing book entries like &#39;The Great Gatsby&#39;, &#39;Animal Farm&#39;, and &#39;To Kill a Mockingbird&#39;." tabindex="0" loading="lazy"><figcaption>A tree structure diagram representing a set of books, showing nodes with titles such as &#39;Jane Eyre&#39; and &#39;War and Peace&#39;, along with leaf nodes containing book entries like &#39;The Great Gatsby&#39;, &#39;Animal Farm&#39;, and &#39;To Kill a Mockingbird&#39;.</figcaption></figure><p>We can’t just start reading for those matched records. That would give us</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">&quot;Animal Farm&quot;</span>
<span class="line">&quot;Of Mice and Men&quot;</span>
<span class="line">&quot;Lord of The Flies&quot;</span>
<span class="line">&quot;The Catcher in The Rye&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The books under each publisher are ordered, but the overall list of matches is not. And again, Postgres operates on <em>simple</em> operations. Elaborate meta descriptions like “well it’ll just merge the matches from each publisher taking the less of the next entry from either until the limit is satisfied” won’t show up in your execution plan, at least not directly.</p><h3 id="why-did-the-publisher-id-change-the-plan" tabindex="-1"><a class="header-anchor" href="#why-did-the-publisher-id-change-the-plan"><span>Why did the publisher id change the plan?</span></a></h3><p>Before we make this query fast, let’s briefly consider why our query’s plan changed so radically between searching for two small publishers compared to an enormous publisher and a small one.</p><p>As we discussed in part 1, Postgres tracks and uses statistics about your data in order to craft the best execution plan it can. Here, when you searched for the large publisher, it realized that query would yield an enormous number of rows. That led it to decide that simply scanning through the heap directly would be faster than the large number of random i/o that would be incurred from following so many matches in the index’s leaf nodes, over to the corresponding locations on the heap. Random i/o is bad, and Postgres will usually try to avoid it.</p><hr><h2 id="crafting-a-better-query" tabindex="-1"><a class="header-anchor" href="#crafting-a-better-query"><span>Crafting a better query</span></a></h2><p>You can absolutely have Postgres find the top 10 books in both publishers, and then put them together, sorted, and take the first 10 from there. You just have to be explicit about it.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span></span>
<span class="line"><span class="token keyword">WITH</span> pub1 <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> books</span>
<span class="line">    <span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> <span class="token number">157595</span></span>
<span class="line">    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title <span class="token keyword">LIMIT</span> <span class="token number">10</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">,</span> pub2 <span class="token keyword">as</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> books</span>
<span class="line">    <span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> <span class="token number">210537</span></span>
<span class="line">    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title <span class="token keyword">LIMIT</span> <span class="token number">10</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pub1</span>
<span class="line"><span class="token keyword">UNION</span> <span class="token keyword">ALL</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pub2</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The syntax below is called a common table expression, or a CTE. It’s basically a query that we define, and then query against later.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">WITH</span> pub1 <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> books</span>
<span class="line">    <span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> <span class="token number">157595</span></span>
<span class="line">    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title <span class="token keyword">LIMIT</span> <span class="token number">10</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let’s run it!</p><p>The execution plan is beautiful</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img11-cte-append.png?resize=1024%2C257&amp;ssl=1" alt="A screenshot displaying a query execution plan from a database, showing the steps involved in retrieving data for two publishers from a books table using indexed scans and sorting." tabindex="0" loading="lazy"><figcaption>A screenshot displaying a query execution plan from a database, showing the steps involved in retrieving data for two publishers from a books table using indexed scans and sorting.</figcaption></figure><p>It’s fast! As you can see, it runs in less than a fifth of a millisecond (0.186ms — but who’s counting)?</p><p>Always read these from the bottom:</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img11a-cte-append.png?resize=1024%2C130&amp;ssl=1" alt="Execution plan showing the performance of an index scan in a PostgreSQL database, with details on limits, rows processed, and execution time." tabindex="0" loading="lazy"><figcaption>Execution plan showing the performance of an index scan in a PostgreSQL database, with details on limits, rows processed, and execution time.</figcaption></figure><p>It’s the same exact index scan from before, but on a single publisher, with a limit of 10, run twice. Postgres can seek to the right publisher, and just read 10 for the first publisher, and then repeat for the second publisher. Then it puts those lists together.</p><p>Remember the silly, contrived Postgres operation I made up before?</p><blockquote><p>… and then start reading forward on both, and sort of merge them together, taking the smaller title from either, until you have 10 books total.</p></blockquote><p>You’re not going to believe this, but that’s exactly what the Merge Append on line 2 does</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">-&gt;  Merge Append  (cost=1.40..74.28 rows=20 width=111) (actual time=0.086..0.115 rows=10 loops=1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You can achieve amazing things with modern databases if you know how to structure your queries <em>just</em> right.</p><hr><h2 id="how-does-this-scale" tabindex="-1"><a class="header-anchor" href="#how-does-this-scale"><span>How does this scale?</span></a></h2><p>You won’t want to write queries like this manually. Presumably, you’d have application code taking a list of publisher ids, and constructing something like this. How will it perform as you add more and more publishers?</p><p>I’ve explored this very idea on larger production sets of data (much larger than what we’re using here). I found that, somewhere around a <em>thousand</em> ids, the performance does break down. But not because there’s too much data to work with. The <em>execution</em> of those queries, with even a thousand ids, took only a few hundred <code>ms</code>. But the <em>Planning Time</em> started to take many, many seconds. It turns out having Postgres parse through a thousand CTEs, and put a plan together takes time.</p><hr><h2 id="version-2" tabindex="-1"><a class="header-anchor" href="#version-2"><span>Version 2</span></a></h2><p>We’re onto something, for sure. But can we take a list of ids, and force them into individual queries that match on that specific id, with a limit, and then select from the overall bucket of results? Exactly like before, but without having to manually cobble together a CTE for each id?</p><p>When there’s a will, there’s a way.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span></span>
<span class="line"><span class="token keyword">WITH</span> ids <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span></span>
<span class="line">      <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">157595</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">210537</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span> t<span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">,</span> results <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> bookInfo<span class="token punctuation">.</span><span class="token operator">*</span></span>
<span class="line">    <span class="token keyword">FROM</span> ids</span>
<span class="line">    <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> lateral <span class="token punctuation">(</span></span>
<span class="line">      <span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line">      <span class="token keyword">FROM</span> books</span>
<span class="line">      <span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> ids<span class="token punctuation">.</span>id</span>
<span class="line">      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line">      <span class="token keyword">LIMIT</span> <span class="token number">10</span></span>
<span class="line">    <span class="token punctuation">)</span> bookInfo</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> results</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let’s walk through this.</p><p>Our <code>ids</code> CTE:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">WITH</span> ids <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span></span>
<span class="line">      <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">157595</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">210537</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span> t<span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This defines a pseudo-table that has one column, with two rows. The rows have values of our publisher ids for the sole column: 157595 and 210537.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">values (157595), (210537)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>But if it’s a table, how do we query against the column? It needs to have a name. That’s what this syntax is.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">t(id)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We gave that column a name of <code>id</code>.</p><p>The <code>results</code> CTE is where the real work happens.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line">results <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> bookInfo<span class="token punctuation">.</span><span class="token operator">*</span></span>
<span class="line">    <span class="token keyword">FROM</span> ids</span>
<span class="line">    <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> lateral <span class="token punctuation">(</span></span>
<span class="line">      <span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line">      <span class="token keyword">FROM</span> books</span>
<span class="line">      <span class="token keyword">WHERE</span> publisher <span class="token operator">=</span> ids<span class="token punctuation">.</span>id</span>
<span class="line">      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line">      <span class="token keyword">LIMIT</span> <span class="token number">10</span></span>
<span class="line">    <span class="token punctuation">)</span> bookInfo</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We query against our <code>ids</code> table, and then use the ugly <code>cross join lateral</code> expression as a neat trick to run our normal books query, but with access to the publisher value in the ids CTE. The value in the ids CTE is the publisher id. So we’ve achieved what we want: we’re conceptually looping through those ids, and then running our fast query on each.</p><p>The term <code>lateral</code> is the key. Think of (American) football, where a lateral is a sideways pass. Here, the lateral keyword allows us to “laterally” reference the <code>ids.id</code> value from the expression right beside it; the <code>ids</code> CTE <em>laterals</em> each id over to the results CTE.</p><p>That coaxes Postgres to run its normal index scan, followed by a read of the next 10 rows. That happens once for each id. That whole meta-list will then contain (up to) 10 rows for each publisher, and then this…</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> results</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>… re-sorts, and takes the first 10. In my own experience, this scales fabulously. Even with a few thousand ids I couldn’t get this basic setup to take longer than half a second, even on a much larger table than we’ve been looking at here.</p><h3 id="let-s-run-it" tabindex="-1"><a class="header-anchor" href="#let-s-run-it"><span>Let’s run it!</span></a></h3><p>Let’s see what this version of our query looks like</p><figure><img src="https://i0.wp.com/frontendmasters.com/blog/wp-content/uploads/2025/08/img12-cross-join.png?resize=1024%2C268&amp;ssl=1" alt="A query plan execution analysis demonstrating performance improvements after creating an index on the &#39;books&#39; table in Postgres." tabindex="0" loading="lazy"><figcaption>A query plan execution analysis demonstrating performance improvements after creating an index on the &#39;books&#39; table in Postgres.</figcaption></figure><p>Still a small fraction of a millisecond, but ever so slightly slower; this now runs in 0.207ms. And the execution plan is a bit longer and more complex.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">-&gt;  Nested Loop  (cost=0.69..81.19 rows=20 width=111) (actual time=0.042..0.087 rows=20 loops=1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>A nested loop join is a pretty simple (and <em>usually</em> pretty slow) join algorithm. It just takes each value in the one list, and then applies it to each value in the second list. In this case, though, it’s taking values from a static list and applying them against an incredibly fast query.</p><p>The left side of the join is each id from that static table we built</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">-&gt;  Values Scan on &quot;\*VALUES\*&quot;  (cost=0.00..0.03 rows=2 width=4) (actual time=0.001..0.002 rows=2 loops=1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The right side is our normal (<em>fast</em>) query that we’ve seen a few times now.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">-&gt;  Limit  (cost=0.69..40.48 rows=10 width=111) (actual time=0.024..0.037 rows=10 loops=2)</span>
<span class="line">      -&gt;  Index Scan using idx_publisher_title on books  (cost=0.69..2288.59 rows=575 width=111) (actual time=0.023..0.034 rows=10 loops=2)</span>
<span class="line">         Index Cond: (publisher = &quot;\*VALUES\*&quot;.column1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>However, our nice Merge Append is gone, replaced with a normal sort. The reason is that we replaced discrete CTEs, each of which produced separate, identically sorted outputs, which the planner could identify, and apply a Merge Append to. Merge Append works on multiple, independently sorted streams of data. Instead, this is just a regular join, which produces one stream of data, and therefore needs to be sorted.</p><p>But this is no tragedy. The query runs in a tiny fraction of a <strong>milli</strong>second, and will not suffer planning time degradation like the previous CTE version would, as we add more and more publisher ids. Plus, the sort is over just <code>N*10</code> records, where N is the number of publishers. It would take a catastrophically large N to wind up with enough rows where Postgres would struggle to sort them quickly, especially since the limit of 10 would allow it to do an efficient top-N heapsort, like we saw in part 1. ---</p><h2 id="stepping-back" tabindex="-1"><a class="header-anchor" href="#stepping-back"><span>Stepping back</span></a></h2><p>The hardest part of writing this post is knowing when to stop. I could easily write as much content again: we haven’t even gotten into joins, and how indexes can help there, or even materialized views. This is an endless topic, and one that I enjoy, but we’ll stop here for now.</p><p>The one theme throughout can be summed up as: understand <em>how</em> your data is stored, and <em>craft</em> your queries to make the best use possible of this knowledge. If you’re not sure exactly how to craft your queries to do this, then use your knowledge of how indexes work, and what you want your queries to accomplish to ask an <em>extremely</em> specific question to your favorite AI model. It’s very likely to <em>at least</em> get you closer to your answer. Oftentimes knowing <em>what</em> to ask is half the battle.</p><p>And of course, if your data is not stored as you need, then change how your data is stored. Indexes are the most common way, which we’ve discussed here. Materialized views would be the next power tool to consider when needed. But that’s a topic for another day.</p><hr><h2 id="parting-thoughts" tabindex="-1"><a class="header-anchor" href="#parting-thoughts"><span>Parting thoughts</span></a></h2><p>Hopefully, these posts have taught you a few things about querying, query tuning, and crafting the right index for the right situation. These are skills that can have a huge payoff in achieving palpable performance gains that your users will notice.</p><div class="hint-container info"><p class="hint-container-title">Article Series</p><a class="route-link vp-card" href="/bookshelf/frontendmasters.com/intro-to-postgres-indexes.html" style="background:rgba(188,75,52,0.2);"><img class="vp-card-logo" src="https://frontendmasters.com/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Introduction to Postgres Indexes</div><hr><div class="vp-card-desc">This Part 1 (of a 2-part series) is a practical, hands-on, applicable approach to database indexes. We’ll cover what B Trees are with a focus on deeply understanding, and internalizing how they store data on disk, and how your database uses them to speed up queries. This will set us up nicely for part 2, […]</div></div></a><a class="route-link vp-card" href="/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html" style="background:rgba(188,75,52,0.2);"><img class="vp-card-logo" src="https://frontendmasters.com/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization</div><hr><div class="vp-card-desc">Postgres creates an execution plan for how to retrieve the data you're asking for in a query. The execution plan is based in part on statistics from your data and indexes it has available. Just the right index and a bit of query tuning can have a huge payoff in performance gains that your users will notice.</div></div></a></div><div class="hint-container note"><p class="hint-container-title">Editor’s note</p><p>our <a href="https://frontendmasters.com/courses/complete-go/" target="_blank" rel="noopener noreferrer">The Complete Course for Building Backend Web Apps with Go</a> includes setting up a PostgreSQL database and running it in Docker, all from scratch.</p></div><!-- TODO: add ARTICLE CARD --><a class="vp-card" href="https://chanhi2000.github.io/bookshelf/frontendmasters.com/advanced-postgresql-indexing.html" target="_blank" style="background:rgba(188,75,52,0.2);"><img class="vp-card-logo" src="https://frontendmasters.com/favicon.ico" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Advanced PostgreSQL Indexing: Multi-Key Queries and Performance Optimization</div><hr><div class="vp-card-desc">Postgres creates an execution plan for how to retrieve the data you're asking for in a query. The execution plan is based in part on statistics from your data and indexes it has available. Just the right index and a bit of query tuning can have a huge payoff in performance gains that your users will notice.</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/frontendmasters.com/advanced-postgresql-indexing.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/data-science/postgres/articles/" aria-label="/data-science/postgres/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/data-science/postgres/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/frontendmasters.com/intro-to-postgres-indexes.html" aria-label="Introduction to Postgres Indexes"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Introduction to Postgres Indexes<i class="vp-icon iconfont icon-postgresql" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><div class="vp-copyright">Copyright © 2025 Adam Rackis </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
