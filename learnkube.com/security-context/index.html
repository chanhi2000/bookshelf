<!doctype html>
<html lang="en-US" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.99" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"From Linux Primitives to Kubernetes Security Contexts","image":["https://static.learnkube.com/e35dce29118ebe296671cab01d160a5c.png","https://learnkube.com/a/be7a7a42d500d60d85ff95a550147e18.svg","https://learnkube.com/a/c59552e508a9802dff5de01983790a72.svg","https://learnkube.com/a/3af70ded6be4dce280ffdcaac3500eb5.svg","https://makelinux.github.io/kernel/map/","https://learnkube.com/a/2a4f54de9482a24ad9168d795b366911.svg","https://learnkube.com/a/8073408f5aa250870831e8424e8495f7.svg","https://learnkube.com/a/5fb7ed4a532839d3b559342e04d6d802.svg","https://learnkube.com/a/386c29c1f90fec22694a4f0ce0b5aa0d.svg","https://learnkube.com/a/abd0a2e760de387283d844e0c9b590b7.svg","https://learnkube.com/a/f4ad672dd92d863c0d5b324b954c20eb.svg","https://learnkube.com/a/ae8392b36d19cf7486761af8fce97b6e.svg","https://learnkube.com/a/7db84bc90ac80a944676bc7db80424bf.svg","https://learnkube.com/a/219af075732ea2ad7bf79a3a8ce838bd.svg","https://learnkube.com/a/cd62a2e690b06c0659b570c519e473da.svg","https://learnkube.com/a/fcaaf0aa811f986ba357f73b5ae6365c.svg","https://learnkube.com/a/be18e9e2649498e83be2d8301bb850f6.svg","https://learnkube.com/a/3f09a092f3be11f3a5ad1628d754586f.svg","https://learnkube.com/a/5c399bad12e1202ad138851a8a0973de.svg","https://learnkube.com/a/23631e66d828e3cc9d6313c4441e1011.svg","https://learnkube.com/a/5e44d03eaaf7b6a8a92dff5c1600c948.svg","https://learnkube.com/a/80c037eca089724e2e941baa2a5ad59e.svg","https://learnkube.com/a/4d6005ebf2ca4ae55b2e6288c2445f10.svg","https://learnkube.com/a/4dbf8701996e839152727222e64f17b7.svg","https://learnkube.com/a/f641beea53964c60434e21fc62725218.svg","https://learnkube.com/a/3929520349640bb4efa9f168d7dbc2fe.svg","https://learnkube.com/a/86dd608ffe45dc2ef9ff56eaf74492a6.svg","https://learnkube.com/a/7d396d8ed2ba612d19a2fb85d209b4c9.svg","https://learnkube.com/a/6cb224662f002fd8d1c532185510e869.svg","https://learnkube.com/a/6b164bccfb75ee7af564de3d57117fed.svg","https://learnkube.com/a/ccb425a87cfe714b1030c6f138553ff6.svg","https://learnkube.com/a/2148666d18da9b98e4382050d93509d1.svg","https://learnkube.com/a/c62aa9e0e0cc79d11e68aa09e8e672d9.svg","https://learnkube.com/a/9d75d1dbde3ec0c09a05eef08a5156ef.svg","https://learnkube.com/a/97fccaca51ca06540a85ca3180dd6684.png"],"datePublished":"2025-08-01T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Dave Altena","url":"https://www.linkedin.com/in/dave-altena/"}]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/learnkube.com/security-context/"><meta property="og:site_name" content="ðŸ“šBookshelf"><meta property="og:title" content="From Linux Primitives to Kubernetes Security Contexts"><meta property="og:description" content="Article(s) > From Linux Primitives to Kubernetes Security Contexts"><meta property="og:type" content="article"><meta property="og:image" content="https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png"><meta name="twitter:image:alt" content="From Linux Primitives to Kubernetes Security Contexts"><meta property="article:author" content="Dave Altena"><meta property="article:tag" content="k8s"><meta property="article:tag" content="kubernetes"><meta property="article:tag" content="devops"><meta property="article:tag" content="learnkube.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2025-08-01T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>From Linux Primitives to Kubernetes Security Contexts | ðŸ“šBookshelf</title><meta name="description" content="Article(s) > From Linux Primitives to Kubernetes Security Contexts">
    <link rel="preload" href="/bookshelf/assets/style-Bhb-QcDa.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-Bhb-QcDa.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">ðŸ“šBookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="oddbird.net"><!--[--><img class="vp-icon" src="https://oddbird.net/safari-pinned-tab.svg" alt aria-hidden no-view sizing="both"><!--]-->oddbird.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/zeroheight.com/" aria-label="zeroheight.com"><!--[--><img class="vp-icon" src="https://zeroheight.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->zeroheight.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/typescript.tv/" aria-label="typescript.tv"><!--[--><img class="vp-icon" src="https://typescript.tv/_astro/android-chrome-192x192.BhQ8hcWh.png" alt aria-hidden no-view sizing="both"><!--]-->typescript.tv<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/bram.us/" aria-label="bram.us"><!--[--><img class="vp-icon" src="https://bram.us/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->bram.us<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/una.im/" aria-label="una.im"><!--[--><img class="vp-icon" src="https://una.im/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->una.im<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/joshwcomeau.com/" aria-label="joshwcomeau.com"><!--[--><img class="vp-icon" src="https://joshwcomeau.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->joshwcomeau.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tip.com/" aria-label="css-tip.com"><!--[--><img class="vp-icon" src="https://css-tip.com/img/fav.png" alt aria-hidden no-view sizing="both"><!--]-->css-tip.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/nerdy.dev/" aria-label="nerdy.dev"><!--[--><img class="vp-icon" src="https://nerdy.dev/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->nerdy.dev<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/learnkube.com/" aria-label="learnkube.com"><!--[--><img class="vp-icon" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnkube.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/bookshelf" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><!----></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="vp-icon" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">learnkube.com</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-k8s" sizing="height"></i>From Linux Primitives to Kubernetes Security Contexts</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorðŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.linkedin.com/in/dave-altena/" target="_blank" rel="noopener noreferrer">Dave Altena</a></span><span property="author" content="Dave Altena"></span></span><!----><span class="page-date-info" aria-label="Writing DateðŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">8/1/25</span><meta property="datePublished" content="2025-08-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 30 min</span><meta property="timeRequired" content="PT30M"></span><span class="page-category-info" aria-label="CategoryðŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2" role>DevOps</span><span class="page-category-item color7" role>Kubernetes</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="DevOps,Kubernetes,Article(s)"></span><span class="page-tag-info" aria-label="TagðŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color1" role>learnkube.com</span><span class="page-tag-item color7" role>devops</span><span class="page-tag-item color2" role>kubernetes</span><span class="page-tag-item color5" role>k8s</span><!--]--><meta property="keywords" content="blog,learnkube.com,devops,kubernetes,k8s"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-á„€á…ªá†«á„…á…§á†«" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-á„€á…ªá†«á„…á…§á†«"><span>From Linux Primitives to Kubernetes Security Contexts ê´€ë ¨</span></a></h1><a class="route-link vp-card" href="/bookshelf/devops/k8s/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="/bookshelf/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Kubernetes > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#table-of-contents" class="router-link-active router-link-exact-active">Table of Contents</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#linux-primitives-beneath-kubernetes" class="router-link-active router-link-exact-active">Linux Primitives Beneath Kubernetes</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#syscalls-the-kernel-s-api-surface" class="router-link-active router-link-exact-active">Syscalls: The Kernel&#39;s API Surface</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#control-groups-cgroups-enforcing-resource-limits" class="router-link-active router-link-exact-active">Control Groups (cgroups): Enforcing Resource Limits</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#namespaces-isolating-what-a-process-can-see" class="router-link-active router-link-exact-active">Namespaces: Isolating What a Process Can See</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#from-kernel-primitives-to-developer-abstractions" class="router-link-active router-link-exact-active">From Kernel Primitives to Developer Abstractions</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#linux-user-ids-and-permissions" class="router-link-active router-link-exact-active">Linux User IDs and Permissions</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#user-namespaces-and-uid-mapping-in-containers" class="router-link-active router-link-exact-active">User Namespaces and UID Mapping in Containers</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#how-docker-manages-uids" class="router-link-active router-link-exact-active">How Docker Manages UIDs</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#runasuser-and-runasnonroot" class="router-link-active router-link-exact-active">runAsUser and runAsNonRoot</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#linux-capabilities" class="router-link-active router-link-exact-active">Linux Capabilities</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#allowprivilegeescalation" class="router-link-active router-link-exact-active">allowPrivilegeEscalation</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#privileged-containers" class="router-link-active router-link-exact-active">Privileged Containers</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#readonlyrootfilesystem" class="router-link-active router-link-exact-active">readOnlyRootFilesystem</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#seccomp-profiles" class="router-link-active router-link-exact-active">Seccomp Profiles</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#apparmor" class="router-link-active router-link-exact-active">AppArmor</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#fsgroup-and-supplementalgroups" class="router-link-active router-link-exact-active">fsGroup and supplementalGroups</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#how-fsgroup-works-with-csi-volumes" class="router-link-active router-link-exact-active">How fsGroup Works with CSI Volumes</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#live-debugging-diagnosing-securitycontext-failures" class="router-link-active router-link-exact-active">Live Debugging: Diagnosing SecurityContext Failures</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#troubleshooting-when-security-context-conflicts-with-container-behavior" class="router-link-active router-link-exact-active">Troubleshooting: When Security Context Conflicts with Container Behavior</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/security-context/#summary-and-best-practices" class="router-link-active router-link-exact-active">Summary and Best Practices</a></li></ul></nav><hr><div class="vp-site-info" data-name="From Linux Primitives to Kubernetes Security Contexts"><a class="vp-site-info-navigator no-external-link-icon" title="From Linux Primitives to Kubernetes Security Contexts" href="https://learnkube.com/security-contexts" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://static.learnkube.com/97fccaca51ca06540a85ca3180dd6684.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt loading="lazy" no-view><div class="vp-site-info-name">From Linux Primitives to Kubernetes Security Contexts</div><div class="vp-site-info-desc">Dive deep into Kubernetes Security Contexts and learn how to manage security settings for your pods and containers.</div></div><!----></div><div class="pdf-viewer-wrapper" style="width:100%;height:auto;"><div></div><button class="pdf-fullscreen-button"><svg xmlns="http://www.w3.org/2000/svg" class="pdf-fullscreen-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="enter-fullscreen icon" name="enter-fullscreen"><path d="M762.773 90.24h-497.28c-96.106 0-174.4 78.293-174.4 174.4v497.28c0 96.107 78.294 174.4 174.4 174.4h497.28c96.107 0 175.04-78.293 174.4-174.4V264.64c0-96.213-78.186-174.4-174.4-174.4zm-387.2 761.173H215.04c-21.867 0-40.427-17.92-41.067-41.066V649.92c0-22.507 17.92-40.427 40.427-40.427 11.307 0 21.227 4.694 28.48 11.947 7.253 7.253 11.947 17.92 11.947 28.48v62.293l145.28-145.28c15.893-15.893 41.813-15.893 57.706 0 15.894 15.894 15.894 41.814 0 57.707l-145.28 145.28h62.294c22.506 0 40.426 17.92 40.426 40.427s-17.173 41.066-39.68 41.066zM650.24 165.76h160.427c21.866 0 40.426 17.92 41.066 41.067v160.426c0 22.507-17.92 40.427-40.426 40.427-11.307 0-21.227-4.693-28.48-11.947-7.254-7.253-11.947-17.92-11.947-28.48v-62.186L625.6 450.347c-15.893 15.893-41.813 15.893-57.707 0-15.893-15.894-15.893-41.814 0-57.707l145.28-145.28H650.88c-22.507 0-40.427-17.92-40.427-40.427s17.174-41.173 39.787-41.173z"></path></svg></button></div><figure><img src="https://static.learnkube.com/e35dce29118ebe296671cab01d160a5c.png" alt="From Linux Primitives to Kubernetes Security Contexts" tabindex="0" loading="lazy"><figcaption>From Linux Primitives to Kubernetes Security Contexts</figcaption></figure><p>In Kubernetes, containers typically start with <strong>root privileges</strong>.</p><p>This happens because, by default, container processes run as <code>UID 0</code> unless overridden.</p><p>Kubernetes does not impose a non-root policy; it inherits whatever the image defines.</p><p>This isn&#39;t a bug, it&#39;s a design choice carried over from Docker.</p><p>While convenient during development, it introduces unnecessary risk in production environments.</p><p>If an attacker compromises the container, <strong>root access</strong> increases the likelihood of privilege escalation to the host.</p><p>The Kubernetes API offers several ways to restrict container privileges using the <strong>Security Context</strong>.</p><p>With it, you can control the user a container runs as, manage <strong>Linux capabilities</strong>, enforce read-only filesystems, and block privilege escalation.</p><p>However, despite its importance, <strong>Security Contexts</strong> are often misunderstood or misapplied.</p><p>Many teams discover these controls only after a security audit or scanner flags a running container.</p><p>The next steps are usually reactively patching the config, suppressing the warning and moving on.</p><p>Before we get into <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-k8s" sizing="height"></i>Kubernetes SecurityContexts</a>, we need to understand what they&#39;re actually configuring under the hood.</p><hr><h2 id="table-of-contents" tabindex="-1"><a class="header-anchor" href="#table-of-contents"><span>Table of Contents</span></a></h2><ul><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#linux-primitives-beneath-kubernetes">Linux Primitives Beneath Kubernetes</a></li><li><a href="#syscalls-the-kernel-s-api-surface">Syscalls: The Kernel&#39;s API Surface</a></li><li><a href="#control-groups-cgroups-enforcing-resource-limits">Control Groups (cgroups): Enforcing Resource Limits</a></li><li><a href="#namespaces-isolating-what-a-process-can-see">Namespaces: Isolating What a Process Can See</a></li><li><a href="#from-kernel-primitives-to-developer-abstractions">From Kernel Primitives to Developer Abstractions</a></li><li><a href="#linux-user-ids-and-permissions">Linux User IDs and Permissions</a></li><li><a href="#user-namespaces-and-uid-mapping-in-containers">User Namespaces and UID Mapping in Containers</a></li><li><a href="#how-docker-manages-uids">How Docker Manages UIDs</a></li><li><a href="#runasuser-and-runasnonroot"><code>runAsUser</code> and <code>runAsNonRoot</code></a></li><li><a href="#linux-capabilities">Linux Capabilities</a></li><li><a href="#allowprivilegeescalation"><code>allowPrivilegeEscalation</code></a></li><li><a href="#privileged-containers">Privileged Containers</a></li><li><a href="#readonlyrootfilesystem">readOnlyRootFilesystem</a></li><li><a href="#seccomp-profiles">Seccomp Profiles</a></li><li><a href="#apparmor">AppArmor</a></li><li><a href="#fsgroup-and-supplementalgroups">fsGroup and supplementalGroups</a></li><li><a href="#how-fsgroup-works-with-csi-volumes">How fsGroup Works with CSI Volumes</a></li><li><a href="#live-debugging-diagnosing-securitycontext-failures">Live Debugging: Diagnosing SecurityContext Failures</a></li><li><a href="#troubleshooting-when-security-context-conflicts-with-container-behavior">Troubleshooting: When Security Context Conflicts with Container Behavior</a></li><li><a href="#summary-and-best-practices">Summary and Best Practices</a></li></ul><hr><h2 id="linux-primitives-beneath-kubernetes" tabindex="-1"><a class="header-anchor" href="#linux-primitives-beneath-kubernetes"><span>Linux Primitives Beneath Kubernetes</span></a></h2><p>A <strong>container in Kubernetes</strong> is just a regular Linux process.</p><p>It runs directly on the host&#39;s kernel, but it&#39;s isolated using namespaces (for things like networking, mounts, and process IDs) and <a href="https://man7.org/linux/man-pages/man7/cgroups.7.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>cgroups</a> (for resource limits).</p><p>It also gets its own virtual filesystem, which is an isolated root directory.</p><p>There&#39;s no virtual machine here.</p><p>It&#39;s just <strong>Linux, sandboxed</strong>.</p><p>That&#39;s why it really matters who the process runs as inside the container; especially if it&#39;s <code>root</code>.</p><p>The <strong>securityContext</strong> field in a pod spec is a declarative way to configure how that process interacts with the kernel.</p><p><strong>But Kubernetes doesn&#39;t enforce these settings itself.</strong></p><p>It passes them down to the container runtime, which translates them into kernel-level instructions at container start.</p><p>Every setting you apply in a pod spec ultimately maps to low-level kernel features like syscalls, namespaces, cgroups, or capabilities.</p><p>To configure these effectively, you need to understand what each one does.</p><p>So before touching YAML, let&#39;s dissect the kernel-level primitives that SecurityContexts rely on.</p><hr><h2 id="syscalls-the-kernel-s-api-surface" tabindex="-1"><a class="header-anchor" href="#syscalls-the-kernel-s-api-surface"><span>Syscalls: The Kernel&#39;s API Surface</span></a></h2><p>In Linux, user-space applications can&#39;t interact with hardware or kernel-managed resources directly.</p><p>Every interaction must go through the kernel, and the only sanctioned way to do that is via system calls.</p><p>System calls are predefined entry points that expose core kernel functionality.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-0" aria-selected="true">1/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-1" aria-selected="false">2/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-2" aria-selected="false">3/3</button></div><!--[--><div class="vp-tab active" id="v-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/3</div><!--[--><figure><img src="https://learnkube.com/a/be7a7a42d500d60d85ff95a550147e18.svg" alt="The kernel works as a middle-man between your app and the hardware. When your Java application accesses a file on the filesystem, it initiates a syscall to the Linux kernel." tabindex="0" loading="lazy"><figcaption>The kernel works as a middle-man between your app and the hardware. When your Java application accesses a file on the filesystem, it initiates a syscall to the Linux kernel.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/3</div><!--[--><figure><img src="https://learnkube.com/a/c59552e508a9802dff5de01983790a72.svg" alt="The Kernel knows how to access the underlying storage and lets your app retrieve the files. You could think of syscalls as API calls." tabindex="0" loading="lazy"><figcaption>The Kernel knows how to access the underlying storage and lets your app retrieve the files. You could think of syscalls as API calls.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/3</div><!--[--><figure><img src="https://learnkube.com/a/3af70ded6be4dce280ffdcaac3500eb5.svg" alt="Similarly, if your Node.js app has to initiate a network connection, it still has to go through the kernel with a system call." tabindex="0" loading="lazy"><figcaption>Similarly, if your Node.js app has to initiate a network connection, it still has to go through the kernel with a system call.</figcaption></figure><!--]--></div><!--]--></div><p>You can think of system calls as the <strong>kernel&#39;s API</strong>â€”over 300 entry points grouped by what they do.</p><p>Some handle files, some manage processes, others deal with networking or memory.</p><p>Each one has a unique ID in the kernel and takes specific arguments to tell the kernel exactly what to do.</p><figure><img src="https://learnkube.com/a/fcdf8fc3577862cf163db7d71e5f51ca.svg" alt="Linux kernel map&lt;br/&gt;&lt;VPIcon icon=&quot;fas fa-globe&quot;/&gt;You can find an interactive map for all kernels calls here." tabindex="0" loading="lazy"><figcaption>Linux kernel map<br><a href="https://makelinux.github.io/kernel/map/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>You can find an interactive map for all kernels calls here.</a></figcaption></figure><p>Take the <a href="https://man7.org/linux/man-pages/man2/open.2.html#:~:text=The%20open()%20system%20call" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i><code>open</code> syscall</a>â€”it needs a file path, an access mode like read or write, and permission bits.</p><p>You can see the exact options and signature by checking the manual:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">man</span> <span class="token number">2</span> <span class="token function">open</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">8</span> <span class="token string">&quot;SYNOPSIS&quot;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># SYNOPSIS</span></span>
<span class="line"><span class="token comment">#        #include &lt;fcntl.h&gt;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int open(const char *pathname, int flags, ...</span></span>
<span class="line"><span class="token comment">#                   /* mode_t mode */ );</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int creat(const char *pathname, mode_t mode);</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int openat(int dirfd, const char *pathname, int flags, ...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how it looks when a real application makes these calls:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">strace</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>openat <span class="token function">ls</span> /tmp <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-5</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/etc/ld.so.cache&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/lib/x86_64-linux-gnu/libselinux.so.1&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>, O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;/tmp&quot;</span>, O_RDONLY<span class="token operator">|</span>O_NONBLOCK<span class="token operator">|</span>O_CLOEXEC<span class="token operator">|</span>O_DIRECTORY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or <code>socket</code>, which asks for a network domain like IPv4, a type like TCP, and the protocol you want to use.</p><p>You can inspect the socket and connect syscall signatures:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">man</span> <span class="token number">2</span> socket <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">8</span> <span class="token string">&quot;SYNOPSIS&quot;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># SYNOPSIS</span></span>
<span class="line"><span class="token comment">#        #include &lt;sys/socket.h&gt;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment">#        int socket(int domain, int type, int protocol);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how these work together in a real network request:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">strace</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>socket,connect <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://httpbin.org/ip <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;(socket|connect)&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">socket<span class="token punctuation">(</span>AF_INET, SOCK_STREAM, IPPROTO_TCP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span></span>
<span class="line">connect<span class="token punctuation">(</span><span class="token number">5</span>, <span class="token punctuation">{</span>sa_family<span class="token operator">=</span>AF_INET, <span class="token assign-left variable">sin_port</span><span class="token operator">=</span>htons<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>, <span class="token assign-left variable">sin_addr</span><span class="token operator">=</span>inet_addr<span class="token punctuation">(</span><span class="token string">&quot;192.168.2.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>, <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>socket()</code> call creates a TCP socket (<code>AF_INET</code> + <code>SOCK_STREAM</code>), then <code>connect()</code> establishes the connection to the remote server.</p><p>Even high-level code, like a simple network request in Node.js, still ends up triggering a <code>socket</code> syscall behind the scenes.</p><p><strong>This level of access gives user-space applications immense power.</strong></p><p>But it also exposes a large attack surface, especially when privileged capabilities are involved.</p><p>For instance, the <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i><code>CAP_NET_ADMIN</code> capability</a> capability unlocks dozens of networking syscalls ranging from setting interface flags to modifying routing tables.</p><p>Each of those calls takes arguments that can be used in wildly different ways, depending on the context.</p><p>So two processes with the same capability can behave very differently, depending on which syscalls they invoke and how they use them.</p><p><strong>This is where the problem starts: the kernel trusts that you know what you&#39;re doing.</strong></p><p>That&#39;s why Linux adds another layer to contain that risk: control groups, or cgroups.</p><hr><h2 id="control-groups-cgroups-enforcing-resource-limits" tabindex="-1"><a class="header-anchor" href="#control-groups-cgroups-enforcing-resource-limits"><span>Control Groups (cgroups): Enforcing Resource Limits</span></a></h2><p><a href="https://man7.org/linux/man-pages/man7/cgroups.7.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Control groups</a> are kernel-level mechanisms that restrict how much CPU, memory, I/O, and other resources a processâ€”or a group of processesâ€”can consume.</p><p>They define how much of the system each one is allowed to use.</p><p>Say you&#39;re running a JVM application.</p><p>You can assign it to a <code>cgroup</code> that caps its memory at 256MB and restricts it to a single CPU core.</p><p>Now take a second processâ€”maybe a Node.js app. You can place it in a separate cgroup with its own constraints.</p><p>Each cgroup defines a <strong>resource boundary</strong>.</p><p>You control how much each process gets, and the kernel enforces it.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-3" aria-selected="true">1/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-4" aria-selected="false">2/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-5" aria-selected="false">3/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-6" aria-selected="false">4/4</button></div><!--[--><div class="vp-tab active" id="v-3" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/4</div><!--[--><figure><img src="https://learnkube.com/a/2a4f54de9482a24ad9168d795b366911.svg" alt="In this case, I have a control group for the JVM." tabindex="0" loading="lazy"><figcaption>In this case, I have a control group for the JVM.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-4" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/4</div><!--[--><figure><img src="https://learnkube.com/a/8073408f5aa250870831e8424e8495f7.svg" alt="I can create a control group that limits access to CPU, memory, network bandwidth, etc." tabindex="0" loading="lazy"><figcaption>I can create a control group that limits access to CPU, memory, network bandwidth, etc.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-5" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/4</div><!--[--><figure><img src="https://learnkube.com/a/5fb7ed4a532839d3b559342e04d6d802.svg" alt="Each process can have its control group. I could create a second control group for the Node.js app." tabindex="0" loading="lazy"><figcaption>Each process can have its control group. I could create a second control group for the Node.js app.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-6" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">4/4</div><!--[--><figure><img src="https://learnkube.com/a/386c29c1f90fec22694a4f0ce0b5aa0d.svg" alt="I can fine-tune the settings for the new control group and further restrict the available resources for that process." tabindex="0" loading="lazy"><figcaption>I can fine-tune the settings for the new control group and further restrict the available resources for that process.</figcaption></figure><!--]--></div><!--]--></div><p><strong>This lets you isolate workloads by physical limits on what they can consume.</strong></p><p>But while cgroups enforce resource boundaries, they don&#39;t isolate what a process can see or interact with.</p><p>For that, Linux relies on another primitive: <strong>namespaces</strong>.</p><hr><h2 id="namespaces-isolating-what-a-process-can-see" tabindex="-1"><a class="header-anchor" href="#namespaces-isolating-what-a-process-can-see"><span>Namespaces: Isolating What a Process Can See</span></a></h2><p>While cgroups control how much a process can consume, <strong>namespaces</strong> control what a process can see.</p><p>They determine which part of the system a process believes it&#39;s running in.</p><p>For example, with <strong>network namespaces</strong>, a process only sees its own interfaces and traffic.</p><p>It can&#39;t see packets or sockets from outside its namespace.</p><p><strong>Namespaces isolate identity and scope</strong>.</p><p>With a <strong>mount namespace</strong>, a process sees a private filesystem view.</p><p>It might believe it sees <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc</code>, <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/var</code>, and <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/home</code>, but it&#39;s only accessing a container-specific overlay.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-7" aria-selected="true">1/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-8" aria-selected="false">2/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-9" aria-selected="false">3/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-10" aria-selected="false">4/4</button></div><!--[--><div class="vp-tab active" id="v-7" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/4</div><!--[--><figure><img src="https://learnkube.com/a/abd0a2e760de387283d844e0c9b590b7.svg" alt="Since kernel version 5.6, there are eight kinds of namespaces and the mount namespace is one of them." tabindex="0" loading="lazy"><figcaption>Since kernel version 5.6, there are eight kinds of namespaces and the mount namespace is one of them.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-8" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/4</div><!--[--><figure><img src="https://learnkube.com/a/f4ad672dd92d863c0d5b324b954c20eb.svg" alt="With the mount namespace, you can let the process believe it has access to all directories on the host, when in fact it does not." tabindex="0" loading="lazy"><figcaption>With the mount namespace, you can let the process believe it has access to all directories on the host, when in fact it does not.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-9" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/4</div><!--[--><figure><img src="https://learnkube.com/a/ae8392b36d19cf7486761af8fce97b6e.svg" alt="The mount namespace is designed to isolate resources â€” in this case, the filesystem." tabindex="0" loading="lazy"><figcaption>The mount namespace is designed to isolate resources â€” in this case, the filesystem.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-10" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">4/4</div><!--[--><figure><img src="https://learnkube.com/a/7db84bc90ac80a944676bc7db80424bf.svg" alt="Each process can see the same filesystem, while still being isolated from the others." tabindex="0" loading="lazy"><figcaption>Each process can see the same filesystem, while still being isolated from the others.</figcaption></figure><!--]--></div><!--]--></div><p><strong>As of Linux kernel 5.6, there are eight namespace types.</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">uname</span> <span class="token parameter variable">-r</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># 5.15.167.4-microsoft-standard-WSL2</span></span>
<span class="line"></span>
<span class="line">lsns</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># NS TYPE    NPROCS     PID USER</span></span>
<span class="line"><span class="token comment"># 4026531834 time       17  1035</span></span>
<span class="line"><span class="token comment"># 4026531835 cgroup     17  1035</span></span>
<span class="line"><span class="token comment"># 4026531837 user       17  1035</span></span>
<span class="line"><span class="token comment"># 4026531840 net        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532242 ipc        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532253 mnt        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532254 uts        17  1035</span></span>
<span class="line"><span class="token comment"># 4026532255 pid        17  1035</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Each isolates a distinct dimension of system identity.</p><p>That means you can run multiple processes on the same machine, each in its own isolated environment, each with resource limits, and each believing it&#39;s alone.</p><p><strong>Together with cgroups, namespaces form the backbone of container isolation</strong>.</p><p>But configuring them manually is complex and error-prone.</p><p>Managing syscalls, cgroups, and namespaces directly is powerfulâ€”but not practical for day-to-day development.</p><p><em>What if you could abstract them into a simpler interface?</em></p><p>That&#39;s exactly what Docker did.</p><p>By combining Linux namespaces and cgroups with filesystem overlays and a clean CLI, Docker made it easy to define, package, and run isolated workloads.</p><hr><h2 id="from-kernel-primitives-to-developer-abstractions" tabindex="-1"><a class="header-anchor" href="#from-kernel-primitives-to-developer-abstractions"><span>From Kernel Primitives to Developer Abstractions</span></a></h2><p><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-docker" sizing="height"></i>Docker</a> is a popular way to manage containers in a developer-friendly way.</p><p>Docker is not the only way to run containers, though.</p><p>There are other tools that abstract control groups and namespaces, such as <a href="https://podman.io/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-podman" sizing="height"></i>Podman</a> (Red Hat) and <a href="https://cri-o.io/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cri-o" sizing="height"></i>CRI-O</a> (Red Hat).</p><p>Instead of managing syscalls, cgroups, and namespaces manually, you define a container image, run a single command, and the runtime sets everything up behind the scenes.</p><p>At their core, these platforms are just orchestration layers on top of three key Linux kernel features: <strong>Syscalls</strong>, <strong>Control Groups</strong> and <strong>namespaces</strong></p><p>When combined, these primitives give you secure, lightweight, isolated environmentsâ€”<strong>containers</strong>.</p><p>At this point, we&#39;ve seen how Linux isolates containers using namespaces and resource controls.</p><p><strong>But isolation isn&#39;t just about what a process can see or consume.</strong></p><p>It&#39;s also about <strong>who the process is</strong>, and <strong>what permissions it has</strong>.</p><hr><h2 id="linux-user-ids-and-permissions" tabindex="-1"><a class="header-anchor" href="#linux-user-ids-and-permissions"><span>Linux User IDs and Permissions</span></a></h2><p>In Linux, every process runs with a <strong>User ID</strong>, or <code>UID</code>.</p><p>The UID is the kernel&#39;s primary access control mechanism.</p><p>It defines ownership and tells what the process can access or modify.</p><p>You can verify the configured boundaries on most systems by inspecting <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc/</code><i class="vp-icon fas fa-file-lines" sizing="height"></i><code>login.defs</code>.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">grep</span> UID_ /etc/login.defs</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># UID_MIN                  1000</span></span>
<span class="line"><span class="token comment"># UID_MAX                 60000</span></span>
<span class="line"><span class="token comment"># #SYS_UID_MIN              100</span></span>
<span class="line"><span class="token comment"># #SYS_UID_MAX              999</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By convention, <code>UID 0</code> means <code>root</code>, which has full control over everything.</p><p>UIDs 1-999 are usually for system services running in the background.</p><p>UIDs 1000 and above are assigned to regular users and applications.</p><p>You can confirm this division by listing user accounts and their UIDs.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">awk</span> -F: <span class="token string">&#39;$3 &lt; 1000 { print $1, $3 }&#39;</span> /etc/passwd</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># root 0</span></span>
<span class="line"><span class="token comment"># daemon 1</span></span>
<span class="line"><span class="token comment"># bin 2</span></span>
<span class="line"><span class="token comment"># man 6</span></span>
<span class="line"><span class="token comment"># ...</span></span>
<span class="line"><span class="token comment"># _apt 100</span></span>
<span class="line"><span class="token comment"># sshd 105</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And those assigned to regular users:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">awk</span> -F: <span class="token string">&#39;$3 &gt;= 1000 { print $1, $3 }&#39;</span> /etc/passwd</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># nobody 65534</span></span>
<span class="line"><span class="token comment"># docker 1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Each time a process attempts a privileged operation, the Linux kernel checks its <code>UID</code> to decide whether that action should be allowed.</strong></p><p>In containerized environments, this creates a subtle risk.</p><p>Many containers still run as <code>UID 0</code>.</p><p>If that UID maps directly to the host, a compromised container could gain <strong>real root access</strong> on the node.</p><p>To prevent this, Linux introduces <strong>user namespaces</strong>.</p><hr><h2 id="user-namespaces-and-uid-mapping-in-containers" tabindex="-1"><a class="header-anchor" href="#user-namespaces-and-uid-mapping-in-containers"><span>User Namespaces and UID Mapping in Containers</span></a></h2><p>The <a href="https://man7.org/linux/man-pages/man7/user_namespaces.7.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>user namespace</a> lets you remap UIDs inside a container to unprivileged UIDs on the host.</p><p>This means a process can run as <code>UID 0</code> (root) <em>inside</em> the container, while the kernel maps it to an unprivileged UID like 2000 <em>outside</em>.</p><p>From the container&#39;s perspective, the process is <code>root</code> and can do anything.</p><p>But from the host&#39;s perspective, it&#39;s just a regular user with no elevated privileges.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-11" aria-selected="true">1/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-12" aria-selected="false">2/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-13" aria-selected="false">3/3</button></div><!--[--><div class="vp-tab active" id="v-11" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/3</div><!--[--><figure><img src="https://learnkube.com/a/219af075732ea2ad7bf79a3a8ce838bd.svg" alt="On the host system, User 0 (root) has complete administrative privileges while regular users (1000-2000, 2000-4000) have limited permissions." tabindex="0" loading="lazy"><figcaption>On the host system, User 0 (root) has complete administrative privileges while regular users (1000-2000, 2000-4000) have limited permissions.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-12" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/3</div><!--[--><figure><img src="https://learnkube.com/a/cd62a2e690b06c0659b570c519e473da.svg" alt="Container 1 creates a user namespace where host user 1000 is mapped to root (User 0) inside the container, providing administrative privileges within the isolated environment." tabindex="0" loading="lazy"><figcaption>Container 1 creates a user namespace where host user 1000 is mapped to root (User 0) inside the container, providing administrative privileges within the isolated environment.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-13" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/3</div><!--[--><figure><img src="https://learnkube.com/a/fcaaf0aa811f986ba357f73b5ae6365c.svg" alt="Multiple containers can run simultaneously with different user mappings - Container 1 maps host user 1000 to root, while Container 2 maps host user 2000 to root, maintaining isolation." tabindex="0" loading="lazy"><figcaption>Multiple containers can run simultaneously with different user mappings - Container 1 maps host user 1000 to root, while Container 2 maps host user 2000 to root, maintaining isolation.</figcaption></figure><!--]--></div><!--]--></div><p>This <strong>UID mapping</strong> prevents container processes from gaining root access to the host, even if they appear to be root in their own environment.</p><hr><h2 id="how-docker-manages-uids" tabindex="-1"><a class="header-anchor" href="#how-docker-manages-uids"><span>How Docker Manages UIDs</span></a></h2><p><a href="https://docs.docker.com/engine/security/userns-remap/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-docker" sizing="height"></i>Docker</a> uses both namespaces and process UID settings to manage security inside containers.</p><p>By default, the process runs with the UID defined in the container imageâ€”usually <code>UID 0</code>.</p><p>Unless <a href="https://docs.docker.com/engine/security/userns-remap/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-docker" sizing="height"></i>user namespaces are explicitly enabled</a>, UID 0 inside the container is also UID 0 on the host.</p><figure><img src="https://learnkube.com/a/be18e9e2649498e83be2d8301bb850f6.svg" alt="UID 0 in the container is mapped to UID 0 on the host" tabindex="0" loading="lazy"><figcaption>UID 0 in the container is mapped to UID 0 on the host</figcaption></figure><p>That&#39;s a problem.</p><p><strong>If the container is compromised, the attacker gains root-level privileges over any accessible host resources.</strong></p><p>This is why running containers as a <strong>non-root user</strong> is a critical best practice.</p><p>Even if isolation breaks, the process still has limited permissions.</p><hr><h2 id="runasuser-and-runasnonroot" tabindex="-1"><a class="header-anchor" href="#runasuser-and-runasnonroot"><span><code>runAsUser</code> and <code>runAsNonRoot</code></span></a></h2><p>Kubernetes builds on these kernel-level security controls using <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-k8s" sizing="height"></i>SecurityContext</a>.</p><p><code>runAsUser</code> and <code>runAsNonRoot</code> options in <strong>securityContext</strong> let you explicitly control the UID that a container process runs as.</p><p><code>runAsUser</code> sets the exact UID for the process:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This means the container will start as <code>UID 1000</code> instead of root.</strong></p><p>This setting will apply to all containers in the Pod unless overridden.</p><p>But you&#39;re not required to use 1000 specifically.</p><p>You can choose any UID that exists in the image and has access to the required files.</p><p>Even if there&#39;s no matching entry in <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc/</code><i class="vp-icon fas fa-key" sizing="height"></i><code>passwd</code>, the kernel can still run the process as long as the UID is valid.</p><p>To make sure the container never runs as rootâ€”regardless of image defaultsâ€”Kubernetes offers the <code>runAsNonRoot</code> flag:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>If the container tries to start as UID 0, Kubernetes blocks itâ€”even if <code>runAsUser</code> isn&#39;t explicitly set.</strong></p><p>For stronger guarantees, you can combine both fields:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This setting ensures the process runs as a specific non-root UID, and any future changes to the image or spec won&#39;t accidentally elevate privileges.</strong></p><p>Let&#39;s inspect a widely used official image that includes a non-root user by default:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-it</span> node:20-slim <span class="token function">cat</span> /etc/passwd</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># node:x:1000:1000::/home/node:/bin/bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This shows that the <code>node</code> user is predefined with UID 1000. However, this only defines the user.</p><p>To check which user the image actually runs as by default, inspect the runtime UID:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> node:20-slim <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># uid=0(root) gid=0(root) groups=0(root)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Despite defining a node user, the container runs as root by default.</p><p>To enforce non-root execution, you must either modify the <a href="https://docs.docker.com/reference/dockerfile/#user" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-docker" sizing="height"></i>Dockerfile</a> to include:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token environment constant">USER</span> <span class="token function">node</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Or override it in Kubernetes.</p><p>To achieve this let&#39;s create a minikube cluster.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">minikube start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then apply the following <i class="vp-icon iconfont icon-yaml" sizing="height"></i><code>node-nonroot.yaml</code> file:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="node-nonroot.yaml"><span>node-nonroot.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>nonroot</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>slim</span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can verify if <code>runAsUser: 1000</code> is respected and overrides the image&#39;s root default:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> node-nonroot.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/node-nonroot created</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-nonroot -- <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># uid=1000(node) gid=1000(node) groups=1000(node)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Running a container as a non-root user is a solid start, but some applications still need access to specific system-level operations to function properly.</p><p><em>That&#39;s where Linux capabilities come in.</em></p><hr><h2 id="linux-capabilities" tabindex="-1"><a class="header-anchor" href="#linux-capabilities"><span>Linux Capabilities</span></a></h2><p><a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Capabilities</a> define which privileged operations a process is allowed to perform.</p><p>Rather than granting full root access, the Linux kernel splits root privileges into fine-grained units like <code>CHOWN</code>, <code>NET_ADMIN</code>, and <code>SYS_PTRACE</code>.</p><p><strong>Each capability grants just one class of operations.</strong></p><p>In a traditional Linux system, the root user has full access to everything.</p><p>But under the hood, many of these powers are broken out into smaller units called <strong>capabilities</strong>.</p><p>They are like a menu of root powers.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-14" aria-selected="true">1/2</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-15" aria-selected="false">2/2</button></div><!--[--><div class="vp-tab active" id="v-14" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/2</div><!--[--><figure><img src="https://learnkube.com/a/3f09a092f3be11f3a5ad1628d754586f.svg" alt="User 0 (root) has all capabilities by default, including the full range of privileged operations from  to ." tabindex="0" loading="lazy"><figcaption>User 0 (root) has all capabilities by default, including the full range of privileged operations from <code>CHOWN</code> to <code>NET_BIND_SERVICE</code>.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-15" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/2</div><!--[--><figure><img src="https://learnkube.com/a/5c399bad12e1202ad138851a8a0973de.svg" alt="User 1000 has limited capabilities like  but lacks most root privileges." tabindex="0" loading="lazy"><figcaption>User 1000 has limited capabilities like <code>NET_BIND_SERVICE</code> but lacks most root privileges.</figcaption></figure><!--]--></div><!--]--></div><p><strong>You can assign only the entries your process needs, and drop the rest.</strong></p><p>Let&#39;s say your application needs to change file ownership using the chown system call.</p><p>Normally, only root can change file ownership using the <strong>chown syscall</strong>.</p><p>But instead of running the entire container as <code>UID 0</code>, you can selectively grant just the capability required to perform that action.</p><p>One of those fine-grained capabilities is <code>CAP_CHOWN</code>, which allows a process to change file ownershipâ€”even if it&#39;s not root.</p><p>Kubernetes exposes this through the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-k8s" sizing="height"></i>securityContext.capabilities</a> field.</p><p>You can run the container as a non-root UID and add just the <code>CHOWN</code> capability.</p><p>Kubernetes doesn&#39;t let you change security settings like <code>securityContext.capabilities</code> of a Pod after it&#39;s created.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="node-cap-chown.yaml"><span>node-cap-chown.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>cap<span class="token punctuation">-</span>chown</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>20<span class="token punctuation">-</span>slim</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">0</span></span>
<span class="line">      <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>We explicitly drop all capabilities first to ensure a clean baseline, then add back only <code>CHOWN</code>.</strong></p><p>Let&#39;s delete the existing Pod and recreate it with the updated spec:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl delete pod node-nonroot <span class="token parameter variable">--force</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod &quot;node-nonroot&quot; force deleted</span></span>
<span class="line"></span>
<span class="line">kubectl apply <span class="token parameter variable">-f</span> node-cap-chown.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/node-cap-chown created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>The container still runs as a non-root user, but now it can perform a privileged operation.</strong></p><p>Let&#39;s confirm the container is not root, but it can perform <code>chown</code>.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">id</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># id=0(root) gid=0(root) groups=0(root)</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;touch /tmp/test &amp;&amp; ls -l /tmp/test&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#-rw-r--r-- 1 root root 0 Jul  5 08:53 /tmp/test</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;chown 1234:1234 /tmp/test &amp;&amp; ls -l /tmp/test&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># -rw-r--r-- 1 1234 1234 0 Jul  5 08:53 /tmp/test</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The container is running as UID 0 with only <code>CHOWN</code> allowed.</p><p>The next step is to verify that the container has only the <code>CHOWN</code> capabilityâ€”and nothing more.</p><p>Let&#39;s run a few root-only operations from inside the container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs tmpfs /mnt</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># mount: /mnt: permission denied.</span></span>
<span class="line"></span>
<span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;2024-01-01&quot;</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># date: cannot set date: Operation not permitted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Both <code>mount</code> and <code>date -s</code> fail.</p><p>These syscalls <code>mount()</code> and <code>settimeofday()</code> needs capabilities like <code>CAP_SYS_ADMIN</code> or <code>CAP_SYS_TIME</code>, which we haven&#39;t granted.</p><p>Now let&#39;s confirm the capabilities at the kernel level:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl <span class="token builtin class-name">exec</span> node-cap-chown -- <span class="token function">cat</span> /proc/1/status <span class="token operator">|</span> <span class="token function">grep</span> CapEff</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># CapEff: 0000000000000001</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Decode it to human-readable form:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">printf</span> <span class="token string">&quot;%x<span class="token entity" title="\n">\n</span>&quot;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> capsh <span class="token parameter variable">--decode</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 0x0000000000000001=cap_chown</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The container runs as a non-root user with only the <code>CHOWN</code> capability.</p><p><em>So, how does Kubernetes enforce this?</em></p><p>It doesn&#39;t.</p><p>Well, not directly.</p><p>You declare your intent in the <code>securityContext</code>, but enforcement happens deeper in the stack.</p><p><strong>The kubelet passes the configuration to the container runtime and the runtime applies the requested capabilities when launching the container.</strong></p><p>This is done via the Linux <code>capset()</code> system call.</p><p>From that point on, the Linux kernel handles enforcement.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-16" aria-selected="true">1/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-17" aria-selected="false">2/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-18" aria-selected="false">3/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-19" aria-selected="false">4/4</button></div><!--[--><div class="vp-tab active" id="v-16" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/4</div><!--[--><figure><img src="https://learnkube.com/a/23631e66d828e3cc9d6313c4441e1011.svg" alt="The kubelet polls the control plane for pods. If it finds one, it downloads the spec." tabindex="0" loading="lazy"><figcaption>The kubelet polls the control plane for pods. If it finds one, it downloads the spec.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-17" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/4</div><!--[--><figure><img src="https://learnkube.com/a/5e44d03eaaf7b6a8a92dff5c1600c948.svg" alt="The Kubelet delegates container operations to runtime interfaces (CRI, CNI, CSI)." tabindex="0" loading="lazy"><figcaption>The Kubelet delegates container operations to runtime interfaces (CRI, CNI, CSI).</figcaption></figure><!--]--></div><div class="vp-tab" id="v-18" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/4</div><!--[--><figure><img src="https://learnkube.com/a/80c037eca089724e2e941baa2a5ad59e.svg" alt="The container runtime sets capabilities on the kernel for enforcement." tabindex="0" loading="lazy"><figcaption>The container runtime sets capabilities on the kernel for enforcement.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-19" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">4/4</div><!--[--><ul><li><img src="https://learnkube.com/a/4d6005ebf2ca4ae55b2e6288c2445f10.svg" alt="Linux kernel enforces capabilities for all containers through system calls.Linux kernel enforces capabilities for all containers through system calls." tabindex="0" loading="lazy"><figcaption>Linux kernel enforces capabilities for all containers through system calls.Linux kernel enforces capabilities for all containers through system calls.</figcaption></li></ul><p>Linux kernel enforces capabilities for all containers through system calls.</p><!--]--></div><!--]--></div><p><strong>But figuring out which capabilities your application actually needs isn&#39;t always straightforward.</strong></p><p>Some tools document this clearly, but many don&#39;tâ€”especially older or less-maintained ones.</p><p>A good starting point is to remove everything using <code>drop: [&quot;ALL&quot;]</code>, then add capabilities back one by one until the container works.</p><p>This trial-and-error approach is common and works well for simple setups.</p><p>If you need more precision, you can trace system calls using tools like <a href="https://kernel.org/doc/Documentation/prctl/seccomp_filter.txt" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>seccomp</a> or audit logs.</p><p>This lets you see exactly which capabilities the process tries to use at runtime.</p><p><strong>By running as a non-root user and enabling only the few capabilities your app truly needs, you reduce exposure without breaking functionality.</strong></p><p><em>But there&#39;s a remaining risk: what if the process tries to gain more privileges after it starts, even if it begins as a non-root user?</em></p><hr><h2 id="allowprivilegeescalation" tabindex="-1"><a class="header-anchor" href="#allowprivilegeescalation"><span><code>allowPrivilegeEscalation</code></span></a></h2><p>Some binaries are designed to do exactly that.</p><p>This is often done using mechanisms like <strong>setuid binaries</strong>, which are programs that automatically run with elevated privileges when executed.</p><p><strong>That means a container can start as a non-root user but still end up with root-level privileges mid-execution.</strong></p><p>Kubernetes addresses this with the <code>allowPrivilegeEscalation</code> setting.</p><p>Setting <code>allowPrivilegeEscalation: false</code> tells the container runtime not to allow the process to gain more privileges than it started with.</p><p>To do that, the container runtime sets the <a href="https://docs.kernel.org/userspace-api/no_new_privs.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>no_new_privs</a> flag on the process at launch.</p><p>This flag is a <strong>kernel-enforced bit</strong> that locks privilege boundaries for the entire process tree.</p><p>You can verify that it&#39;s active by inspecting the container&#39;s main process.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">cat</span> /proc/1/status <span class="token operator">|</span> <span class="token function">grep</span> NoNewPrivs</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NoNewPrivs:	1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A value of <code>1</code> confirms that the process is explicitly prohibited from gaining any additional privilegesâ€”even if it executes a <strong>setuid binary</strong>.</p><p><strong>This is a Linux kernel feature that tells the kernel to deny any privilege escalation, even if the binary tries.</strong></p><p>It&#39;s simple, fast, and effective, especially in containers based on general-purpose Linux images, which often include tools like <code>sudo</code> or <code>su</code>.</p><p>Let&#39;s demonstrate what <code>allowPrivilegeEscalation: true</code> setting does with a practical example.</p><p>We&#39;ll create a container that runs as the <code>nobody</code> user and configure <code>sudo</code> to allow privilege escalation.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="privilege-escalation.yaml"><span>privilege-escalation.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> privilege<span class="token punctuation">-</span>escalation</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never</span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sudo<span class="token punctuation">-</span>container</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">      apt-get update &amp;&amp; apt-get install -y sudo</span>
<span class="line">      echo &quot;nobody ALL=(ALL) NOPASSWD: ALL&quot; &gt; /etc/sudoers.d/nobody</span>
<span class="line">      # Execute commands as the nobody user</span>
<span class="line">      su - nobody -s /bin/bash -c &#39;</span>
<span class="line">        echo &quot;Current user: $(whoami)&quot;</span>
<span class="line">        echo &quot;Current UID: $(id -u)&quot;</span>
<span class="line">        echo &quot;Attempting sudo whoami...&quot;</span>
<span class="line">        sudo whoami</span>
<span class="line">        echo &quot;sudo exit status: $?&quot;</span>
<span class="line">      &#39;</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># Explicitly allowing escalation</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When you run this pod, you&#39;ll see:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> privilege-escalation.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/privilege-escalation created</span></span>
<span class="line"></span>
<span class="line">kubectl get pod</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME                      READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span class="token comment"># privilege-escalation      1/1     Running   0          5s</span></span>
<span class="line"></span>
<span class="line">kubectl logs privilege-escalation</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: nobody</span></span>
<span class="line"><span class="token comment"># Current UID: 65534</span></span>
<span class="line"><span class="token comment"># Attempting sudo whoami...</span></span>
<span class="line"><span class="token comment"># root</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>nobody</code> user successfully escalated to root using sudo.</p><p>Now let&#39;s see what happens when we set <code>allowPriviliegeEscalation: false</code></p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Let&#39;s get the logs of the <code>privilege-escalation-false</code> pod:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl get pod</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME                      READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span class="token comment"># privilege-escalation-false   1/1     Running     0          3s</span></span>
<span class="line"></span>
<span class="line">kubectl logs privilege-escalation-false</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: nobody</span></span>
<span class="line"><span class="token comment"># Current UID: 65534</span></span>
<span class="line"><span class="token comment"># Attempting sudo whoami...</span></span>
<span class="line"><span class="token comment"># sudo: The &quot;no new privileges&quot; flag is set, which prevents sudo from running as root.</span></span>
<span class="line"><span class="token comment"># sudo: If sudo is running in a container, you may need to adjust the container configuration to disable the flag.</span></span>
<span class="line"><span class="token comment"># sudo exit status: 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>The kernel blocks the privilege escalation attempt.</strong></p><p>Even though <code>sudo</code> is installed and configured, the <code>no_new_privs</code> flag prevents the process from gaining root privileges.</p><p>This setting works hand-in-hand with <code>runAsNonRoot</code> and <strong>Linux capabilities</strong>.</p><p><strong>Even if a container includes a binary that would normally let it elevate to root, this flag ensures it won&#39;t be allowed to do so.</strong></p><p>It&#39;s especially useful for securing containers that use third-party tools or packages, where you might not know exactly what&#39;s inside.</p><p>For example, an image based on a general-purpose Linux distribution might contain <code>sudo</code> or <code>su</code> commands that could otherwise be misused.</p><p>In most production environments, it&#39;s safeâ€”and recommendedâ€”to set <code>allowPrivilegeEscalation</code> to false for every container unless you have a clear, documented reason not to.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">  <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This container runs as a non-root user, cannot elevate privileges, and only has one additional capability.</strong></p><p><em>Just enough to perform a required task.</em></p><p>With privilege escalation locked down, the next layer of defense is the container&#39;s filesystem.</p><p>Even if an attacker gains access, they shouldn&#39;t be able to modify the container&#39;s binaries, drop malware, or tamper with startup logic.</p><p>But first, it&#39;s important to understand the worst-case scenario: containers that bypass all isolation.</p><hr><h2 id="privileged-containers" tabindex="-1"><a class="header-anchor" href="#privileged-containers"><span>Privileged Containers</span></a></h2><p><strong>Privileged containers</strong> override or nullify many kernel-level security mechanisms like seccomp, AppArmor, SELinux.</p><p>Setting <code>privileged: true</code> field in the <code>securityContext</code> field for the container, removes nearly all security boundaries between the container and the host.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Never do this unless absolutely necessary</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>A privileged container has access to all host devices, can see all processes on the host, and bypasses most security restrictions.</strong></p><p>It&#39;s equivalent to running with all Linux capabilities and more.</p><p>Under the hood, privileged mode disables multiple layers of isolation:</p><ol><li><strong>It grants access to the host PID namespace,</strong> so the container can see and interact with all system processes.</li><li><strong>It shares the host&#39;s network and device namespaces,</strong> bypassing network isolation and exposing physical interfaces and hardware devices.</li><li><strong>It allows mount operations,</strong> including remounting sensitive filesystems like <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/proc</code>, <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/sys</code>, or even the host root.</li></ol><p>For cgroups, the process still runs within resource limits, but privileged containers can often manipulate cgroup settings themselves, potentially escaping restrictions or affecting other containers.</p><p><strong>The result is that privileged containers behave more like virtual machines than isolated processes.</strong></p><p>This is why they represent such a significant security risk.</p><p>In practice, privileged containers should be extremely rare and tightly controlled.</p><p><strong>The only legitimate use cases are typically system-level tools</strong> like: Container runtime components (like containerd), Network plugins that need to configure host networking, Storage drivers that manage host volumes.</p><p>If you believe your workload needs <code>privileged: true</code>, first validate whether granting a specific capability solves the problem.</p><p>If that doesn&#39;t work, document exactly why privileged access is required and implement compensating controls like network policies and admission controllers.</p><hr><h2 id="readonlyrootfilesystem" tabindex="-1"><a class="header-anchor" href="#readonlyrootfilesystem"><span>readOnlyRootFilesystem</span></a></h2><p><strong>Most containers don&#39;t need to write to their own filesystem after startup.</strong></p><p>In fact, allowing them to do so introduces unnecessary risk.</p><p>If an attacker compromises the container, a <strong>writable root filesystem</strong> makes it easier to drop malicious binaries, overwrite scripts, or tamper with logs and config files.</p><p>Kubernetes allows you to lock this down using the <code>readOnlyRootFilesystem</code> option.</p><p>Under the hood, this setting passes a <strong>read-only flag</strong> to the container runtime when the root filesystem mount is created.</p><p>The container runtime then ensures that the root of the container is mounted with <code>readOnly: true</code>.</p><p>Any write attempts to paths like <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/bin</code>, <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc</code>, or <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/var</code> will fail unless a writable volume is mounted to override that location.</p><p>It&#39;s enforced entirely by the <strong>Linux kernel</strong>, so even if an attacker gains access, they can&#39;t persist changes to the image.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When <code>readOnlyRootFilesystem</code> is enabled, the container runtime mounts the container&#39;s root filesystem in <strong>read-only mode</strong>.</p><p>This is done at container startup, before any processes are launched, using the container&#39;s dedicated <strong>mount namespace</strong>.</p><p>That namespace provides an isolated view of the filesystem, and within it, the runtime uses the standard Linux <code>mount()</code> syscall with the <code>MS_RDONLY</code> flag.</p><p>This flag tells the kernel to treat the mount as read-only, just as if you had run <code>mount -o ro</code> on a physical system.</p><p>The <strong>Virtual File System (VFS)</strong> is the kernel subsystem that handles all file operations.</p><p>Internally, the kernel marks this mount with the <code>MNT_RDONLY</code> flag, which becomes visible and enforceable at the VFS layer.</p><p>When a process inside the container attempts a write operation, such as <code>write()</code>, <code>mkdir()</code>, or <code>unlink()</code>, the syscall passes through the VFS.</p><p>At this point, the VFS checks the mount flags.</p><p>If it sees <code>MNT_RDONLY</code> set, the kernel immediately rejects the request.</p><p>Even if an attacker has shell access or tries to execute payloads from within the container, they won&#39;t be able to write to any path unless a writable volume has been mounted over it.</p><p>They can&#39;t drop binaries, modify config files, or make any lasting changes to the image.</p><p>The <strong>root filesystem remains immutable</strong> for the lifetime of the container.</p><p>Not all applications are compatible with a fully read-only root.</p><p>Some need to write logs to <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/tmp</code>, store runtime state in <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/var/run</code>, or generate temporary files in <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/home</code>.</p><p>In those cases, you can mount <strong>writable volumes</strong> at those paths to provide the necessary write access.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp</span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This configuration creates an isolated in-memory volume and gives the container a safe place to write while keeping the rest of the filesystem immutable.</strong></p><p>We&#39;ve now locked down who the container runs as, what it&#39;s allowed to do, and where it can write.</p><p><em>But that&#39;s only part of the picture.</em></p><p>Containers frequently interact with mounted volumes and those volumes bring their own permission and access challenges.</p><p><strong>Capabilities limit what a process can do, but they don&#39;t restrict which system calls a process can actually make.</strong></p><p>That&#39;s where Seccomp comes in.</p><hr><h2 id="seccomp-profiles" tabindex="-1"><a class="header-anchor" href="#seccomp-profiles"><span>Seccomp Profiles</span></a></h2><p><strong><a href="https://kernel.org/doc/Documentation/prctl/seccomp_filter.txt" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Seccomp</a> (short for secure computing mode) provides syscall-level control by attaching a BPF (Berkeley Packet Filter) program directly to a process.</strong></p><p>Each time the process invokes a system call, the kernel intercepts it and hands the syscall number and arguments to the <strong>BPF filter</strong>.</p><p>This happens in <strong>kernel mode</strong>, just before the syscall is executed.</p><p>The filter can then allow the call, block it with an <code>EPERM</code>, terminate the process with a <code>SIGSYS</code>, or log the attempt for auditing.</p><p>Unlike capabilities, which act at a higher abstraction level, Seccomp operates on the <strong>syscall interface</strong>.</p><p>It lets you specify which syscalls a process is allowed to use and deny everything else by default.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-20" aria-selected="true">1/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-21" aria-selected="false">2/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-22" aria-selected="false">3/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-23" aria-selected="false">4/4</button></div><!--[--><div class="vp-tab active" id="v-20" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/4</div><!--[--><figure><img src="https://learnkube.com/a/4dbf8701996e839152727222e64f17b7.svg" alt="JVM applications make system calls through the kernel to access system resources like the network." tabindex="0" loading="lazy"><figcaption>JVM applications make system calls through the kernel to access system resources like the network.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-21" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/4</div><!--[--><figure><img src="https://learnkube.com/a/f641beea53964c60434e21fc62725218.svg" alt="The kernel uses capabilities to control privileged operations, checking permissions for specific syscalls like  and ." tabindex="0" loading="lazy"><figcaption>The kernel uses capabilities to control privileged operations, checking permissions for specific syscalls like <code>CHOWN</code> and <code>CAP_NET_ADMIN</code>.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-22" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/4</div><!--[--><figure><img src="https://learnkube.com/a/3929520349640bb4efa9f168d7dbc2fe.svg" alt="Seccomp adds another security layer that can block specific syscalls like ioctl while allowing others through BPF filtering." tabindex="0" loading="lazy"><figcaption>Seccomp adds another security layer that can block specific syscalls like ioctl while allowing others through BPF filtering.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-23" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">4/4</div><!--[--><figure><img src="https://learnkube.com/a/86dd608ffe45dc2ef9ff56eaf74492a6.svg" alt="Multiple syscalls can be filtered simultaneously, with seccomp allowing setsockopt while blocking ioctl, providing fine-grained syscall control." tabindex="0" loading="lazy"><figcaption>Multiple syscalls can be filtered simultaneously, with seccomp allowing setsockopt while blocking ioctl, providing fine-grained syscall control.</figcaption></figure><!--]--></div><!--]--></div><p><strong>In container runtimes, the default Seccomp profile explicitly allows just over 300 common syscalls required for typical container workloads.</strong></p><p>Everything else is blocked using <code>SCMP_ACT_ERRNO</code>, which causes the syscall to fail with a permission error.</p><p>Blocked syscalls include:</p><ul><li><code>mount</code> / <code>umount</code> â€“ filesystem mounting</li><li><code>ptrace</code> â€“ process tracing and debugging</li><li><code>reboot</code> â€“ system reboot</li><li><code>setns</code> â€“ namespace manipulation</li><li><code>keyctl</code> â€“ kernel keyring access</li></ul><p>By default, Kubernetes applies no seccomp profile.</p><p>The <code>RuntimeDefault</code> seccomp profile allows only a minimal set of system calls required for basic container execution.</p><p>To apply the <code>RuntimeDefault</code> seccomp profile, the kubelet must be started with the <code>--seccomp-default</code> flag.</p><p>This enables <code>RuntimeDefault</code> as the default profile for all pods that do not explicitly specify one.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>When the kubelet starts a container with this setting, it passes the seccomp configuration to the container runtime via CRI.</strong></p><p>The runtime loads its built-in <strong>BPF filter program</strong> and attaches this filter to the container process using the <code>seccomp()</code> syscall.</p><p>From that point on, every syscall from the container is evaluated by the BPF program.</p><p>If you need more granular control, you can define a <strong>custom seccomp profile</strong>.</p><p>To achieve this, you need to create a JSON file on the node and reference it in the pod spec.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="app-specific.json"><span>app-specific.json</span></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;defaultAction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;architectures&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;SCMP_ARCH_X86_64&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;syscalls&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fstat&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ALLOW&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;connect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;accept&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token property">&quot;op&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SCMP_CMP_EQ&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>This seccomp profile blocks all system calls by default using <code>SCMP_ACT_ERRNO</code> and explicitly allows basic file operations.</strong></p><p>It also permits socket-related calls only when the first argument (<code>domain</code>) is <code>2</code> (<code>AF_INET</code>, i.e., IPv4).</p><p>To reference it in your pod.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> Localhost</span>
<span class="line">    <span class="token key atrule">localhostProfile</span><span class="token punctuation">:</span> profiles/app<span class="token punctuation">-</span>specific.json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The most restrictive pod security configuration blocks all Linux capabilities and restricts syscalls to a minimal safe set:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line">  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If your application fails, the process usually receives an <code>EPERM</code> (Operation not permitted) error.</p><p>You can use <code>strace</code> to trace syscall activity inside the container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl debug <span class="token parameter variable">-it</span> your-pod <span class="token parameter variable">--image</span><span class="token operator">=</span>nicolaka/netshoot -- <span class="token function">strace</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">trace</span><span class="token operator">=</span>all your-command</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If audit logging is enabled, you can query the system audit logs for seccomp violations:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ausearch <span class="token parameter variable">-m</span> SECCOMP</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Start with the <code>RuntimeDefault</code> profile and only create custom profiles if you have specific security requirements or compliance needs.</p><p><strong>After confirming your application runs safely under baseline constraints, incrementally tighten syscall restrictions with a custom seccomp profile.</strong></p><p>Many applications work fine with the default restrictions, but some (especially those doing system-level operations) may need careful tuning.</p><hr><h2 id="apparmor" tabindex="-1"><a class="header-anchor" href="#apparmor"><span>AppArmor</span></a></h2><p><a href="https://apparmor.net/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>AppArmor</a> provides another layer of access control by restricting programs to a limited set of resources through path-based access control profiles.</p><p><strong>Unlike seccomp which filters system calls, AppArmor focuses on file system access, network access, and capability usage.</strong></p><p>For example, a container might use seccomp to block <code>mount()</code> syscalls completely, while AppArmor ensures that even if file operations are allowed, they can only access specific directories.</p><p>Kubernetes supports AppArmor through annotations, but it requires profiles to be loaded on each node beforehand.</p><p><strong>Most production environments rely on the combination of capabilities, seccomp, and Security Context settings rather than adding AppArmor complexity.</strong></p><p><em>You might wonder why we need both.</em></p><p>They operate at <strong>different levels</strong>.</p><p>AppArmor profiles can be applied at either the pod level or the container level.</p><p>When both are specified, the <strong>container-level profile</strong> takes precedence over the pod-level one.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">appArmorProfile</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This setting tells the container runtime to apply its default AppArmor profile to the container.</p><p><strong>That profile defines what files, paths, and kernel resources the process can access, using a declarative rule set enforced by the kernel.</strong></p><p>While AppArmor controls where and what a process can touch, <strong>Linux capabilities</strong> define whether the process is allowed to perform certain privileged operations.</p><p>AppArmor builds on capabilities by further restricting how those operations interact with the filesystem and system objects.</p><p>It doesn&#39;t grant privilegeâ€”it scopes it to safe, expected paths.</p><p>For example, AppArmor may be used to allow a program to have read access to <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc/</code><i class="vp-icon fas fa-key" sizing="height"></i><code>passwd</code>, but not <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/etc/</code><i class="vp-icon fas fa-key" sizing="height"></i><code>shadow</code>.</p><p><strong>Seccomp</strong> adds a third layer by filtering which system calls the process can execute, and under what conditions.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-24" aria-selected="true">1/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-25" aria-selected="false">2/3</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-26" aria-selected="false">3/3</button></div><!--[--><div class="vp-tab active" id="v-24" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/3</div><!--[--><figure><img src="https://learnkube.com/a/7d396d8ed2ba612d19a2fb85d209b4c9.svg" alt="JVM applications with  can configure network interfaces, routing tables, and iptables rules through system calls to the kernel." tabindex="0" loading="lazy"><figcaption>JVM applications with <code>CAP_NET_ADMIN</code> can configure network interfaces, routing tables, and iptables rules through system calls to the kernel.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-25" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/3</div><!--[--><figure><img src="https://learnkube.com/a/6cb224662f002fd8d1c532185510e869.svg" alt="AppArmor adds a second security layer that restricts syscalls to only work on virtual devices, for example." tabindex="0" loading="lazy"><figcaption>AppArmor adds a second security layer that restricts syscalls to only work on virtual devices, for example.</figcaption></figure><p></p><!--]--></div><div class="vp-tab" id="v-26" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/3</div><!--[--><figure><img src="https://learnkube.com/a/6b164bccfb75ee7af564de3d57117fed.svg" alt="Seccomp provides the final layer by filtering specific syscalls like  and ." tabindex="0" loading="lazy"><figcaption>Seccomp provides the final layer by filtering specific syscalls like <code>ioctl</code> and <code>setsockopt</code>.</figcaption></figure><p></p><!--]--></div><!--]--></div><p>So while capabilities check what kind of privilege a process has, and AppArmor checks where it can apply it, seccomp governs the <strong>syscall-level behavior</strong>.</p><hr><h2 id="fsgroup-and-supplementalgroups" tabindex="-1"><a class="header-anchor" href="#fsgroup-and-supplementalgroups"><span><code>fsGroup</code> and <code>supplementalGroups</code></span></a></h2><p>Even with the container process running as a <strong>non-root user</strong>, file access can still become a problem, especially when working with <strong>mounted volumes</strong>.</p><p>Many Kubernetes volumes, such as those backed by NFS, Ceph, or even emptyDir, are shared between containers or pods.</p><p>These volumes often come with default ownership settings that don&#39;t match the user your container is running as.</p><p>The result? <strong>Permission denied errors</strong> occur when your application tries to read or write files.</p><p>To fix this, Kubernetes provides <code>fsGroup</code>.</p><p>When <code>fsGroup</code> is set, the kubelet takes care of applying it during <strong>volume mount</strong>.</p><p>It recursively changes the group ownership (GID) of the mounted volume&#39;s files to match the provided fsGroup, using <code>chgrp</code> under the hood.</p><p>It also ensures that any new files created by the container will inherit that <strong>group ID</strong>, making them accessible to the process even if it runs as a non-root user.</p><p>This only affects <strong>mounted volumes</strong> - not the image&#39;s internal filesystem - and doesn&#39;t require changes inside the container image itself.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>It also ensures that any files created within those volumes are owned by that group, allowing non-root processes to access them as long as they&#39;re part of the same group.</p><p>Let&#39;s say your container runs as UID 1000, and you set <code>fsGroup: 2000</code>, here&#39;s what happens next.</p><p>When a Pod with <code>fsGroup</code> is scheduled to a node, the <strong>kubelet&#39;s volume manager</strong> prepares the volume mount points.</p><p>Before the container runtime starts the container, the kubelet executes <strong>volume setup operations</strong> on the host.</p><p>The kubelet mounts the volume from its source (e.g., NFS, hostPath, etc.) to a staging path on the host.</p><p>The kubelet then applies the ownership and permission changes based on fsGroup using <strong>host-level system calls</strong>.</p><p>It uses the equivalent of <code>chown -R :2000</code> on the mounted volume.</p><p>If <code>fsGroupChangePolicy</code> is set to <code>OnRootMismatch</code>, it only changes ownership if the root directory&#39;s group doesn&#39;t match the <code>fsGroup</code>.</p><p>Only after the ownership changes are complete does the kubelet instruct the container runtime to start the container with the volume mounted.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-27" aria-selected="true">1/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-28" aria-selected="false">2/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-29" aria-selected="false">3/4</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-30" aria-selected="false">4/4</button></div><!--[--><div class="vp-tab active" id="v-27" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">1/4</div><!--[--><figure><img src="https://learnkube.com/a/ccb425a87cfe714b1030c6f138553ff6.svg" alt="Kubelet receives a pod with fsGroup 2000 and instructs the container runtime to start the container with the volume mounted." tabindex="0" loading="lazy"><figcaption>Kubelet receives a pod with fsGroup 2000 and instructs the container runtime to start the container with the volume mounted.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-28" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">2/4</div><!--[--><figure><img src="https://learnkube.com/a/2148666d18da9b98e4382050d93509d1.svg" alt="The kubelet mounts the volume to a staging path and applies the fsGroup ownership using ." tabindex="0" loading="lazy"><figcaption>The kubelet mounts the volume to a staging path and applies the fsGroup ownership using <code>chown -R :2000</code>.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-29" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">3/4</div><!--[--><figure><img src="https://learnkube.com/a/c62aa9e0e0cc79d11e68aa09e8e672d9.svg" alt="The container starts as UID 1000 while the volume ownership changes are applied by the kubelet on the host." tabindex="0" loading="lazy"><figcaption>The container starts as UID 1000 while the volume ownership changes are applied by the kubelet on the host.</figcaption></figure><!--]--></div><div class="vp-tab" id="v-30" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">4/4</div><!--[--><figure><img src="https://learnkube.com/a/9d75d1dbde3ec0c09a05eef08a5156ef.svg" alt="The container can now read and write to the volume since it&#39;s part of group 2000, which owns the mounted files." tabindex="0" loading="lazy"><figcaption>The container can now read and write to the volume since it&#39;s part of group 2000, which owns the mounted files.</figcaption></figure><!--]--></div><!--]--></div><p><strong>This is especially useful for logging directories that need to be shared across containers, database volumes that expect specific permissions, web servers that serve files from a mounted volume.</strong></p><p>If your application needs access to multiple groups, Kubernetes also supports <code>supplementalGroups</code>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This adds additional <strong>GIDs</strong> to the process&#39;s group list.</p><p>It&#39;s worth noting that both <code>fsGroup</code> and <code>supplementalGroups</code> affect <strong>volumes only</strong>.</p><p>They do not change permissions inside the container image itselfâ€”only the volumes mounted at runtime.</p><p>With this, you can safely manage shared file access without resorting to running as root or globally relaxing file permissions.</p><hr><h2 id="how-fsgroup-works-with-csi-volumes" tabindex="-1"><a class="header-anchor" href="#how-fsgroup-works-with-csi-volumes"><span>How fsGroup Works with CSI Volumes</span></a></h2><p>The <strong>Container Storage Interface (CSI)</strong> transforms how Kubernetes handles volume permissions compared to traditional in-tree volumes.</p><p>This affects how <code>fsGroup</code> settings get applied to mounted storage.</p><p>When a pod with a CSI volume specifies an <code>fsGroup</code>, the kubelet communicates with the <strong>CSI driver</strong> through a Unix socket.</p><p><strong>Unlike with in-tree volumes where the kubelet handles everything, CSI drivers take over significant responsibilities.</strong></p><p>The driver mounts storage to a <strong>staging path</strong> first, then to the final target path where containers access it.</p><p>Whether the <code>fsGroup</code> gets applied depends on the driver&#39;s <strong>declared capabilities</strong>.</p><p>Since Kubernetes v1.19, CSI drivers explicitly report their <code>fsGroup</code> support through the <code>CSI_VOLUME_FSGROUP_POLICY</code> capability.</p><p>CSI drivers implement one of <strong>three distinct policies</strong>:</p><ol><li>With the <code>None</code> policy, the driver doesn&#39;t support permission modifications at all. The kubelet won&#39;t attempt any ownership changes, leaving permissions as-is on the volume.</li><li>Under the <code>File</code> policy, the kubelet behaves similarly to in-tree volumes, recursively changing ownership and permissions on all files and directories to match the specified fsGroup.</li><li>The <code>ReadWriteOnceWithFSType</code> policy represents a middle ground. The kubelet only applies fsGroup changes when the volume has a specified filesystem type and uses the <strong>ReadWriteOnce access mode</strong>.</li></ol><p>This flexible approach solves several real-world problems:</p><ul><li><strong>Recursive permission changes</strong> on large volumes can severely impact performance and delay pod startup.</li><li>Many <strong>distributed storage systems</strong> implement permissions differently than Linux&#39;s user/group model.</li><li><strong>Enterprise storage platforms</strong> often have specialized security requirements that would conflict with blanket permission changes.</li></ul><figure><img src="https://learnkube.com/a/97fccaca51ca06540a85ca3180dd6684.png" alt="Flowchart outlining secure container configuration in Kubernetes, including user settings, capabilities, filesystem access, and seccomp profile" tabindex="0" loading="lazy"><figcaption>Flowchart outlining secure container configuration in Kubernetes, including user settings, capabilities, filesystem access, and seccomp profile</figcaption></figure><hr><h2 id="live-debugging-diagnosing-securitycontext-failures" tabindex="-1"><a class="header-anchor" href="#live-debugging-diagnosing-securitycontext-failures"><span>Live Debugging: Diagnosing SecurityContext Failures</span></a></h2><p>Security settings make more sense when they&#39;re tied to actual use cases.</p><p>Let&#39;s look at a few possible scenarios where <strong>Kubernetes Security Contexts</strong> helped solve concrete problems without compromising functionality.</p><p>The first example is a <strong>Legacy Monitoring Tool</strong>.</p><p>A team could be migrating an older monitoring agent into Kubernetes.</p><p>The agent needs <strong>low-level access</strong> to inspect processes and collect network metrics.</p><p>Initially, the container ran as root to make this work, but this created security concerns during audits.</p><p>Instead of keeping full root access, the team should drop all capabilities and add only what is needed.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">    <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;SYS_PTRACE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NET_ADMIN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The container worked exactly as before, but with a <strong>dramatically reduced risk profile</strong>.</p><p><strong>Second example is a backup process that needs <code>chown</code>.</strong></p><p>A database backup job is failing in Kubernetes because file ownership needs to be changed on a <strong>mounted volume</strong>.</p><p>Running the container as root fixed it, but isn&#39;t acceptable from a <strong>compliance perspective</strong>.</p><p>Instead, you can keep the container running as a non-root user and add the <code>CHOWN</code> capability.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CHOWN&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Combined with <code>fsGroup</code>, the container could manage file ownership correctly without <strong>elevated privileges</strong>.</p><p>Third use case is <strong>Read-Only containers</strong> for public-facing apps.</p><p>A frontend application serving static files is containerized and exposed to the internet.</p><p>As a precaution, the container running the application is configured to run with a <strong>read-only root filesystem</strong>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pod.yaml"><span>pod.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>An <code>emptyDir</code> volume is used and mounted to <code>/tmp</code> to handle temporary files.</p><p>This setting protects the container from <strong>unauthorized file modifications</strong> in case of compromise, while keeping the application fully functional.</p><p>A key implementation detail here is <strong>volume setup and ownership adjustments</strong> are handled by the kubelet on the host, not inside the container.</p><p><strong>The kubelet runs as root and has the necessary privileges to create volumes, mount them into the container&#39;s namespace, and adjust file ownership to match the container&#39;s <code>runAsUser</code> and <code>runAsGroup</code>.</strong></p><p>The container itself doesn&#39;t need any elevated privileges to access these volumes.</p><p>The ownership changes are <strong>ephemeral</strong>â€”they persist only for the lifetime of the Pod&#39;s volumes and are scoped to the container&#39;s view of the filesystem.</p><p>Now, let&#39;s walk through a real troubleshooting scenario where a <strong>container security context</strong> silently breaks your workload.</p><hr><h2 id="troubleshooting-when-security-context-conflicts-with-container-behavior" tabindex="-1"><a class="header-anchor" href="#troubleshooting-when-security-context-conflicts-with-container-behavior"><span>Troubleshooting: When Security Context Conflicts with Container Behavior</span></a></h2><p>You deploy a Node.js application that needs to write logs, but the pod keeps crashing with <strong>permission errors</strong>.</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-app.yaml"><span>nodejs-app.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>app</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span>e</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">        const fs = require(&#39;fs&#39;);</span>
<span class="line">        const path = &#39;/var/log/app.log&#39;;</span>
<span class="line">        fs.writeFileSync(path, &#39;Starting app&#39;);</span>
<span class="line">        console.log(&#39;App started&#39;);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Deploy this pod and check the status:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> nodejs-app.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/nodejs-app created</span></span>
<span class="line"></span>
<span class="line">kubectl get pod nodejs-app</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># NAME         READY   STATUS      RESTARTS      AGE</span></span>
<span class="line"><span class="token comment"># nodejs-app   0/1     Completed   2 (21s ago)   91s</span></span>
<span class="line"></span>
<span class="line">kubectl logs nodejs-app</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Error: EACCES: permission denied, open &#39;/var/log/app.log&#39;</span></span>
<span class="line"><span class="token comment">#     at Object.openSync (node:fs:596:3)</span></span>
<span class="line"><span class="token comment">#     at Object.writeFileSync (node:fs:2322:35)</span></span>
<span class="line"><span class="token comment">#     at [eval]:1:30</span></span>
<span class="line"><span class="token comment">#     at runScriptInThisContext (node:internal/vm:143:10)</span></span>
<span class="line"><span class="token comment">#     at node:internal/process/execution:100:14</span></span>
<span class="line"><span class="token comment">#     at [eval]-wrapper:6:24</span></span>
<span class="line"><span class="token comment">#     at runScript (node:internal/process/execution:83:62)</span></span>
<span class="line"><span class="token comment">#     at evalScript (node:internal/process/execution:114:10)</span></span>
<span class="line"><span class="token comment">#     at node:internal/main/eval_string:30:3 {</span></span>
<span class="line"><span class="token comment">#   errno: -13,</span></span>
<span class="line"><span class="token comment">#   syscall: &#39;open&#39;,</span></span>
<span class="line"><span class="token comment">#   code: &#39;EACCES&#39;,</span></span>
<span class="line"><span class="token comment">#   path: &#39;/var/log/app.log&#39;</span></span>
<span class="line"><span class="token comment"># }</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># Node.js v18.20.8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let&#39;s investigate what&#39;s happening inside the container:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-debug.yaml"><span>nodejs-debug.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>debug</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> debug</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">      echo &quot;Current user: $(whoami)&quot;</span>
<span class="line">      echo &quot;User ID: $(id -u)&quot;</span>
<span class="line">      echo &quot;Group ID: $(id -g)&quot;</span>
<span class="line">      echo &quot;Groups: $(id -G)&quot;</span>
<span class="line">      ls -la /var/log/</span>
<span class="line">      touch /var/log/test.log 2&gt;&amp;1 || echo &quot;Cannot write to /var/log&quot;</span>
<span class="line">      sleep 3600</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The output reveals:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl logs nodejs-debug</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Current user: node</span></span>
<span class="line"><span class="token comment"># User ID: 1000</span></span>
<span class="line"><span class="token comment"># Group ID: 1000</span></span>
<span class="line"><span class="token comment"># Groups: 1000 2000</span></span>
<span class="line"><span class="token comment"># drwxr-xr-x 1 root root 4096 May 30 10:00 /var/log/</span></span>
<span class="line"><span class="token comment"># Cannot write to /var/log</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/var/log</code> directory is owned by root and not writable by our user!</p><p>First solution is using a writable volume.</p><p>Let&#39;s add an <code>emptyDir</code> volume for logs:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-fixed-volume.yaml"><span>nodejs-fixed-volume.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>fixed<span class="token punctuation">-</span>volume</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log</span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          echo &quot;Volume permissions:&quot;</span>
<span class="line">          ls -la /var/log</span></span>
<span class="line"></span>
<span class="line">          node <span class="token punctuation">-</span>e &quot;</span>
<span class="line">            const fs = require(&#39;fs&#39;);</span>
<span class="line">            fs.writeFileSync(&#39;/var/log/app.log&#39;<span class="token punctuation">,</span> &#39;App started successfully<span class="token tag">!&#39;);</span></span>
<span class="line">            console.log(&#39;Success<span class="token tag">!</span> Log written&#39;);</span>
<span class="line">          &quot;</span>
<span class="line">          echo &quot;Log contents<span class="token punctuation">:</span>&quot;</span>
<span class="line">          cat /var/log/app.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Let&#39;s apply the file:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl apply <span class="token parameter variable">-f</span> nodejs-fixed-volume.yaml</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># pod/nodejs-fixed-volume created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Stream the logs:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">kubectl logs nodejs-fixed-volume</span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Volume permissions: total 12</span></span>
<span class="line"><span class="token comment"># drwxrwsrwx 2 root 2000 4096 Jul  4 07:44 .</span></span>
<span class="line"><span class="token comment"># drwxr-xr-x 1 root root 4096 May 20 00:00 ..</span></span>
<span class="line"><span class="token comment"># -rw-r--r-- 1 node 2000   25 Jul  4 07:45 app.log</span></span>
<span class="line"><span class="token comment"># Success! Log written</span></span>
<span class="line"><span class="token comment"># App started successfully!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This works!</p><p>The <code>fsGroup</code> ensures the volume is writable by our container.</p><p>Let&#39;s consider an alternative approach: adjusting the application&#39;s log path.</p><p>Sometimes it&#39;s easier to change where the app writes:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-home.yaml"><span>nodejs-home.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>home</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">        echo &quot;Home directory: $HOME&quot;</span>
<span class="line">        echo &quot;Home permissions:&quot;</span>
<span class="line">        ls -la &quot;$HOME&quot;</span>
<span class="line">        node -e &quot;</span>
<span class="line">          const fs = require(&#39;fs&#39;);</span>
<span class="line">          const path = process.env.HOME + &#39;/app.log&#39;;</span>
<span class="line">          fs.writeFileSync(path, &#39;Using home directory&#39;);</span>
<span class="line">          console.log(&#39;Success using home dir&#39;);</span>
<span class="line">        &quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><em>This works too!</em></p><p><strong>But for production, that&#39;s not enough.</strong></p><p>A production-ready solution combines all security best practices into a single configuration:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="nodejs-production.yaml"><span>nodejs-production.yaml</span></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nodejs<span class="token punctuation">-</span>production</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">    <span class="token key atrule">fsGroupChangePolicy</span><span class="token punctuation">:</span> <span class="token string">&quot;OnRootMismatch&quot;</span></span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">18</span></span>
<span class="line">      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">        <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">capabilities</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ALL&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs</span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /logs</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp</span>
<span class="line">          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp</span>
<span class="line">      <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NODE_ENV</span>
<span class="line">          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;production&quot;</span></span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">-</span>e</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          const fs = require(&#39;fs&#39;);</span>
<span class="line">          const logFile = &#39;/logs/app.log&#39;;</span>
<span class="line">          // Verify we can write</span>
<span class="line">          fs.writeFileSync(logFile, `App started at ${new Date().toISOString()}\n`);</span>
<span class="line">          console.log(&#39;Application running securely!&#39;);</span></span>
<span class="line"></span>
<span class="line">          // Simulate app work</span>
<span class="line">          setInterval(() =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            fs.appendFileSync(logFile<span class="token punctuation">,</span> `Heartbeat at $<span class="token punctuation">{</span>new Date().toISOString()<span class="token punctuation">}</span>\n`);</span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span> 5000);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This version respects all security best practices, and ensures <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/logs</code> and <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/tmp</code> are writable while the root filesystem remains read-only.</p><p><em>So, what did we learn from these excercises?</em></p><p><strong>Many containerized applications attempt writes to system paths like <i class="vp-icon fas fa-folder-open" sizing="height"></i><code>/var/log</code> or <code>/run</code> due to defaults inherited from upstream Linux software.</strong></p><p>With non-root users and a read-only root, those paths break.</p><p><code>fsGroup</code> fixes that by making volumes writable to your container&#39;s user.</p><p>Security needs layersâ€”<code>runAsNonRoot</code>, <code>readOnlyRootFilesystem</code>, and dropped capabilities each block different risks.</p><p>Don&#39;t apply everything at once.</p><p>Add one control, test, then move to the next.</p><p>When things fail, use a debug shell.</p><p>Check <code>id</code>, <code>ls</code>, and try writing files to see what&#39;s blocked.</p><hr><h2 id="summary-and-best-practices" tabindex="-1"><a class="header-anchor" href="#summary-and-best-practices"><span>Summary and Best Practices</span></a></h2><p>Securing containers in Kubernetes isn&#39;t about one magic setting, it&#39;s about <strong>layering protections</strong> that make it harder for things to go wrong.</p><p>Treat <strong>Security Contexts</strong> as part of your architecture.</p><p>Here&#39;s how to achieve this effectively.</p><p>Start by avoiding root entirely.</p><p>Always set <code>runAsNonRoot: true</code> and define an explicit <code>runAsUser</code>.</p><p>Even though root inside a container isn&#39;t host root, it still carries <strong>unnecessary privilege</strong>.</p><p>Next, <strong>drop all Linux capabilities</strong> by default.</p><p>Most applications don&#39;t need them.</p><p>Use <code>drop: [&quot;ALL&quot;]</code> as your baseline, and add back only what&#39;s strictly requiredâ€”like <code>NET_ADMIN</code> for <strong>low-level networking</strong>.</p><p><strong>Block privilege escalation</strong>.</p><p>Set <code>allowPrivilegeEscalation: false</code> to prevent processes from gaining extra rights via <strong>setuid binaries</strong> or other mechanisms.</p><p>Then <strong>lock down the root filesystem</strong>.</p><p>If the app doesn&#39;t need to write to its own image, use <code>readOnlyRootFilesystem: true</code>.</p><p>This stops attackers from modifying binaries or installing tools.</p><p>Mount <strong>temporary writable volumes</strong> (like emptyDir) only where necessary.</p><p>To make them accessible to non-root users, set <code>fsGroup</code> to match the container&#39;s runtime group ID.</p><p>Finally, don&#39;t trust <strong>third-party images</strong> by default.</p><p>Many assume root or lack minimal security settings.</p><p>Review base images carefully, override insecure defaults, and scan for embedded risks.</p><p>Each of these controls blocks a specific class of attacksâ€”<strong>privilege escalation</strong>, <strong>lateral movement</strong>, and <strong>persistence</strong>.</p><p>Build incrementally, test behavior, and validate permissions at runtime.</p><!-- TODO: add ARTICLE CARD --><a class="vp-card" href="https://chanhi2000.github.io/bookshelf/learnkube.com/security-contexts/" target="_blank" style="background:rgba(102,152,204,0.2);"><img class="vp-card-logo" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">From Linux Primitives to Kubernetes Security Contexts</div><hr><div class="vp-card-desc">Dive deep into Kubernetes Security Contexts and learn how to manage security settings for your pods and containers.</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/bookshelf/edit/main/src/learnkube.com/security-context/README.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/devops/k8s/articles/" aria-label="/devops/k8s/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/devops/k8s/articles/</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright Â© 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><div class="vp-copyright">Copyright Â© 2026 Dave Altena </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BItykJLQ.js" defer></script>
  </body>
</html>
