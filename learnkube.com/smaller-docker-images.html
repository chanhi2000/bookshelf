<!doctype html>
<html lang="ko-KR" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.99" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"3 simple tricks for smaller Docker images","image":["https://learnkube.com/a/aab9d512e6d5693641b6f2173d5e8053.svg"],"datePublished":"2019-04-14T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Daniele Polencic","url":"https://linkedin.com/in/danielepolencic"}]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/learnkube.com/smaller-docker-images.html"><meta property="og:site_name" content="ðŸ“šBookshelf"><meta property="og:title" content="3 simple tricks for smaller Docker images"><meta property="og:description" content="Article(s) > 3 simple tricks for smaller Docker images"><meta property="og:type" content="article"><meta property="og:image" content="https://static.learnkube.com/553d74fb0904984a84abefffdb5957af.svg"><meta property="og:locale" content="ko-KR"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://static.learnkube.com/553d74fb0904984a84abefffdb5957af.svg"><meta name="twitter:image:alt" content="3 simple tricks for smaller Docker images"><meta property="article:author" content="Daniele Polencic"><meta property="article:tag" content="docker"><meta property="article:tag" content="devops"><meta property="article:tag" content="learnkube.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2019-04-14T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>3 simple tricks for smaller Docker images | ðŸ“šBookshelf</title><meta name="description" content="Article(s) > 3 simple tricks for smaller Docker images">
    <link rel="preload" href="/bookshelf/assets/style-Bhb-QcDa.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-Bhb-QcDa.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">ðŸ“šBookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="oddbird.net"><!--[--><img class="vp-icon" src="https://oddbird.net/safari-pinned-tab.svg" alt aria-hidden no-view sizing="both"><!--]-->oddbird.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/zeroheight.com/" aria-label="zeroheight.com"><!--[--><img class="vp-icon" src="https://zeroheight.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->zeroheight.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/typescript.tv/" aria-label="typescript.tv"><!--[--><img class="vp-icon" src="https://typescript.tv/_astro/android-chrome-192x192.BhQ8hcWh.png" alt aria-hidden no-view sizing="both"><!--]-->typescript.tv<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/bram.us/" aria-label="bram.us"><!--[--><img class="vp-icon" src="https://bram.us/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->bram.us<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/una.im/" aria-label="una.im"><!--[--><img class="vp-icon" src="https://una.im/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->una.im<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/joshwcomeau.com/" aria-label="joshwcomeau.com"><!--[--><img class="vp-icon" src="https://joshwcomeau.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->joshwcomeau.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tip.com/" aria-label="css-tip.com"><!--[--><img class="vp-icon" src="https://css-tip.com/img/fav.png" alt aria-hidden no-view sizing="both"><!--]-->css-tip.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/nerdy.dev/" aria-label="nerdy.dev"><!--[--><img class="vp-icon" src="https://nerdy.dev/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->nerdy.dev<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/learnkube.com/" aria-label="learnkube.com"><!--[--><img class="vp-icon" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnkube.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/bookshelf" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><!----></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">learnkube.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2025</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2024</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2022</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2021</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2020</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2019</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/kubernetes-ingress-api-gateway.html" aria-label="Can you expose your microservices with an API gateway in Kubernetes?"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Can you expose your microservices with an API gateway in Kubernetes?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/scaling-spring-boot-microservices.html" aria-label="Scaling Microservices with Message Queues, Spring Boot and Kubernetes"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Scaling Microservices with Message Queues, Spring Boot and Kubernetes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/autoscaling-apps-kubernetes.html" aria-label="How to autoscale apps on Kubernetes with custom metrics"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->How to autoscale apps on Kubernetes with custom metrics<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/kubernetes-secrets-in-git.html" aria-label="How to keep your Kubernetes secrets secure in Git"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->How to keep your Kubernetes secrets secure in Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/visualise-dependencies-kubernetes.html" aria-label="How do you visualise dependencies in your Kubernetes YAML files?"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->How do you visualise dependencies in your Kubernetes YAML files?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/helm-templating-kubernetes-yaml.html" aria-label="Is Helm used just for templating Kubernetes YAML files?"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Is Helm used just for templating Kubernetes YAML files?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/kubectl-productivity.html" aria-label="Boosting your kubectl productivity"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Boosting your kubectl productivity<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/kubernetes-chaos-engineering-lessons-learned.html" aria-label="Kubernetes Chaos Engineering: Lessons Learned â€” Part 1"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Kubernetes Chaos Engineering: Lessons Learned â€” Part 1<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/learnkube.com/smaller-docker-images.html" aria-label="3 simple tricks for smaller Docker images"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->3 simple tricks for smaller Docker images<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/learnkube.com/connecting-multiple-kubernetes-clusters.html" aria-label="How do you connect Kubernetes clusters located in different data centres?&quot;"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->How do you connect Kubernetes clusters located in different data centres?&quot;<!----></a></li></ul></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://static.learnkube.com/553d74fb0904984a84abefffdb5957af.svg" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-docker" sizing="height"></i>3 simple tricks for smaller Docker images</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorðŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://linkedin.com/in/danielepolencic" target="_blank" rel="noopener noreferrer">Daniele Polencic</a></span><span property="author" content="Daniele Polencic"></span></span><!----><span class="page-date-info" aria-label="Writing DateðŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">19. 4. 14.</span><meta property="datePublished" content="2019-04-14T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 9 min</span><meta property="timeRequired" content="PT9M"></span><span class="page-category-info" aria-label="CategoryðŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2" role>DevOps</span><span class="page-category-item color8" role>Docker</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="DevOps,Docker,Article(s)"></span><span class="page-tag-info" aria-label="TagðŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color1" role>learnkube.com</span><span class="page-tag-item color7" role>devops</span><span class="page-tag-item color2" role>docker</span><!--]--><meta property="keywords" content="blog,learnkube.com,devops,docker"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-á„€á…ªá†«á„…á…§á†«" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-á„€á…ªá†«á„…á…§á†«"><span>3 simple tricks for smaller Docker images ê´€ë ¨</span></a></h1><a class="route-link vp-card" href="/bookshelf/devops/docker/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Docker > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/learnkube.com/smaller-docker-images.html#_1-squash-multiple-layers-into-one-with-multi-stage-docker-builds" class="router-link-active router-link-exact-active">1. Squash multiple layers into one with multi-stage Docker builds</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/smaller-docker-images.html#_2-remove-all-the-unnecessary-cruft-from-the-container-with-distroless" class="router-link-active router-link-exact-active">2. Remove all the unnecessary cruft from the container with distroless</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/smaller-docker-images.html#_3-smaller-base-images-with-alpine" class="router-link-active router-link-exact-active">3. Smaller base images with Alpine</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/smaller-docker-images.html#what-base-image-should-you-choose" class="router-link-active router-link-exact-active">What base image should you choose?</a></li><li><a aria-current="page" href="/bookshelf/learnkube.com/smaller-docker-images.html#conclusion" class="router-link-active router-link-exact-active">Conclusion</a></li></ul></nav><hr><div class="vp-site-info" data-name="3 simple tricks for smaller Docker images"><a class="vp-site-info-navigator no-external-link-icon" title="3 simple tricks for smaller Docker images" href="https://learnkube.com/smaller-docker-images" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://static.learnkube.com/553d74fb0904984a84abefffdb5957af.svg) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" alt loading="lazy" no-view><div class="vp-site-info-name">3 simple tricks for smaller Docker images</div><div class="vp-site-info-desc">When it comes to building Docker containers, you should always strive for smaller images. Images that share layers and are smaller in size are quicker to transfer and deploy. But how do you keep the size under control when every RUN statement creates a new layer, and you need intermediate artefacts before the image is ready?</div></div><!----></div><p>When it comes to building Docker containers, you should always strive for smaller images. <strong>Images that share layers and are smaller in size are quicker to transfer and deploy</strong>.</p><p>But how do you keep the size under control when every <code>RUN</code> statement creates a new layer, and you need intermediate artefacts before the image is ready?</p><p>You may have noticed that most of the <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code>s in the wild have some weird tricks like this:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dockerfile"><span>Dockerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> ubuntu</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install vim</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Why the <code>&amp;&amp;</code>? Why not running two <code>RUN</code> statements like this?</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dockerfile"><span>Dockerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> ubuntu</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get install vim</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Since Docker 1.10 the <code>COPY</code>, <code>ADD</code> and <code>RUN</code> statements add a new layer to your image. The previous example created two layers instead of just one.</p><figure><img src="https://learnkube.com/a/aab9d512e6d5693641b6f2173d5e8053.svg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>Layers are like git commits.</strong></p><p>Docker layers store the difference between the previous and the current version of the image. And like git commits they&#39;re handy if you share them with other repositories or images.</p><p>In fact, when you request an image from a registry you download only the layers that you don&#39;t own already. This way is much more efficient to share images.</p><p>But layers aren&#39;t free.</p><p><strong>Layers use space</strong> and the more layer you have, the heavier the final image is. Git repositories are similar in this respect. The size of your repository increases with the number of layers because Git has to store all the changes between commits.</p><p>In the past, it was a good practice to combine several <code>RUN</code> statements on a single line. Like in the first example.</p><p>Not anymore.</p><hr><h2 id="_1-squash-multiple-layers-into-one-with-multi-stage-docker-builds" tabindex="-1"><a class="header-anchor" href="#_1-squash-multiple-layers-into-one-with-multi-stage-docker-builds"><span>1. Squash multiple layers into one with multi-stage Docker builds</span></a></h2><p>When a Git repository becomes bigger, you can choose to squash the history into a single commit and forget about the past.</p><p>It turns out you can do something similar in Docker too with a multi-stage build.</p><p>In this example, you will build a Node.js container.</p><p>Let&#39;s start with an<i class="vp-icon fa-brands fa-js" sizing="height"></i><code>index.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Example app listening on port 3000!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>and<i class="vp-icon iconfont icon-json" sizing="height"></i><code>package.json</code>:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="package.json"><span>package.json</span></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello-world&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.16.2&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node index.js&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can package this application with the following <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code>:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dockerfile"><span>Dockerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> package.json index.js ./</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> npm install</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can build the image with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> node-vanilla <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And you can test that it works correctly with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 <span class="token parameter variable">-ti</span> <span class="token parameter variable">--rm</span> <span class="token parameter variable">--init</span> node-vanilla</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># &gt; hello-world@1.0.0 start /app</span></span>
<span class="line"><span class="token comment"># &gt; node index.js</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># Example app listening on port 3000!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You should be able to visit <code>http://localhost:3000</code> and be greeted by <em>&quot;Hello World!&quot;</em>.</p><p>There is a <code>COPY</code> and a <code>RUN</code> statements in the <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code>. So you should expect to see at least two layers more than the base image:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token function">history</span> node-vanilla</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># IMAGE          CREATED BY                                      SIZE</span></span>
<span class="line"><span class="token comment"># 075d229d3f48   /bin/sh -c #(nop)  CMD [&quot;npm&quot; &quot;start&quot;]          0B</span></span>
<span class="line"><span class="token comment"># bc8c3cc813ae   /bin/sh -c npm install                          2.91MB</span></span>
<span class="line"><span class="token comment"># bac31afb6f42   /bin/sh -c #(nop) COPY multi:3071ddd474429e1â€¦   364B</span></span>
<span class="line"><span class="token comment"># 500a9fbef90e   /bin/sh -c #(nop) WORKDIR /app                  0B</span></span>
<span class="line"><span class="token comment"># 78b28027dfbf   /bin/sh -c #(nop)  EXPOSE 3000                  0B</span></span>
<span class="line"><span class="token comment"># b87c2ad8344d   /bin/sh -c #(nop)  CMD [&quot;node&quot;]                 0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex   &amp;&amp; for key in     6A010â€¦   4.17MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  ENV YARN_VERSION=1.3.2       0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c ARCH= &amp;&amp; dpkgArch=&quot;$(dpkg --printâ€¦   56.9MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  ENV NODE_VERSION=8.9.4       0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex   &amp;&amp; for key in     94AE3â€¦   129kB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c groupadd --gid 1000 node   &amp;&amp; useâ€¦   335kB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex;  apt-get update;  apt-geâ€¦   324MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦   123MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex;  if ! command -v gpg &gt; /â€¦   0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦   44.6MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop) ADD file:1dd78a123212328bdâ€¦   123MB</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Instead the resulting image has five new layers: one for each statement in your <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code>.</p><p>Let&#39;s try the multi-stage Docker build.</p><p>You will use the same <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code> above, but twice:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dockerfile"><span>Dockerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8 <span class="token keyword">as</span> build</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> package.json index.js ./</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> npm install</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /app /</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;index.js&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The first part of the <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code> creates three layers. The layers are then merged and copied across to the second and final stage. Two more layers are added on top of the image for a total of 3 layers.</p><!-- TODO: ì—ë‹ˆë©”ì´ì…˜ íŒŒì•…í•˜ê¸° --><p>Go ahead and verify yourself. First, build the container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> node-multi-stage <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And now inspect the history:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token function">history</span> node-multi-stage</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># IMAGE          CREATED BY                                      SIZE</span></span>
<span class="line"><span class="token comment"># 331b81a245b1   /bin/sh -c #(nop)  CMD [&quot;index.js&quot;]             0B</span></span>
<span class="line"><span class="token comment"># bdfc932314af   /bin/sh -c #(nop)  EXPOSE 3000                  0B</span></span>
<span class="line"><span class="token comment"># f8992f6c62a6   /bin/sh -c #(nop) COPY dir:e2b57dff89be62f77â€¦   1.62MB</span></span>
<span class="line"><span class="token comment"># b87c2ad8344d   /bin/sh -c #(nop)  CMD [&quot;node&quot;]                 0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex   &amp;&amp; for key in     6A010â€¦   4.17MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  ENV YARN_VERSION=1.3.2       0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c ARCH= &amp;&amp; dpkgArch=&quot;$(dpkg --printâ€¦   56.9MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  ENV NODE_VERSION=8.9.4       0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex   &amp;&amp; for key in     94AE3â€¦   129kB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c groupadd --gid 1000 node   &amp;&amp; useâ€¦   335kB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex;  apt-get update;  apt-geâ€¦   324MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦   123MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c set -ex;  if ! command -v gpg &gt; /â€¦   0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦   44.6MB</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B</span></span>
<span class="line"><span class="token comment"># &lt;missing&gt;      /bin/sh -c #(nop) ADD file:1dd78a123212328bdâ€¦   123MB</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hurrah! Has the file size changed at all?</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> node-</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># node-multi-stage   331b81a245b1   678MB</span></span>
<span class="line"><span class="token comment"># node-vanilla       075d229d3f48   679MB</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Yes, the last image is slightly smaller.</p><p>Not too bad! You reduced the overall size even if this is an already slimmed down application.</p><p>But the image is still big!</p><p>Is there anything you can do to make it even smaller?</p><hr><h2 id="_2-remove-all-the-unnecessary-cruft-from-the-container-with-distroless" tabindex="-1"><a class="header-anchor" href="#_2-remove-all-the-unnecessary-cruft-from-the-container-with-distroless"><span>2. Remove all the unnecessary cruft from the container with distroless</span></a></h2><p>The current image ships Node.js as well as <code>yarn</code>, <code>npm</code>, <code>bash</code> and a lot of other binaries. It&#39;s also based on Ubuntu. So you have a fully fledged operating system with all its little binaries and utilities.</p><p>You don&#39;t need any of those when you run your container. The only dependency you need is Node.js.</p><p>Docker containers should wrap a single process and contain the bare minimal to run it. You don&#39;t need an operating system.</p><p>In fact, you could remove everything but Node.js.</p><p><strong>But how?</strong></p><p>Fortunately, Google had the same idea and came up with <a href="https://github.com/GoogleCloudPlatform/distroless" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-github" sizing="height"></i><code>GoogleCloudPlatform/distroless</code></a>.</p><p>As the description for the repository points out:</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>&quot;Distroless&quot; images contain only your application and its runtime dependencies. They do not contain package managers, shells any other programs you would expect to find in a standard Linux distribution.</p></div><p>This is precisely what you need!</p><p>You can tweak the <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code> to leverage the new base image like this:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dockerfile"><span>Dockerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8 <span class="token keyword">as</span> build</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> package.json index.js ./</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> npm install</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> gcr.io/distroless/nodejs</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /app /</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;index.js&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>And you can compile the image as usual with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> node-distroless <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The application should run as normal. To verify that is still the case, you could run the container like this:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 <span class="token parameter variable">-ti</span> <span class="token parameter variable">--rm</span> <span class="token parameter variable">--init</span> node-distroless</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And visit the page at <code>http://localhost:3000</code>.</p><p>Is the image without all the extra binaries smaller?</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> node-distroless</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># node-distroless   7b4db3b7f1e5   76.7MB</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>That&#39;s only 76.7MB!</strong></p><p>600MB less than your previous image!</p><p>Excellent news! But there&#39;s something you should pay attention to when it comes to distroless.</p><p>When your container is running, and you wish to inspect it, you can attach to a running container with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> <span class="token operator">&lt;</span>insert_docker_id<span class="token operator">&gt;</span> <span class="token function">bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Attaching to a running container and running <code>bash</code> feels like establishing an SSH session.</p><p>But since distroless is a stripped down version of the original operating system, there are no extra binaries. There&#39;s no shell in the container!</p><p>How can you attach to a running container if there&#39;s no shell?</p><p>The good and the bad news is that you can&#39;t.</p><p>It&#39;s bad news because you can only execute the binaries in the container. The only binary you could run is Node.js:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> <span class="token operator">&lt;</span>insert_docker_id<span class="token operator">&gt;</span> <span class="token function">node</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>It&#39;s good news because an attacker exploiting your application and gaining access to the container won&#39;t be able to do as much damage as if were to access a shell. In other words, fewer binaries mean smaller sizes and increased security. But at the cost of more painful debugging.</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>Please note that perhaps you shouldn&#39;t attach to and debug containers in a production environment. You should rather rely on proper logging and monitoring.</p></div><p>But what if you cared about debugging and smaller sizes?</p><hr><h2 id="_3-smaller-base-images-with-alpine" tabindex="-1"><a class="header-anchor" href="#_3-smaller-base-images-with-alpine"><span>3. Smaller base images with Alpine</span></a></h2><p>You could replace the distroless base image with an Alpine based image.</p><p><a href="https://alpinelinux.org/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-alpine" sizing="height"></i>Alpine Linux</a> is:</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>a security-oriented, lightweight Linux distribution based on <a href="https://musl-libc.org/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>musl libc</a> and <a href="https://busybox.net/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>busybox</a></p></div><p>In other words, a Linux distribution that is smaller in size and more secure.</p><p>You shouldn&#39;t take their words for granted. Let&#39;s check if the image is smaller.</p><p>You should tweak the <i class="vp-icon fa-brands fa-docker" sizing="height"></i><code>Dockerfile</code> and use <code>node:8-alpine</code>:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="Dcokerfile"><span>Dcokerfile</span></div><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code class="language-docker"><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8 <span class="token keyword">as</span> build</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> package.json index.js ./</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> npm install</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> node:8-alpine</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /app /</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can build the image with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> node-alpine <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And you can check the size with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> node-alpine</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># node-alpine   aa1f85f8e724   69.7MB</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>69.7MB!</strong></p><p>Even smaller than the distroless image!</p><p>Can you attach to a running container, unlike distroless? It&#39;s time to find out.</p><p>Let&#39;s start the container first:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 <span class="token parameter variable">-ti</span> <span class="token parameter variable">--rm</span> <span class="token parameter variable">--init</span> node-alpine</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># Example app listening on port 3000!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can attach to the running container with:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> 9d8e97e307d7 <span class="token function">bash</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># OCI runtime exec failed: exec failed: container_linux.go:296: starting container process caused</span></span>
<span class="line"><span class="token comment"># &quot;exec: \&quot;bash\&quot;: executable file not found in $PATH&quot;: unknown</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With no luck. But perhaps the container has a <code>sh</code>ell?</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> 9d8e97e307d7 <span class="token function">sh</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># exit</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Yes! You can still attach to a running container and you have an overall smaller image.</p><p>It sounds promising, but there&#39;s a catch.</p><p>Alpine based images are based on muslc â€” an alternative standard library for C.</p><p>However, most Linux distribution such as Ubuntu, Debian and CentOS are based on glibc. The two libraries are supposed to implement the same interface to the kernel.</p><p>However, they have different goals:</p><ul><li><strong>glibc</strong> is the most common and faster</li><li><strong>muslc</strong> uses less space and is written with security in mind</li></ul><p>When an application is compiled, it is compiled against a specific libc for the most part. If you wish to use them with another libc you have to recompile them.</p><p>In other words, building your containers with Alpine images may lead to unexpected behaviour because the standard C library is different.</p><p>You may notice discrepancies particularly when you&#39;re dealing with precompiled binaries such as Node.js C++ extensions.</p><p>As an example, the PhantomJS prebuilt package doesn&#39;t work on Alpine.</p><hr><h2 id="what-base-image-should-you-choose" tabindex="-1"><a class="header-anchor" href="#what-base-image-should-you-choose"><span>What base image should you choose?</span></a></h2><p>Do you use Alpine, distroless or vanilla images?</p><p><strong>If you&#39;re running in production and you&#39;re concerned about security</strong>, perhaps distroless images are more appropriate.</p><p>Every binary that is added to a Docker image adds a certain amount of risk to the overall application.</p><p>You can reduce the overall risk by having only one binary installed in the container.</p><p>As an example, if an attacker was able to exploit a vulnerability in your app running on Distroless, they won&#39;t be able to spawn a shell in the container because there isn&#39;t one!</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>Please note that <a href="https://owasp.org/index.php/Minimize_attack_surface_area" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>minimising attack surface area is recommended by OWASP</a>.</p></div><p><strong>If you&#39;re concerned about size at all costs, then you should switch to Alpine based images</strong>.</p><p>Those are generally very small but at the price of compatibility. Alpine uses a slightly different standard C library â€” muslc. You may experience some compatibility issues from time to time. More examples of that <a href="https://github.com/grpc/grpc/issues/8528" target="_blank" rel="noopener noreferrer">here &quot;alpine-node docker image and google-cloud equals error loading ld-linux-x86-64.so.2&quot; (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>grpc/grpc</code>)</a> and <a href="https://github.com/grpc/grpc/issues/6126" target="_blank" rel="noopener noreferrer">here &quot;Import error trying to run gRPC on alpine&quot; (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>grpc/grpc</code>)</a>.</p><p><strong>The vanilla base image is perfect for testing and development</strong>.</p><p>It&#39;s big but provides the same experiences as if you were to have your workstation with Ubuntu installed. Also, you have access to all the binaries available in the operating system.</p><p>Recap of image sizes:</p><table><thead><tr><th>Image</th><th>Size (MB)</th></tr></thead><tbody><tr><td><code>node:8</code></td><td>681</td></tr><tr><td><code>node:8</code> with multi stage build</td><td>678</td></tr><tr><td><code>gcr.io/distroless/nodejs</code></td><td>76.7</td></tr><tr><td><code>node:8-alpine</code></td><td>69.7</td></tr></tbody></table><hr><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>That&#39;s all folks!</p><p>Thanks to <a href="https://github.com/chrisns" target="_blank" rel="noopener noreferrer">Chris Nesbitt-Smith (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>chrisns</code>)</a>, <a href="https://valentin.ouvrard.it/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Valentin Ouvrard</a> and <a href="https://keith-mifsud.me/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Keith Mifsud</a> for their feedback!</p><p>If you enjoyed this article, you might find the following articles interesting:</p><ul><li><a href="https://learnkube.com/blog/installing-docker-and-kubernetes-on-windows" target="_blank" rel="noopener noreferrer">Getting started with Docker and Kubernetes on Windows 10</a></li></ul><a class="route-link vp-card" href="/bookshelf/learnkube.com/learnk8s.com/kubernetes-chaos-engineering-lessons-learned.html" style="background:rgba(102,152,204,0.2);"><img class="vp-card-logo" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Kubernetes Chaos Engineering: Lessons Learned â€” Part 1</div><hr><div class="vp-card-desc">When you deploy an app in Kubernetes, your code ends up running on one or more worker nodes. But what happens when a node breaks and the network proxy crashes?</div></div></a><!-- TODO: add ARTICLE CARD --><a class="vp-card" href="https://chanhi2000.github.io/bookshelf/learnk8s.com/learnkube.com/smaller-docker-images.html" target="_blank" style="background:rgba(102,152,204,0.2);"><img class="vp-card-logo" src="https://static.learnkube.com/f7e5160d4744cf05c46161170b5c11c9.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">3 simple tricks for smaller Docker images</div><hr><div class="vp-card-desc">When it comes to building Docker containers, you should always strive for smaller images. Images that share layers and are smaller in size are quicker to transfer and deploy. But how do you keep the size under control when every RUN statement creates a new layer, and you need intermediate artefacts before the image is ready?</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/bookshelf/edit/main/src/learnkube.com/smaller-docker-images.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/devops/docker/articles/" aria-label="/devops/docker/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/devops/docker/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/learnkube.com/connecting-multiple-kubernetes-clusters.html" aria-label="How do you connect Kubernetes clusters located in different data centres?&quot;"><div class="hint">Next<span class="arrow end"></span></div><div class="link">How do you connect Kubernetes clusters located in different data centres?&quot;<i class="vp-icon iconfont icon-k8s" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright Â© 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><div class="vp-copyright">Copyright Â© 2026 Daniele Polencic </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BItykJLQ.js" defer></script>
  </body>
</html>
