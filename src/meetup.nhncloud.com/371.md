---
lang: ko-KR
title: PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹±
description: Article(s) > PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹±
icon: fa-brands fa-android
category: 
  - Android
  - JavaScript
  - DevOps
  - Article(s)
tag: 
  - blog
  - meetup.nhncloud.com
  - js
  - android
  - so
head:
  - - meta:
    - property: og:title
      content: Article(s) > PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹±
    - property: og:description
      content: PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹±
    - property: og:url
      content: https://chanhi2000.github.io/bookshelf/meetup.nhncloud.com/371.html
prev: /programming/java-android/articles/README.md
date: 2023-09-04
isOriginal: false
cover: https://image.toast.com/aaaadh/real/2023/techblog/NHNuD074uB77CuC6B0uB4DC%20MeetupPLT%20Hook%20uCCB4uD06CuB97C%20uC704uD55C%20Android%20so%20uD30CuC77C%20uD30CuC2F1uC12CuB124uC77C230829.jpg
---

# {{ $frontmatter.title }} ê´€ë ¨

```component VPCard
{
  "title": "Andriod > Article(s)",
  "desc": "Article(s)",
  "link": "/programming/java-android/articles/README.md",
  "logo": "/images/ico-wind.svg",
  "background": "rgba(10,10,10,0.2)"
}
```

```component VPCard
{
  "title": "JavaScript > Article(s)",
  "desc": "Article(s)",
  "link": "/programming/js/articles/README.md",
  "logo": "/images/ico-wind.svg",
  "background": "rgba(10,10,10,0.2)"
}
```

[[toc]]

---

<SiteInfo
  name="PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹± | NHN Cloud Meetup"
  desc="PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼ íŒŒì‹±"
  url="https://meetup.nhncloud.com/posts/371"
  logo="https://meetup.nhncloud.com/resources/img/favicon.ico"
  preview="https://image.toast.com/aaaadh/real/2023/techblog/NHNuD074uB77CuC6B0uB4DC%20MeetupPLT%20Hook%20uCCB4uD06CuB97C%20uC704uD55C%20Android%20so%20uD30CuC77C%20uD30CuC2F1uC12CuB124uC77C230829.jpg"/>

![[NHNí´ë¼ìš°ë“œ] Meetup!_PLT Hook ì²´í¬ë¥¼ ìœ„í•œ Android so íŒŒì¼](https://image.toast.com/aaaadh/real/2023/techblog/NHNuD074uB77CuC6B0uB4DC%20MeetupPLT%20Hook%20uCCB4uD06CuB97C%20uC704uD55C%20Android%20so%20uD30CuC77C%20uD30CuC2F1uC12CuB124uC77C230829.jpg)

## ë“¤ì–´ê°€ë©°

Android PLT(procedure linkage table) hookê³¼ ê´€ë ¨í•´ plt hook ë‹¹í•œ í•¨ìˆ˜ë¥¼ ì‹ë³„í•˜ëŠ” ë°©ë²•ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤. plt hook ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œëŠ” bytedanceì—ì„œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œí•œ [<FontIcon icon="iconfont icon-github"/> `bytedance/bhook`](https://github.com/bytedance/bhook)ì´ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

ì‹¤ì œë¡œ ì‚¬ìš©í•´ ë³´ë‹ˆ ì‰½ê³ , ì•ˆì •ì ìœ¼ë¡œ í›„í‚¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¤ìŒ ì‚¬ì§„ì€ fopen í•¨ìˆ˜ë¥¼ plt hookí•˜ì—¬ ë¡œê·¸ë¥¼ ì°ì€ ê²ƒì…ë‹ˆë‹¤.

![](https://image.toast.com/aaaadh/real/2023/techblog/01%287%29.png)

ì œê°€ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤ëŠ” ê±´ ë‚¨ë“¤ë„, íŠ¹íˆ í•´ì»¤ë“¤ë„ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤ëŠ” ê±°ê² ì£ ? ì´ëŸ¬í•œ í›„í‚¹ì€ ì–´ë·°ì§•ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¶„ì„í•˜ëŠ” ì…ì¥ì—ì„œëŠ” plt hook ë‹¹í•œ í•¨ìˆ˜ë¥¼ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì–´ì•¼ê² ì£ .

---

## PLT hook í•˜ë©´ ë¬´ìŠ¨ ì¼ì´ ë°œìƒí•˜ëŠ”ê°€?

so íŒŒì¼ì€ ELF íŒŒì¼ í¬ë§·ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ELF íŒŒì¼ì€ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ë©´ .rela.plt ì„¹ì…˜ì— ì •ì˜ë˜ì–´ ìˆëŠ” í•¨ìˆ˜(ì‹¬ë³¼)ì˜ ì£¼ì†Œê°’ì„ .got.plt ì„¹ì…˜ì— ì €ì¥í•©ë‹ˆë‹¤. ê·¸ í›„ .got.plt ì„¹ì…˜ì— ì €ì¥ë˜ì–´ ìˆëŠ” ì£¼ì†Œë¥¼ ì°¸ì¡°í•˜ì—¬ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.

ë‹¤ìŒì€ <FontIcon icon="fas fa-file-lines"/>`libart.so` íŒŒì¼ì„ ë¡œì»¬ì—ì„œ elf íŒŒì‹±([<FontIcon icon="iconfont icon-github"/>`horsicq/XELFViewer`](https://github.com/horsicq/XELFViewer)) í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì—´ì–´ ë³¸ ê²ƒì…ë‹ˆë‹¤. `.rela.plt` ì„¹ì…˜ì— `0x212` ë¼ëŠ” ì‹¬ë³¼ì´ ì •ì˜ë˜ì–´ ìˆê³ , `r_offset` ê°’ì´ `0x6a6480`ì…ë‹ˆë‹¤. `r_offset` ì€ <FontIcon icon="fas fa-file-lines"/>`libart.so` íŒŒì¼ì´ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ë©´ ê·¸ base ì£¼ì†Œë¡œë¶€í„° `0x6a6480` ìœ„ì¹˜ë§Œí¼ ë–¨ì–´ì§„ ê³³ì— `0x212` ì‹¬ë³¼ì˜ ì£¼ì†Œê°’ì„ ì €ì¥í•˜ê² ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

![](https://image.toast.com/aaaadh/real/2023/techblog/02%285%29.png)

0x212 ì‹¬ë³¼ì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”? `.dynsym` ì„¹ì…˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `0x212`ëŠ” ì‹­ì§„ìˆ˜ë¡œ 530ì…ë‹ˆë‹¤. 530ì€ `.dynsym` ì„¹ì…˜ì˜ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤. ì¦‰, `.dynsym` ì„¹ì…˜ì—ì„œ 530ë²ˆì§¸ ì €ì¥ë˜ì–´ ìˆëŠ” ì‹¬ë³¼ì¸ ê²ƒì´ì£ . `fopen`ì´ë„¤ìš”.

![](https://image.toast.com/aaaadh/real/2023/techblog/03%285%29.png)

ì •ë¦¬í•˜ë©´ "`fopen` í•¨ìˆ˜ëŠ” .rela.plt ì„¹ì…˜ì— ì •ì˜ë˜ì–´ ìˆê³ , <FontIcon icon="fas fa-file-lines"/>`libart.so` íŒŒì¼ì´ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ë©´ base ì£¼ì†Œë¡œë¶€í„° `0x6a6480` ìœ„ì¹˜ ë–¨ì–´ì§„ ê³³ì— `fopen` í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì €ì¥í•œë‹¤. ê·¸ê³³ì˜ ìœ„ì¹˜ëŠ” `.got.plt` ì„¹ì…˜ì— ìˆë‹¤"ê°€ ë˜ê² ìŠµë‹ˆë‹¤.

ë§Œì•½ `fopen` í•¨ìˆ˜ê°€ plt hook ë‹¹í•˜ë©´ `.got.plt` ì„¹ì…˜ì— ì €ì¥ë˜ëŠ” `fopen` í•¨ìˆ˜ì˜ ì£¼ì†Œê°€ ë‹¤ë¥¸ ê³³(ì•…ì„± so íŒŒì¼ì˜ í•¨ìˆ˜ ì£¼ì†Œ)ìœ¼ë¡œ ë°”ë€Œê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

![](https://image.toast.com/aaaadh/real/2023/techblog/04%286%29.png)

---

## PLT hook ë‹¹í•œ í•¨ìˆ˜ë¥¼ ì–´ë–»ê²Œ ì‹ë³„í•˜ëŠ”ê°€?

ëŸ°íƒ€ì„ ì‹œì— íŠ¹ì • í•¨ìˆ˜ê°€ plt hookì„ ë‹¹í•˜ë©´ `.got.plt` ì„¹ì…˜ì— ì €ì¥ë˜ëŠ” ì£¼ì†Œê°’ì´ ë°”ê¿”ì¹˜ê¸° ë‹¹í•  ê²ƒì…ë‹ˆë‹¤. `.got.plt` ì„¹ì…˜ì— ì£¼ì†Œê°’ì„ ì €ì¥í•˜ëŠ” ì‹¬ë³¼ë“¤ì€ `.rela.plt` ì„¹ì…˜ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. `.rela.plt` ì„¹ì…˜ì—ëŠ” ì–´ë–¤ ì‹¬ë³¼ ë° ê·¸ ì‹¬ë³¼ì˜ ì£¼ì†Œê°’ì´ ì–´ëŠ ìœ„ì¹˜ì— ì €ì¥ë˜ëŠ”ì§€ ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‹ˆ, `.rela.plt` ì„¹ì…˜ì„ íŒŒì‹±í•´ì„œ ì–´ë–¤ ì‹¬ë³¼ì˜ ì£¼ì†Œê°’ì´ ì•…ì„± `so` íŒŒì¼ì— ìœ„ì¹˜í•˜ê³  ìˆìœ¼ë©´ plt hook ë‹¹í•œ ê²ƒìœ¼ë¡œ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`.rela.plt` ì„¹ì…˜ì„ ì–´ë–»ê²Œ íŒŒì‹±í• ê¹Œìš”? ê·¸ëƒ¥ `open` í•¨ìˆ˜ë¡œ `so` íŒŒì¼ ì—´ì–´ì„œ íŒŒì‹±í•˜ë©´ ë˜ëŠ” ê²ƒ ì•„ë‹ê¹Œìš”? ê·¸ëŸ¬ë‚˜ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. `android:extractNativeLibs="false"` ì˜µì…˜ìœ¼ë¡œ ë¹Œë“œí•œ apk íŒŒì¼ì˜ ê²½ìš° so íŒŒì¼ì„ apk íŒŒì¼ì—ì„œ ì¶”ì¶œí•˜ì§€ ì•Šê³  ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— `open` í•¨ìˆ˜ë¡œ ì—´ì–´ë³¼ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ì–´ëŠ ê²Œì„ ì•±ì˜ ë©”ëª¨ë¦¬ì— ë¡œë“œëœ <FontIcon icon="fas fa-file-lines"/>`libil2cpp.so` íŒŒì¼ ì •ë³´ì¸ë°ìš”. ê·¸ ê²½ë¡œê°€ <FontIcon icon="fa-brands fa-android"/>`split_config_arm64_v8a.apk` íŒŒì¼ ì•ˆì— ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤(! í‘œì‹œê°€ `apk` íŒŒì¼ ì•ˆì— ìˆëŠ” ê²½ë¡œë¥¼ ì˜ë¯¸í•¨).

![](https://image.toast.com/aaaadh/real/2023/techblog/05%285%29.png)

í ...ê·¸ë˜ë„ ë¬¸ì œì—†ì£ . ì–´ì°¨í”¼ `so` íŒŒì¼ì€ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ëŠ” ê²ƒì´ë‹ˆ ë©”ëª¨ë¦¬ì—ì„œ ì§ì ‘ .rela.plt ì„¹ì…˜ì„ íŒŒì‹±í•˜ë©´ ë  í…Œë‹ˆê¹Œìš”. ê·¸ëŸ¬ë©´ .rela.plt ì„¹ì…˜ì´ ë©”ëª¨ë¦¬ì˜ ì–´ë””ì— ìœ„ì¹˜í•˜ê³  ìˆëŠ”ì§€ ì•Œì•„ë‚´ë©´ ë˜ê² ìŠµë‹ˆë‹¤. `.rela.plt` ì„¹ì…˜ì˜ ìœ„ì¹˜ëŠ” Section Headerë¼ëŠ” ê³³ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ Section Headerì˜ ìœ„ì¹˜ëŠ” Elf Header(Elf_Ehdr)ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ì—ì„œ <FontIcon icon="fas fa-file-lines"/>`libart.so` íŒŒì¼ì˜ Elf Header ì¤‘ `e_shoff` ê°’ì´ `0x836a98`ì…ë‹ˆë‹¤. ê·¸ê³³ì´ Section Headerì˜ ìœ„ì¹˜ì…ë‹ˆë‹¤.

![](https://image.toast.com/aaaadh/real/2023/techblog/06%286%29.png)

ì, ì´ì œ Section Header ìœ„ì¹˜ë¡œ ì§ì ‘ ê°€ì„œ ë©”ëª¨ë¦¬ë¥¼ ê´€ì°°í•´ ë´ì•¼ê² ìŠµë‹ˆë‹¤.

ì•„ë¿”ì‹¸! Memory access violationì´ ë°œìƒí•˜ë©´ì„œ ì ‘ê·¼ì´ ì•ˆ ë©ë‹ˆë‹¤...ë¬´ìŠ¨ ë¬¸ì œì¼ê¹Œìš”?

![](https://image.toast.com/aaaadh/real/2023/techblog/07%285%29.png)

ëŸ°íƒ€ì„ ì‹œì— Seciton Headerë„ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ì ‘ê·¼í•˜ì˜€ëŠ”ë°, ì°¾ì•„ë³´ë‹ˆ Section HeaderëŠ” ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤(ì¶œì²˜: [<FontIcon icon="fa-brands fa-stack-overflow"/>https://stackoverflow.com/a/44854052](https://stackoverflow.com/a/44854052)).

ë‚œê°í•˜ë„¤ìš”. Section Header ì— `.rela.plt` ë“± ì„¹ì…˜ ìœ„ì¹˜ê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ë°, ì´ê²Œ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì–´ë–»ê²Œ ìœ„ì¹˜ë¥¼ ì•Œì•„ë‚´ê³  íŒŒì‹±ì„ í•  ìˆ˜ ìˆì„ê¹Œìš”? ë‹¤í–‰íˆ Program HeaderëŠ” ë©”ëª¨ë¦¬ì— ë¡œë“œê°€ ë©ë‹ˆë‹¤.

![ì´ Program Headerì—ëŠ” `.dynamic` ì„¹ì…˜ì˜ ìœ„ì¹˜ ë“± ì •ë³´ê°€ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.](https://image.toast.com/aaaadh/real/2023/techblog/08%284%29.png)

![ê·¸ë¦¬ê³  ì´ `.dynamic` ì„¹ì…˜ì—ëŠ” íŒŒì‹±ì— í•„ìš”í•œ ë‹¤ë¥¸ ì„¹ì…˜ë“¤ì˜ ìœ„ì¹˜ ì •ë³´ê°€ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.](https://image.toast.com/aaaadh/real/2023/techblog/09%283%29.png)

ì´ì œ, ì„¹ì…˜ë“¤ì˜ ë©”ëª¨ë¦¬ìƒì˜ ìœ„ì¹˜ ì •ë³´ë¥¼ í™•ë³´í–ˆìœ¼ë‹ˆ íŒŒì‹±ë§Œ í•˜ë©´ ë˜ê² êµ°ìš”.

ë‹¤ìŒì€ ì–´ëŠ ê²Œì„ ì•±ì˜ `fopen` í•¨ìˆ˜ë¥¼ plt hook í•œ ë’¤, <FontIcon icon="fas fa-file-lines"/>`libil2cpp.so` íŒŒì¼ì˜ .rela.plt ì„¹ì…˜ì„ ë©”ëª¨ë¦¬ìƒì—ì„œ íŒŒì‹±í•œ ê²°ê³¼ì…ë‹ˆë‹¤. ìŒ...`fopen` í•¨ìˆ˜ì˜ ì£¼ì†Œê°€ `0x72079708e8`ì¸ë°, ê·¸ ìœ„ì¹˜ê°€ <FontIcon icon="fas fa-file-lines"/>`libplthooktest.so` íŒŒì¼ì´ë„¤ìš”. ì›ë˜ë¼ë©´ ìœ„ì¹˜ê°€ <FontIcon icon="fas fa-file-lines"/>`libc.so`ê°€ ë˜ì–´ì•¼ í•  ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ `fopen` í•¨ìˆ˜ê°€ plt hook ë‹¹í•œ ê²ƒìœ¼ë¡œ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](https://image.toast.com/aaaadh/real/2023/techblog/10%283%29.png)

íŒŒì‹±ì— ì‚¬ìš©ëœ frida ìŠ¤í¬ë¦½íŠ¸ ê³µìœ í•©ë‹ˆë‹¤.

```js
var magic = "464c457f"

function parseElf(base) {
    base = ptr(base)
    // Read elf header
    var elf_magic = base.readU32()
    if (parseInt(elf_magic).toString(16) != magic) {
        console.log("Wrong magic")
    }

    var arch = Process.arch
    var is32bit = arch == "arm" ? 1 : 0 // 1:32 0:64

    var size_of_Elf32_Ehdr = 0x34;
    var off_of_Elf32_Ehdr_phoff = 28;
    var off_of_Elf32_Ehdr_shoff = 32;
    var off_of_Elf32_Ehdr_phentsize = 42;
    var off_of_Elf32_Ehdr_phnum = 44;
    var off_of_Elf32_Ehdr_shentsize = 46;
    var off_of_Elf32_Ehdr_shnum = 48;
    var off_of_Elf32_Ehdr_shstrndx = 50;

    var size_of_Elf64_Ehdr = 0x40;
    var off_of_Elf64_Ehdr_phoff = 32;
    var off_of_Elf64_Ehdr_shoff = 40;
    var off_of_Elf64_Ehdr_phentsize = 54;
    var off_of_Elf64_Ehdr_phnum = 56;
    var off_of_Elf64_Ehdr_shentsize = 58;
    var off_of_Elf64_Ehdr_shnum = 60;
    var off_of_Elf64_Ehdr_shstrndx = 62;

    var got_plt_secition_addr = null;
    var dynamic_section_addr = null;
    var dynstr_section_addr = null;
    var dynsym_section_addr = null;
    var rela_plt_section_addr = null;

    // Parse Ehdr(Elf header)
    var phoff = is32bit ? size_of_Elf32_Ehdr : size_of_Elf64_Ehdr   // Program header table file offset
    var shoff = is32bit ? base.add(off_of_Elf32_Ehdr_shoff).readU32() : base.add(off_of_Elf64_Ehdr_shoff).readU64();   // Section header table file offset
    var phentsize = is32bit ? base.add(off_of_Elf32_Ehdr_phentsize).readU16() : base.add(off_of_Elf64_Ehdr_phentsize).readU16();    // Size of entries in the program header table
    if (is32bit && phentsize != 32) {  // 0x20
        console.log("[*] Wrong e_phentsize. Should be 32. Let's assume it's 32");
        phentsize = 32;
    } else if (!is32bit && phentsize != 56) {
        console.log("Wrong e_phentsize. Should be 56. Let's assume it's 56");
        phentsize = 56;
    }
    var phnum = is32bit ? base.add(off_of_Elf32_Ehdr_phnum).readU16() : base.add(off_of_Elf64_Ehdr_phnum).readU16();    // Number of entries in program header table
    if (phnum == 0) {
        console.log("phnum is 0. Let's assume it's 10. because we just need to find .dynamic section")
        phnum = 10;
    }
    var shentsize = is32bit ? base.add(off_of_Elf32_Ehdr_shentsize).readU16() : base.add(off_of_Elf64_Ehdr_shentsize).readU16();    // Size of the section header
    if (is32bit && shentsize != 40) {  // 0x28
        console.log("Wrong e_shentsize. Should be 40");
    } else if (!is32bit && shentsize != 64) {
        console.log("Wrong e_shentsize. Should be 64");
    }
    var shnum = is32bit ? base.add(off_of_Elf32_Ehdr_shnum).readU16() : base.add(off_of_Elf64_Ehdr_shnum).readU16();    // Number of entries in section header table
    var shstrndx = is32bit ? base.add(off_of_Elf32_Ehdr_shstrndx).readU16() : base.add(off_of_Elf64_Ehdr_shstrndx).readU16();  // Section header table index of the entry associated with the section name string table
    // console.log(`phoff: ${phoff}, shoff: ${shoff}, phentsize: ${phentsize}, phnum: ${phnum}, shentsize: ${shentsize}, shnum: ${shnum}, shstrndx: ${shstrndx}`)

    // Parse Phdr(Program header)
    var phdrs = base.add(phoff)
    for (var i = 0; i < phnum; i++) {
        var phdr = phdrs.add(i * phentsize);
        var p_type = phdr.readU32()
        var p_offset = is32bit ? phdr.add(0x4).readU32() : phdr.add(0x8).readU64();
        var p_vaddr = is32bit ? phdr.add(0x8).readU32() : phdr.add(0x10).readU64();
        var p_paddr = is32bit ? phdr.add(0xc).readU32() : phdr.add(0x18).readU64();
        var p_filesz = is32bit ? phdr.add(0x10).readU32() : phdr.add(0x20).readU64();
        var p_memsz = is32bit ? phdr.add(0x14).readU32() : phdr.add(0x28).readU64();
        var p_flags = is32bit ? phdr.add(0x18).readU32() : phdr.add(0x4).readU32();
        var p_align = is32bit ? phdr.add(0x1c).readU32() : phdr.add(0x30).readU64();
        // console.log(`p_type: ${p_type}, p_offset: ${p_offset}, p_vaddr: ${p_vaddr}, p_paddr: ${p_paddr}, p_filesz: ${p_filesz}, p_memsz: ${p_memsz}, p_flags: ${p_flags}, p_align: ${p_align}`);

        if (p_type == 0x2) {
            // .dynamic
            dynamic_section_addr = base.add(p_vaddr);
            var dynamic_section_indices = parseInt(p_memsz) / parseInt(p_align) * 2
            var dynamic_section_entsize = p_align * 2
            for (var i = 0; i < dynamic_section_indices; i++) {
                var d_tag = is32bit ? dynamic_section_addr.add(i * dynamic_section_entsize).readU32() : dynamic_section_addr.add(i * dynamic_section_entsize).readU64()
                if (d_tag == 0) break;
                var d_value = is32bit ? dynamic_section_addr.add(i * dynamic_section_entsize + 4).readU32() : dynamic_section_addr.add(i * dynamic_section_entsize + 8).readU64()

                if (d_tag == 0x3) {
                    // .got.plt
                    got_plt_secition_addr = base.add(d_value);
                } else if (d_tag == 0x5) {
                    // .dynstr
                    dynstr_section_addr = base.add(d_value);
                } else if (d_tag == 0x6) {
                    // .dynsym
                    dynsym_section_addr = base.add(d_value);
                } else if (d_tag == 0x17) {
                    // .rela.plt
                    rela_plt_section_addr = base.add(d_value);
                }
            }
        }
    }

    // Parse .dynsym
    var dynsym_section_entsize = is32bit ? 0x10 : 0x18;
    var dynsyms = {};
    var st_infos = [
        0x00,   // LOCAL NOTYPE
        0x03,   // LOCAL SECTION
        0x10,   // GLOBAL NOTYPE
        0x11,   // GLOBAL OBJECT
        0x12,   // GLOBAL FUNC
        0x1a,   // GLOBAL LOOS
        0x20,   // WEAK NOTYPE
        0x21,   // WEAK OBJECT
        0x22,   // WEAK FUNC
    ]
    var st_others = [
        0x0,        /* STV_DEFAULT. Default symbol visibility rules */
        0x1,        /* STV_INTERNAL. Processor specific hidden class */
        0x2,        /* STV_HIDDEN. Sym unavailable in other modules */
        0x3,        /* STV_PROTECTED. Not preemptible, not exported */
    ]
    for (var i = 0, id = 0;;i += dynsym_section_entsize, id++) {
        var dynsym_section_entaddr = dynsym_section_addr.add(i)
        var st_name = is32bit ? dynsym_section_entaddr.readU32() : dynsym_section_entaddr.readU32();
        var st_value = is32bit ? dynsym_section_entaddr.add(0x4).readU32() : dynsym_section_entaddr.add(0x8).readU64();
        var st_size = is32bit ? dynsym_section_entaddr.add(0x8).readU32() : dynsym_section_entaddr.add(0x10).readU64();
        var st_info = is32bit ? dynsym_section_entaddr.add(0xc).readU8() : dynsym_section_entaddr.add(0x4).readU8();
        if (!st_infos.includes(st_info)) {
            console.log(`st_info: ${st_info} is not a valid`)
            break;
        }
        var st_other = is32bit ? dynsym_section_entaddr.add(0xd).readU8() : dynsym_section_entaddr.add(0x5).readU8();
        if (!st_others.includes(st_other)) {
            console.log(`st_ohter: ${st_other} is not a valid`)
            break;
        }
        var st_shndx = is32bit ? dynsym_section_entaddr.add(0xe).readU16() : dynsym_section_entaddr.add(0x6).readU16();
        try {
            var symbol_name = dynstr_section_addr.add(st_name).readUtf8String();
        } catch (error) {
            break;
        }
        dynsyms[id] = {
            "symbol_name": symbol_name, 
            "st_value": st_value, 
            "st_size": st_size, 
            "st_info": st_info, 
            "st_other": st_other, 
            "st_shndx": st_shndx
        }
        // console.log(`${id}. st_name: ${st_name} --> ${symbol_name}, st_value: ${st_value}, st_size: ${st_size}, st_info: ${st_info}, st_other: ${st_other}, st_shndx: ${st_shndx}`)
    }

    // Parse .rela.plt
    var rela_plt_section_entsize = is32bit ? 0x8 : 0x18
    var R_ARM_JUMP_SLOT = 0x16  /* Create PLT entry */
    var R_AARCH64_JUMP_SLOT = 0x402
    for (var i = 0, id = 0;;i += rela_plt_section_entsize, id++) {
        var rela_plt_section_entaddr = rela_plt_section_addr.add(i);
        var r_offset = is32bit ? rela_plt_section_entaddr.readU32() : rela_plt_section_entaddr.readU64();
        var r_info_addr = is32bit ? rela_plt_section_entaddr.add(0x4) : rela_plt_section_entaddr.add(0x8);
        var reloc_type = is32bit ? r_info_addr.readU8() : r_info_addr.readU32();
        if ((is32bit && reloc_type != R_ARM_JUMP_SLOT) || (!is32bit && reloc_type != R_AARCH64_JUMP_SLOT)) {
            break;
        }

        var sym_index = is32bit ? r_info_addr.readU32() > 8 : r_info_addr.add(0x4).readU32();
        var symptr_in_got_plt = base.add(r_offset).readPointer();
        var r_addend = rela_plt_section_entaddr.add(0x10).readU64();
        var location = Process.findModuleByAddress(symptr_in_got_plt) === null ? 'None' : Process.findModuleByAddress(symptr_in_got_plt).name
        console.log(`${id}. symbol: ${dynsyms[sym_index]["symbol_name"]} --> addr: ${symptr_in_got_plt}(${location})`)
    }
}

parseElf(Module.findBaseAddress("libil2cpp.so"))
```

ê¸´ ê¸€ì„ ì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

---

## ì°¸ê³  ë¬¸í—Œ

```component VPCard
{
  "title": "elf.h source code [glibc/elf/elf.h] - Codebrowser ",
  "desc": "Browse the source of glibc glibc-2 using KDAB Codebrowser which provides IDE like features for browsing C, C++, Rust & Dart code in your browser",
  "link": "https://codebrowser.dev/glibc/glibc/elf/elf.h.html",
  "logo": "https://codebrowser.dev/img/favico.svg",
  "background": "rgba(0,119,200,0.2)"
}
```

```component VPCard
{
  "title": "bytedance/bhook",
  "desc": "ğŸ”¥ ByteHook is an Android PLT hook library which supports armeabi-v7a, arm64-v8a, x86 and x86_64.",
  "link": "https://github.com/bytedance/bhook",
  "logo": "https://avatars.githubusercontent.com/u/4158466?s=200&v=4",
  "background": "rgba(13,16,20,0.2)"
}
```

```component VPCard
{
  "title": "personal_script/Frida_script/android_hook_detect.js at master Â· lich4/personal_script Â· GitHub",
  "desc": "Scripts useful for Vulnerability Exploit, Static Analysis, Dynamic Analysis, File Format Exploit, ...",
  "link": "https://github.com/lich4/personal_script/blob/master/Frida_script/android_hook_detect.js",
  "logo": "https://avatars.githubusercontent.com/u/8621719?v=4",
  "background": "rgba(13,16,20,0.2)"
}
```

```component VPCard
{
  "title": "horsicq/XELFViewer",
  "desc": "ELF file viewer/editor for Windows, Linux and MacOS.",
  "link": "https://github.com/horsicq/XELFViewer",
  "logo": "https://avatars.githubusercontent.com/u/7762949?v=4",
  "background": "rgba(13,16,20,0.2)"  
}
```

```component VPCard
{
  "title": "linux - Reading ELF header of loaded shared object during runtime - Stack Overflow",
  "desc": "I wrote some code to search for a symbol in a shared library's ELF header. The code works if I parse the shared object file stored on my disk. Now, I wanted to use this code to parse the ELF heade...",
  "link": "https://stackoverflow.com/a/44854052",
  "logo": "https://cdn.sstatic.net/Sites/stackoverflow/Img/favicon.ico?v=ec617d715196",
  "background": "rgba(244,128,36,0.2)"
}
```

---

<TagLinks />