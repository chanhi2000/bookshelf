<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"외부 툴 변경에 휘둘리지 않는 서버 코드 작성기","image":["https://static.blog.gangnamunni.com/files/6b/6b00eb04-f97a-4a9b-91fd-a614cd9848c6.jpeg","https://static.blog.gangnamunni.com/files/7c/7ce08538-ccd9-42cd-a0f2-5a0b84b05722.jpeg","https://static.blog.gangnamunni.com/files/49/49a4f475-7900-426f-ba95-815eea85d748.jpeg","https://static.blog.gangnamunni.com/files/47/47ed87a6-1b48-4bd8-aaa0-8e5ad2e5ec31.jpeg","https://static.blog.gangnamunni.com/files/ca/ca805f0e-7109-40f4-a06d-20e096449a7b.jpeg","https://static.blog.gangnamunni.com/files/03/03cb5c62-583e-4329-9913-89c3f88df09f.jpeg","https://static.blog.gangnamunni.com/files/ae/ae446bf5-fa3c-4f4b-88fe-cbe26f92eef9.jpeg","https://static.blog.gangnamunni.com/files/7f/7f60f345-feaa-4953-9d30-95d709f45425.jpeg","https://static.blog.gangnamunni.com/files/3e/3ea1a9bd-976b-49f6-b198-9094861fa5a8.jpeg"],"datePublished":"2021-08-19T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="외부 툴 변경에 휘둘리지 않는 서버 코드 작성기"><meta property="og:description" content="Article(s) > 외부 툴 변경에 휘둘리지 않는 서버 코드 작성기"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.gangnamunni.com/_nuxt/img/ae65a45.jpg"><meta property="og:locale" content="ko-KR"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://blog.gangnamunni.com/_nuxt/img/ae65a45.jpg"><meta name="twitter:image:alt" content="외부 툴 변경에 휘둘리지 않는 서버 코드 작성기"><meta property="article:tag" content="dependency-inversion-principle"><meta property="article:tag" content="dependency-inversion"><meta property="article:tag" content="dip"><meta property="article:tag" content="spring"><meta property="article:tag" content="java"><meta property="article:tag" content="blog.gangnamunni.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2021-08-19T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>외부 툴 변경에 휘둘리지 않는 서버 코드 작성기 | 📚Bookshelf</title><meta name="description" content="Article(s) > 외부 툴 변경에 휘둘리지 않는 서버 코드 작성기">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">blog.gangnamunni.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/privacy-changes-in-android-q-1.html" aria-label="Privacy Changes in Android Q#1"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Privacy Changes in Android Q#1<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/privacy-changes-in-android-q-2.html" aria-label="Privacy Changes in Android Q#2"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->Privacy Changes in Android Q#2<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/swiftui-combine-quick-look.html" aria-label="SwiftUI + Combine 핥아보기"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->SwiftUI + Combine 핥아보기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/coroutine-basic.html" aria-label="Coroutine Basic"><!--[--><i class="vp-icon iconfont icon-kotlin" sizing="both"></i><!--]-->Coroutine Basic<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/arrays-arraylist-arraylist.html" aria-label="날 닮은 너를, 부족한 너를."><!--[--><i class="vp-icon fa-brands fa-java" sizing="both"></i><!--]-->날 닮은 너를, 부족한 너를.<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/spring-async-hibernate-db.html" aria-label="여러개의 DB 작업을 동시에 수행하고 결과를 합쳐서 보내줘야 할 때"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->여러개의 DB 작업을 동시에 수행하고 결과를 합쳐서 보내줘야 할 때<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/motionlayout.html" aria-label="안드로이드 MotionLayout"><!--[--><i class="vp-icon fa-brands fa-android" sizing="both"></i><!--]-->안드로이드 MotionLayout<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html" aria-label="외부 툴 변경에 휘둘리지 않는 서버 코드 작성기"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->외부 툴 변경에 휘둘리지 않는 서버 코드 작성기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/blog.gangnamunni.com/saas-event-sourcing.html" aria-label="[SaaS] 시간여행이 가능한 시스템 아키텍처"><!--[--><i class="vp-icon iconfont icon-spring" sizing="both"></i><!--]-->[SaaS] 시간여행이 가능한 시스템 아키텍처<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://blog.gangnamunni.com/_nuxt/img/ae65a45.jpg" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-spring" sizing="height"></i>외부 툴 변경에 휘둘리지 않는 서버 코드 작성기</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">21. 8. 19.</span><meta property="datePublished" content="2021-08-19T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 3 min</span><meta property="timeRequired" content="PT3M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8" role>Java</span><span class="page-category-item color1" role>Spring</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Java,Spring,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color8" role>blog.gangnamunni.com</span><span class="page-tag-item color8" role>java</span><span class="page-tag-item color8" role>spring</span><span class="page-tag-item color6" role>dip</span><span class="page-tag-item color0" role>dependency-inversion</span><span class="page-tag-item color0" role>dependency-inversion-principle</span><!--]--><meta property="keywords" content="blog,blog.gangnamunni.com,java,spring,dip,dependency-inversion,dependency-inversion-principle"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>외부 툴 변경에 휘둘리지 않는 서버 코드 작성기 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/java-spring/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Spring > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#backgrounds" class="router-link-active router-link-exact-active">Backgrounds</a><ul><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#braze" class="router-link-active router-link-exact-active">Braze</a></li><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#강남언니-api-서버" class="router-link-active router-link-exact-active">강남언니 API 서버</a></li></ul></li><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#design" class="router-link-active router-link-exact-active">Design</a><ul><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#design-v1" class="router-link-active router-link-exact-active">Design V1</a></li><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#design-v2" class="router-link-active router-link-exact-active">Design V2</a></li><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#design-v3-latest" class="router-link-active router-link-exact-active">Design V3(latest)</a></li></ul></li><li><a aria-current="page" href="/bookshelf/blog.gangnamunni.com/dependency-inversion-principle.html#dip-dependency-inversion-principle" class="router-link-active router-link-exact-active">DIP(Dependency Inversion Principle)</a></li></ul></nav><hr><div class="vp-site-info" data-name="외부 툴 변경에 휘둘리지 않는 서버 코드 작성기"><a class="vp-site-info-navigator no-external-link-icon" title="외부 툴 변경에 휘둘리지 않는 서버 코드 작성기" href="https://blog.gangnamunni.com/post/dependency-inversion-principle/" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://blog.gangnamunni.com/_nuxt/img/ae65a45.jpg) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://blog.gangnamunni.com/favicon.ico" alt loading="lazy" no-view><div class="vp-site-info-name">외부 툴 변경에 휘둘리지 않는 서버 코드 작성기</div><div class="vp-site-info-desc">사례로 보는, DIP를 이용한 외부 툴에 의존하지 않는 도메인 모델 설계</div></div><!----></div><p>안녕하세요. 강남언니 백엔드 개발자 Joon입니다. 저는 강남언니 유저들에게 더 많은 가치를 지속적으로 전달할 수 있는 구조, 즉 지속 성장이 가능한 구조에 관심을 가지고 있습니다. 최근 제가 경험한 지속 성장 가능한 소프트웨어 구조 설계 경험을 공유하고자 글을 씁니다.</p><p><strong>지속 성장이 가능한 구조</strong>란 무엇일까요? 우리가 개발하는 소프트웨어는 변경이 매우 잦습니다. 요구 사항이 바뀔 때마다 코드에 큰 변경이 필요한 소프트웨어는 지속 성장이 어려울 겁니다. 즉, <strong>여러 요구 사항 변경에도 쉽게 적응할 수 있는 구조</strong>가 지속 성장 가능한 구조일 것입니다.</p><p>최근 강남언니에서는 <a href="https://braze.com/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Braze</a>라는 외부 툴을 도입할 니즈가 생겼습니다. 외부 툴은 내부 도메인에 비해 훨씬 더 변경될 가능성이 높고, 그 변경점을 예측하기도 어렵습니다. 심지어는 아예 다른 외부 툴을 사용하겠다는 의사 결정이 있을 수도 있습니다. 그래서 Braze 관련 변경점이 생기더라도 내부 핵심 도메인 모델은 영향 받지 않도록 설계해야 했습니다. 즉, 내부 도메인 모델이 외부 툴 관련 코드에 의존하지 않도록 하는데 집중했습니다.</p><p>작업 중 여러 번의 설계 수정이 있었고, 각 설계 단계에서 지속 성장 가능한 구조를 만들기 위해 어떤 고민을 했는지를 소개하겠습니다. 지속 성장이 가능한 구조를 만들기 위해서는 신경 쓸 것이 매우 많을 텐데, 이 글에서는 그 중에서도 외부 툴에 의존하지 않는 내부 도메인 모델을 만드는 것에 집중하려 합니다.</p><hr><h2 id="backgrounds" tabindex="-1"><a class="header-anchor" href="#backgrounds"><span>Backgrounds</span></a></h2><p>각 설계 단계를 살펴 보기에 앞서 작업 배경을 먼저 소개하겠습니다. Braze란 무엇이고 왜 도입하려고 하는지, 어떤 요구 사항이 있었는지, 강남언니 API 서버는 어떤 상태인지를 확인하겠습니다.</p><h3 id="braze" tabindex="-1"><a class="header-anchor" href="#braze"><span>Braze</span></a></h3><p>강남언니에서는 상담 신청이 완료되었다는 알림, 게시글에 답글이 달렸다는 알림, 이벤트 광고 등 다양한 정보를 이메일, SMS, 푸시 등을 이용해 유저에게 발송하고 있습니다. 기존에는 이러한 앱 외부 정보 전달을 강남언니 서비스 내에서 자체적으로 처리하고 있었으나, 유저들이 원하는 컨텐츠를 더 쉽게 제공하기 위해 Braze라는 외부 툴을 이용하게 되었습니다.</p><p>Braze를 이용하면 보톡스 이벤트를 많이 찾아 본 유저들에게 최근 일주일 동안 가장 많은 유저가 확인한 보톡스 이벤트를 푸시로 발송하는 등, 유저들의 관심사에 맞는 컨텐츠를 쉽게 제공할 수 있습니다.</p><h4 id="braze-도입-관련-요구사항" tabindex="-1"><a class="header-anchor" href="#braze-도입-관련-요구사항"><span>Braze 도입 관련 요구사항</span></a></h4><p>Braze 도입과 관련해서 두 가지 주요 요구 사항이 있었습니다.</p><h5 id="유저의-정보-수신-동의-여부를-braze에-동기화-할-것" tabindex="-1"><a class="header-anchor" href="#유저의-정보-수신-동의-여부를-braze에-동기화-할-것"><span>유저의 정보 수신 동의 여부를 Braze에 동기화 할 것.</span></a></h5><p>Braze를 이용해 유저들에게 정보를 발송하기 위해서는 유저들이 정보 수신에 동의하는지를 확인해야 합니다. 따라서 Braze에 각 유저의 정보 수신 동의 여부를 최신 버전으로 저장해야 합니다. 서버 단에서 필요한 작업은 유저의 아래 세 가지 정보 수신 동의 여부가 수정되면 이를 Braze에도 동기화하는 것입니다.</p><ul><li>광고성 푸시 수신 동의 여부</li><li>SMS 수신 동의 여부</li><li>Email 수신 동의 여부</li></ul><h5 id="braze-과금-정책에-따라-비용을-최소화-할-것" tabindex="-1"><a class="header-anchor" href="#braze-과금-정책에-따라-비용을-최소화-할-것"><span>Braze 과금 정책에 따라 비용을 최소화 할 것.</span></a></h5><p>Braze는 업데이트가 요청된 필드 수에 비례해 과금하는 정책을 가지고 있습니다. 실제 업데이트가 발생하는 필드 수가 아닌 업데이트가 요청된 필드 수에 비례해 비용이 발생하므로, 정말 업데이트가 필요한 필드만 골라내어 Braze에 업데이트를 요청해야 합니다.</p><h3 id="강남언니-api-서버" tabindex="-1"><a class="header-anchor" href="#강남언니-api-서버"><span>강남언니 API 서버</span></a></h3><p>강남언니 백엔드에는 구 API 서버(이하 구서버)와 신 API 서버(이하 신서버)가 동시에 동작하고 있습니다. 현재 새로 만들어지는 도메인 모델은 신서버에 작성하고 있으며, 유저와 같이 오래된 도메인 모델은 구서버에 작성되어 있습니다.</p><p>Braze 활용에 필요한 유저 관련 코드는 구서버에 작성되어 있고, Braze와 관련해서 새로 작성하는 코드들은 신서버에 작성된다는 점에 주목해 주세요.</p><hr><h2 id="design" tabindex="-1"><a class="header-anchor" href="#design"><span>Design</span></a></h2><p>이제 각 설계 단계를 살펴 보겠습니다. 설계에는 크게 두 번의 변경이 있었습니다. 각 단계를 Design V1 ~ V3로 라벨링, 아래 내용들을 각 단계별로 서술하겠습니다.</p><ul><li>어떻게 동작하는가?</li><li>왜 이렇게 설계했는가?</li><li>지속 성장이 가능한 구조인가?</li></ul><p>각 단계별 다이어그램은 데이터 흐름, 혹은 프로그램 컨트롤의 흐름을 표현한 것으로, &#39;어떻게 동작하는가?&#39;와 함께 보시는 것을 권장 드립니다.</p><h3 id="design-v1" tabindex="-1"><a class="header-anchor" href="#design-v1"><span>Design V1</span></a></h3><figure><img src="https://static.blog.gangnamunni.com/files/6b/6b00eb04-f97a-4a9b-91fd-a614cd9848c6.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Braze에 동기화할 유저의 정보들은 구서버에 있으며, 구서버 API 동작 중에 값이 변경됩니다. 예를 들면, 유저가 회원 정보를 수정하면 구서버에 있는 회원 정보 수정 API가 호출될 것입니다. 이 때 유저의 정보 수신 동의 여부가 변경되면 신서버에 있는 Braze 관련 코드가 동작, Braze에 정보 수신 동의 여부를 수정하도록 요청해야 합니다.</p><h4 id="어떻게-동작하는가" tabindex="-1"><a class="header-anchor" href="#어떻게-동작하는가"><span>어떻게 동작하는가?</span></a></h4><ol><li>구서버에서 유저의 정보 수신 동의 여부가 변경되면 Internal Event를 발행합니다.</li><li>Event Handler가 Internal Event를 수신, AWS SNS로 메시지를 전달합니다.</li><li>SNS를 구독하고 있는 SQS로 메시지가 적재됩니다.</li><li>신서버의 SQS Listener가 메시지를 수신, Braze API caller method를 호출합니다.</li><li>Braze API caller가 Braze API를 호출해 유저의 정보 수신 동의 여부를 업데이트합니다.</li></ol><h4 id="왜-이렇게-설계했는가" tabindex="-1"><a class="header-anchor" href="#왜-이렇게-설계했는가"><span>왜 이렇게 설계했는가?</span></a></h4><p>Design V1에서 집중한 부분은 아래와 같습니다.</p><h5 id="_1-구서버의-동작이-신서버와-braze의-통신에-영향을-받지-않도록-하기-위해-구서버와-신서버의-통신을-비동기로-합니다" tabindex="-1"><a class="header-anchor" href="#_1-구서버의-동작이-신서버와-braze의-통신에-영향을-받지-않도록-하기-위해-구서버와-신서버의-통신을-비동기로-합니다"><span>1. 구서버의 동작이 신서버와 Braze의 통신에 영향을 받지 않도록 하기 위해, 구서버와 신서버의 통신을 비동기로 합니다.</span></a></h5><p>만약 구서버와 신서버의 통신이 비동기 방식이 아니라면, 신서버와 Braze의 통신 중 문제가 발생하거나 Braze가 신서버로 반환하는 응답이 지연되는 경우 구서버의 회원 정보 수정 API도 영향을 받습니다. 여러 가지 방법 중 Amazon AWS SQS를 사용해 구서버와 신서버의 통신을 비동기로 만들었습니다.</p><h5 id="_2-braze-비용을-최소화하기-위해-각-정보-수신-동의-여부-변경을-따로-트래킹합니다" tabindex="-1"><a class="header-anchor" href="#_2-braze-비용을-최소화하기-위해-각-정보-수신-동의-여부-변경을-따로-트래킹합니다"><span>2. Braze 비용을 최소화하기 위해 각 정보 수신 동의 여부 변경을 따로 트래킹합니다.</span></a></h5><p>정말 변경이 발생한 정보 수신 동의 여부 필드만 Braze에 동기화하기 위해, 각 정보 수신 동의 필드마다 SQS를 하나씩 운영합니다.</p><h4 id="지속-성장이-가능한-구조인가" tabindex="-1"><a class="header-anchor" href="#지속-성장이-가능한-구조인가"><span>지속 성장이 가능한 구조인가?</span></a></h4><p>Design V1은 지속 성장이 가능하지 않은 구조입니다.</p><h5 id="_1-언뜻-보면-구서버는-braze-컨텍스트와-완전히-분리되어-있는-것처럼-보이지만-사실은-그렇지-않습니다" tabindex="-1"><a class="header-anchor" href="#_1-언뜻-보면-구서버는-braze-컨텍스트와-완전히-분리되어-있는-것처럼-보이지만-사실은-그렇지-않습니다"><span>1. 언뜻 보면 구서버는 Braze 컨텍스트와 완전히 분리되어 있는 것처럼 보이지만, 사실은 그렇지 않습니다.</span></a></h5><p>Update 필드 수 비례 과금 체계는 Braze-specific합니다. 즉, 비용 최적화를 위해 필드별로 SQS를 두고 각 SQS에 메시지를 나누어 발행하는 것은 Braze 컨텍스트에 영향 받은 설계입니다. Braze가 아닌 다른 툴을 사용하게 되면 구서버까지 수정해야 할 가능성이 높습니다.</p><h5 id="_2-신서버에-생성한-module-braze-module-이-충분히-작은-단위로-구성되지-않았습니다" tabindex="-1"><a class="header-anchor" href="#_2-신서버에-생성한-module-braze-module-이-충분히-작은-단위로-구성되지-않았습니다"><span>2. 신서버에 생성한 module(<code>braze module</code>)이 충분히 작은 단위로 구성되지 않았습니다.</span></a></h5><p>SQS Listener는 외부로부터 온 요청을 받아내는 인터페이스입니다. 유저의 정보 수신 동의 여부가 변경되면 Braze에 이를 알리는 것은 비즈니스 로직입니다. 현재 아예 다른 역할을 하는 두 객체가 한 layer에 뭉쳐 있어, Braze 관련 변경점이 생기면 <code>braze module</code>을 통째로 수정해야 합니다.</p><h3 id="design-v2" tabindex="-1"><a class="header-anchor" href="#design-v2"><span>Design V2</span></a></h3><figure><img src="https://static.blog.gangnamunni.com/files/7c/7ce08538-ccd9-42cd-a0f2-5a0b84b05722.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Design V1의 문제점을 수정하여 Design V2를 만듭니다.</p><h4 id="어떻게-동작하는가-1" tabindex="-1"><a class="header-anchor" href="#어떻게-동작하는가-1"><span>어떻게 동작하는가?</span></a></h4><ol><li>구서버에서 유저의 정보 수신 동의 여부가 변경되면 Internal Event를 발행합니다.</li><li>Event Handler가 Internal Event를 수신, AWS SNS로 메시지를 전달합니다.</li><li>SNS를 구독하고 있는 SQS로 메시지가 적재됩니다.</li><li>SQS를 구독하고 있는 SQS Listener가 메시지를 수신, Logic(service)에 전달합니다.</li><li>Logic이 실제 변경이 발생한 필드를 구별, 해당 필드를 업데이트하는 Braze API caller method를 호출합니다.</li><li>Braze API caller가 Braze API를 호출해 유저의 정보 수신 동의 여부를 업데이트합니다.</li></ol><h4 id="왜-이렇게-설계했는가-1" tabindex="-1"><a class="header-anchor" href="#왜-이렇게-설계했는가-1"><span>왜 이렇게 설계했는가?</span></a></h4><p>Design V1의 문제를 어떻게 해결했는지 확인하겠습니다.</p><blockquote><p>언뜻 보면 구서버는 Braze 컨텍스트와 완전히 분리되어 있는 것처럼 보이지만, 사실은 그렇지 않습니다.</p><p>Update 필드 수 비례 과금 체계는 Braze-specific합니다. 즉, 최적화를 위해 필드별로 SQS를 두고 각 SQS에 SNS를 나누어 발행하는 것은 Braze에 영향 받은 설계입니다. Braze가 아닌 다른 툴을 사용하게 되면 수정해야 할 가능성이 높습니다.</p></blockquote><p>구서버에서 Braze 컨텍스트를 떼어 내기 위해 유저의 정보 수신 동의 여부 변경 SNS를 구독하는 SQS를 하나로 두고, 어떤 정보 수신 동의 여부가 변경되더라도 Internal Event Handler가 Braze 컨텍스트에 독립된 하나의 메시지를 SNS에 전달하도록 합니다.</p><p>정말 업데이트가 필요한 정보 수신 동의 여부 필드를 구별하는 코드는 신서버에 작성되어, 구서버에는 더 이상 Braze 컨텍스트가 존재하지 않습니다. Braze가 아닌 다른 툴을 사용하더라도 유저가 정보 수신에 동의하는지 여부는 트래킹해야 할 것이므로, 다른 툴을 사용하게 되었을 때 구서버에 있는 코드는 변경될 가능성이 낮습니다.</p><blockquote><p>신서버에 생성한 module(<code>braze module</code>)이 충분히 작은 단위로 구성되지 않았습니다.</p><p>SQS Listener는 외부로부터 온 요청을 받아내는 인터페이스입니다. 유저의 정보 수신 동의 여부가 변경되면 Braze에 이를 알리는 것은 비즈니스 로직입니다. 현재 아예 다른 역할을 하는 두 객체가 한 layer에 뭉쳐 있어, Braze 관련 변경점이 생기면 <code>braze module</code>을 통째로 수정해야 합니다.</p></blockquote><p>신서버의 module도 역할에 따라 더 세분화합니다. 외부와의 인터페이스 역할을 하는 SQS Listener를 <code>api module</code>에, 실제 업데이트가 발생해 Braze에 notify 해야 할 필드가 무엇인지를 구별하는 로직을 <code>logic module</code>에, Braze와 통신하는 부분을 <code>braze module</code>에 둡니다.</p><h4 id="지속-성장이-가능한-구조인가-1" tabindex="-1"><a class="header-anchor" href="#지속-성장이-가능한-구조인가-1"><span>지속 성장이 가능한 구조인가?</span></a></h4><p>Design V2 역시 지속 성장이 가능하지 않은 구조입니다.</p><h5 id="_1-여전히-신서버에-생성한-module들은-요구-사항-변경에-약한-구조입니다" tabindex="-1"><a class="header-anchor" href="#_1-여전히-신서버에-생성한-module들은-요구-사항-변경에-약한-구조입니다"><span>1. 여전히 신서버에 생성한 module들은 요구 사항 변경에 약한 구조입니다.</span></a></h5><p>앞서 말씀드렸듯이 Braze와 같은 외부 툴 관련 코드는 내부 도메인 모델에 비해 변경될 가능성이 높습니다. Braze 대신 다른 외부 툴을 사용하겠다는 비즈니스 의사 결정은 유저, 계정 등 내부 도메인 모델을 새로 만들어야 한다는 의사 결정보다 더 일어남직 합니다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsentLogic</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BrazeMemberConsentNotifier</span> notifier<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MemberConsentLogic</span><span class="token punctuation">(</span><span class="token class-name">BrazeMemberConsentNotifier</span> notifier<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>notifier <span class="token operator">=</span> notifier<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">MemberConsents</span> memberConsents<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeAdvtsPush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            notifier<span class="token punctuation">.</span><span class="token function">notifyAgreeAdvtsPush</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeAdvtsPush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            notifier<span class="token punctuation">.</span><span class="token function">notifyAgreeSms</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            notifier<span class="token punctuation">.</span><span class="token function">notifyAgreeEmail</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>현재는 Logic이 Braze Notifier에 의존하고 있는데, 따라서 Braze 대신 다른 외부 툴을 사용하게 되면 Logic을 수정해야 합니다. 즉, <code>logic module</code>이 수정되어야 합니다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsentLogic</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AnotherToolNotifier</span> notifier<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MemberConsentLogic</span><span class="token punctuation">(</span><span class="token class-name">AnotherToolNotifier</span> notifier<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>notifier <span class="token operator">=</span> notifier<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">MemberConsents</span> memberConsents<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>위와 같이 로직을 재작성해야 할 가능성이 높습니다.</p><h3 id="design-v3-latest" tabindex="-1"><a class="header-anchor" href="#design-v3-latest"><span>Design V3(latest)</span></a></h3><figure><img src="https://static.blog.gangnamunni.com/files/49/49a4f475-7900-426f-ba95-815eea85d748.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Design V2의 문제점을 수정하여 Design V3를 만듭니다.</p><h4 id="어떻게-동작하는가-2" tabindex="-1"><a class="header-anchor" href="#어떻게-동작하는가-2"><span>어떻게 동작하는가?</span></a></h4><ol><li>구서버에서 유저의 정보 수신 동의 여부가 변경되면 Internal Event를 발행합니다.</li><li>Event Handler가 Internal Event를 수신, AWS SNS로 메시지를 전달합니다.</li><li>SNS를 구독하고 있는 SQS로 메시지가 적재됩니다.</li><li>SQS를 구독하고 있는 SQS Listener가 메시지를 수신, Logic(service)에 전달합니다.</li><li>Logic은 Notifier interface method를 호출합니다.</li><li>Notifier interface를 구현하는 Braze Notifier가 메시지를 수신, 실제로 변경이 일어난 필드를 구별해 Braze에 유저의 정보 수신 동의 여부를 업데이트합니다.</li></ol><h4 id="왜-이렇게-설계했는가-2" tabindex="-1"><a class="header-anchor" href="#왜-이렇게-설계했는가-2"><span>왜 이렇게 설계했는가?</span></a></h4><p>Design V2의 문제점을 다시 한 번 살펴 보겠습니다.</p><blockquote><p>현재는 <code>logic module</code>이 <code>braze module</code>에 의존하고 있는데, 따라서 Braze 대신 다른 외부 툴을 사용하게 되면 <code>logic module</code>이 수정되어야 합니다.</p><p>... 로직을 재작성해야 할 가능성이 높습니다.</p></blockquote><p>Braze 대신 다른 외부 툴을 사용하게 되었을 때 <code>braze module</code>뿐만 아니라 <code>logic module</code>에도 변경이 생기게 되는 것이 문제인데, 이는 <code>logic module</code>이 <code>braze module</code>에 의존하기 때문입니다.</p><p><code>logic module</code>이 의존하는 대상이 Braze-specific하기 때문에 Braze를 사용하지 않게 되면 <code>logic module</code>이 수정되어야 하는 것인데요, 그렇다면 Braze를 사용하지 않게 되었을 때 <code>logic module</code>이 수정되지 않도록 하려면 어떻게 해야 할까요?</p><figure><img src="https://static.blog.gangnamunni.com/files/47/47ed87a6-1b48-4bd8-aaa0-8e5ad2e5ec31.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>MemberConsentLogic</code>이 어떠한 툴에 영향 받지 않는 general한, 추상적인 것에 의존하면 됩니다. 또한 그 추상적인 것을 실제로 Braze-specific하게 구현하면 됩니다. 이 때 툴이 변경되어도 <code>MemberConsentLogic</code>이 영향을 받지 않도록 하기 위해 그 추상적인 것은 <code>logic module</code> 내부에 배치하였습니다. <strong>따라서 <code>logic module</code>과 <code>braze module</code>의 dependency 방향이 반전되게 됩니다.</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Notifier</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">MemberConsents</span> memberConsents<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsentLogic</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Notifier</span> notifier<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MemberConsentLogic</span><span class="token punctuation">(</span><span class="token class-name">Notifier</span> notifier<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>notifier <span class="token operator">=</span> notifier<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">MemberConsents</span> memberConsents<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrazeMemberConsentNotifier</span> <span class="token keyword">implements</span> <span class="token class-name">Notifier</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">MemberConsents</span> memberConsents<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeAdvtsPush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">notifyAgreeAdvtsPush</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeAdvtsPush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">notifyAgreeSms</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">notifyAgreeEmail</span><span class="token punctuation">(</span>memberConsents<span class="token punctuation">.</span><span class="token function">getAgreeEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="지속-성장이-가능한-구조인가-2" tabindex="-1"><a class="header-anchor" href="#지속-성장이-가능한-구조인가-2"><span>지속 성장이 가능한 구조인가?</span></a></h4><p>Braze가 아닌 다른 툴을 사용하게 된 경우를 생각해 보겠습니다.</p><figure><img src="https://static.blog.gangnamunni.com/files/ca/ca805f0e-7109-40f4-a06d-20e096449a7b.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>이제 <code>braze module</code>과 <code>logic module</code>의 의존 관계를 끊고, 새로 생성한 모듈이 <code>logic module</code>에 의존, interface를 구현하는 새로운 notifier를 생성하면 됩니다. Braze가 아닌 다른 툴을 사용하더라도, <code>logic module</code>은 수정할 필요가 없습니다.</p><p>이제 강남언니 내부 도메인 모델에는 Braze 관련 컨텍스트가 남아있지 않습니다. 첫 설계에 비해서는 변경이 훨씬 용이한, 지속 성장이 가능한 구조가 되었습니다.</p><figure><img src="https://static.blog.gangnamunni.com/files/03/03cb5c62-583e-4329-9913-89c3f88df09f.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h2 id="dip-dependency-inversion-principle" tabindex="-1"><a class="header-anchor" href="#dip-dependency-inversion-principle"><span>DIP(Dependency Inversion Principle)</span></a></h2><p>지금까지 강남언니 서버에 새로운 외부 툴 Braze를 도입하는 과정에 어떻게 지속 성장이 가능한 구조를 만들지, 특히 어떻게 내부 도메인 모델이 외부 툴에 의존하지 않도록 할지 고민한 과정을 소개했습니다.</p><p>하지만 위에서 보여드린 설계는 새롭게 발견된 어떤 것이 아닙니다. 위 설계는 Uncle Bob(Robert C. Martin)이 소개한 개발 설계 원칙인 DIP를 적용한 사례입니다. DIP가 무엇인지, 이 글에서 소개한 강남언니의 사례에는 어떻게 DIP가 적용되었는지 간략히 보여드리고 마치겠습니다.</p><p>DIP의 정의는 아래와 같습니다.</p><div class="hint-container info"><p class="hint-container-title">DIP(Dependency Inversion Principle)</p><p>High-level module은 low-level module에 의존하지 않아야 합니다.</p><p>High-level module과 low-level module 모두 abstraction(ex. Java interface)에 의존해야 합니다.</p><p>Abstraction은 detail에 의존하지 않아야 합니다. Detail이 abstraction에 의존해야 합니다.</p></div><p>여기서 module은 Java module이 아닌 <strong>Java class</strong>로, 아래 본문에서는 high-level module 대신 high-level class, low-level module 대신 low-level class로 표기하겠습니다.</p><ul><li>High-level class는 low-level class에 의존하지 않아야 합니다.</li><li>High-level class와 low-level class 모두 abstraction(ex. Java interface)에 의존해야 합니다.</li><li>Abstraction은 detail에 의존하지 않아야 합니다. Detail이 abstraction에 의존해야 합니다.</li></ul><p>즉 위 세 가지 조건을 만족하면 DIP가 적용되는 것인데요, 위 조건들이 dependency inversion과 무슨 관계가 있을까요?</p><h4 id="inversion" tabindex="-1"><a class="header-anchor" href="#inversion"><span>Inversion?</span></a></h4><p>먼저, 역전(Inversion)이 있다는 것은 보통의 경우와 반대가 된다는 것으로 이해할 수 있습니다. 따라서 의존 관계(Dependency)에 역전(Inversion)이 있다는 것은 보통의 경우와 의존 관계가 반대가 된다는 것으로 이해할 수 있습니다.</p><figure><img src="https://static.blog.gangnamunni.com/files/ae/ae446bf5-fa3c-4f4b-88fe-cbe26f92eef9.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>일반적으로 high-level class는 low-level class에 의존합니다. 위와 같이 controller class는 service class에 의존, service class는 repository class에 의존하는 것이 일반적입니다. Design V2에서도 마찬가지로 high-level class가 low-level class에 의존하는 설계를 보여 드렸습니다.</p><figure><img src="https://static.blog.gangnamunni.com/files/7f/7f60f345-feaa-4953-9d30-95d709f45425.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>하지만 Braze 관련 변경이 <code>braze module</code>을 넘어 <code>logic module</code>까지 영향을 미치는 것을 방지하고 싶었고, 따라서 <code>MemberConsentLogic</code>이 툴에 영향을 받지 않는 추상적인 interface에 의존하도록 했습니다. 그 과정에서 <code>logic module</code>과 <code>braze module</code>의 의존 관계가 반전되었습니다.</p><figure><img src="https://static.blog.gangnamunni.com/files/3e/3ea1a9bd-976b-49f6-b198-9094861fa5a8.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>여기서 비교적 high-level class인 <code>MemberConsentLogic</code>은 비교적 low-level class인 <code>BrazeMemberConsentNotifier</code>에 의존하지 않습니다. 비교적 high-level class인 <code>MemberConsentLogic</code>과 비교적 low-level class인 <code>BrazeMemberConsentNotifier</code>는 모두 interface에 의존합니다. Interface는 다른 어떤 detail에 의존하지 않습니다. Braze 비용 절감을 위한 로직 등 detail은 모두 interface가 알지 못하며, detail이 interface에 의존하여 구현되고 있습니다.</p><p>즉, 내부 도메인 코드가 Braze 컨텍스트에 오염되지 않도록 한 결과, DIP가 적용되었습니다.</p><p>끝으로, 많은 개발 설계 패턴, 원칙들과 같이 DIP 역시 trade-off가 존재합니다. Runtime에야 의존 대상이 결정되어 코드를 이해하기 어려워지는 등, DIP를 적용하면 변경에 강한 코드를 작성할 수 있다는 장점이 있으나 그렇다고 모든 의존 관계에 DIP를 적용하는 것이 반드시 좋지는 않을 것입니다. 변경의 여지가 많지 않은 의존 관계에 DIP를 적용하는 것은 오버 엔지니어링입니다.</p><p>이 글에서 소개한 사례 역시 Braze라는 외부 툴 사용 여부는 언제든 바뀔 수 있기 때문에 변경에 강한 코드를 작성하는 것이 더욱 필요한 경우였다는 점에 주목해 주시면 좋겠습니다.</p><p>이상으로 강남언니 서버에 새로운 툴을 도입하는 과정에서 지속 성장이 가능한 구조를 만들기 위해 어떤 과정을 거쳤는지 소개를 마치겠습니다. 어떻게 하면 외부 툴에 영향 받지 않는 내부 도메인 모델을 만들 수 있는지 궁금하신 분들께 도움이 되면 좋겠습니다.</p><p>감사합니다.</p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/blog.gangnamunni.com/dependency-inversion-principle.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/java-spring/articles/" aria-label="/programming/java-spring/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/java-spring/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/blog.gangnamunni.com/saas-event-sourcing.html" aria-label="[SaaS] 시간여행이 가능한 시스템 아키텍처"><div class="hint">Next<span class="arrow end"></span></div><div class="link">[SaaS] 시간여행이 가능한 시스템 아키텍처<i class="vp-icon iconfont icon-spring" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
