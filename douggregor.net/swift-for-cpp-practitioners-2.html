<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Swift for C++ Practitioners, Part 2: Reference Types & Optionals","image":[""],"datePublished":"2024-02-10T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Swift for C++ Practitioners, Part 2: Reference Types & Optionals"><meta property="og:description" content="Article(s) > Swift for C++ Practitioners, Part 2: Reference Types & Optionals"><meta property="og:type" content="article"><meta property="og:locale" content="ko-KR"><meta property="article:tag" content="cpp"><meta property="article:tag" content="c++"><meta property="article:tag" content="ios"><meta property="article:tag" content="swift"><meta property="article:tag" content="douggregor.net"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2024-02-10T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Swift for C++ Practitioners, Part 2: Reference Types & Optionals | 📚Bookshelf</title><meta name="description" content="Article(s) > Swift for C++ Practitioners, Part 2: Reference Types & Optionals">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><i class="vp-icon fas fa-globe" sizing="both"></i><span class="vp-sidebar-title">douggregor.net</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-1.html" aria-label="Swift for C++ Practitioners, Part 1: Intro &amp; Value Types"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 1: Intro &amp; Value Types<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html" aria-label="Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-3.html" aria-label="Swift for C++ Practitioners, Part 3: Extensions and Access Control"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 3: Extensions and Access Control<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-4.html" aria-label="Swift for C++ Practitioners, Part 4: Generics"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 4: Generics<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-5.html" aria-label="Swift for C++ Practitioners, Part 5: Type erasure &amp; metatypes"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 5: Type erasure &amp; metatypes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-6.html" aria-label="Swift for C++ Practitioners, Part 6: Error Handling"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 6: Error Handling<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-7.html" aria-label="Swift for C++ Practitioners, Part 7: Closures"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 7: Closures<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-8.html" aria-label="Swift for C++ Practitioners, Part 8: Global Variables"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 8: Global Variables<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-9.html" aria-label="Swift for C++ Practitioners, Part 9: Extensible Literals"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 9: Extensible Literals<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-swift" sizing="height"></i>Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">24. 2. 10.</span><meta property="datePublished" content="2024-02-10T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 18 min</span><meta property="timeRequired" content="PT18M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3" role>Swift</span><span class="page-category-item color6" role>C++</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Swift,C++,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color8" role>douggregor.net</span><span class="page-tag-item color6" role>swift</span><span class="page-tag-item color8" role>ios</span><span class="page-tag-item color8" role>c++</span><span class="page-tag-item color4" role>cpp</span><!--]--><meta property="keywords" content="blog,douggregor.net,swift,ios,c++,cpp"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/swift/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Swift > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><a class="route-link vp-card" href="/bookshelf/programming/cpp/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">C++ > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#classes-have-reference-semantics" class="router-link-active router-link-exact-active">Classes have reference semantics</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#inheritance-overriding" class="router-link-active router-link-exact-active">Inheritance &amp; overriding</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#member-initialization-is-backwards" class="router-link-active router-link-exact-active">Member initialization is... backwards?</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#deinitializers" class="router-link-active router-link-exact-active">Deinitializers</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#downcasting" class="router-link-active router-link-exact-active">Downcasting</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#optionals" class="router-link-active router-link-exact-active">Optionals</a><ul><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#options-for-accessing-optionals" class="router-link-active router-link-exact-active">Options for accessing optionals</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#optionals-for-dictionary-access" class="router-link-active router-link-exact-active">Optionals for dictionary access</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#optional-chaining" class="router-link-active router-link-exact-active">Optional chaining</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#optionals-replace-the-dreaded-null" class="router-link-active router-link-exact-active">Optionals replace the dreaded NULL</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#aside-how-big-is-an-optional" class="router-link-active router-link-exact-active">Aside: How big is an optional?</a></li></ul></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#automatic-reference-counting" class="router-link-active router-link-exact-active">Automatic reference counting</a><ul><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#weak-references" class="router-link-active router-link-exact-active">Weak references</a></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#why-reference-counting" class="router-link-active router-link-exact-active">Why reference counting?</a></li></ul></li><li><a aria-current="page" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html#wrap-up-and-what-s-next" class="router-link-active router-link-exact-active">Wrap-up and what&#39;s next?</a></li></ul></nav><hr><a class="vp-card" href="https://www.douggregor.net/posts/swift-for-cxx-practitioners-reference-types/" target="_blank" style="background:rgba(22,22,22,0.2);"><!----><div class="vp-card-content"><div class="vp-card-title">Swift for C++ Practitioners, Part 2: Reference Types & Optionals | Doug's Compiler Corner</div><hr><div class="vp-card-desc">Swift for C++ Practitioners, Part 2: Reference Types & Optionals</div></div></a><p>In our first episode, we talked a lot about value types. In general, you should prefer value types in Swift whenever you can.</p><p>However, Object-Oriented Programming (OOP) is a reasonable approach when you need your objects to have identity and to form relationships amongst each other in arbitrary ways. For these cases, Swift has classes with support for inheritance, overriding, and subtyping. A class is defined in Swift with---you guessed it---the <code>class</code> keyword:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">  <span class="token keyword">var</span> age<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Classes look a lot like structs, with all the same basic ingredients: stored properties (&quot;non-static data members&quot; in C++ parlance), initializers, methods, etc. Each of these ingredients works basically the same way, so if you know how to write a struct, you&#39;re pretty close to writing a class. In fact, you could take nearly any <code>struct</code> from my value-types post and use the <code>class</code> keyword, and it would probably compile! However, even though it will compile, it will behave <em>radically</em> differently, because...</p><hr><h2 id="classes-have-reference-semantics" tabindex="-1"><a class="header-anchor" href="#classes-have-reference-semantics"><span>Classes have reference semantics</span></a></h2><p>Let&#39;s say we have a little <code>Temperature</code> struct:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">struct</span> <span class="token class-name">Temperature</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> fahrenheit<span class="token punctuation">:</span> <span class="token class-name">Double</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>fahrenheit<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>fahrenheit <span class="token operator">=</span> fahrenheit</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And some sensible-looking code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span>fahrenheit<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">)</span></span>
<span class="line">home<span class="token punctuation">.</span>thermostat<span class="token punctuation">.</span>temperature <span class="token operator">=</span> temp</span>
<span class="line"></span>
<span class="line">temp<span class="token punctuation">.</span>fahrenheit <span class="token operator">=</span> <span class="token number">400</span></span>
<span class="line">home<span class="token punctuation">.</span>oven<span class="token punctuation">.</span>temperature <span class="token operator">=</span> temp</span>
<span class="line">home<span class="token punctuation">.</span>oven<span class="token punctuation">.</span><span class="token function">bake</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Fine, right?</p><p>If we change that <code>struct</code> to a <code>class</code>, everything will still compile fine... but it&#39;s going to get really, really hot in here. When <code>Temperature</code> is a class, it has reference semantics: there is one instance <code>temp</code> created in the first line, and that instance is shared between the thermostat and the oven, so changing the temperature on one affects the other.</p><p>There are times when reference semantics are the right way to model your problem, and classes are great for those. <code>Temperature</code> is an example of something that should remain a struct, because it is intrinsically a value. The key distinguishing characteristics for choosing a class is when you need <em>identity</em> and <em>sharing</em>, such that two different places in your code need to be able to refer to the same entity, and see the effects of each other&#39;s changes to that entity.</p><p>Coming from C++, there are other clues as to whether to choose <code>struct</code> or <code>class</code>. If in C++ you would always pass around the type by pointer or reference (whether a raw pointer or a smart pointer like <code>std::shared_ptr</code>), or ever comparing the address of the instances, or if you&#39;re going to be deleting the copy constructor, then you probably have reference semantics and should use a <code>class</code> in Swift. C++ features like <code>virtual</code> functions or <code>dynamic_cast</code> are also indicators of reference semantics, but they aren&#39;t as strong: these could be merely implementation mechanisms for something else.</p><p>Most importantly, in C++ we often use inheritance to get implementations for free in a new type, even without <code>virtual</code> functions. The <a href="https://en.cppreference.com/w/cpp/language/crtp" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i>Curiously Recurring Template Pattern (CRTP)</a> is one such pattern that uses C++ inheritance even in types that have value semantics. This pattern does <em>not</em> translate well into Swift, and there are alternative ways to express this kind of polymorphism through the generics system and so-called &quot;protocol extensions&quot;. The fact that one would use inheritance in C++ to model a problem is not a good indicator that one should use classes in Swift. Instead, it all comes back to reference semantics and identity.</p><hr><h2 id="inheritance-overriding" tabindex="-1"><a class="header-anchor" href="#inheritance-overriding"><span>Inheritance &amp; overriding</span></a></h2><p>Swift classes allow single inheritance, with overriding of methods. Let&#39;s create a subclass of <code>Person</code> for employees of some company:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">:</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> badgeNumber<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> badgeNumber<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>badgeNumber <span class="token operator">=</span> badgeNumber</span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> age<span class="token punctuation">:</span> age<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, your badge number is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The base class (which we call the <em>superclass</em> in Swift) is specified after the colon. There can be at most one superclass, which keeps Objected-Oriented hierarchies a lot more simple and direct. The expressivity gap with C++&#39;s support for multiple inheritance is mostly filled by the generics system, which we&#39;ll get to later (sorry, I keep saying that).</p><p>All inheritance is effectively <code>public</code>. There&#39;s no notion of <code>private</code> inheritance, and <code>protected</code> doesn&#39;t even exist in Swift. I&#39;m going to ignore Swift&#39;s access control for a while longer, and note that when all of your code is in one Swift module, you often don&#39;t think about access control, and it&#39;s fine.</p><p>Our <code>Employee</code> type has an initializer and a <code>greet</code> method. The <code>greet</code> method overrides the one declared in <code>Person</code>, as indicated by the <code>override</code> keyword. Class members are effectively <code>virtual</code> by default, although one can explicitly mark a specific class or class member as <code>final</code> to cut off all subclassing or overriding for that entity for good. Subtyping and virtual dispatch works as one would expect:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> person<span class="token punctuation">:</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Doug&quot;</span></span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">39</span><span class="token punctuation">,</span> badgeNumber<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">person<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// prints &quot;Hello Doug, your badge number is 1!&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="member-initialization-is-backwards" tabindex="-1"><a class="header-anchor" href="#member-initialization-is-backwards"><span>Member initialization is... backwards?</span></a></h2><p>If you looked at the body of that initializer for <code>Employee</code>, it might have freaked you out a little bit:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> badgeNumber<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>badgeNumber <span class="token operator">=</span> badgeNumber</span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> age<span class="token punctuation">:</span> age<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice how we initialized the data members of our subclass (or &quot;derived class&quot; in C++ parlance) first, and <em>then</em> called the superclass initializer. Weird, right?</p><p>This is absolutely not how C++ works: C++ initializes the base classes first, and then the members of the derived class, and then executes the code in the constructor of the derived class. But the C++ model has some weird behaviors with virtual function calls <a href="https://isocpp.org/wiki/faq/strange-inheritance#calling-virtuals-from-ctors" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>in constructors</a> that fall out of it. Let&#39;s see what happens if we write the above classes in C++ and try to greet the person in the constructor:</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> age<span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;!&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Person</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">int</span> badgeNumber<span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">Employee</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">int</span> badgeNumber<span class="token punctuation">)</span> </span>
<span class="line">    <span class="token operator">:</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">badgeNumber</span><span class="token punctuation">(</span>badgeNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, your badge number is &quot;</span> <span class="token operator">&lt;&lt;</span> badgeNumber <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;!&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">Person <span class="token operator">*</span>person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Employee</span><span class="token punctuation">(</span><span class="token string">&quot;Doug&quot;</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// prints &quot;Hello Doug!&quot;</span></span>
<span class="line">person<span class="token operator">-&gt;</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints &quot;Hello Doug, your badge number is 1!&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Weird-er, right? The problem with calling virtual functions in constructors is that the base class constructor doesn&#39;t have a fully-formed object of the subclass type, because the members of the derived class haven&#39;t been initialized yet, and it would be undefined behavior to access them. So it&#39;s not safe for the <code>Person</code> constructor to treat the object as the <code>Employee</code> instance it will eventually be. Instead, it treats the object as an instance of <code>Person</code>, calling <code>Person::greet</code> instead of <code>Employee::greet</code>, causing the difference in behavior above. This is also the reason that it&#39;s possible to get errors at runtime due to calls to abstract virtual functions in C++, even though the language prevents you from creating an instance of an abstract type. Supporting this weird semantics is also awful for C++ compiler writers; <a href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable-ctor" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>read this</a> if you&#39;d like to feel bad for them.</p><p>Okay, back to Swift. If we go put a call to <code>greet</code> in the initializer for <code>Person</code>, we&#39;ll get consistent output:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Hello Doug, your badge number is 1</span>
<span class="line">Hello Doug, your badge number is 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The &quot;backwards&quot; initialization required by Swift, where you must initialize all of your own data members before calling your superclass initializer (via <code>super.init</code>), gives an important guarantee: the superclass initializer knows that all of it&#39;s subclasses have already initialized all of their own data members before it ever runs. Follow that logic all the way up to the root class&#39;s initializer (which has no superclass), and we know that once that initializer has initialized all of its own data members, the object is fully-initialized with its final type. Definite Initialization then makes <code>self</code> available (which happens after the <code>super.init</code> call in non-root classes), so you can call any overridden method in an initializer and get a consistent result. So the Swift approach, while weird at first, provides more consistent semantics with less syntax than C++, and doesn&#39;t require any kind of &quot;default&quot; state for data members. Sometimes weird is actually good, eh?</p><hr><h2 id="deinitializers" tabindex="-1"><a class="header-anchor" href="#deinitializers"><span>Deinitializers</span></a></h2><p>Unlike structs and enums, an instance of a class has a well-defined point at which it is destroyed (when it is no longer used). At this point, one can execute cleanup code in the <em>deinitializer</em>. A Swift deinitializer is like a C++ destructor, except it&#39;s written as <code>deinit</code> like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token comment">// in Person</span></span>
<span class="line"><span class="token keyword">deinit</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> has expired&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Deinitializers are never overridden in the sense that methods are. Rather, all of the deinitializers in the class hierarchy are executed from the most-derived class to the root class, and then all of the data members are destroyed.</p><hr><h2 id="downcasting" tabindex="-1"><a class="header-anchor" href="#downcasting"><span>Downcasting</span></a></h2><p>Let&#39;s say you have a <code>Person</code> and you want to check whether it&#39;s actually an instance of <code>Employee</code>. In C++, you would use <code>dynamic_cast</code> to perform the cast dynamically. In Swift, we use <code>as?</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">checkIfEmployee</span><span class="token punctuation">(</span>person<span class="token punctuation">:</span> <span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token keyword">let</span> employee <span class="token operator">=</span> person <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Yes, employee badge number is #</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">employee<span class="token punctuation">.</span>badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The way to read this is that we are attempting to downcast the <code>person</code> instance into an <code>Employee</code>. If it succeeds, we&#39;ll enter the body of the <code>if let</code> with the variable <code>employee</code> bound to the same instance as <code>person</code>, but with type <code>Employee</code>. If it fails, the <code>if</code> body doesn&#39;t run. Now, sometimes we <em>know</em> based on other invariants in the program that a particular person instance must be an <code>Employee</code>. In C++, you would use a <code>static_cast</code> here (or a <code>dynamic_cast</code> on a reference to the type). In Swift, you can use <code>as!</code>, e.g.,</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Employee badge number is #</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token punctuation">(</span>person <span class="token keyword">as</span><span class="token operator">!</span> <span class="token class-name">Employee</span><span class="token punctuation">)</span><span class="token punctuation">.</span>badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Swift is going to check this cast at runtime, and halt the program with an error message if <code>person</code> is not, in fact, an <code>Employee</code>. The <code>as!</code> cast should be used only in rare cases where you&#39;re unable to express what you need through the type system, and other invariants ensure that it will always succeed. Just like we always do with <code>static_cast</code> in C++, right? RIGHT?</p><hr><h2 id="optionals" tabindex="-1"><a class="header-anchor" href="#optionals"><span>Optionals</span></a></h2><p>In bundling together the <code>as?</code> cast and the <code>if let</code> in the example above, I glossed over what&#39;s actually happening here. Specifically, the <code>as?</code> can be used anywhere, and it produces a value of <em>optional</em> type. If we were to write:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> maybeEmployee <span class="token operator">=</span> person <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">Employee</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The type of <code>maybeEmployee</code> is <code>Employee?</code>, where the question mark implies that might have an <code>Employee</code>, or we might have nothing. If you&#39;ve used the C++ <a href="https://en.cppreference.com/w/cpp/utility/optional" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::optional</code></a>, it&#39;s the same idea, but with syntactic sugar in Swift to make it more ergonomic. <code>if let</code> is one of the ways to check whether there&#39;s a value inside an optional:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> employee <span class="token operator">=</span> maybeEmployee <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Yes, employee badge number is #</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">employee<span class="token punctuation">.</span>badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// employee is not available</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, the <code>if let</code> is checking whether the optional value to the right-hand side of <code>=</code> actually contains a value. If so, it pulls that value out and puts it into the variable declared to the left of the <code>=</code>. Otherwise, the body of the <code>if</code> doesn&#39;t run, but the <code>else</code> block (if present) would be executed. The <code>else</code> block does not have access to the <code>employee</code> variable at all.</p><h3 id="options-for-accessing-optionals" tabindex="-1"><a class="header-anchor" href="#options-for-accessing-optionals"><span>Options for accessing optionals</span></a></h3><p><code>if let</code> is the most popular way to extract a value out of an optional, but it isn&#39;t the only one. There is also the dual to <code>if</code>, called <code>guard</code>, which helps with the &quot;early returns&quot; style of programming. We could refactor the code above to look like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">guard</span> <span class="token keyword">let</span> employee <span class="token operator">=</span> maybeEmployee <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// employee is not available</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// employee is an Employee instance. Use it for the rest of the function</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Yes, employee badge number is #</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">employee<span class="token punctuation">.</span>badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A <code>guard</code> statement checks that its conditions are true, which can involving introducing new variables. It also requires an <code>else</code> block that <em>must return</em>, so there is no way to fall out of the <code>else</code> block and into later code. Early returns are <a href="https://www.fluentcpp.com/2018/08/24/how-to-design-early-returns-in-c-based-on-procedural-programming/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>surprisingly controversial</a> in C++, I think because you have to mentally dig for the <code>return</code> along all of the paths in the early-returning <code>if</code>. Swift&#39;s <code>guard</code> addresses those concerns by giving this pattern a specific keyword up front (<code>guard</code>), making the condition a positive one (you pass the guard if this condition holds), and ensuring that if the condition fails you always do an early return. Enough about <code>guard</code>; back to optionals, shall we?</p><p>The third way one can look into an optional is with a <code>switch</code>, because the <code>?</code> syntax is actually just synactic sugar for a use of the generic <code>Optional</code> type that&#39;s defined in the Swift standard library. It looks like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">Optional</span><span class="token operator">&lt;</span><span class="token class-name">Wrapped</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token keyword">none</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token keyword">some</span><span class="token punctuation">(</span><span class="token class-name">Wrapped</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>none</code> case means there is no value, and the <code>some</code> case means that there is a value of type <code>Wrapped</code>. The angle brackets are for generics, as one would expect, declaring that <code>Optional</code> has a type parameter (akin to a <em>template type parameter</em> in C++). Given a value of optional type, you can switch on the two cases:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">switch</span> maybeEmployee <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">some</span><span class="token punctuation">(</span><span class="token keyword">let</span> employee<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Yes, employee badge number is #</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">employee<span class="token punctuation">.</span>badgeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="optionals-for-dictionary-access" tabindex="-1"><a class="header-anchor" href="#optionals-for-dictionary-access"><span>Optionals for dictionary access</span></a></h3><p>Optionals can be formed from any type, and are useful for APIs that might return &quot;no result&quot;. One great example of this is accessing elements within a Swift <a href="https://developer.apple.com/documentation/swift/dictionary" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>Dictionary</code></a>, which is like a <a href="https://en.cppreference.com/w/cpp/container/unordered_map" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::unordered_map</code></a>, by looking for an element with a specific key. Let&#39;s say we create a dictionary that maps from badge numbers to the employee with that badge number, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token comment">// Create a dictionary from (badgeNumber, employee) pairs</span></span>
<span class="line"><span class="token keyword">let</span> employeesByBadgeNumber<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">:</span> <span class="token class-name">Employee</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>uniqueKeysWithValues<span class="token punctuation">:</span> employees<span class="token punctuation">.</span>map <span class="token punctuation">{</span> </span>
<span class="line">  employee <span class="token keyword">in</span> <span class="token punctuation">(</span>employee<span class="token punctuation">.</span>badgeNumber<span class="token punctuation">,</span> employee<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The use of closures will be explained in a separate post, but if you&#39;re used to C++ lambdas, it probably looks familiar already. The <code>[Int: Employee]</code> syntax is sugar for a <code>Dictionary</code> mapping from <code>Int</code> keys to <code>Employee</code> values. It mirrors the syntax of dictionary literals, i.e., <code>[1: doug]</code> is a dictionary containing a single entry mapping <code>1</code> to the <code>doug</code> instance.</p><p>We can look for the employee with a given badge number by subscripting this dictionary. The result of the subscript is going to be an <code>Employee?</code>, i.e., it&#39;s the employee if one with that badge number was found, or <code>nil</code> otherwise, which works very nicely with <code>if let</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> employee <span class="token operator">=</span> employeesByBadgeNumber<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  employee<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>again, the type system is helping here: the obvious way to find the value associated with a key is to use subscript, and it returns an optional so you&#39;re sure to handle the case where the value is missing. If you find yourself longing for the insert-a-default-if-nothing-is-there behavior of C++&#39;s <code>std::map</code> and <code>std::unordered_map</code>, there&#39;s a special subscript just for you that also takes a default. You could use it like this, say, to count word frequency in a list of words:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">var</span> frequency<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> word <span class="token keyword">in</span> words <span class="token punctuation">{</span></span>
<span class="line">  frequency<span class="token punctuation">[</span>word<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The subscript that takes a default value produces a non-optional value, because an entry <code>[word: 0]</code> will be added if one wasn&#39;t already present. So, we can increment the frequency of each word directly.</p><h3 id="optional-chaining" tabindex="-1"><a class="header-anchor" href="#optional-chaining"><span>Optional chaining</span></a></h3><p>Optionals are really common in Swift code, so the language has a number of affordances to make them easier to work with. For example, earlier we wanted to greet an employee with the given badge number, so we wrote this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> employee <span class="token operator">=</span> employeesByBadgeNumber<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  employee<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code is fine. It will work. But it&#39;s a little bit verbose, with the whole <code>if-let</code> dance to create a new variable. Instead, one can use optional <em>chaining</em> to call the <code>greet</code> method only when there is an employee, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line">employeesByBadgeNumber<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>?</code> in this case means that we&#39;re doing optional chaining. It is followed by accesses into the instance (i.e., <code>.greet()</code>) that only happen when there is a value inside the optional. You can even chain multiple optional accesses together. For example, let&#39;s imagine that our <code>Employee</code> class added a <code>manager</code> data member, i.e.,</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">var</span> manager<span class="token punctuation">:</span> <span class="token class-name">Employee</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We could get the name of the employee 17&#39;s manager like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> managerName <span class="token operator">=</span> employeesByBadgeNumber<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span>manager<span class="token operator">?</span><span class="token punctuation">.</span>name</span>
<span class="line"><span class="token comment">// &gt;----------------------------------------^--------^----&gt;</span></span>
<span class="line"><span class="token comment">//                                          1        2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Evaluation is left-to-right in Swift, so you can read this as looking in the dictionary for an employee with badge number 17. If that <code>Employee?</code> result contains an <code>Employee</code> (i.e., it is not <code>nil</code>) at the point marked #1, then we access the manager of that employee. If the manager data member contains an <code>Employee</code> at the point marked #2, then we access the name of that manager instance.</p><p>But what is the type of the <code>managerName</code> variable? Well, we know that <code>Employee.name</code> is a <code>String</code>, but of course at either #1 or #2 we might have encountered a <code>nil</code> and had to stop evaluation. We can&#39;t just leave <code>managerName</code> undefined (gasp!), so instead it gets type <code>String?</code>, where it either stores the result of completing the optional chain or it <code>nil</code> if a <code>nil</code> was encountered along the way.</p><h3 id="optionals-replace-the-dreaded-null" tabindex="-1"><a class="header-anchor" href="#optionals-replace-the-dreaded-null"><span>Optionals replace the dreaded NULL</span></a></h3><p>In Swift, an instance of class type can never be NULL. If you have a value <code>employee</code> of type <code>Employee</code>, there is always a valid instance there. Instead of NULL pointers, Swift uses optionals: <code>Employee?</code> is either a value employee, or it&#39;s <code>nil</code>. But unlike the C++ equivalent of <code>Employee*</code>, Swift has static affordances to make it easy to use optionals correctly. That means no NULL pointer dereferences, no defensive checks against NULL when you&#39;re not sure. Unless you&#39;re one of the few using a <a href="https://www.cppstories.com/2017/10/notnull/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>not_null</code> smart pointer type</a>, it may surprise you at just how liberating it is to stop thinking about the special case of NULL everywhere and let the type checker support you.</p><h3 id="aside-how-big-is-an-optional" tabindex="-1"><a class="header-anchor" href="#aside-how-big-is-an-optional"><span>Aside: How big is an optional?</span></a></h3><p>One last little fun bit of trivial: if I run this C++ code, what values should we expect to get?</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Employee<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>optional<span class="token operator">&lt;</span>Employee<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>On my system, I get 8 and 16, respectively. Using <code>std::optional</code> doubles the storage needed!</p><p>Now what happens with the Swift equivalent code?</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout</span><span class="token operator">&lt;</span><span class="token class-name">Employee</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout</span><span class="token operator">&lt;</span><span class="token class-name">Employee</span><span class="token operator">?&gt;</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I get 8 for both! Swift is doing an important space optimization behind the scenes: because an <code>Employee</code> must refer to a valid address, and the integral value of 0 is not a valid address, Swift will use the integer representation <code>0</code> to mean the <code>.none</code> of the optional (which corresponds to <code>nil</code>) and all other values to mean the <code>.some</code> case of the optional. Therefore, it can use a single pointer&#39;s width of storage to capture an optional value. This is generally good for memory usage, but it&#39;s also really important for interoperability with C++, because a C++ pointer value (that can be <code>NULL</code>) can be treated as a Swift optional, and vice-versa.</p><p>Now, if you were to create an optional integer, <code>Int?</code>, you would see that the optional takes more space than a single <code>Int</code>. That&#39;s because all possible bit representations in an <code>Int</code> are valid values of an <code>Int</code>, so we add an extra byte (from 8 to 9 on a 64-bit machine) to tell whether we&#39;re in the <code>.none</code> or the <code>.some</code> case. But the thing is... spare bits and holes in bit representations are everywhere, and Swift will dig to try to find them. For example, let&#39;s add a <code>Contractor</code> class and create an enum with three cases:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">Payee</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">employee</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">contractor</span><span class="token punctuation">(</span><span class="token class-name">Contractor</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> myself</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>How big are <code>Payee</code> and <code>Payee?</code>, based on what we&#39;ve seen before?. In fact, both are the same 8 bytes on a 64-bit system. It&#39;s not magic, it&#39;s how computers work: a class like <code>Employee</code> or <code>Contractor</code> is going to be at least 8-byte-aligned, because of it&#39;s object header. That means that a valid reference to a class (basically, a pointer) will always have the lowest three bits be zero: anything else would be a misaligned pointer. So between those two cases, we have three common low bits we can use for whatever we want, and the third case (<code>myself</code>) has no data. Three bits is plenty of space to store a discriminator that says whether a given <code>Payee</code> instance is an <code>employee</code>, <code>contractor</code>, or <code>myself</code>: we need only mask off the upper bits to figure out what case we&#39;re in, and then mask off the lower bits to get a proper <code>Employee</code> or <code>Contractor</code> pointer when we know which one it is. Cool, right?</p><p>That explains <code>Payee</code>, but what about the optional <code>Payee?</code> size? The principle is the same: <code>Payee</code> only needed two of the three low bits to represent its three cases. That leaves one glorious extra bit to distinguish between the <code>some</code> and <code>none</code> cases, so <code>Payee?</code> still needs only 8 bytes. You can do all of these optimization tricks in C++ with template metaprogramming. Clang uses LLVM&#39;s <a href="https://llvm.org/doxygen/classllvm_1_1PointerUnion.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i><code>PointerUnion</code></a> class template <em>extensively</em> to get this same kind of memory savings, but it&#39;s a whole lot nicer when the language just does it for you and you don&#39;t have to think about it.</p><hr><h2 id="automatic-reference-counting" tabindex="-1"><a class="header-anchor" href="#automatic-reference-counting"><span>Automatic reference counting</span></a></h2><p>By now you&#39;ve probably noted the lack of <code>delete</code> or <code>free</code> or any other kind of explicit deallocation. Swift provides automatic memory management using reference counting: a new instance of class type is allocated with a reference count of 1. Anything that needs to hold onto the object will increment its reference count to do so, and decrement the reference count when it is no longer needed. When the reference count hits zero, the object will be de-initialized and the memory freed.</p><p>The C++ standard library has a reference-counting smart pointer template, <a href="https://en.cppreference.com/w/cpp/memory/shared_ptr" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::shared_ptr</code></a>. If you&#39;ve used <code>shared_ptr</code>, you already have a sense of how reference counting works in practice, and you can think of Swift&#39;s classes as using roughly the same semantic model but eliminating the syntactic overhead by bringing it into the language. Swift also has an analogue to <a href="https://en.cppreference.com/w/cpp/memory/weak_ptr" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::weak_ptr</code></a>, which is a non-owning reference to something that may be kept alive by other <code>shared_ptr</code> instances.</p><p>However, the <code>shared_ptr</code> analogy is somewhat flawed because <code>std::shared_ptr</code> makes a number of compromises so that it can be used to point to any type. A <code>shared_ptr</code> is often two pointers large, because it has to separate out the &quot;control block&quot; (which handles the reference count) from the raw object pointer. This isn&#39;t great for efficiency, and also makes the <code>get()</code> operation particularly dangerous: once you&#39;ve extracted the raw object pointer, there&#39;s no way to get back to the safety of a <code>shared_ptr</code> unless you&#39;ve also used <a href="https://en.cppreference.com/w/cpp/memory/enable_shared_from_this" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::enable_shared_from_this</code></a>. A better comparison to Swift would be <a href="https://www.boost.org/doc/libs/1_84_0/libs/smart_ptr/doc/html/smart_ptr.html#intrusive_ptr" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i><code>boost::intrusive_ptr</code></a>, because the Swift reference count is embedded within the object itself. That means you&#39;re only passing around a single pointer to the object rather than the two pointers often needed for a <code>std::shared_ptr</code>, and reference-counting operations have better locality with the object.</p><h3 id="weak-references" tabindex="-1"><a class="header-anchor" href="#weak-references"><span>Weak references</span></a></h3><p>One problem with reference counting is the potential for reference cycles: if object <code>a</code> holds a reference to object <code>b</code>, and object <code>b</code> holds a reference to object <code>a</code>, then these two objects will keep each other alive even after the rest of the program has forgotten about them, resulting in a leak:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> b<span class="token punctuation">:</span> <span class="token class-name">B</span><span class="token operator">?</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> a<span class="token punctuation">:</span> <span class="token class-name">A</span><span class="token operator">?</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This problem exists in all reference counting implementations, whether it&#39;s the C++ <code>std::shared_ptr</code> or <a href="https://devguide.python.org/internals/garbage-collector/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-python" sizing="height"></i>Python</a>. Python has a built-in garbage collector to find these reference cycles and arbitrarily break them to free memory, but such an approach requires a fairly heavy runtime. Swift&#39;s approach is more like <code>std::shared_ptr</code>: the programmer is responsible for ensuring there are no reference cycles, and Swift provides tools to identify and deal with them when they happen.</p><p>Weak references are the primary mechanism for breaking cycles. A weak pointer points at an object but does not keep it alive. Weak references are introduced with the <code>weak</code> modifier on a variable, e.g.,</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">weak</span> <span class="token keyword">var</span> a<span class="token punctuation">:</span> <span class="token class-name">A</span><span class="token operator">?</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A <code>weak</code> variable must have optional type, because the object it points to might go away at any point. If the object it points to is destroyed, then the weak reference will get the value <code>nil</code>. Code that works with weak references will naturally &quot;promote&quot; the weak reference to a strong reference when working with it, because it&#39;s the same operation as determining whether any other optional has a value in it:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> a <span class="token operator">=</span> b<span class="token punctuation">.</span>a <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// a has type A, a strong reference that keeps the object alive</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is akin to the <code>lock()</code> operation of a <code>std::weak_ptr</code> returning a possibly-NULL <code>std::shared_ptr</code>, but benefits from all of the conveniences for optional types that Swift offers.</p><h3 id="why-reference-counting" tabindex="-1"><a class="header-anchor" href="#why-reference-counting"><span>Why reference counting?</span></a></h3><p>We opted for reference counting in Swift because we felt it hit the sweet spot for automatic memory management. Unlike more traditional garbage collectors, reference counting is deterministic: when your reference count goes to zero, your object goes away. There&#39;s no delay until the garbage collector runs where you are using memory than you should be, nor is there ever a need to &quot;pause&quot; the program to run the garbage collector. Moreover, reference counting can be implemented with a tiny runtime footprint---just a couple of atomic operations---vs. a more elaborate garbage collector runtime. It also places no restrictions on the program beyond the need to correctly balance out &quot;retains&quot; and &quot;releases&quot;, so you can freely mix reference-counted code with other code in the system (say, in other languages). Finally, reference counting is locally optimizable: if you can prove that an object is kept alive within a given scope, you don&#39;t need to perform any reference counting within that region of the code. That means you can optimize away all of the reference counts in a particularly performance-sensitive part of the code while not having to change the basic model used by the same classes elsewhere in the program.</p><p>At the other end of the spectrum from a traditional garbage collector are systems with unique ownership, such as <a href="https://en.cppreference.com/w/cpp/memory/unique_ptr" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::unique_ptr</code></a>. This approach requires no overhead for automatic memory management, but makes it hard to express any data structure that isn&#39;t tree-like in nature. Reference counting can express arbitrary graphs of objects directly, making it more flexible than models based on unique ownership.</p><p>Coming from C++, the &quot;automatic&quot; part of Swift&#39;s automatic reference counting can be frustrating. The optimizer might not remove all of the reference counting that you want it to, and where in C++ you might just grab the raw pointer when your smart pointers aren&#39;t optimizing away, Swift makes it a little harder. My advice here is to profile your code: not some micro-benchmark that does no work, but your actual code. If reference-counting is causing performance issues, <code>swift_retain</code> and <code>swift_release</code> will light up in your profiler and you can work on optimizing those hot spots. Swift has some tools for helping with this, such as <code>unowned(unsafe)</code> references (which are effectively raw pointers) as well as ways to be deliberate about ownership, such as <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0366-move-function.md" target="_blank" rel="noopener noreferrer">the <code>consume</code> operation (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>apple/swift-evolution</code>)</a>. In my experience, most of the time the reference counting isn&#39;t in the way, and when it is a problem, one can optimize locally, usually without having to dip into unsafe code.</p><hr><h2 id="wrap-up-and-what-s-next" tabindex="-1"><a class="header-anchor" href="#wrap-up-and-what-s-next"><span>Wrap-up and what&#39;s next?</span></a></h2><p>We dove into Swift&#39;s support for Object-Oriented Programming, which is based on classes with single inheritance and method overriding. We went over initialization (<em>weird</em>, but good) and de-initialization, as well as down casting.</p><p>That led us into the world of optionals, and how Swift uses them to eliminate NULL pointers from the language (Tony Hoare&#39;s self-proclaimed <a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>billion-dollar mistake</a>). Optionals are a huge part of working with Swift, even if you stick to the value-semantic world of structs and enums, so it&#39;s worth getting a feel for the syntactic constructs that make them easy to work with.</p><p>We&#39;re going to take a break on introducing new kinds of types: structs, enums, and classes form the core of Swift&#39;s semantic model. Next, we&#39;re going to talk a bit about code organization in Swift, and how extensions take all of the fun out of the &quot;free function or member function?&quot; debate.</p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/douggregor.net/swift-for-cpp-practitioners-2.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/swift/articles/" aria-label="/programming/swift/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/swift/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-3.html" aria-label="Swift for C++ Practitioners, Part 3: Extensions and Access Control"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Swift for C++ Practitioners, Part 3: Extensions and Access Control<i class="vp-icon fa-brands fa-swift" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
