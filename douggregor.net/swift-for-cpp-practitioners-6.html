<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Swift for C++ Practitioners, Part 6: Error Handling","image":[""],"datePublished":"2024-04-15T00:00:00.000Z","dateModified":null,"author":[]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/douggregor.net/swift-for-cpp-practitioners-6.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Swift for C++ Practitioners, Part 6: Error Handling"><meta property="og:description" content="Article(s) > Swift for C++ Practitioners, Part 6: Error Handling"><meta property="og:type" content="article"><meta property="og:locale" content="ko-KR"><meta property="article:tag" content="cpp"><meta property="article:tag" content="c++"><meta property="article:tag" content="ios"><meta property="article:tag" content="swift"><meta property="article:tag" content="douggregor.net"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2024-04-15T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Swift for C++ Practitioners, Part 6: Error Handling | 📚Bookshelf</title><meta name="description" content="Article(s) > Swift for C++ Practitioners, Part 6: Error Handling">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><i class="vp-icon fas fa-globe" sizing="both"></i><span class="vp-sidebar-title">douggregor.net</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-1.html" aria-label="Swift for C++ Practitioners, Part 1: Intro &amp; Value Types"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 1: Intro &amp; Value Types<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-2.html" aria-label="Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 2: Reference Types &amp; Optionals<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-3.html" aria-label="Swift for C++ Practitioners, Part 3: Extensions and Access Control"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 3: Extensions and Access Control<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-4.html" aria-label="Swift for C++ Practitioners, Part 4: Generics"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 4: Generics<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-5.html" aria-label="Swift for C++ Practitioners, Part 5: Type erasure &amp; metatypes"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 5: Type erasure &amp; metatypes<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-6.html" aria-label="Swift for C++ Practitioners, Part 6: Error Handling"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 6: Error Handling<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-7.html" aria-label="Swift for C++ Practitioners, Part 7: Closures"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 7: Closures<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-8.html" aria-label="Swift for C++ Practitioners, Part 8: Global Variables"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 8: Global Variables<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-9.html" aria-label="Swift for C++ Practitioners, Part 9: Extensible Literals"><!--[--><i class="vp-icon fa-brands fa-swift" sizing="both"></i><!--]-->Swift for C++ Practitioners, Part 9: Extensible Literals<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-swift" sizing="height"></i>Swift for C++ Practitioners, Part 6: Error Handling</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">24. 4. 15.</span><meta property="datePublished" content="2024-04-15T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 21 min</span><meta property="timeRequired" content="PT21M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3" role>Swift</span><span class="page-category-item color6" role>C++</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="Swift,C++,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color8" role>douggregor.net</span><span class="page-tag-item color6" role>swift</span><span class="page-tag-item color8" role>ios</span><span class="page-tag-item color8" role>c++</span><span class="page-tag-item color4" role>cpp</span><!--]--><meta property="keywords" content="blog,douggregor.net,swift,ios,c++,cpp"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Swift for C++ Practitioners, Part 6: Error Handling 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/swift/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Swift > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><a class="route-link vp-card" href="/bookshelf/programming/cpp/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">C++ > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><a class="vp-card" href="https://www.douggregor.net/posts/swift-for-cxx-practitioners-error-handling/" target="_blank" style="background:rgba(22,22,22,0.2);"><!----><div class="vp-card-content"><div class="vp-card-title">Swift for C++ Practitioners, Part 6: Error Handling | Doug's Compiler Corner</div><hr><div class="vp-card-desc">Swift for C++ Practitioners, Part 6: Error Handling</div></div></a><p>C++ has a few different mechanisms for handling errors. One is <a href="https://en.cppreference.com/w/cpp/utility/expected" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::expected</code></a>, where the return type of a function is either the expected value or an error value. Another is <a href="https://cplusplus.com/doc/tutorial/exceptions/" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i>exceptions</a>, which come with a whole host of downsides (we&#39;ll get there in a moment). Personally, I find that I end up hand-rolling something more like <code>std::expected</code> in C++ more often than not, and the experience isn&#39;t great.</p><p>Swift takes some of the syntax of C++ exceptions (<code>throw</code> and <code>catch</code>), but the underlying philosophy of error handling in Swift is a bit different from C++. To get to it, let&#39;s start by looking at some of the issues with C++ exceptions, as they will help inform the choices made in Swift.</p><hr><h2 id="issues-with-c-exceptions" tabindex="-1"><a class="header-anchor" href="#issues-with-c-exceptions"><span>Issues with C++ exceptions</span></a></h2><p>Herb Sutter did quite an excellent job of laying out the issues with C++ exceptions in <a href="https://open-std.org/jtc1/sc22/wg21/docs/papers/2019/p0709r4.pdf" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-file-pdf" sizing="height"></i>P0709</a>. Rather than come up with my own formulation from scratch, I&#39;ll quote directly from his abstract and refine from there:</p><div class="pdf-viewer-wrapper" style="width:100%;height:auto;"><div></div><button class="pdf-fullscreen-button"><svg xmlns="http://www.w3.org/2000/svg" class="pdf-fullscreen-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="enter-fullscreen icon" name="enter-fullscreen"><path d="M762.773 90.24h-497.28c-96.106 0-174.4 78.293-174.4 174.4v497.28c0 96.107 78.294 174.4 174.4 174.4h497.28c96.107 0 175.04-78.293 174.4-174.4V264.64c0-96.213-78.186-174.4-174.4-174.4zm-387.2 761.173H215.04c-21.867 0-40.427-17.92-41.067-41.066V649.92c0-22.507 17.92-40.427 40.427-40.427 11.307 0 21.227 4.694 28.48 11.947 7.253 7.253 11.947 17.92 11.947 28.48v62.293l145.28-145.28c15.893-15.893 41.813-15.893 57.706 0 15.894 15.894 15.894 41.814 0 57.707l-145.28 145.28h62.294c22.506 0 40.426 17.92 40.426 40.427s-17.173 41.066-39.68 41.066zM650.24 165.76h160.427c21.866 0 40.426 17.92 41.066 41.067v160.426c0 22.507-17.92 40.427-40.426 40.427-11.307 0-21.227-4.693-28.48-11.947-7.254-7.253-11.947-17.92-11.947-28.48v-62.186L625.6 450.347c-15.893 15.893-41.813 15.893-57.707 0-15.893-15.894-15.893-41.814 0-57.707l145.28-145.28H650.88c-22.507 0-40.427-17.92-40.427-40.427s17.174-41.173 39.787-41.173z"></path></svg></button></div><ul><li>§4.1: C++ projects commonly ban exceptions, because today’s dynamic exception types violate the zero- overhead principle, and do not have statically boundable space and time costs. In particular, throw requires dynamic allocation and catch of a type requires RTTI.</li><li>§4.2: Programs bugs are not recoverable run-time errors and so should not be reported as exceptions or error codes.</li><li>§4.3: Allocation failure is not like other recoverable run-time errors and should be treated separately.</li><li>§4.5: Some users don’t use exceptions because exceptional control flow is invisible.</li></ul><p>I think Herb missed one overarching problem, which is that C++ got the defaults wrong with respect to exceptions. In C++, a function is assumed to throw unless it is explicitly marked <a href="https://en.cppreference.com/w/cpp/language/noexcept_spec" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>noexcept</code></a>(or <code>throw()</code> in the pre-C++11 beforetimes). This means that nearly every C++ function out there can throw, because only the most diligent C++ developer is going to carefully audit each function to make sure it is marked <code>noexcept</code>, and suffer the unexpected <a href="https://en.cppreference.com/w/cpp/error/terminate" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::terminate</code></a> call if they got it wrong. The problem with getting this default wrong is that it undercuts everything else you&#39;d like to fix with the C++ exceptions design. The space and time costs for exceptions (Herb&#39;s §4.1) might be perfectly acceptable if you only paid for them where you used exceptions, but because of throwing-by-default, you&#39;re paying those costs across the entire code base even if only a narrow portion of it actually uses exceptions. Additionally, you can&#39;t change the language to make exceptional control flow visible (Herb&#39;s §4.5) when the default is &quot;everything throws&quot;, because exceptional control flow is <em>everywhere</em> in C++. And while you could eliminate <code>std::bad_alloc</code> (Herb&#39;s §4.3) to reduce the number of places that could automatically throw, it barely makes a dent in the user experience when everything is already assumed to throw.</p><p>Error handling is hard: it&#39;s hard to anticipate what failures can occur, hard to figure out how to respond appropriately to get back to a reasonable state after an error, and hard to simulate those errors in a test to be sure you got it right. A language needs to help you identify and deal with errors, and most-everything-can-throw does the opposite.</p><hr><h2 id="swift-s-approach-to-error-handling" tabindex="-1"><a class="header-anchor" href="#swift-s-approach-to-error-handling"><span>Swift&#39;s approach to error handling</span></a></h2><p>Swift&#39;s error handling model is similar in spirit to C++: an error is thrown with <code>throw</code>, can propagate through multiple stack frames (tearing down local values and running <code>defer</code> blocks along the way), and is eventually caught with a <code>catch</code> block. Nearly any type can be thrown: the only constraint is that the type must conform to the <a href="https://developer.apple.com/documentation/swift/error" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>Error</code></a> protocol. By default, errors in Swift are type-erased to <code>any Error</code>; see my prior post on type erasure if you want to learn more about type erasure.</p><p>The differences are mainly in the defaults, but they make a world of difference. A Swift function cannot throw unless it explicitly specifies that it <code>throws</code>, and memory allocation failure is not handled via a thrown error (Herb&#39;s §4.3), so the vast majority of Swift functions are non-throwing.</p><p>Thrown errors are checked at compile time: a throwing operation must be marked via the <code>try</code> keyword to make all of the control flow in code explicit (Herb&#39;s §4.5), and the thrown error must either be handled (e.g., with a <code>catch</code> block) or the enclosing function must be marked <code>throws</code> to allow the error to propagate out of it. The key goal here is that there should be <code>no surprises</code> in error handling: you know where errors originate and how they propagate, and while you can write bad error-handling code, it&#39;s hard to forget to write it at all, and you only do so when things can actually fail.</p><h3 id="an-example" tabindex="-1"><a class="header-anchor" href="#an-example"><span>An example</span></a></h3><p>Let&#39;s see Swift&#39;s error handling in action by writing a simple function to parse a string into an integer. Because I love generic programming, we&#39;re going to make it generic over any fixed-with integer type by turning it into an extension of the <a href="https://developer.apple.com/documentation/swift/fixedwidthinteger" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>FixedWidthInteger</code> protocol</a>. But first, let&#39;s think about what can go wrong: the easiest thing that can go wrong is that one of the characters in the string isn&#39;t a digit. Let&#39;s capture that case in a new <code>Error</code>-conforming <code>enum</code> that will describe errors that occur during integer parsing:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Index</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We haven&#39;t talked about the <a href="https://developer.apple.com/documentation/swift/string" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>String</code></a> type much, so allow me a slight digression...</p><div class="hint-container info"><p class="hint-container-title">Digression</p><p>A proper discussion of <code>String</code> could fill up its own post, so here&#39;s the short version: <code>String</code> is a fully Unicode-aware string type and always contains a valid Unicode string. It&#39;s generally best to form and manipulate them with string literals, string interpolations, or other high-level operations. For lower-level operations you can treat them as a collection of <a href="https://developer.apple.com/documentation/swift/character" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>Character</code></a> instances. <code>Character</code> is about as far from the C++ <code>char</code> type as you can get, because it captures the notion of a <em>grapheme cluster</em>, which is the nearest approximation Unicode has to what a human would consider a single character on screen. This covers everything from simple ASCII characters to composed multi-byte sequences like flag emoji (🇺🇦) and family emoji (👩‍👩‍👦‍👦).</p></div><p>So, let&#39;s build our first iteration of a parsing function that takes a string and converts it to any fixed-width integer:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">FixedWidthInteger</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>parsing string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">for</span> index <span class="token keyword">in</span> string<span class="token punctuation">.</span>indices <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> char <span class="token operator">=</span> string<span class="token punctuation">[</span>index<span class="token punctuation">]</span></span>
<span class="line">      <span class="token keyword">guard</span> <span class="token keyword">let</span> digit <span class="token operator">=</span> char<span class="token punctuation">.</span>wholeNumberValue <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> index<span class="token punctuation">:</span> index<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token keyword">Self</span><span class="token punctuation">(</span>exactly<span class="token punctuation">:</span> digit<span class="token punctuation">)</span><span class="token operator">!</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I chose to make this an initializer, so that it can be used as (e.g.) <code>Int8(parsing: string)</code>. The code itself walks through each of the indices in the string, extracting each character, turning it into a <a href="https://developer.apple.com/documentation/swift/character/wholenumbervalue" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i>whole number value</a>, and accumulating the result into <code>self</code>. If at any point it finds a character that isn&#39;t a whole number value, it will <code>throw</code> an instance of <code>IntegerParseError</code> that describes what the problem is.</p><p>There is no error-handling code within this initializer, so it must be marked as <code>throws</code> to indicate that an error can propagate out of a call to the initializer. The Swift compiler will produce an error if the <code>throws</code> is missing.</p><p>Now, when we use this initializer, we will always need to acknowledge the error. For example, let&#39;s try to parse &quot;1+23&quot; into an <code>Int8</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;1+23&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>try</code> must be present to indicate that an operation to its right can throw. Just as any code containing a <code>throw</code> must account for the error (by handling it or being <code>throws</code> itself), code containing a <code>try</code> must account for the error. This makes control flow due to errors explicit. Note that you can cover multiple throw sites with a single <code>try</code> if you&#39;d like. For example:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> <span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> firstString<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> secondString<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>is equivalent to</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> <span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> firstString<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> secondString<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>It&#39;s a matter of taste. My personal style leans toward the former, because if there&#39;s any kind of side effect in a subexpression that would need different control flow, I&#39;m going to break that out into a separate statement anyway.</p><h3 id="do-catch-blocks" tabindex="-1"><a class="header-anchor" href="#do-catch-blocks"><span><code>do..catch</code> blocks</span></a></h3><p>So, we&#39;ve seen that we can mark a function as <code>throws</code> to allow an error to propagate out of it, so how we can handle an error when we don&#39;t want it to propagate? In Swift, it&#39;s a <code>do..catch</code> block:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;1 + 23&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Integer value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">value</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token keyword">let</span> error <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Invalid input string: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Any errors thrown within the body of the <code>do</code> part of a <code>do..catch</code> block will be checked against each of the <code>catch</code> blocks, much like C++&#39;s <code>try..catch</code>. In this example, we have a single <code>catch</code> block that catches any error. The error itself will be named <code>error</code> and have type <code>any Error</code>.</p><p>There can be multiple <code>catch</code> clauses, and they use the same pattern-matching syntax as <code>switch</code> statements, so we can match a particular error case if we want:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value<span class="token punctuation">:</span> <span class="token class-name">Int8</span><span class="token operator">?</span></span>
<span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;1 + 23&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">let</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">#&quot;Non-digit character &quot;</span><span class="token interpolation-punctuation punctuation">\#(</span><span class="token interpolation">string<span class="token punctuation">[</span>index<span class="token punctuation">]</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot; found in string &quot;</span><span class="token interpolation-punctuation punctuation">\#(</span><span class="token interpolation">string</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;.&quot;#</span></span><span class="token punctuation">)</span></span>
<span class="line">  value <span class="token operator">=</span> <span class="token nil constant">nil</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unhandled error </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">throw</span> error</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now when an <code>IntegerParserError.nonDigitCharacter</code> error is thrown, it will be matched against the first <code>catch</code>, with the <code>string</code> and <code>index</code> values of the error bound to the stored values.</p><div class="hint-container note"><p class="hint-container-title">Aside</p><p>I snuck another minor Swift feature into that <code>print</code> statement, raw string literals, which are written with <code>#&quot;...&quot;#</code>. Inside, double-quotes don&#39;t finish the raw string literal unless followed by a <code>#</code>, and the <code>\</code> is not an escaping character unless followed by the <code>#</code>. If you really want to use <code>&quot;#</code> or <code>\#</code> inside the raw string literal, you can even add more <code>#</code>s around the outside double-quotes, where you need a matching number of <code>#</code>s to make the <code>&quot;</code> or <code>#</code> significant, e.g., <code>###&quot; not escaped \&quot;# until we get here &quot;###</code>.</p></div><p>Any errors that don&#39;t match that first <code>catch</code> clause will fall into the second catch clause. As a little shortcut, if the catch clause doesn&#39;t specify anything to match, it&#39;s equivalent to <code>let error</code>, i.e., it introduces local <code>error</code> value of type <code>any Error</code>.</p><p>Note that this second <code>catch</code> block throws <code>error</code> again: Swift doesn&#39;t have (nor need) a special &quot;rethrows&quot; syntax, because errors are just values. So if we want to &quot;rethrow&quot;, we can <code>throw</code> the error we got. Or we can package it up---there&#39;s no need for special mechanisms like <a href="https://en.cppreference.com/w/cpp/error/exception_ptr" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::exception_ptr</code></a> in C++.</p><h3 id="try" tabindex="-1"><a class="header-anchor" href="#try"><span><code>try?</code></span></a></h3><p>There&#39;s one last shorthand syntax to get out of the way before we switch gears a bit. If you find yourself trying an operation and producing either a value or <code>nil</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value<span class="token punctuation">:</span> <span class="token class-name">Int8</span><span class="token operator">?</span></span>
<span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> string<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">  value <span class="token operator">=</span> <span class="token nil constant">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then you can use the <code>try?</code> shorthand to simplify the code to:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> string<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>try?</code> expression performs the operation to its right and, if successful, returns its value. If the operation throws an error, then the <code>try?</code> expression returns <code>nil</code>. The type of a <code>try?</code> is an optional of the expression to its right, so in this case, we get an <code>Int?</code>. I&#39;m not a huge fan of this feature, because it loses information about the specific error that was thrown, but it can be convenient when throwing together some Swift code to get a task done once or twice.</p><h3 id="throwing-closures" tabindex="-1"><a class="header-anchor" href="#throwing-closures"><span>Throwing closures</span></a></h3><p>Just like functions, closures can throw. Such closures can explicitly be marked with <code>throws</code> if you provide a parameter list, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">commaSeparatedIntegers</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">Int8</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// split String into [Substring] instances at the given separator</span></span>
<span class="line">  <span class="token keyword">let</span> strings <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>separator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;,&quot;</span></span><span class="token punctuation">)</span> </span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">try</span> strings<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token punctuation">(</span>substring<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token keyword">in</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span>substring<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A few things to note: the <a href="https://developer.apple.com/documentation/swift/sequence/split(separator:maxsplits:omittingemptysubsequences:)" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>split(separator:)</code></a> operation on a collection turns an array of subcollections that are separated by the <code>Equatable</code> element provided by the <code>separator</code> argument. In this example, we then <code>map</code> over those substrings (a <a href="https://en.cppreference.com/w/cpp/algorithm/transform" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i><code>std::transform</code></a> in C++ STL-speak) to parse each of them into an integer. Because the initializer of the <code>UInt8</code> <code>throws</code>, we must mark the closure&#39;s return expression with <code>try</code>. Now, when giving a throwing closure, the <code>map</code> operation itself also throws, so we need to mark the <code>map</code> call with a <code>try</code> as well. Therefore, all of the exceptional control flow (out of the closure, and out of the map call) is indicated in the program.</p><p>Now, we don&#39;t <em>have</em> to mark a closure as throwing when it throws, because it can be inferred. A closure that contains a <code>throw</code> or a <code>try</code> (that isn&#39;t swallowed up in a <code>do..catch</code> / <code>try?</code> / <code>try!</code>) is known to throw, so the above can be written more succinctly as:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">commaSeparatedIntegers</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">Int8</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// split String into [Substring] instances at the given separator</span></span>
<span class="line">  <span class="token keyword">let</span> strings <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>separator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;,&quot;</span></span><span class="token punctuation">)</span> </span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">try</span> strings<span class="token punctuation">.</span>map <span class="token punctuation">{</span> </span>
<span class="line">    <span class="token keyword">try</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I&#39;m also using the <code>$0</code> shorthand for &quot;the first closure argument&quot;, because this closure is so small that it&#39;s not worth naming the argument. The presence of <code>try</code> implies that the closure <code>throws</code>.</p><p>We&#39;re going to come back to <code>map</code> and it&#39;s &quot;it throws if its input closure throws&quot; behavior a bit later, when we talk about typed throws.</p><hr><h2 id="program-bugs-are-not-exceptional-conditions" tabindex="-1"><a class="header-anchor" href="#program-bugs-are-not-exceptional-conditions"><span>Program bugs are not exceptional conditions</span></a></h2><p>We&#39;ve talked a lot about the mechanics of error handling in Swift, so now let&#39;s talk some philosophy. Swift takes the viewpoint that errors are exceptional conditions that the program has to deal with, but <code>program bugs are not exceptional conditions.</code> When Swift detects a program bug, such as an out-of-bounds index into an array or an attempt to force an optional value containing <code>nil</code> (via <code>!</code> or <code>as!</code>), it will immediately halt the program. It will look like a program crash, but should be accompanied by a message indicating what went wrong.</p><p>The Swift philosophy, echoed by Herb&#39;s §4.2, is that a program should not attempt to recover from a programmer error. Programmer errors are likely to mean broken invariants that will cause more problems later, and a program that&#39;s limping on after a program error is ripe for security exploits. So when things go wrong, Swift halts the program to prevent further damage.</p><p>Now, you don&#39;t <em>have</em> to buy in to Swift&#39;s philosophy here. You can go ahead and add an <code>Array</code> subscript that throws when out of bounds, or a cast operation that throws when it fails, and generally turn every bad thing that can happen into a thrown error. You&#39;ll be going against the grain of the Swift standard library and general community, but it&#39;s possible. But know that I will know, and I will judge you.</p><h3 id="try-1" tabindex="-1"><a class="header-anchor" href="#try-1"><span><code>try!</code></span></a></h3><p>There are some times when you&#39;re using a general operation that can throw an error, but because of where you are in the program, you <em>know</em> it can&#39;t fail. Perhaps you&#39;re working from data that&#39;s baked into the program elsewhere, or are in program startup where things can&#39;t go wrong yet. As a corollary to <code>try?</code>, there&#39;s a <code>try!</code> operation that produces a fatal error if an error is thrown from its subexpression. For example, if we do:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;1+23&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The type of the <code>try!</code> expression is the type of its subexpression; here, that&#39;s <code>Int8</code>. If an error is thrown from the subexpression, the program will halt with an error message something like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line">parsing<span class="token operator">/</span>parsing<span class="token punctuation">.</span>swift<span class="token punctuation">:</span><span class="token number">94</span><span class="token punctuation">:</span> <span class="token class-name">Fatal</span> error<span class="token punctuation">:</span> &#39;<span class="token keyword">try</span><span class="token operator">!</span>&#39; expression unexpectedly raised an error<span class="token punctuation">:</span> parsing<span class="token punctuation">.</span><span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;12+3&quot;</span></span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token class-name">Swift</span><span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Index</span><span class="token punctuation">(</span>_rawBits<span class="token punctuation">:</span> <span class="token number">65799</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You can think of <code>try!</code> as having about the same semantics as <code>(try? &lt;subexpression&gt;)!</code>, but providing a better error message when things go wrong. Unlike <code>try?</code>, I actually do like <code>try!</code>: when the program invariants say there can&#39;t be an error here, it&#39;s a lot more convenient than a <code>do..catch</code> with a <code>fatalError</code> in the <code>catch</code> block.</p><div class="hint-container note"><p class="hint-container-title">Aside</p><p>Some Swift style guides prohibit the use of the various <code>!</code> operations, whether they are <code>!</code> to force-unwrap optional, <code>as!</code> to force-cast, or <code>try!</code> to assert that an operation cannot fail. These constructs exist in Swift for a reason, and are appropriate to use when the surrounding program invariants ensure that the operation cannot fail, but you weren&#39;t able to express those invariants in the type system. The consistent use of <code>!</code> is meant to say &quot;be wary&quot;, not &quot;run away screaming.&quot;</p></div><h3 id="preconditions-and-assertions" tabindex="-1"><a class="header-anchor" href="#preconditions-and-assertions"><span>Preconditions and assertions</span></a></h3><p>A careful programmer will document the invariants of data structures and the preconditions of any functions, so that misuses due to programmer error are caught quickly. To support this checking consistently, Swift provides the <code>precondition</code> function, which takes a <code>Bool</code> condition, an optional error message string, and optional file/line information (that will be automatically filled in for you). For example, a bounds check on an array subscript will use a precondition like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">precondition</span><span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> count<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;out-of-bounds array index&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If that <code>Bool</code> expression evaluates <code>false</code>, the program will halt immediately and display the error message, line, and column. The actual declaration of <code>precondition</code> shows off a few tiny features that Swift library developers like to use, that I otherwise wouldn&#39;t have gotten to, so here it is:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">precondition</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token omit keyword">_</span> condition<span class="token punctuation">:</span> <span class="token attribute atrule">@autoclosure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token omit keyword">_</span> message<span class="token punctuation">:</span> <span class="token attribute atrule">@autoclosure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">StaticString</span> <span class="token operator">=</span> <span class="token class-name">StaticString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  file<span class="token punctuation">:</span> <span class="token class-name">StaticString</span> <span class="token operator">=</span> <span class="token literal constant">#file</span><span class="token punctuation">,</span> line<span class="token punctuation">:</span> <span class="token class-name">UInt</span> <span class="token operator">=</span> <span class="token literal constant">#line</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The first argument is the <code>Bool</code> condition, but it has <em>function</em> type and this <code>@autoclosure</code> thing. What&#39;s going on? Well, an &quot;autoclosure&quot; is a fun way in which a function can defer computation of one of its arguments. In essence, when we wrote the expression <code>index &gt;= 0 &amp;&amp; index &lt; count</code>, Swift packaged that up into a closure</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token punctuation">{</span> index <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> count <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>and passed that closure into the <code>precondition</code> function. We can evaluate the condition by calling <code>condition()</code> in the body of the function. Note that the <code>message</code> is also an <code>@autoclosure</code>: we won&#39;t call the closure unless the condition has failed, so we don&#39;t need to form the string instance except along the error path. Auto-closures actually came into being because we wanted to be able to express the short-circuiting behavior of the logical <code>&amp;&amp;</code> operation in the library. The implementation looks like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>lhs<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">,</span> rhs<span class="token punctuation">:</span> <span class="token attribute atrule">@autoclosure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span></span>
<span class="line">    lhs <span class="token operator">?</span> <span class="token function">rhs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Autoclosures are also used in Swift&#39;s <code>assert</code> function, which ensures that a particular condition holds <em>but only in debug builds</em>. In release builds, the <code>assert</code> function folds away, never evaluating the condition. Use asserts for checking invariants that are too expensive in release builds, but can help aid debugging when things go wrong:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isSorted<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;insert operation must maintain sortedness property&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Both <code>precondition</code> and <code>assert</code> have defaulted <code>file</code> and <code>line</code> arguments. If you don&#39;t pass in a value, they take on the default values <code>#file</code> and <code>#line</code>, respectively. These are built-in macros that produce the file and line at the call site, which allows <code>precondition</code> and <code>assert</code> to point at where the failing precondition/assertion occurred in the source code.</p><h3 id="arithmetic-overflow-is-a-program-bug" tabindex="-1"><a class="header-anchor" href="#arithmetic-overflow-is-a-program-bug"><span>Arithmetic overflow is a program bug</span></a></h3><p>In the C++ community, we&#39;ve spent a <em>lot</em> of time <a href="https://open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0907r4.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>fretting</a> over what to do about arithmetic overflow. It&#39;s been undefined behavior since the dawn of time, and undefined behavior is bad, so there&#39;s been a push to define it somehow. The most reasonable answer is to define it as basically every system out there implements it, which is <a href="https://ccrma.stanford.edu/~jos/fp/Two_s_Complement_Wrap_Around.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>two&#39;s complement wrapping</a>. That&#39;s better, but it&#39;s not great: arithmetic overflow that is guaranteed to wrap can open up security vulnerabilities if an attacker can manager to wrap a buffer index to get access to other data they shouldn&#39;t.</p><p>Swift&#39;s answer is to define arithmetic overflow as a programmer error, and trap when it occurs. You can see the effect of this by trying to pass a string for a too-large integer into our parsing initializer:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;155&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The program will trap (crash) when trying to multiply 15 * 10 as an <code>Int8</code>. This is not great for our parsing function, so let&#39;s fix it!</p><p>Swift has two ways of dealing with arithmetic overflow programmatically. The first is a set of <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/advancedoperators/#Overflow-Operators" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i>&quot;wrapping&quot; arithmetic operators</a> with the <code>&amp;</code> prefix that wrap their results according to two&#39;s complement arithmetic. If we replace the <code>*</code> and <code>+</code> in our <code>init(parsing:)</code> implementation with <code>&amp;*</code> and <code>&amp;+</code>, respectively, the crash will go away! Yay! Except that the answers are going to be wrong, because <code>try Int8(parsing: &quot;155&quot;)</code> will now produce the result <code>-101</code>. Use the wrapping arithmetic operations when the algorithm you&#39;re implementing is designed for two&#39;s complement arithmetic, not as a &quot;please make it not crash&quot; hammer.</p><p>The second way of dealing with overflow is through the <code>*ReportingOverflow</code> family of methods on <code>FixedWidthInteger</code>, which form the appropriate operation and return the partial value along with a flag that indicates whether it overflowed or not. This allows us to detect an react to the overflow. Let&#39;s do that, and report the overflow via a thrown error. We can represent the failure condition with a new case in the <code>IntegerParseError</code> enum:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">case</span> <span class="token function">overflow</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> any <span class="token class-name">Numeric</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, instead of writing <code>self * 10</code>, we can use the <code>multipliedReportingOverflow(by:)</code> operation, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">var</span> overflow<span class="token punctuation">:</span> <span class="token class-name">Bool</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> overflow<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">multipliedReportingOverflow</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> overflow <span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">throw</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">overflow</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It&#39;s a little verbose, but it works. I bet someone could write a nice throwing wrapper around a <code>FixedWidthInteger</code> type that makes this kind of code easier to write, but for now I&#39;m going to go the brute-force method and also addition counterpart. The final integer-parsing operation is as follows:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">FixedWidthInteger</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>parsing string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">for</span> index <span class="token keyword">in</span> string<span class="token punctuation">.</span>indices <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> char <span class="token operator">=</span> string<span class="token punctuation">[</span>index<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">guard</span> <span class="token keyword">let</span> digit <span class="token operator">=</span> char<span class="token punctuation">.</span>wholeNumberValue <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> index<span class="token punctuation">:</span> index<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">var</span> overflow<span class="token punctuation">:</span> <span class="token class-name">Bool</span></span>
<span class="line">      <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> overflow<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">multipliedReportingOverflow</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> overflow <span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">throw</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">overflow</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> overflow<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addingReportingOverflow</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> overflow <span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">throw</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">.</span><span class="token function">overflow</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now if we <code>try Int8(parsing: &quot;155&quot;)</code> we&#39;ll get a thrown error that describes the failure: the value <code>&quot;155&quot;</code> doesn&#39;t fit into the integer type. We can even make the error nice and human-readable:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">IntegerParseError</span><span class="token punctuation">:</span> <span class="token class-name">CustomStringConvertible</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">,</span> <span class="token keyword">let</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token string-literal"><span class="token string">&quot;non-digit character &#39;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">string<span class="token punctuation">[</span>index<span class="token punctuation">]</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&#39; at index </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">index</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> when converting &#39;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">string</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&#39; to an integer&quot;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">overflow</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">,</span> <span class="token keyword">let</span> type<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token string-literal"><span class="token string">&quot;overflow converting &#39;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">string</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&#39; to integer type &#39;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">type</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&#39;&quot;</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>so we end up with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line">overflow converting &#39;<span class="token number">155</span>&#39; to integer type &#39;<span class="token class-name">Int8</span>&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>It&#39;s definitely worth making your error types provide nice, human-readable error messages, because they&#39;re likely to propagate up to some part of the system that can&#39;t do anything better than present the error to the user. And that message is a whole lot nicer for most users than the default rendering <code>parsing.IntegerParseError.overflow(&quot;155&quot;, Swift.Int8)</code>.</p><hr><h2 id="typed-throws" tabindex="-1"><a class="header-anchor" href="#typed-throws"><span>Typed throws</span></a></h2><p>Thus far, all the functions and closures we&#39;ve seen have used &quot;untyped&quot; thows, where all errors are type-erased to <code>any Error</code>. Untyped errors are a good default: you can still pick out a specific error type using pattern-matching in a <code>catch</code> in those (generally rare) cases where you must, but most error-handling code just deals with any kind of error opaquely and safely backs out of the failed operation.</p><p>There are a few cases where untyped throws are insufficient, though:</p><ol><li>In performance-critical or very low-level code that cannot afford the runtime cost of type erasure or perhaps cannot allocate at all along the error path. This includes <a href="https://github.com/apple/swift-evolution/blob/main/visions/embedded-swift.md" target="_blank" rel="noopener noreferrer">Embedded Swift (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>apple/swift-evolution</code>)</a>, which doesn&#39;t allow for type erasure in any form. (Note that this restriction is captured by Herb&#39;s §4.1).</li><li>In generic code that will only propagate errors that are introduced by operations on its generic inputs, such as the <code>map</code> operation throwing an error only when its closure parameter throws.</li></ol><p>In such cases, it can be valuable to specify the exact type of the error that can be thrown. Swift allows this with typed throws, which allows one to specify a concrete thrown error type in parentheses after the <code>throws</code> keyword. Our parsing code could adopt typed throws like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">init</span><span class="token punctuation">(</span>parsing string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">IntegerParseError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, this initializer may only throw or propagate errors of the type <code>IntegerParseError</code>. If you really want, you can take advantage of the type inference this affords for throws statements to omit the <code>IntegerParseError</code> on them, e.g.,</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">throw</span> <span class="token punctuation">.</span><span class="token function">nonDigitCharacter</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> index<span class="token punctuation">:</span> index<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>For callers, the knowledge that this initializer can only throw <code>IntegerParseError</code> gives tighter bounds for <code>do..catch</code> blocks. For example, this code knows that the caught <code>error</code> is of type <code>IntegerParseError</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Int8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> string<span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">value</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// error has type `IntegerParseError`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That&#39;s the basics of typed throws: you can specify the type of a thrown error, which of course must conform to the <code>Error</code> protocol. This becomes part of the interface contract, so the implementation must only every throw this type, and clients are guaranteed to only ever see a thrown error of this type. It&#39;s all enforced statically, so you can&#39;t get it wrong. However, you can come to regret being specific about the thrown error type, if you later change the implementation in a manner that can produce new kinds of errors.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>As of the time of this writing (April, 2024), typed throws has been accepted into the upcoming Swift 6.0 and is available in <a href="https://swift.org/download/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i>nightly snapshots</a>, but has not yet made it into a Swift release. While it&#39;s not terribly likely, it&#39;s possible that details may change.</p></div><h3 id="untyped-throws" tabindex="-1"><a class="header-anchor" href="#untyped-throws"><span>Untyped throws</span></a></h3><p>Okay, so now we have <em>untyped</em> throws, and we have <em>typed</em> throws, so how do these relate? Fortunately, this is easy: untyped throws (spelled <code>throws</code>) is the same thing as throwing <code>any Error</code> (spelled <code>throws(any Error)</code>); it&#39;s effectively just a shorthand. A function that throws some type <code>E</code> can be converted to a function that throws <code>any Error</code>. That&#39;s it; nothing weird here. Just some syntactic sugar and an implicit conversion.</p><h3 id="non-throwing-functions-and-the-never-type" tabindex="-1"><a class="header-anchor" href="#non-throwing-functions-and-the-never-type"><span>Non-throwing functions and the <code>Never</code> type</span></a></h3><p>A <em>much</em> more interesting question is how typed throws relates to <em>non-throwing</em> functions. For that, we need to introduce another special Swift type called <code>Never</code>. There&#39;s no real equivalent to <code>Never</code> in C++, so I&#39;ll describe it from first principles. Please try not to equate it to anything in C++, because it&#39;ll create more confusion: it may sound a little like <code>void</code>, but it&#39;s not that. It may sound a little like an incomplete type, but it&#39;s not that. Enough preamble, what is it?</p><p><code>Never</code> is a type for which there can never be an instance, ever. Formally, <code>Never</code> is an <code>enum</code> with no cases, which is also called an <em>uninhabited enum</em>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">Never</span> <span class="token punctuation">{</span> <span class="token comment">/* empty */</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now, because there can never be an instance of type <code>Never</code>, any computation that <em>produces</em> a value of type <code>Never</code> must be unreachable. Dead code. An impossible state.</p><p><code>Never</code> came into Swift as a more composable way to indicate that a function could never return. C++11 has <a href="https://en.cppreference.com/w/cpp/language/attributes/noreturn" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-cpp" sizing="height"></i>the <code>noreturn</code> attribute</a> to say that a function could never return, but it&#39;s an attribute tacked on to a function, and doesn&#39;t get any real checking. In Swift, we give that function the result type <code>Never</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">explode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Never</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;BOOM!&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A <code>Never</code>-returning function must not return along any path. If any path could return or fall off the end of the function, the compiler will emit an error. The <code>explode()</code> function above is known to be correct because it&#39;s calling <code>fatalError</code>, which is defined in the Standard Library to return <code>Never</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">fatalError</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token omit keyword">_</span> message<span class="token punctuation">:</span> <span class="token attribute atrule">@autoclosure</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  file<span class="token punctuation">:</span> <span class="token class-name">StaticString</span> <span class="token operator">=</span> <span class="token literal constant">#file</span><span class="token punctuation">,</span> line<span class="token punctuation">:</span> <span class="token class-name">UInt</span> <span class="token operator">=</span> <span class="token literal constant">#line</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Never</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using the <code>Never</code> type instead of an attribute has really nice properties, because it interacts nicely with type inference. If you form a closure that calls <code>fatalError</code>, it will be inferred to have result type <code>Never</code>, so we know that calls to that closure never return. And if you call a generic function that returns a <code>T</code>, and <code>T</code> is inferred to <code>Never</code>, you know that the generic function won&#39;t return.</p><p>Let&#39;s get back to throwing. If a function isn&#39;t marked with <code>throws</code>, then it doesn&#39;t throw. One might say it... <em>never</em>... throws. Joking aside, this means that a function that <code>throws(Never)</code> is equivalent to one that does not throw. So typed throws is actually a generalization of throwing functions, where <code>throws(any Error)</code> is &quot;can throw anything&quot; and <code>throws(Never)</code> is &quot;does not throw&quot;, and you can have any <code>throws(Concrete)</code> in between.</p><h3 id="generic-error-propagation" tabindex="-1"><a class="header-anchor" href="#generic-error-propagation"><span>Generic error propagation</span></a></h3><p>A bit earlier, we had this call to <code>map</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">return</span> <span class="token keyword">try</span> strings<span class="token punctuation">.</span>map <span class="token punctuation">{</span> </span>
<span class="line">  <span class="token keyword">try</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>and I noted that <code>map</code> propagates the error from the closure out. Now that we have typed throws, we can express the <code>map</code> operation generically:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Collection</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">map</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> result<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> element <span class="token keyword">in</span> <span class="token keyword">self</span> <span class="token punctuation">{</span></span>
<span class="line">      result<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">try</span> <span class="token function">body</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> result</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The basic idea is that we&#39;re calling <code>body</code> for each element in the collection, and appending the result to the <code>result</code> array to be returned at the end. Easy.</p><p>Now, <code>body</code> can throw an error of type <code>E</code>. When it does, that error propagates out of <code>map</code>, which is <em>also</em> defined to throw type <code>E</code>. <code>E</code>, in this case, is a generic parameter that is inferred from the call site. Everything type-checks in the <code>map</code> definition because the only throwing call site produces an <code>E</code>.</p><p>Now let&#39;s look at the client. In our original <code>map</code> call</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">return</span> <span class="token keyword">try</span> strings<span class="token punctuation">.</span>map <span class="token punctuation">{</span> </span>
<span class="line">  <span class="token keyword">try</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>the closure will be inferred to throw an error (<code>IntegerParseError</code>) based on the call to <code>init(parsing:)</code>. The generic argument for <code>E</code> will, therefore, be inferred to be <code>IntegerParseError</code>, so the whole <code>map</code> call throws <code>IntegerParseError</code>. What about a non-throwing case?</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">return</span> strings<span class="token punctuation">.</span>map <span class="token punctuation">{</span> </span>
<span class="line">  <span class="token punctuation">(</span><span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>parsing<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// turn failures into 0s</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, the closure does not throw (because the error from <code>init(parsing:)</code> is swallowed by the <code>try?</code>), so it has a thrown error type of <code>Never</code>. The generic argument for <code>E</code> is inferred to <code>Never</code>, so the call to <code>map</code> is known not to throw... and we don&#39;t need a <code>try</code> outside of the call to <code>map</code>.</p><p>Operations like <code>map</code> that are expressed in terms of generic thrown error types are only considered to throw when the thrown error type is inferred to something other than <code>Never</code>, allowing them to act as either throwing or not depending on context. This abstraction over thrown error types means we don&#39;t have to duplicate generic implementations to account for throwing vs. non-throwing. <code>Never</code> may feel odd, but it&#39;s quite powerful.</p><div class="hint-container note"><p class="hint-container-title">Historical note</p><p>Prior to the introduction of typed throws, a different feature called <code>rethrows</code> captured the notion that a particular function would only throw when one of the closure arguments passed into it throws. This feature was used for algorithms like <code>map</code>, and is expected to rapidly fall out of favor (and probably be deprecated) once typed throws is in widespread use.</p></div><h3 id="the-result-type" tabindex="-1"><a class="header-anchor" href="#the-result-type"><span>The <code>Result</code> type</span></a></h3><p>Swift has a standard type <a href="https://developer.apple.com/documentation/swift/result" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-swift" sizing="height"></i><code>Result</code></a> type for packaging up either a successful result, or a failure condition, and is intended to be used in much the same way as <code>std::expected</code>. Personally, I&#39;ve found a lot less of a need for <code>Result</code> now that Swift has <code>async</code>/<code>await</code> (the subject of a later post, I promise), but you may see it in Swift code and it&#39;s good for exposition. <code>Result</code> is an enum with two cases:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Success</span><span class="token punctuation">,</span> <span class="token class-name">Failure</span><span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">Success</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">Failure</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A function that returns <code>Result&lt;T, E&gt;</code> is morally equivalent to one that returns a <code>T</code> and <code>throws(E)</code>. Indeed, one can convert in both directions fairly readily. To go from a function (or closure) to a <code>Result</code> instance, use this handy initializer:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">init</span><span class="token punctuation">(</span>catching body<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">Failure</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Success</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">try</span> <span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      </span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In other words: run the body. If it succeeds, put the successful value into <code>self</code> via the <code>success</code> case. If it fails, it will have thrown an instance of type <code>Failure</code>, so the <code>catch</code> block will initialize <code>self</code> via the <code>failure</code> case. Either way, <code>self</code> is fully initialized at the end!</p><p>To go the other way, there&#39;s a <code>get</code> operation:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">func</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">Failure</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Success</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> success</span>
<span class="line">      <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">let</span> error<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">throw</span> error</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A call to <code>get</code> will either get the success value, or throw failure. If you prefer to use property access, we can write that with a throwing computed property:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">extension</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> value<span class="token punctuation">:</span> <span class="token class-name">Success</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">get</span> <span class="token keyword">throws</span><span class="token punctuation">(</span><span class="token class-name">Failure</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Result</code> illustrates another one of the great things about <code>Never</code>: if you have a type <code>Result&lt;Int, Never&gt;</code>, then it&#39;s just a wrapper around an <code>Int</code>. If you call <code>get()</code> or use <code>value</code>, it&#39;s known not to throw (because <code>Failure</code> is <code>Never</code>), so you don&#39;t need a <code>try</code>. All of the generic code just works, because it&#39;s impossible to ever end up in the <code>failure</code> case dynamically to trigger a thrown error.</p><hr><h2 id="wrap-up" tabindex="-1"><a class="header-anchor" href="#wrap-up"><span>Wrap-up</span></a></h2><p>Error handling is one of the parts of Swift I adore: it&#39;s purposeful and opinioned, the pieces all compose well, and it helps take a tricky aspect of programming and makes it easier through useful application of a static type system. For C++ practitioners, there&#39;s a lot to be familiar with, because the basic model is effectively the same: thrown errors propagate up until they hit a matching catch. However, the defaults have been re-oriented to make exceptional conditions uncommon, static checking has been made sound to prevent accidents, and exceptional control flow has been made explicit to aid in understanding code.</p><p>And although it&#39;s not baked into the language design per se, Swift has definite opinions about when to throw errors and when to trap. Programmer errors should trap as soon as they are detected to prevent them from causing bad behavior, including security issues. Other exceptional conditions that prevent the normal flow of the problem should be reported as errors, preserving enough detail to provide a useful error message to be logged for the programmer or reported to the end user. I believe that following this philosophy, and being properly supported by the language in handling errors, leads to better-quality code in the long run.</p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/douggregor.net/swift-for-cpp-practitioners-6.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/swift/articles/" aria-label="/programming/swift/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/swift/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/douggregor.net/swift-for-cpp-practitioners-7.html" aria-label="Swift for C++ Practitioners, Part 7: Closures"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Swift for C++ Practitioners, Part 7: Closures<i class="vp-icon fa-brands fa-swift" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><!----></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
