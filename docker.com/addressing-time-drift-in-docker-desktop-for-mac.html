<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Addressing Time Drift in Docker Desktop for Mac","image":["https://docker.com/app/uploads/2022/03/time_drift_1.png","https://docker.com/app/uploads/engineering/2019/01/time_drift_2.png","https://docker.com/app/uploads/engineering/2019/01/time_drift_3.png","https://docker.com/app/uploads/engineering/2019/01/rate-1.png","https://docker.com/app/uploads/engineering/2019/01/time_drift_5.png","https://docker.com/app/uploads/engineering/2019/01/time_drift_6.png","https://docker.com/app/uploads/engineering/2019/01/time_drift_7.png"],"datePublished":"2019-02-26T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"David Scott","url":"https://docker.com/author/dscott/"}]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Addressing Time Drift in Docker Desktop for Mac"><meta property="og:description" content="Article(s) > Addressing Time Drift in Docker Desktop for Mac"><meta property="og:type" content="article"><meta property="og:image" content="https://docker.com/app/uploads/2022/03/time_drift_1.png"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://docker.com/app/uploads/2022/03/time_drift_1.png"><meta name="twitter:image:alt" content="Addressing Time Drift in Docker Desktop for Mac"><meta property="article:author" content="David Scott"><meta property="article:tag" content="docker"><meta property="article:tag" content="devops"><meta property="article:tag" content="docker.com"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2019-02-26T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Addressing Time Drift in Docker Desktop for Mac | 📚Bookshelf</title><meta name="description" content="Article(s) > Addressing Time Drift in Docker Desktop for Mac">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">docker.com</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2025</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2024</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2022</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2021</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2020</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2019</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/new-filesharing-implementation-in-docker-desktop-windows.html" aria-label="New Filesharing Implementation in Docker Desktop Windows Improves Developer Inner Loop UXDocker"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->New Filesharing Implementation in Docker Desktop Windows Improves Developer Inner Loop UXDocker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/depend-on-docker-for-kubeflow.html" aria-label="Depend on Docker for Kubeflow"><!--[--><i class="vp-icon iconfont icon-k8s" sizing="both"></i><!--]-->Depend on Docker for Kubeflow<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/developing-docker-windows-app-wsl2.html" aria-label="Developing Docker-Powered Apps on Windows with WSL 2"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Developing Docker-Powered Apps on Windows with WSL 2<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/keep-nodejs-rockin-in-docker.html" aria-label="Top 4 Tactics To Keep Node.js Rockin’ in Docker"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Top 4 Tactics To Keep Node.js Rockin’ in Docker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/road-to-containing-iscsi.html" aria-label="Road to containing iSCSI"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Road to containing iSCSI<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/intro-guide-to-dockerfile-best-practices.html" aria-label="Intro Guide to Dockerfile file Best Practices"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Intro Guide to Dockerfile file Best Practices<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/getting-started-with-docker-for-arm-on-linux.html" aria-label="Getting started with Docker for Arm on Linux"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Getting started with Docker for Arm on Linux<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/containerizing-test-tooling-creating-your-dockerfile-and-makefile.html" aria-label="Containerizing Test Tooling: Creating your file and Makefile"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Containerizing Test Tooling: Creating your file and Makefile<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/whats-in-a-container-platform.html" aria-label="What&#39;s in a Container Platform?"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->What&#39;s in a Container Platform?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/multi-arch-images.html" aria-label="Building Multi-Arch Images for Arm and x86 with  Desktop"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Building Multi-Arch Images for Arm and x86 with  Desktop<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/docker.com/happy-pi-day-docker-raspberry-pi.html" aria-label="Happy Pi Day with  and Raspberry Pi"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Happy Pi Day with  and Raspberry Pi<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html" aria-label="Addressing Time Drift in Docker Desktop for Mac"><!--[--><i class="vp-icon fa-brands fa-docker" sizing="both"></i><!--]-->Addressing Time Drift in Docker Desktop for Mac<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2018</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2017</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2016</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2015</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2013</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://docker.com/app/uploads/2022/03/time_drift_1.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fa-brands fa-docker" sizing="height"></i>Addressing Time Drift in Docker Desktop for Mac</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://docker.com/author/dscott/" target="_blank" rel="noopener noreferrer">David Scott</a></span><span property="author" content="David Scott"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2/26/19</span><meta property="datePublished" content="2019-02-26T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 9 min</span><meta property="timeRequired" content="PT9M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2" role>DevOps</span><span class="page-category-item color8" role>Docker</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="DevOps,Docker,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color5" role>docker.com</span><span class="page-tag-item color7" role>devops</span><span class="page-tag-item color2" role>docker</span><!--]--><meta property="keywords" content="blog,docker.com,devops,docker"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Addressing Time Drift in Docker Desktop for Mac 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/devops/docker/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="/bookshelf/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Docker > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#wait-doesn-t-the-vm-have-a-virtual-hardware-real-time-clock-rtc" class="router-link-active router-link-exact-active">Wait, doesn’t the VM have a (virtual) hardware Real Time Clock (RTC)?</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#how-bad-is-this-in-practice" class="router-link-active router-link-exact-active">How bad is this in practice?</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#ok-can-we-turn-on-ntp-and-forget-about-it" class="router-link-active router-link-exact-active">OK, can we turn on NTP and forget about it?</a><ul><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#how-about-using-the-default-pool-ntp-org-like-everyone-else" class="router-link-active router-link-exact-active">How about using the “default” pool.ntp.org like everyone else?</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#which-server-implementation-should-we-use" class="router-link-active router-link-exact-active">Which server implementation should we use?</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#which-ntp-client-should-we-use-and-does-it-even-matter" class="router-link-active router-link-exact-active">Which NTP client should we use (and does it even matter)?</a></li></ul></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#is-there-anything-special-about-the-final-value-of-the-kernel-frequency-offset" class="router-link-active router-link-exact-active">Is there anything special about the final value of the kernel frequency offset?</a><ul><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#adj-frequency" class="router-link-active router-link-exact-active">ADJ_FREQUENCY</a></li></ul></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#so-what-should-we-do" class="router-link-active router-link-exact-active">So what should we do?*</a><ul><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#option-1-adjust-the-kernel-tick" class="router-link-active router-link-exact-active">Option 1: adjust the kernel “tick”</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#option-2-regularly-bump-the-clock-forward-with-settimeofday-2" class="router-link-active router-link-exact-active">Option 2: regularly bump the clock forward with settimeofday (2)</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#the-choice" class="router-link-active router-link-exact-active">The choice</a></li></ul></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#just-a-sec-couldn-t-we-just-run-hwclock-s-every-30s" class="router-link-active router-link-exact-active">Just a sec, couldn’t we just run hwclock -s every 30s?</a></li><li><a aria-current="page" href="/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html#in-summary" class="router-link-active router-link-exact-active">In Summary</a></li></ul></nav><hr><div class="vp-site-info" data-name="Addressing Time Drift in Docker Desktop for Mac"><a class="vp-site-info-navigator no-external-link-icon" title="Addressing Time Drift in Docker Desktop for Mac" href="https://docker.com/blog/addressing-time-drift-in-docker-desktop-for-mac" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://docker.com/app/uploads/2022/03/time_drift_1.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt loading="lazy" no-view><div class="vp-site-info-name">Addressing Time Drift in Docker Desktop for Mac</div><div class="vp-site-info-desc">Learn from Docker experts to simplify and advance your app development and management with Docker. Stay up to date on Docker events and new version</div></div><!----></div><p>Docker Desktop for Mac runs the Docker engine and Linux containers in a helper <a href="https://github.com/linuxkit" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-github" sizing="height"></i><code>linuxkit</code></a> VM since macOS doesn’t have native container support. The helper VM has its own internal clock, separate from the host’s clock. When the two clocks drift apart then suddenly commands which rely on the time, or on file timestamps, may start to behave differently. For example “make” will stop working properly across shared volumes (“docker run -v”) when the modification times on source files (typically written on the host) are older than the modification times on the binaries (typically written in the VM) even after the source files are changed. Time drift can be very frustrating as you can see by reading issues such as</p><div class="vp-site-info" data-name="Time drift on MacOS · Issue #2076 · docker/for-mac"><a class="vp-site-info-navigator no-external-link-icon" title="Time drift on MacOS · Issue #2076 · docker/for-mac" href="https://github.com/docker/for-mac/issues/2076/" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://opengraph.githubassets.com/ec474e2268a4d6056e12f9ccc3a746d22880b13f6ffc8f8adbe7d9524ce64f1d/docker/for-mac/issues/2076) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://github.githubassets.com/favicons/favicon-dark.svg" alt loading="lazy" no-view><div class="vp-site-info-name">Time drift on MacOS · Issue #2076 · docker/for-mac</div><div class="vp-site-info-desc">Version 17.06.2-ce-mac27 (19124) Can confirm that there is time drift on the Docker client for Mac. I was able to confirm that restarting the Docker client corrects the time issue. Issue is present...</div></div><!----></div><h2 id="wait-doesn-t-the-vm-have-a-virtual-hardware-real-time-clock-rtc" tabindex="-1"><a class="header-anchor" href="#wait-doesn-t-the-vm-have-a-virtual-hardware-real-time-clock-rtc"><span>Wait, doesn’t the VM have a (virtual) hardware Real Time Clock (RTC)?</span></a></h2><p>When the helper VM boots the clocks are initially synchronised by an explicit invocation of “hwclock -s” which reads the <a href="https://github.com/moby/hyperkit/blob/cdbd5d7226f672786847b22fac55c5d8e1571663/src/lib/vmm/vmm_api.c#L730" target="_blank" rel="noopener noreferrer">virtual RTC in HyperKit (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>moby/hyperkit</code>)</a>. Unfortunately reading the RTC is a slow operation (both on physical hardware and virtual) so the Linux kernel builds its own internal clock on top of other sources of timing information, known as <a href="https://github.com/torvalds/linux/blob/195303136f192d37b89e20a8d1d2670d0d825266/include/linux/clocksource.h#L31" target="_blank" rel="noopener noreferrer">clocksources (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>torvalds/linux</code>)</a>. The most reliable is usually the CPU Time Stamp Counter (“tsc”) clocksource which measures time by counting the number of CPU cycles since the last CPU reset. TSC counters are frequently used for benchmarking, where the current TSC value is read (via the <code>rdtsc</code> instruction) at the beginning and then again at the end of a test run. The two values can then be subtracted to yield the time the code took to run in CPU cycles. However there are problems when we try to use these counters long-term as a reliable source of absolute physical time, particularly when running in a VM:</p><ul><li>There is <a href="https://vmware.com/pdf/vmware_timekeeping.pdf?ClickID=dmrb0rnnw0kk2wnwyrkzc0o0szohoyn2rybk" target="_blank" rel="noopener noreferrer"><i class="vp-icon iconfont icon-vmware" sizing="height"></i>no reliable way to discover the TSC frequency</a>: without this we don’t know what to divide the counter values by to transform the result into seconds.</li><li>Some power management technology will change the TSC frequency dynamically.</li><li>The counter can jump back to 0 when the physical CPU is reset, for example over a host suspend / resume.</li><li>When a virtual CPU is stopped executing on one physical CPU core and later starts executing on another one, the TSC counter can suddenly jump forwards or backwards.</li></ul><p>The unreliability of using TSC counters can be seen on this Docker Desktop for Mac install:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--privileged</span> alpine /bin/dmesg <span class="token operator">|</span> <span class="token function">grep</span> clocksource</span>
<span class="line"><span class="token comment"># …</span></span>
<span class="line"><span class="token comment"># [    3.486187] clocksource: Switched to clocksource tsc</span></span>
<span class="line"><span class="token comment"># [ 6963.789123] clocksource: timekeeping watchdog on CPU3: Marking clocksource &#39;tsc&#39; as unstable because the skew is too large:</span></span>
<span class="line"><span class="token comment"># [ 6963.792264] clocksource:                       &#39;hpet&#39; wd_now: 388d8fc2 wd_last: 377f3b7c mask: ffffffff</span></span>
<span class="line"><span class="token comment"># [ 6963.794806] clocksource:                       &#39;tsc&#39; cs_now: 104a0911ec5a cs_last: 10492ccc2aec mask: ffffffffffffffff</span></span>
<span class="line"><span class="token comment"># [ 6963.797812] clocksource: Switched to clocksource hpet</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Many hypervisors fix these problems by providing an explicit “paravirtualised clock” interface, providing enough additional information to the VM to allow it to correctly convert a TSC value to seconds. Unfortunately the Hypervisor.framework on the Mac does not provide enough information (particularly over suspend/resume) to allow the implementation of such a paravirtualised timesource so we reported the issue to Apple and searched for a workaround.</p><hr><h2 id="how-bad-is-this-in-practice" tabindex="-1"><a class="header-anchor" href="#how-bad-is-this-in-practice"><span>How bad is this in practice?</span></a></h2><p>I wrote a simple tool to measure the time drift between a VM and the host– the source is <a href="https://github.com/djs55/hyperkit-measure-time-drift" target="_blank" rel="noopener noreferrer">here (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>djs55/hyperkit-measure-time-drift</code>)</a>. I created a small LinuxKit test VM without any kind of time synchronisation software installed and measured the “natural” clock drift after the VM boots:</p><figure><img src="https://docker.com/app/uploads/2022/03/time_drift_1.png" alt="time drift 1" tabindex="0" loading="lazy"><figcaption>time drift 1</figcaption></figure><p>Each line on the graph shows the clock drift for a different test run. From the graph it appears that the time in the VM loses roughly 2ms for every 3s of host time which passes. Once the total drift gets to about 1s (after approximately 1500s or 25 minutes) it will start to get really annoying.</p><hr><h2 id="ok-can-we-turn-on-ntp-and-forget-about-it" tabindex="-1"><a class="header-anchor" href="#ok-can-we-turn-on-ntp-and-forget-about-it"><span>OK, can we turn on NTP and forget about it?</span></a></h2><p>The Network Time Protocol (NTP) is designed to keep clocks in sync so it should be ideal. The question then becomes</p><ul><li>which client?</li><li>which server?</li></ul><h3 id="how-about-using-the-default-pool-ntp-org-like-everyone-else" tabindex="-1"><a class="header-anchor" href="#how-about-using-the-default-pool-ntp-org-like-everyone-else"><span>How about using the “default” pool.ntp.org like everyone else?</span></a></h3><p>Many machines and devices uses the free pool.ntp.org as their NTP server. This is a bad idea for us for several reasons:</p><ul><li>it’s against their <a href="%5Bhttps://pool.ntp.org/en/vendors.html%5D(http://www.pool.ntp.org/en/vendors.html)"><i class="vp-icon fas fa-globe" sizing="height"></i>guidelines</a> (although we could register as a vendor)</li><li>there’s no guarantee clocks in the NTP server pool are themselves well-synchronised</li><li>people don’t like their Mac sending unexpected UDP traffic; they fear it’s malware infestation</li><li>anyway… we don’t want the VM to synchronise with atomic clocks in some random physics lab, we want it to synchronise with the host (so the timestamps work). If the host itself has drifted 30 minutes away from “real” time, we want the VM to also be 30 minutes away from “real” time.</li></ul><p>Therefore in Docker Desktop we should run our own NTP server on the host, serving the host’s clock.</p><h3 id="which-server-implementation-should-we-use" tabindex="-1"><a class="header-anchor" href="#which-server-implementation-should-we-use"><span>Which server implementation should we use?</span></a></h3><p>The NTP protocol is designed to be robust and globally scalable. Servers with accurate clock hardware (e.g. an atomic clock or a GPS feed containing a signal from an atomic clock) are relatively rare so not all other hosts can connect directly to them. NTP servers are arranged in a hierarchy where lower “strata” synchronise with the stratum directly above and end-users and devices synchronise with the servers at the bottom. Since our use-case only involves one server and one client this is all completely unnecessary and so we use “Simplified NTP” as described in <a href="https://tools.ietf.org/html/rfc2030" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>RFC2030</a> which enables clients (in our case the VM) to synchronise immediately with a server (in our case the host).</p><h3 id="which-ntp-client-should-we-use-and-does-it-even-matter" tabindex="-1"><a class="header-anchor" href="#which-ntp-client-should-we-use-and-does-it-even-matter"><span>Which NTP client should we use (and does it even matter)?</span></a></h3><p>Early versions of Docker Desktop included <a href="https://openntpd.org" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>openntpd</a> from the <a href="https://github.com/linuxkit/linuxkit/tree/master/pkg/openntpd" target="_blank" rel="noopener noreferrer">upstream LinuxKit package (<i class="vp-icon iconfont icon-github" sizing="height"></i><code>linuxkit/linuxkit</code>)</a>. The following graph shows the time drift on one VM boot where openntpd runs for the first 10000s and then we switch to the busybox NTP client:</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/time_drift_2.png" alt="time drift 2" tabindex="0" loading="lazy"><figcaption>time drift 2</figcaption></figure><p>The diagram shows the clock still drifting significantly with openntpd running but it’s “fixed” by running busybox — why is this? To understand this it’s important to first understand how an NTP client adjusts the Linux kernel clock:</p><ul><li><a href="http://man7.org/linux/man-pages/man3/adjtime.3.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>adjtime (3)</a> – this accepts a delta (e.g. -10s) and tells the kernel to gradually adjust the system clock avoiding suddenly moving the clock forward (or backward, which can cause problems with timing loops which aren’t using monotonic clocks)</li><li><a href="http://man7.org/linux/man-pages/man2/adjtimex.2.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>adjtimex (2)</a> – this allows the kernel clock *rate* itself to be adjusted, to cope with systematic drift like we are suffering from</li><li><a href="https://linux.die.net/man/2/settimeofday" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>settimeofday (2)</a> – this immediately bumps the clock to the given time</li></ul><p>If we look at line 433 of <a href="https://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.sbin/ntpd/ntpd.c?annotate=1.113" target="_blank" rel="noopener noreferrer">openntpd ntp.c</a> (sorry no direct link in cvsweb) then we can see that openntpd is using adjtime to periodically add a delta to the clock, to try to correct the drift. This could also be seen in the openntpd logs. So why wasn’t this effective?</p><p>The following graph shows how the natural clock drift is affected by a call to adjtime(+10s) and adjtime(-10s):</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/time_drift_3.png" alt="time drift 3" tabindex="0" loading="lazy"><figcaption>time drift 3</figcaption></figure><p>It seems the “natural” drift we’re experiencing is so large it can’t be compensated for solely by using “adjtime”. The reason busybox performs better for us is because it adjusts the clock rate itself using “adjtimex”.</p><p>The following graph shows the change in kernel clock frequency (<code>timex.freq</code>) viewed using adjtimex. For the first 10000s we use openntpd (and hence the adjustment is 0 since it doesn’t use the API) and for the rest of the graph we used busybox:</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/rate-1.png" alt="rate 1" tabindex="0" loading="lazy"><figcaption>rate 1</figcaption></figure><p>Note how the adjustment value remains flat and very negative after an initial spike upwards. I have to admit when I first saw this graph I was disappointed — I was hoping to see something zig-zag up and down, as the clock rate was constantly micro-managed to remain stable.</p><hr><h2 id="is-there-anything-special-about-the-final-value-of-the-kernel-frequency-offset" tabindex="-1"><a class="header-anchor" href="#is-there-anything-special-about-the-final-value-of-the-kernel-frequency-offset"><span>Is there anything special about the final value of the kernel frequency offset?</span></a></h2><p>Unfortunately it is special. From the <a href="http://man7.org/linux/man-pages/man2/adjtimex.2.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>adjtimex (2) manpage</a>:</p><h3 id="adj-frequency" tabindex="-1"><a class="header-anchor" href="#adj-frequency"><span>ADJ_FREQUENCY</span></a></h3><p>Set frequency offset from <em>buf.freq</em>. Since Linux 2.6.26, the supplied value is clamped to the range (-32768000, +32768000).</p><p>So it looks like busybox slowed the clock by the maximum amount (-32768000) to correct the systematic drift. According to the <a href="https://linux.die.net/man/8/adjtimex" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>adjtimex(8) manpage</a> a value of 65536 corresponds to 1ppm, so 32768000 corresponds to 500ppm. Recall that the original estimate of the systematic drift was 2ms every 3s, which is about 666ppm. This isn’t good: this means that we’re right at the limit of what adjtimex can do to compensate for it and are probably also relying on adjtime to provide additional adjustments. Unfortunately all our tests have been on one single machine and it’s easy to imagine a different system (perhaps with different powersaving behaviour) where even adjtimex + adjtime would be unable to cope with the drift.</p><hr><h2 id="so-what-should-we-do" tabindex="-1"><a class="header-anchor" href="#so-what-should-we-do"><span>So what should we do?*</span></a></h2><p>The main reason why NTP clients use APIs like adjtime and adjtimex is because they want</p><ul><li>monotonicity: i.e. to ensure time never goes backwards because this can cause bugs in programs which aren’t using monotonic clocks for timing, for example <a href="https://blog.cloudflare.com/how-and-why-the-leap-second-affected-cloudflare-dns/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-cloudflare" sizing="height"></i>How and why the leap second affected Cloudflare DNS</a>; and</li><li>smoothness: i.e. no sudden jumping forwards, triggering lots of timing loops, cron jobs etc at once.</li></ul><p>Docker Desktop is used by developers to build and test their code on their laptops and desktops. Developers routinely edit files on their host with an IDE and then build them in a container using <code>docker run -v</code>. This requires the clock in the VM to be synchronised with the clock in the host, otherwise tools like <code>make</code> will fail to rebuild changed source files correctly.</p><h3 id="option-1-adjust-the-kernel-tick" tabindex="-1"><a class="header-anchor" href="#option-1-adjust-the-kernel-tick"><span>Option 1: adjust the kernel “tick”</span></a></h3><p>According to <a href="https://linux.die.net/man/8/adjtimex" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>adjtimex(8)</a> it’s possible to adjust the kernel “tick”:</p><blockquote><p>Set the number of microseconds that should be added to the system time for each kernel tick interrupt. For a kernel with USER_HZ=100, there are supposed to be 100 ticks per second, so <em>val</em> should be close to 10000. Increasing <em>val</em> by 1 speeds up the system clock by about 100 ppm,</p></blockquote><p>If we knew (or could measure) the systematic drift we could make a coarse-grained adjustment with the “tick” and then let busybox NTP to manage the remaining drift.</p><h3 id="option-2-regularly-bump-the-clock-forward-with-settimeofday-2" tabindex="-1"><a class="header-anchor" href="#option-2-regularly-bump-the-clock-forward-with-settimeofday-2"><span>Option 2: regularly bump the clock forward with settimeofday (2)</span></a></h3><p>If we assume that the clock in the VM is always running slower than the real physical clock (because it is virtualised, vCPUs are periodically descheduled etc) and if we don’t care about smoothness, we could use an NTP client which calls <a href="https://linux.die.net/man/2/settimeofday" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>settimeofday (2)</a> periodically to immediately resync the clock.</p><h3 id="the-choice" tabindex="-1"><a class="header-anchor" href="#the-choice"><span>The choice</span></a></h3><p>Although option 1 could potentially provide the best results, we decided to keep it simple and go with option 2: regularly bump the clock forward with <a href="https://linux.die.net/man/2/settimeofday" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>settimeofday (2)</a> rather than attempt to measure and adjust the kernel tick. We assume that the VM clock always runs slower than the host clock but we don’t have to measure exactly how much it runs slower, or assume that the slowness remains constant over time, or across different hardware setups. The solution is very simple and easy to understand. The VM clock should stay in close sync with the host and it should still be monotonic but it will not be very smooth.</p><p>We use an NTP client called <a href="https://git.alpinelinux.org/cgit/hosted/sntpc/tree/sntpc.c" target="_blank" rel="noopener noreferrer"><i class="vp-icon fa-brands fa-alpine" sizing="height"></i>SNTPC</a> written by Natanael Copa, founder of Alpine Linux (quite a coincidence considering we use Alpine extensively in Docker Desktop). SNTPC can be configured to call settimeofday every n seconds with the following results:</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/time_drift_5.png" alt="time drift 5" tabindex="0" loading="lazy"><figcaption>time drift 5</figcaption></figure><p>As you can see in the graph, every 30s the VM clock has fallen behind by 20ms and is then bumped forward. Note that since the VM clock is always running slower than the host, the VM clock always jumps forwards but never backwards, maintaining monotonicity.</p><hr><h2 id="just-a-sec-couldn-t-we-just-run-hwclock-s-every-30s" tabindex="-1"><a class="header-anchor" href="#just-a-sec-couldn-t-we-just-run-hwclock-s-every-30s"><span>Just a sec, couldn’t we just run hwclock -s every 30s?</span></a></h2><p>Rather than running a simple NTP client and server communicating over UDP every 30s we could instead run hwclock -s to synchronise with the hardware RTC every 30s. Reading the RTC is inefficient because the memory reads trap to the hypervisor and block the vCPU, unlike UDP traffic which is efficiently queued in shared memory; however the code would be simple and an expensive operation once every 30s isn’t too bad. How well would it actually keep the clock in sync?</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/time_drift_6.png" alt="time drift 6" tabindex="0" loading="lazy"><figcaption>time drift 6</figcaption></figure><p>Unfortunately running hwclock -s in a HyperKit Linux VM only manages to keep the clock in sync within about 1s, which would be quite noticeable when editing code and immediately recompiling it. So we’ll stick with NTP.</p><div class="hint-container info"><p class="hint-container-title">Final design</p><p>The final design looks like this:</p><figure><img src="https://docker.com/app/uploads/engineering/2019/01/time_drift_7.png" alt="time drift 7" tabindex="0" loading="lazy"><figcaption>time drift 7</figcaption></figure><p>In the VM the sntpc process sends UDP on port 123 (the NTP port) to the virtual NTP server running on the gateway, managed by the vpnkit process on the host. The NTP traffic is forwarded to a custom SNTP server running on localhost which executes gettimeofday and replies. The sntpc process receives the reply, calculates the local time by subtracting an estimate of the round-trip-time and calls settimeofday to bump the clock to the correct value.</p></div><hr><h2 id="in-summary" tabindex="-1"><a class="header-anchor" href="#in-summary"><span>In Summary</span></a></h2><ul><li>Timekeeping in computers is hard (especially so in virtual computers)</li><li>There’s a serious source of systematic drift in the macOS Hypervisor.framework, HyperKit, Linux system.</li><li>Minimising time drift is important for developer use-cases where file timestamps are used in build tools like make</li><li>For developer use-cases we don’t mind if the clock moves abruptly forwards</li><li>We’ve settled on a simple design using a standard protocol (SNTP) and a pre-existing client (sntpc)</li><li>The new design is very simple and should be robust: even if the clock drift rate is faster in future (e.g. because of a bug in the Hypervisor.framework or HyperKit) the clock will still be kept in sync.</li><li>The new code has shipped on both the stable and the edge channels (as of 18.05)</li></ul><!-- TODO: add ARTICLE CARD --><a class="vp-card" href="https://chanhi2000.github.io/bookshelf/docker.com/addressing-time-drift-in-docker-desktop-for-mac.html" target="_blank" style="background:rgba(29,99,237,0.2);"><img class="vp-card-logo" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Addressing Time Drift in Docker Desktop for Mac</div><hr><div class="vp-card-desc">Learn from Docker experts to simplify and advance your app development and management with Docker. Stay up to date on Docker events and new version</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/docker.com/addressing-time-drift-in-docker-desktop-for-mac.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/devops/docker/articles/" aria-label="/devops/docker/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/devops/docker/articles/</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><div class="vp-copyright">Copyright © 2025 David Scott </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
