<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Implementing the Outbox Pattern","image":["https://milanjovanovic.tech/blogs/mnw_110/outbox_pattern.png?imwidth=3840"],"datePublished":"2024-10-05T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Milan Jovanović"}]}</script><meta property="og:url" content="https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html"><meta property="og:site_name" content="📚Bookshelf"><meta property="og:title" content="Implementing the Outbox Pattern"><meta property="og:description" content="Article(s) > Implementing the Outbox Pattern"><meta property="og:type" content="article"><meta property="og:image" content="https://milanjovanovic.tech/blog-covers/mnw_110.png"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://milanjovanovic.tech/blog-covers/mnw_110.png"><meta name="twitter:image:alt" content="Implementing the Outbox Pattern"><meta property="article:author" content="Milan Jovanović"><meta property="article:tag" content="dotnet"><meta property="article:tag" content="csharp"><meta property="article:tag" content="c#"><meta property="article:tag" content="cs"><meta property="article:tag" content="milanjovanovic.tech"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2024-10-05T00:00:00.000Z"><link rel="icon" href="/bookshelf/assets/icon/favicon.svg"><title>Implementing the Outbox Pattern | 📚Bookshelf</title><meta name="description" content="Article(s) > Implementing the Outbox Pattern">
    <link rel="preload" href="/bookshelf/assets/style-DmRYlEXZ.css" as="style"><link rel="stylesheet" href="/bookshelf/assets/style-DmRYlEXZ.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/bookshelf/" aria-label="Take me home"><img class="vp-nav-logo" src="/bookshelf/assets/icon/favicon.svg" alt><!----><span class="vp-site-name hide-in-pad">📚Bookshelf</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/bookshelf/news.html" aria-label><!--[--><i class="vp-icon fas fa-rss" sizing="height"></i><!--]--><!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-keyboard" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/hackingwithswift.com/" aria-label="hackingwithswift.com"><!--[--><img class="vp-icon" src="https://hackingwithswift.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->hackingwithswift.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fcc/" aria-label="freecodecamp.org"><!--[--><img class="vp-icon" src="https://cdn.freecodecamp.org/universal/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->freecodecamp.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kodeco.com/" aria-label="kodeco.com"><!--[--><img class="vp-icon" src="https://kodeco.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->kodeco.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.kotzilla.io/" aria-label="blog.kotzilla.io"><!--[--><img class="vp-icon" src="https://blog.kotzilla.io/hubfs/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.kotzilla.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/kt.academy/" aria-label="kt.academy"><!--[--><img class="vp-icon" src="https://kt.academy/logo.png" alt aria-hidden no-view sizing="both"><!--]-->kt.academy<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/droidcon.com/" aria-label="droidcon.com"><!--[--><img class="vp-icon" src="https://droidcon.com/wp-content/uploads/2021/07/favicon-300x300.png" alt aria-hidden no-view sizing="both"><!--]-->droidcon.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/outcomeschool.com/" aria-label="outcomeschool.com"><!--[--><img class="vp-icon" src="https://outcomeschool.com/static/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->outcomeschool.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/frontendmasters.com/" aria-label="frontendmasters.com"><!--[--><img class="vp-icon" src="https://frontendmasters.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->frontendmasters.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/css-tricks.com/" aria-label="css-tricks.com"><!--[--><img class="vp-icon" src="https://css-tricks.com/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->css-tricks.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/smashingmagazine.com/" aria-label="smashingmagazine.com"><!--[--><img class="vp-icon" src="https://smashingmagazine.com/images/favicon/favicon.svg" alt aria-hidden no-view sizing="both"><!--]-->smashingmagazine.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.logrocket.com/" aria-label="blog.logrocket.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/blog.logrocket.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->blog.logrocket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/realpython.com/" aria-label="realpython.com"><!--[--><img class="vp-icon" src="https://realpython.com/static/favicon.68cbf4197b0c.png" alt aria-hidden no-view sizing="both"><!--]-->realpython.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/digitalocean.com/" aria-label="digitalocean.com"><!--[--><img class="vp-icon" src="https://digitalocean.com/_next/static/media/favicon.594d6067.ico" alt aria-hidden no-view sizing="both"><!--]-->digitalocean.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/antonioleiva.com/" aria-label="antonioleiva.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/antonioleiva.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->antonioleiva.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/johnnyreilly.com/" aria-label="johnnyreilly.com"><!--[--><img class="vp-icon" src="https://johnnyreilly.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->johnnyreilly.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/code-maze.com/" aria-label="code-maze.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/code-maze.com/favicon.png" alt aria-hidden no-view sizing="both"><!--]-->code-maze.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/bookshelf/milanjovanovic.tech/" aria-label="milanjovanovic.tech"><!--[--><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><!--]-->milanjovanovic.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/shopify.engineering/" aria-label="shopify.engineering"><!--[--><img class="vp-icon" src="https://cdn.shopify.com/static/shopify-favicon.png" alt aria-hidden no-view sizing="both"><!--]-->shopify.engineering<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devtoolstips.org/" aria-label="devtoolstips.org"><!--[--><img class="vp-icon" src="https://devtoolstips.org/assets/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devtoolstips.org<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/piccalil.li/" aria-label="piccalil.li"><!--[--><img class="vp-icon" src="https://piccalil.li/favicons/apple-touch-icon.png" alt aria-hidden no-view sizing="both"><!--]-->piccalil.li<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/sitepoint.com/" aria-label="sitepoint.com"><!--[--><img class="vp-icon" src="https://sitepoint.com/favicons/512x512.png" alt aria-hidden no-view sizing="both"><!--]-->sitepoint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/event-driven.io/" aria-label="event-driven.io"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/event-driven.io/favicon.jfif" alt aria-hidden no-view sizing="both"><!--]-->event-driven.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/packagemain.tech/" aria-label="packagemain.tech"><!--[--><img class="vp-icon" src="https://substack-post-media.s3.amazonaws.com/public/images/2ea54e25-eaa6-4630-bfc0-10b8cfdce894/apple-touch-icon-1024x1024.png" alt aria-hidden no-view sizing="both"><!--]-->packagemain.tech<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/gosolve.io/" aria-label="gosolve.io"><!--[--><img class="vp-icon" src="https://gosolve.io/wp-content/uploads/2022/03/cropped-ikona1-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->gosolve.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/towardsdatascience.com/" aria-label="towardsdatascience.com"><!--[--><img class="vp-icon" src="https://cdn-images-1.medium.com/v2/resize:fill:128:128/1*VzTUkfeGymHP4Bvav-T-lA.png" alt aria-hidden no-view sizing="both"><!--]-->towardsdatascience.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/douggregor.net/" aria-label="douggregor.net"><!--[--><i class="vp-icon fas fa-globe" sizing="both"></i><!--]-->douggregor.net<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/d2.naver.com/" aria-label="d2.naver.com"><!--[--><img class="vp-icon" src="/bookshelf/assets/image/d2.naver.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->d2.naver.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakao.com/" aria-label="tech.kakao.com"><!--[--><img class="vp-icon" src="https://www.kakaocorp.com/page/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakao.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tech.kakaopay.com/" aria-label="tech.kakaopay.com"><!--[--><img class="vp-icon" src="https://tech.kakaopay.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tech.kakaopay.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/fe-developers.kakaoent.com/" aria-label="fe-developers.kakaoent.com"><!--[--><img class="vp-icon" src="https://fe-developers.kakaoent.com/favicon-32x32.png?v=44803cb16c1e2debd3984cf2e8cb2ded" alt aria-hidden no-view sizing="both"><!--]-->fe-developers.kakaoent.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/yozm.wishket.com/" aria-label="yozm.wishket.com"><!--[--><img class="vp-icon" src="https://yozm.wishket.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->yozm.wishket.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/popit.kr/" aria-label="popit.kr"><!--[--><img class="vp-icon" src="https://popit.kr/wp-content/uploads/2016/08/favicon_32x32.png" alt aria-hidden no-view sizing="both"><!--]-->popit.kr<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/devkuma.com/" aria-label="devkuma.com"><!--[--><img class="vp-icon" src="https://devkuma.com/favicons/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->devkuma.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/blog.gangnamunni.com/" aria-label="blog.gangnamunni.com"><!--[--><img class="vp-icon" src="https://blog.gangnamunni.com/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->blog.gangnamunni.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/codingeverybody.kr/" aria-label="codingeverybody.kr"><!--[--><img class="vp-icon" src="https://codingeverybody.kr/wp-content/uploads/cropped-favicon-origin-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->codingeverybody.kr<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label><!--[--><i class="vp-icon fas fa-network-wired" sizing="height"></i><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/tecmint.com/" aria-label="tecmint.com"><!--[--><img class="vp-icon" src="https://tecmint.com/wp-content/uploads/2020/07/favicon.ico" alt aria-hidden no-view sizing="both"><!--]-->tecmint.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/docker.com/" aria-label="docker.com"><!--[--><img class="vp-icon" src="https://docker.com/app/uploads/2024/02/cropped-docker-logo-favicon-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->docker.com<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/learnk8s.io/" aria-label="learnk8s.io"><!--[--><img class="vp-icon" src="https://static.learnk8s.io/f7e5160d4744cf05c46161170b5c11c9.svg" alt aria-hidden no-view sizing="both"><!--]-->learnk8s.io<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/bookshelf/itsfoss.com/" aria-label="itsfoss.com"><!--[--><img class="vp-icon" src="https://itsfoss.com/content/images/size/w256h256/2022/12/android-chrome-192x192.png" alt aria-hidden no-view sizing="both"><!--]-->itsfoss.com<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chanhi2000/articles" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-appearance-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-appearance-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="vp-icon" src="https://milanjovanovic.tech/profile_favicon.png" alt aria-hidden no-view sizing="both"><span class="vp-sidebar-title">milanjovanovic.tech</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2025</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2024</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/what-rewriting-a-40-year-old-project-taught-me-about-software-development.html" aria-label="What Rewriting a 40-Year-Old Project Taught Me About Software Development"><!--[--><i class="vp-icon fas fa-user-tie" sizing="both"></i><!--]-->What Rewriting a 40-Year-Old Project Taught Me About Software Development<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/scheduling-background-jobs-with-quartz-in-dotnet-advanced-concepts.html" aria-label="Scheduling Background Jobs With Quartz in .NET (advanced concepts)"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Scheduling Background Jobs With Quartz in .NET (advanced concepts)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/internal-vs-public-apis-in-modular-monoliths.html" aria-label="Internal vs. Public APIs in Modular Monoliths"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Internal vs. Public APIs in Modular Monoliths<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/central-package-management-in-net-simplify-nuget-dependencies.html" aria-label="Central Package Management in .NET - Simplify NuGet Dependencies"><!--[--><i class="vp-icon iconfont icon-powershell" sizing="both"></i><!--]-->Central Package Management in .NET - Simplify NuGet Dependencies<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/implementing-the-saga-pattern-with-masstransit.html" aria-label="Implementing the Saga Pattern With MassTransit"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Implementing the Saga Pattern With MassTransit<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/building-async-apis-in-aspnetcore-the-right-way.html" aria-label="Building Async APIs in ASP.NET Core - The Right Way"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Building Async APIs in ASP.NET Core - The Right Way<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/hybrid-cache-in-aspnetcore-new-caching-library.html" aria-label="HybridCache in ASP.NET Core - New Caching Library"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->HybridCache in ASP.NET Core - New Caching Library<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/functional-programming-in-csharp-the-practical-parts.html" aria-label="Functional Programming in C#: The Practical Parts"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Functional Programming in C#: The Practical Parts<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/clean-architecture-the-missing-chapter.html" aria-label="Clean Architecture: The Missing Chapter"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Clean Architecture: The Missing Chapter<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/implementing-idempotent-rest-apis-in-aspnetcore.html" aria-label="Implementing Idempotent REST APIs in ASP.NET Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Implementing Idempotent REST APIs in ASP.NET Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/problem-details-for-aspnetcore-apis.html" aria-label="Problem Details for ASP.NET Core APIs"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Problem Details for ASP.NET Core APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/scaling-the-outbox-pattern.html" aria-label="Scaling the Outbox Pattern (2B+ messages per day)"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Scaling the Outbox Pattern (2B+ messages per day)<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html" aria-label="Implementing the Outbox Pattern"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Implementing the Outbox Pattern<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html" aria-label="Breaking It Down: How to Migrate Your Modular Monolith to Microservices"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Breaking It Down: How to Migrate Your Modular Monolith to Microservices<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/how-i-implemented-full-text-search-on-my-website.html" aria-label="How I Implemented Full-Text Search On My Website"><!--[--><i class="vp-icon iconfont icon-nextjs" sizing="both"></i><!--]-->How I Implemented Full-Text Search On My Website<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/dotnet-aspire-a-game-changer-for-cloud-native-development.html" aria-label=".NET Aspire: A Game-Changer for Cloud-Native Development?"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->.NET Aspire: A Game-Changer for Cloud-Native Development?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/refit-in-dotnet-building-robust-api-clients-in-csharp.html" aria-label="Refit in .NET: Building Robust API Clients in C#"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Refit in .NET: Building Robust API Clients in C#<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/introduction-to-event-sourcing-for-net-developers.html" aria-label="Introduction to Event Sourcing for .NET Developers"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Introduction to Event Sourcing for .NET Developers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/screaming-architecture.html" aria-label="Screaming Architecture"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->Screaming Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/complete-guide-to-amazon-sqs-and-amazon-sns-with-masstransit.html" aria-label="Complete Guide to Amazon SQS and Amazon SNS With MassTransit"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Complete Guide to Amazon SQS and Amazon SNS With MassTransit<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/5-ef-core-features-you-need-to-know.html" aria-label="5 EF Core Features You Need To Know"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->5 EF Core Features You Need To Know<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/improving-code-quality-in-csharp-with-static-code-analysis.html" aria-label="Improving Code Quality in C# With Static Code Analysis"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Improving Code Quality in C# With Static Code Analysis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/simple-messaging-in-dotnet-with-redis-pubsub.html" aria-label="Simple Messaging in .NET With Redis Pub/Sub"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Simple Messaging in .NET With Redis Pub/Sub<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/testing-modular-monoliths-system-integration-testing.html" aria-label="Testing Modular Monoliths: System Integration Testing"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Testing Modular Monoliths: System Integration Testing<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/building-your-first-use-case-with-clean-architecture.html" aria-label="Building Your First Use Case With Clean Architecture"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Building Your First Use Case With Clean Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/service-discovery-in-microservices-with-net-and-consul.html" aria-label="Service Discovery in Microservices With .NET and Consul"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Service Discovery in Microservices With .NET and Consul<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/flexible-pdf-reporting-in-net-using-razor-views.html" aria-label="Flexible PDF Reporting in .NET Using Razor Views"><!--[--><i class="vp-icon iconfont icon-blazor" sizing="both"></i><!--]-->Flexible PDF Reporting in .NET Using Razor Views<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/what-you-need-to-know-about-ef-core-bulk-updates.html" aria-label="What You Need To Know About EF Core Bulk Updates"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->What You Need To Know About EF Core Bulk Updates<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/from-transaction-scripts-to-domain-models-a-refactoring-journey.html" aria-label="From Transaction Scripts to Domain Models: A Refactoring Journey"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->From Transaction Scripts to Domain Models: A Refactoring Journey<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/caching-in-aspnetcore-improving-application-performance.html" aria-label="Caching in ASP.NET Core: Improving Application Performance"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Caching in ASP.NET Core: Improving Application Performance<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/vertical-slice-architecture-structuring-vertical-slices.html" aria-label="Vertical Slice Architecture: Structuring Vertical Slices"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Vertical Slice Architecture: Structuring Vertical Slices<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/shift-left-with-architecture-testing-in-dotnet.html" aria-label="Shift Left With Architecture Testing in .NET"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Shift Left With Architecture Testing in .NET<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/efcore-migrations-a-detailed-guide.html" aria-label="EF Core Migrations: A Detailed Guide"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->EF Core Migrations: A Detailed Guide<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/building-resilient-cloud-applications-with-dotnet.html" aria-label="Building Resilient Cloud Applications With .NET"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Building Resilient Cloud Applications With .NET<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html" aria-label="Implementing API Gateway Authentication With YARP"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Implementing API Gateway Authentication With YARP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/request-response-messaging-pattern-with-masstransit.html" aria-label="Request-Response Messaging Pattern With MassTransit"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Request-Response Messaging Pattern With MassTransit<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html" aria-label="Introduction to Distributed Tracing With OpenTelemetry in .NET"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Introduction to Distributed Tracing With OpenTelemetry in .NET<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/a-clever-way-to-implement-pessimistic-locking-in-ef-core.html" aria-label="A Clever Way To Implement Pessimistic Locking in EF Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->A Clever Way To Implement Pessimistic Locking in EF Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/master-claims-transformation-for-flexible-aspnetcore-authorization.html" aria-label="Master Claims Transformation for Flexible ASP.NET Core Authorization"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Master Claims Transformation for Flexible ASP.NET Core Authorization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html" aria-label="Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/fast-sql-bulk-inserts-with-csharp-and-ef-core.html" aria-label="Fast SQL Bulk Inserts With C# and EF Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Fast SQL Bulk Inserts With C# and EF Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/implementing-soft-delete-with-ef-core.html" aria-label="Implementing Soft Delete With EF Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Implementing Soft Delete With EF Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/what-is-a-modular-monolith.html" aria-label="What Is a Modular Monolith?"><!--[--><i class="vp-icon fas fa-pen-ruler" sizing="both"></i><!--]-->What Is a Modular Monolith?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/lightweight-in-memory-message-bus-using-dotnet-channels.html" aria-label="Lightweight In-Memory Message Bus Using .NET Channels"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Lightweight In-Memory Message Bus Using .NET Channels<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/automatically-register-minimal-apis-in-aspnetcore.html" aria-label="Automatically Register Minimal APIs in ASP.NET Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Automatically Register Minimal APIs in ASP.NET Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/using-scoped-services-from-singletons-in-aspnetcore.html" aria-label="Using Scoped Services From Singletons in ASP.NET Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Using Scoped Services From Singletons in ASP.NET Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/getting-the-current-user-in-clean-architecture.html" aria-label="Getting the Current User in Clean Architecture"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Getting the Current User in Clean Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/how-i-made-my-efcore-query-faster-with-batching.html" aria-label="How I Made My EF Core Query 3.42x Faster With Batching"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->How I Made My EF Core Query 3.42x Faster With Batching<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/how-to-build-a-url-shortener-with-dotnet.html" aria-label="How to Build a URL Shortener With .NET"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->How to Build a URL Shortener With .NET<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/balancing-cross-cutting-concerns-in-clean-architecture.html" aria-label="Balancing Cross-Cutting Concerns in Clean Architecture"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Balancing Cross-Cutting Concerns in Clean Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/extending-httpclient-with-delegating-handlers-in-aspnetcore.html" aria-label="Extending HttpClient With Delegating Handlers in ASP.NET Core"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Extending HttpClient With Delegating Handlers in ASP.NET Core<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/bookshelf/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html" aria-label="Using MassTransit with RabbitMQ and Azure Service Bus"><!--[--><i class="vp-icon iconfont icon-csharp" sizing="both"></i><!--]-->Using MassTransit with RabbitMQ and Azure Service Bus<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2022</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="https://milanjovanovic.tech/blog-covers/mnw_110.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-csharp" sizing="height"></i>Implementing the Outbox Pattern</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Milan Jovanović</span></span><span property="author" content="Milan Jovanović"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">10/5/24</span><meta property="datePublished" content="2024-10-05T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 6 min</span><meta property="timeRequired" content="PT6M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color0" role>C#</span><span class="page-category-item color3" role>DotNet</span><span class="page-category-item color8" role>Article(s)</span><!--]--><meta property="articleSection" content="C#,DotNet,Article(s)"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8" role>blog</span><span class="page-tag-item color5" role>milanjovanovic.tech</span><span class="page-tag-item color5" role>cs</span><span class="page-tag-item color4" role>c#</span><span class="page-tag-item color2" role>csharp</span><span class="page-tag-item color0" role>dotnet</span><!--]--><meta property="keywords" content="blog,milanjovanovic.tech,cs,c#,csharp,dotnet"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="frontmatter-title-관련" tabindex="-1"><a class="header-anchor" href="#frontmatter-title-관련"><span>Implementing the Outbox Pattern 관련</span></a></h1><a class="route-link vp-card" href="/bookshelf/programming/cs/articles/" style="background:rgba(10,10,10,0.2);"><img class="vp-card-logo" src="https://chanhi2000.github.io/images/ico-wind.svg" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">C# > Article(s)</div><hr><div class="vp-card-desc">Article(s)</div></div></a><nav class="table-of-contents"><ul><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#why-do-we-need-the-outbox-pattern" class="router-link-active router-link-exact-active">Why Do We Need the Outbox Pattern?</a></li><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#implementing-the-outbox-pattern" class="router-link-active router-link-exact-active">Implementing the Outbox Pattern</a></li><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#processing-the-outbox" class="router-link-active router-link-exact-active">Processing the Outbox</a></li><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#considerations-and-tradeoffs" class="router-link-active router-link-exact-active">Considerations and Tradeoffs</a></li><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#scaling-outbox-processing" class="router-link-active router-link-exact-active">Scaling Outbox Processing</a></li><li><a aria-current="page" href="/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html#wrapping-up" class="router-link-active router-link-exact-active">Wrapping Up</a></li></ul></nav><hr><div class="vp-site-info" data-name="Implementing the Outbox Pattern"><a class="vp-site-info-navigator no-external-link-icon" title="Implementing the Outbox Pattern" href="https://milanjovanovic.tech/blog/implementing-the-outbox-pattern" target="_blank"></a><div class="vp-site-info-preview" style="background:url(https://milanjovanovic.tech/blog-covers/mnw_110.png) center/cover no-repeat;"></div><div class="vp-site-info-detail"><img class="vp-site-info-logo" src="https://milanjovanovic.tech/profile_favicon.png" alt loading="lazy" no-view><div class="vp-site-info-name">Implementing the Outbox Pattern</div><div class="vp-site-info-desc">Discover how the Outbox pattern solves the dual-write problem in distributed systems, ensuring data consistency between your database and external components. This article provides practical strategies for implementing and scaling the Outbox pattern in .NET applications.</div></div><!----></div><p>In distributed systems, we often face the challenge of keeping our database and external systems in sync. Imagine saving an order to a database and then publishing a message to a message broker. If either operation fails, your system ends up in an inconsistent state.</p><p>The <a class="route-link" href="/bookshelf/milanjovanovic.tech/outbox-pattern-for-reliable-microservices-messaging.html">Outbox pattern</a> solves this problem by treating message publication as part of your database transaction. Instead of publishing messages directly, we save them to an Outbox table in our database, ensuring atomic operations. A separate process then reliably publishes these messages.</p><p>In this newsletter, we&#39;ll dive into implementing this pattern in .NET, covering everything from setup to scaling.</p><hr><h2 id="why-do-we-need-the-outbox-pattern" tabindex="-1"><a class="header-anchor" href="#why-do-we-need-the-outbox-pattern"><span>Why Do We Need the Outbox Pattern?</span></a></h2><p>The transactional Outbox pattern fixes a common problem in distributed systems. This problem happens when you need to do two things at once: save data and communicate with an external component.</p><p>Consider scenarios like sending order confirmation emails, notifying other systems about new client registrations, or updating inventory levels after an order is placed. Each of these involves a local data change coupled with an external communication or update.</p><p>For example, imagine a microservice that needs to:</p><ul><li>Save a new order in its database</li><li>Tell other systems about this new order</li></ul><p>If one of these steps fails, your system could end up in an inconsistent state. Maybe the order is saved, but no one else knows about it. Or everyone thinks there&#39;s a new order, but it&#39;s not actually in the database.</p><p>Here&#39;s a <code>CreateOrderCommandHandler</code> without the Outbox pattern:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="CreateOrderCommandHandler.cs"><span>CreateOrderCommandHandler.cs</span></div><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateOrderCommandHandler</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">IOrderRepository</span> orderRepository<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IProductInventoryChecker</span> inventoryChecker<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IUnitOfWork</span> unitOfWork<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IEventBus</span> eventBus<span class="token punctuation">)</span> <span class="token punctuation">:</span> IRequestHandler<span class="token operator">&lt;</span>CreateOrderCommand<span class="token punctuation">,</span> OrderDto<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>OrderDto<span class="token punctuation">&gt;</span></span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">CreateOrderCommand</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Order</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>CustomerId<span class="token punctuation">,</span> request<span class="token punctuation">.</span>ProductId<span class="token punctuation">,</span> request<span class="token punctuation">.</span>Quantity<span class="token punctuation">,</span> inventoryChecker<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> orderRepository<span class="token punctuation">.</span><span class="token function">AddAsync</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> unitOfWork<span class="token punctuation">.</span><span class="token function">CommitAsync</span><span class="token punctuation">(</span>cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// The database transaction is completed at this point.</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> eventBus<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrderCreatedIntegrationEvent</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrderDto</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> order<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> Total <span class="token operator">=</span> order<span class="token punctuation">.</span>Total <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This code has a potential consistency problem. After the database transaction is committed, two things could go wrong:</p><ol><li>The application might crash right after the transaction is committed but before the event is sent. The order would be created in the database, but other systems wouldn&#39;t know about it.</li><li>The event bus might be down or unreachable when we try to send the event. This would result in the order being created without notifying other systems.</li></ol><p>The transactional Outbox pattern helps solve this problem by ensuring that the database update and event publication are treated as a single atomic operation.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_110/outbox_pattern.png?imwidth=3840" alt="Flow diagram explaining how the Outbox Pattern works." tabindex="0" loading="lazy"><figcaption>Flow diagram explaining how the Outbox Pattern works.</figcaption></figure><p>The sequence diagram illustrates how the Outbox pattern solves our consistency challenge. Instead of trying to save data and send a message as separate steps, we save both the order and an Outbox message in a <strong>single database transaction</strong>. This is an all-or-nothing operation - we can&#39;t end up in an inconsistent state.</p><p>A separate Outbox processor handles the actual message sending. It continuously checks for unsent messages in the Outbox table and publishes them to the message queue. The processor marks messages as sent after successful publishing, preventing duplicates.</p><p>An important thing to realize here is that the Outbox pattern gives us <a href="https://cloudcomputingpatterns.org/at_least_once_delivery/" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>at-least-once delivery</a>. The Outbox message will be sent at least once, but it could also be sent multiple times in case of retries. This means we have to make our message consumers idempotent.</p><hr><h2 id="implementing-the-outbox-pattern" tabindex="-1"><a class="header-anchor" href="#implementing-the-outbox-pattern"><span>Implementing the Outbox Pattern</span></a></h2><p>First, let&#39;s create our Outbox table where we will store messages:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> outbox_messages <span class="token punctuation">(</span></span>
<span class="line">    id UUID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">type</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    content JSONB <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    occurred_on_utc <span class="token keyword">TIMESTAMP</span> <span class="token keyword">WITH</span> <span class="token keyword">TIME</span> ZONE <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    processed_on_utc <span class="token keyword">TIMESTAMP</span> <span class="token keyword">WITH</span> <span class="token keyword">TIME</span> ZONE <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    error <span class="token keyword">TEXT</span> <span class="token boolean">NULL</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- We can consider adding this index since we will be querying for unprocessed messages often</span></span>
<span class="line"><span class="token comment">-- and it will contain the rows in the correct sort order for our query.</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> idx_outbox_messages_unprocessed</span>
<span class="line"><span class="token keyword">ON</span> outbox_messages <span class="token punctuation">(</span>occurred_on_utc<span class="token punctuation">,</span> processed_on_utc<span class="token punctuation">)</span></span>
<span class="line">INCLUDE <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">WHERE</span> processed_on_utc <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I&#39;ll use PostgreSQL as the database for this example. Notice the <code>jsonb</code> type for the <code>content</code> column. It allows for indexing and querying of the JSON data if needed in the future.</p><p>Now, let&#39;s create a class to represent our Outbox entry:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="OutboxMessage.cs"><span>OutboxMessage.cs</span></div><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">OutboxMessage</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Type <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Content <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> OccurredOnUtc <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> ProcessedOnUtc <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Error <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Here&#39;s how we can add a message to the Outbox:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="AddToOutbox.cs"><span>AddToOutbox.cs</span></div><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">AddToOutbox</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> message<span class="token punctuation">,</span> <span class="token class-name">NpgsqlDataSource</span> dataSource<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name"><span class="token keyword">var</span></span> outboxMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OutboxMessage</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        OccurredOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span></span>
<span class="line">        Type <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> <span class="token comment">// We&#39;ll need this for deserialization</span></span>
<span class="line">        Content <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> <span class="token keyword">await</span> dataSource<span class="token punctuation">.</span><span class="token function">OpenConnectionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token string">@&quot;&quot;&quot;</span>
<span class="line">        INSERT INTO outbox_messages (id, occurred_on_utc, type, content)</span>
<span class="line">        VALUES (@Id, @OccurredOnUtc, @Type, @Content::jsonb)</span>
<span class="line">        &quot;&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        outboxMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>An elegant approach to implementing this is using <a class="route-link" href="/bookshelf/milanjovanovic.tech/how-to-use-domain-events-to-build-loosely-coupled-systems.html">domain events</a> to represent notifications. When something significant happens in the domain, we will raise a domain event. Before completing the transaction, we can pick up all events and store them as Outbox messages. You could do this from the unit of work or with an <a class="route-link" href="/bookshelf/milanjovanovic.tech/how-to-use-ef-core-interceptors.html">EF Core interceptor</a>.</p><hr><h2 id="processing-the-outbox" tabindex="-1"><a class="header-anchor" href="#processing-the-outbox"><span>Processing the Outbox</span></a></h2><p>The Outbox processor is the next component we&#39;ll need. This could be a <em>physically</em> separate process or a background worker in the same process.</p><p>I&#39;ll use Quartz to <a class="route-link" href="/bookshelf/milanjovanovic.tech/scheduling-background-jobs-with-quartz-net.html">schedule background jobs</a> for Outbox processing. It&#39;s a robust library with excellent support for scheduling recurring jobs.</p><p>Now, let&#39;s implement the <code>OutboxProcessorJob</code>:</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="OutboxProcessorJob.cs"><span>OutboxProcessorJob.cs</span></div><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DisallowConcurrentExecution</span></span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutboxProcessorJob</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">NpgsqlDataSource</span> dataSource<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">IPublishEndpoint</span> publishEndpoint<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">Assembly</span> integrationEventsAssembly<span class="token punctuation">)</span> <span class="token punctuation">:</span> IJob</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name">IJobExecutionContext</span> context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> <span class="token keyword">await</span> dataSource<span class="token punctuation">.</span><span class="token function">OpenConnectionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> transaction <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">BeginTransactionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// You can make the limit a parameter, to control the batch size.</span></span>
<span class="line">        <span class="token comment">// We can also select just the id, type, and content columns.</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> messages <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">QueryAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OutboxMessage<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">@&quot;&quot;&quot;</span>
<span class="line">            SELECT id AS Id, type AS Type, content AS Content</span>
<span class="line">            FROM outbox_messages</span>
<span class="line">            WHERE processed_on_utc IS NULL</span>
<span class="line">            ORDER BY occurred_on_utc LIMIT 100</span>
<span class="line">            &quot;&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token named-parameter punctuation">transaction</span><span class="token punctuation">:</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> message <span class="token keyword">in</span> messages<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name"><span class="token keyword">var</span></span> messageType <span class="token operator">=</span> integrationEventsAssembly<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name"><span class="token keyword">var</span></span> deserializedMessage <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">Deserialize</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>Content<span class="token punctuation">,</span> messageType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// We should introduce retries here to improve reliability.</span></span>
<span class="line">                <span class="token keyword">await</span> publishEndpoint<span class="token punctuation">.</span><span class="token function">Publish</span><span class="token punctuation">(</span>deserializedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token string">@&quot;&quot;&quot;</span>
<span class="line">                    UPDATE outbox_messages</span>
<span class="line">                    SET processed_on_utc = @ProcessedOnUtc</span>
<span class="line">                    WHERE id = @Id</span>
<span class="line">                    &quot;&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token keyword">new</span> <span class="token punctuation">{</span> ProcessedOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span> message<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token named-parameter punctuation">transaction</span><span class="token punctuation">:</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// We can also introduce error logging here.</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token string">@&quot;&quot;&quot;</span>
<span class="line">                    UPDATE outbox_messages</span>
<span class="line">                    SET processed_on_utc = @ProcessedOnUtc, error = @Error</span>
<span class="line">                    WHERE id = @Id</span>
<span class="line">                    &quot;&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token keyword">new</span> <span class="token punctuation">{</span> ProcessedOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span> Error <span class="token operator">=</span> ex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token named-parameter punctuation">transaction</span><span class="token punctuation">:</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">await</span> transaction<span class="token punctuation">.</span><span class="token function">CommitAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This approach uses polling to periodically fetch unprocessed messages from the database. Polling can increase the load on the database, as we&#39;ll need to query for unprocessed messages frequently.</p><p>An alternative way to process Outbox messages is by using <a href="https://microservices.io/patterns/data/transaction-log-tailing.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Transaction log tailing</a>. We can implement this using <a href="https://npgsql.org/doc/replication.html" target="_blank" rel="noopener noreferrer"><i class="vp-icon fas fa-globe" sizing="height"></i>Postgres logical replication</a>. The database will stream changes from the Write-Ahead Log (WAL) to our application, and we&#39;ll process these messages and publish them to the message broker. You can use this to implement a push-based Outbox processor.</p><hr><h2 id="considerations-and-tradeoffs" tabindex="-1"><a class="header-anchor" href="#considerations-and-tradeoffs"><span>Considerations and Tradeoffs</span></a></h2><p>The Outbox pattern, while effective, introduces additional complexity and database writes. In high-throughput systems, it&#39;s crucial to monitor its performance to ensure it doesn&#39;t become a bottleneck.</p><p>I recommend implementing retry mechanisms in the Outbox processor to <a class="route-link" href="/bookshelf/milanjovanovic.tech/building-resilient-cloud-applications-with-dotnet.html">improve reliability</a>. Consider using exponential backoff for transient failures and a circuit breaker for persistent issues to prevent system overload during outages.</p><p>It&#39;s essential that you implement <a class="route-link" href="/bookshelf/milanjovanovic.tech/idempotent-consumer-handling-duplicate-messages.html">idempotent message consumers</a>. Network issues or processor restarts can lead to multiple deliveries of the same message, so your consumers must handle repeated processing safely.</p><p>Over time, the Outbox table can grow significantly, potentially impacting database performance. It&#39;s important to implement an archiving strategy early on. Consider moving processed messages to cold storage or deleting them after a set period.</p><hr><h2 id="scaling-outbox-processing" tabindex="-1"><a class="header-anchor" href="#scaling-outbox-processing"><span>Scaling Outbox Processing</span></a></h2><p>As your system grows, you may find that a single Outbox processor can&#39;t keep up with the volume of messages. This can lead to increased latency between when an event occurs and when it&#39;s processed by consumers.</p><p>One straightforward approach is to increase the frequency of the Outbox processor job. You should consider running it every few seconds. This can significantly reduce the delay in message processing.</p><p>Another effective strategy is to increase the batch size when fetching unprocessed messages. By processing more messages in each run, you can improve throughput. However, be cautious not to make the batches so large that they cause long-running transactions.</p><p>For high-volume systems, processing the Outbox in parallel can be very effective. Implement a locking mechanism to claim batches of messages, allowing multiple processors to work simultaneously without conflict. You can use <code>SELECT ... FOR UPDATE SKIP LOCKED</code> to claim a batch of messages. This approach can dramatically increase your processing capacity.</p><hr><h2 id="wrapping-up" tabindex="-1"><a class="header-anchor" href="#wrapping-up"><span>Wrapping Up</span></a></h2><p>The Outbox pattern is a powerful tool for maintaining data consistency in distributed systems. By decoupling database operations from message publishing, the Outbox pattern ensures that your system remains reliable even in the face of failures.</p><p>Remember to keep your consumers idempotent, implement proper scaling strategies, and manage your Outbox table growth.</p><p>While it adds some complexity, the benefits of guaranteed message delivery make it a valuable pattern in many scenarios.</p><p>If you&#39;re looking to implement the Outbox pattern in a robust, production-ready way, you can check out <a class="route-link" href="/bookshelf/milanjovanovic.tech/pragmatic-clean-architecture/">Pragmatic Clean Architecture</a>. It includes an entire section on implementing the Outbox pattern, along with other essential patterns for building maintainable and scalable .NET applications.</p><p>That&#39;s all for today. Stay awesome, and I&#39;ll see you next week.</p><hr><!-- TODO: add ARTICLE CARD --><a class="vp-card" href="https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-the-outbox-pattern.html" target="_blank" style="background:rgba(79,70,229,0.2);"><img class="vp-card-logo" src="https://milanjovanovic.tech/profile_favicon.png" loading="lazy" no-view><div class="vp-card-content"><div class="vp-card-title">Implementing the Outbox Pattern</div><hr><div class="vp-card-desc">Discover how the Outbox pattern solves the dual-write problem in distributed systems, ensuring data consistency between your database and external components. This article provides practical strategies for implementing and scaling the Outbox pattern in .NET applications.</div></div></a></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chanhi2000/articles/edit/main/src/milanjovanovic.tech/implementing-the-outbox-pattern.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/bookshelf/programming/cs/articles/" aria-label="/programming/cs/articles/"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->/programming/cs/articles/</div></a><a class="route-link auto-link next" href="/bookshelf/milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html" aria-label="Breaking It Down: How to Migrate Your Modular Monolith to Microservices"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Breaking It Down: How to Migrate Your Modular Monolith to Microservices<i class="vp-icon iconfont icon-csharp" sizing="height"></i></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">MIT Licensed | Copyright © 2022-present <a href="https://github.com/chanhi2000">Chan Hee Lee</a></div><div class="vp-copyright">Copyright © 2025 Milan Jovanović </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/bookshelf/assets/app-BVguHYKu.js" defer></script>
  </body>
</html>
